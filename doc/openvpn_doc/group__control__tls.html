<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OpenVPN: Control_tls</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OpenVPN
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">Control_tls</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Control_tls:</div>
<div class="dyncontent">
<div class="center"><img src="group__control__tls.png" border="0" usemap="#group____control____tls" alt=""/></div>
<map name="group____control____tls" id="group____control____tls">
<area shape="rect" href="group__tls__crypt.html" title=" " alt="" coords="139,5,316,60"/>
<area shape="rect" title=" " alt="" coords="5,20,91,45"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__tls__crypt"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tls__crypt.html">Control channel encryption (&amp;ndash;tls-crypt, &amp;ndash;tls-crypt-v2)</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="member-group"></a>
Functions for packets to be sent to a remote OpenVPN peer</h2></td></tr>
<tr class="memitem:gaa5438c5f4b03dafec41e663a3e5734d0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__control__tls.html#gaa5438c5f4b03dafec41e663a3e5734d0">key_state_write_plaintext</a> (struct <a class="el" href="structkey__state__ssl.html">key_state_ssl</a> *ks_ssl, struct <a class="el" href="structbuffer.html">buffer</a> *buf)</td></tr>
<tr class="memdesc:gaa5438c5f4b03dafec41e663a3e5734d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Insert a plaintext buffer into the TLS module.  <a href="group__control__tls.html#gaa5438c5f4b03dafec41e663a3e5734d0">More...</a><br /></td></tr>
<tr class="separator:gaa5438c5f4b03dafec41e663a3e5734d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga67dac3b75328d8b92d3f1a69e86dacdc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__control__tls.html#ga67dac3b75328d8b92d3f1a69e86dacdc">key_state_write_plaintext_const</a> (struct <a class="el" href="structkey__state__ssl.html">key_state_ssl</a> *ks_ssl, const <a class="el" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *data, int len)</td></tr>
<tr class="memdesc:ga67dac3b75328d8b92d3f1a69e86dacdc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Insert plaintext data into the TLS module.  <a href="group__control__tls.html#ga67dac3b75328d8b92d3f1a69e86dacdc">More...</a><br /></td></tr>
<tr class="separator:ga67dac3b75328d8b92d3f1a69e86dacdc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7260a351c5bb3bf22628278e09f2f7b3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__control__tls.html#ga7260a351c5bb3bf22628278e09f2f7b3">key_state_read_ciphertext</a> (struct <a class="el" href="structkey__state__ssl.html">key_state_ssl</a> *ks_ssl, struct <a class="el" href="structbuffer.html">buffer</a> *buf, int maxlen)</td></tr>
<tr class="memdesc:ga7260a351c5bb3bf22628278e09f2f7b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Extract ciphertext data from the TLS module.  <a href="group__control__tls.html#ga7260a351c5bb3bf22628278e09f2f7b3">More...</a><br /></td></tr>
<tr class="separator:ga7260a351c5bb3bf22628278e09f2f7b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="member-group"></a>
Functions for packets received from a remote OpenVPN peer</h2></td></tr>
<tr class="memitem:ga5712e1bfbeafff1041a99b57cf4a91f4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__control__tls.html#ga5712e1bfbeafff1041a99b57cf4a91f4">key_state_write_ciphertext</a> (struct <a class="el" href="structkey__state__ssl.html">key_state_ssl</a> *ks_ssl, struct <a class="el" href="structbuffer.html">buffer</a> *buf)</td></tr>
<tr class="memdesc:ga5712e1bfbeafff1041a99b57cf4a91f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Insert a ciphertext buffer into the TLS module.  <a href="group__control__tls.html#ga5712e1bfbeafff1041a99b57cf4a91f4">More...</a><br /></td></tr>
<tr class="separator:ga5712e1bfbeafff1041a99b57cf4a91f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae5597992eeb64d1be998be0ccf98bf97"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__control__tls.html#gae5597992eeb64d1be998be0ccf98bf97">key_state_read_plaintext</a> (struct <a class="el" href="structkey__state__ssl.html">key_state_ssl</a> *ks_ssl, struct <a class="el" href="structbuffer.html">buffer</a> *buf, int maxlen)</td></tr>
<tr class="memdesc:gae5597992eeb64d1be998be0ccf98bf97"><td class="mdescLeft">&#160;</td><td class="mdescRight">Extract plaintext data from the TLS module.  <a href="group__control__tls.html#gae5597992eeb64d1be998be0ccf98bf97">More...</a><br /></td></tr>
<tr class="separator:gae5597992eeb64d1be998be0ccf98bf97"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="member-group"></a>
Function for authenticating a new connection from a remote OpenVPN peer</h2></td></tr>
<tr class="memitem:gadeac70d67a80b44a96cbde2368dd5f3c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__control__tls.html#gadeac70d67a80b44a96cbde2368dd5f3c">verify_callback</a> (void *session_obj, mbedtls_x509_crt *cert, int cert_depth, <a class="el" href="config-msvc_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> *flags)</td></tr>
<tr class="memdesc:gadeac70d67a80b44a96cbde2368dd5f3c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verify that the remote OpenVPN peer's certificate allows setting up a VPN tunnel.  <a href="group__control__tls.html#gadeac70d67a80b44a96cbde2368dd5f3c">More...</a><br /></td></tr>
<tr class="separator:gadeac70d67a80b44a96cbde2368dd5f3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="member-group"></a>
Function for authenticating a new connection from a remote OpenVPN peer</h2></td></tr>
<tr class="memitem:gaf045c97f727aebae9e8fc9852421c4f3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__control__tls.html#gaf045c97f727aebae9e8fc9852421c4f3">verify_callback</a> (int preverify_ok, X509_STORE_CTX *ctx)</td></tr>
<tr class="memdesc:gaf045c97f727aebae9e8fc9852421c4f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verify that the remote OpenVPN peer's certificate allows setting up a VPN tunnel.  <a href="group__control__tls.html#gaf045c97f727aebae9e8fc9852421c4f3">More...</a><br /></td></tr>
<tr class="separator:gaf045c97f727aebae9e8fc9852421c4f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga7260a351c5bb3bf22628278e09f2f7b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7260a351c5bb3bf22628278e09f2f7b3">&#9670;&nbsp;</a></span>key_state_read_ciphertext()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int key_state_read_ciphertext </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structkey__state__ssl.html">key_state_ssl</a> *&#160;</td>
          <td class="paramname"><em>ks_ssl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxlen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Extract ciphertext data from the TLS module. </p>
<p>If the <em>buf</em> buffer has a length other than zero, this function does not perform any action and returns 0.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ks_ssl</td><td>- The security parameter state for this key session. </td></tr>
    <tr><td class="paramname">buf</td><td>- A buffer in which to store the ciphertext. </td></tr>
    <tr><td class="paramname">maxlen</td><td>- The maximum number of bytes to extract.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The return value indicates whether the data was successfully processed:<ul>
<li><code>1</code>: Data was extracted successfully.</li>
<li><code>0</code>: No data was extracted, this function should be called again later to retry.</li>
<li><code>-1</code>: An error occurred. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ssl__openssl_8c_source.html#l02073">2073</a> of file <a class="el" href="ssl__openssl_8c_source.html">ssl_openssl.c</a>.</p>

<p class="reference">References <a class="el" href="openvpn_2error_8h_source.html#l00218">ASSERT</a>, <a class="el" href="ssl__openssl_8c_source.html#l01902">bio_read()</a>, <a class="el" href="ssl__openssl_8h_source.html#l00048">key_state_ssl::ct_out</a>, <a class="el" href="perf_8h_source.html#l00040">PERF_BIO_READ_CIPHERTEXT</a>, <a class="el" href="perf_8h_source.html#l00082">perf_pop()</a>, and <a class="el" href="perf_8h_source.html#l00078">perf_push()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ssl_8c_source.html#l02649">tls_process()</a>.</p>

</div>
</div>
<a id="gae5597992eeb64d1be998be0ccf98bf97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae5597992eeb64d1be998be0ccf98bf97">&#9670;&nbsp;</a></span>key_state_read_plaintext()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int key_state_read_plaintext </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structkey__state__ssl.html">key_state_ssl</a> *&#160;</td>
          <td class="paramname"><em>ks_ssl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxlen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Extract plaintext data from the TLS module. </p>
<p>If the <em>buf</em> buffer has a length other than zero, this function does not perform any action and returns 0.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ks_ssl</td><td>- The security parameter state for this key session. </td></tr>
    <tr><td class="paramname">buf</td><td>- A buffer in which to store the plaintext. </td></tr>
    <tr><td class="paramname">maxlen</td><td>- The maximum number of bytes to extract.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The return value indicates whether the data was successfully processed:<ul>
<li><code>1</code>: Data was extracted successfully.</li>
<li><code>0</code>: No data was extracted, this function should be called again later to retry.</li>
<li><code>-1</code>: An error occurred. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ssl__openssl_8c_source.html#l02103">2103</a> of file <a class="el" href="ssl__openssl_8c_source.html">ssl_openssl.c</a>.</p>

<p class="reference">References <a class="el" href="openvpn_2error_8h_source.html#l00218">ASSERT</a>, <a class="el" href="ssl__openssl_8c_source.html#l01902">bio_read()</a>, <a class="el" href="perf_8h_source.html#l00038">PERF_BIO_READ_PLAINTEXT</a>, <a class="el" href="perf_8h_source.html#l00082">perf_pop()</a>, <a class="el" href="perf_8h_source.html#l00078">perf_push()</a>, and <a class="el" href="ssl__openssl_8h_source.html#l00046">key_state_ssl::ssl_bio</a>.</p>

<p class="reference">Referenced by <a class="el" href="ssl_8c_source.html#l02649">tls_process()</a>.</p>

</div>
</div>
<a id="ga5712e1bfbeafff1041a99b57cf4a91f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5712e1bfbeafff1041a99b57cf4a91f4">&#9670;&nbsp;</a></span>key_state_write_ciphertext()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int key_state_write_ciphertext </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structkey__state__ssl.html">key_state_ssl</a> *&#160;</td>
          <td class="paramname"><em>ks_ssl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Insert a ciphertext buffer into the TLS module. </p>
<p>After successfully processing the data, the data in <em>buf</em> is zeroized, its length set to zero, and a value of <code>1</code> is returned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ks_ssl</td><td>- The security parameter state for this key session. </td></tr>
    <tr><td class="paramname">buf</td><td>- The ciphertext message to process.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The return value indicates whether the data was successfully processed:<ul>
<li><code>1</code>: All the data was processed successfully.</li>
<li><code>0</code>: The data was not processed, this function should be called again later to retry.</li>
<li><code>-1</code>: An error occurred. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ssl__openssl_8c_source.html#l02088">2088</a> of file <a class="el" href="ssl__openssl_8c_source.html">ssl_openssl.c</a>.</p>

<p class="reference">References <a class="el" href="openvpn_2error_8h_source.html#l00218">ASSERT</a>, <a class="el" href="ssl__openssl_8c_source.html#l01829">bio_write()</a>, <a class="el" href="ssl__openssl_8c_source.html#l01889">bio_write_post()</a>, <a class="el" href="buffer_8h_source.html#l00127">BLEN</a>, <a class="el" href="buffer_8h_source.html#l00124">BPTR</a>, <a class="el" href="ssl__openssl_8h_source.html#l00047">key_state_ssl::ct_in</a>, <a class="el" href="perf_8h_source.html#l00041">PERF_BIO_WRITE_CIPHERTEXT</a>, <a class="el" href="perf_8h_source.html#l00082">perf_pop()</a>, and <a class="el" href="perf_8h_source.html#l00078">perf_push()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ssl_8c_source.html#l02649">tls_process()</a>.</p>

</div>
</div>
<a id="gaa5438c5f4b03dafec41e663a3e5734d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa5438c5f4b03dafec41e663a3e5734d0">&#9670;&nbsp;</a></span>key_state_write_plaintext()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int key_state_write_plaintext </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structkey__state__ssl.html">key_state_ssl</a> *&#160;</td>
          <td class="paramname"><em>ks_ssl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Insert a plaintext buffer into the TLS module. </p>
<p>After successfully processing the data, the data in <em>buf</em> is zeroized, its length set to zero, and a value of <code>1</code> is returned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ks_ssl</td><td>- The security parameter state for this key session. </td></tr>
    <tr><td class="paramname">buf</td><td>- The plaintext message to process.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The return value indicates whether the data was successfully processed:<ul>
<li><code>1</code>: All the data was processed successfully.</li>
<li><code>0</code>: The data was not processed, this function should be called again later to retry.</li>
<li><code>-1</code>: An error occurred. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ssl__openssl_8c_source.html#l02041">2041</a> of file <a class="el" href="ssl__openssl_8c_source.html">ssl_openssl.c</a>.</p>

<p class="reference">References <a class="el" href="openvpn_2error_8h_source.html#l00218">ASSERT</a>, <a class="el" href="ssl__openssl_8c_source.html#l01829">bio_write()</a>, <a class="el" href="ssl__openssl_8c_source.html#l01889">bio_write_post()</a>, <a class="el" href="buffer_8h_source.html#l00127">BLEN</a>, <a class="el" href="buffer_8h_source.html#l00124">BPTR</a>, <a class="el" href="perf_8h_source.html#l00039">PERF_BIO_WRITE_PLAINTEXT</a>, <a class="el" href="perf_8h_source.html#l00082">perf_pop()</a>, <a class="el" href="perf_8h_source.html#l00078">perf_push()</a>, and <a class="el" href="ssl__openssl_8h_source.html#l00046">key_state_ssl::ssl_bio</a>.</p>

<p class="reference">Referenced by <a class="el" href="ssl_8c_source.html#l02649">tls_process()</a>.</p>

</div>
</div>
<a id="ga67dac3b75328d8b92d3f1a69e86dacdc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga67dac3b75328d8b92d3f1a69e86dacdc">&#9670;&nbsp;</a></span>key_state_write_plaintext_const()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int key_state_write_plaintext_const </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structkey__state__ssl.html">key_state_ssl</a> *&#160;</td>
          <td class="paramname"><em>ks_ssl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Insert plaintext data into the TLS module. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ks_ssl</td><td>- The security parameter state for this key session. </td></tr>
    <tr><td class="paramname">data</td><td>- A pointer to the data to process. </td></tr>
    <tr><td class="paramname">len</td><td>- The length in bytes of the data to process.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The return value indicates whether the data was successfully processed:<ul>
<li><code>1</code>: All the data was processed successfully.</li>
<li><code>0</code>: The data was not processed, this function should be called again later to retry.</li>
<li><code>-1</code>: An error occurred. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ssl__openssl_8c_source.html#l02059">2059</a> of file <a class="el" href="ssl__openssl_8c_source.html">ssl_openssl.c</a>.</p>

<p class="reference">References <a class="el" href="openvpn_2error_8h_source.html#l00218">ASSERT</a>, <a class="el" href="ssl__openssl_8c_source.html#l01829">bio_write()</a>, <a class="el" href="buffer_8h_source.html#l00068">buffer::data</a>, <a class="el" href="buffer_8h_source.html#l00066">buffer::len</a>, <a class="el" href="perf_8h_source.html#l00039">PERF_BIO_WRITE_PLAINTEXT</a>, <a class="el" href="perf_8h_source.html#l00082">perf_pop()</a>, <a class="el" href="perf_8h_source.html#l00078">perf_push()</a>, and <a class="el" href="ssl__openssl_8h_source.html#l00046">key_state_ssl::ssl_bio</a>.</p>

<p class="reference">Referenced by <a class="el" href="ssl_8c_source.html#l02109">flush_payload_buffer()</a>, and <a class="el" href="ssl_8c_source.html#l03901">tls_send_payload()</a>.</p>

</div>
</div>
<a id="gaf045c97f727aebae9e8fc9852421c4f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf045c97f727aebae9e8fc9852421c4f3">&#9670;&nbsp;</a></span>verify_callback() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int verify_callback </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>preverify_ok</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">X509_STORE_CTX *&#160;</td>
          <td class="paramname"><em>ctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Verify that the remote OpenVPN peer's certificate allows setting up a VPN tunnel. </p>
<p>This callback function is called every time a new TLS session is being setup to determine whether the remote OpenVPN peer's certificate is allowed to connect. It is called for once for every certificate in the chain. The callback functionality is configured in the <code><a class="el" href="ssl_8c.html#a8ead42ff42559ea4d44fb4cf600a26f1" title="Build master SSL context object that serves for the whole of OpenVPN instantiation.">init_ssl()</a></code> function, which calls the OpenSSL library's <code>SSL_CTX_set_verify()</code> function with <code><a class="el" href="group__control__tls.html#gaf045c97f727aebae9e8fc9852421c4f3" title="Verify that the remote OpenVPN peer&#39;s certificate allows setting up a VPN tunnel.">verify_callback()</a></code> as its callback argument.</p>
<p>It checks preverify_ok, and registers the certificate hash. If these steps succeed, it calls the <code><a class="el" href="ssl__verify_8c.html#a8574f9402b712d3051d9febde91cf220">verify_cert()</a></code> function, which performs OpenVPN-specific verification.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">preverify_ok</td><td>- Whether the remote OpenVPN peer's certificate past verification. A value of 1 means it verified successfully, 0 means it failed. </td></tr>
    <tr><td class="paramname">ctx</td><td>- The complete context used by the OpenSSL library to verify the certificate chain.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The return value indicates whether the supplied certificate is allowed to set up a VPN tunnel. The following values can be returned:<ul>
<li><code>0</code>: failure, this certificate is not allowed to connect.</li>
<li><code>1</code>: success, this certificate is allowed to connect. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ssl__verify__openssl_8c_source.html#l00052">52</a> of file <a class="el" href="ssl__verify__openssl_8c_source.html">ssl_verify_openssl.c</a>.</p>

<p class="reference">References <a class="el" href="openvpn_2error_8h_source.html#l00218">ASSERT</a>, <a class="el" href="ssl__verify__openssl_8c_source.html#l00284">backend_x509_get_serial()</a>, <a class="el" href="ssl__verify_8c_source.html#l00215">cert_hash_remember()</a>, <a class="el" href="errlevel_8h_source.html#l00077">D_TLS_DEBUG_LOW</a>, <a class="el" href="errlevel_8h_source.html#l00059">D_TLS_ERRORS</a>, <a class="el" href="buffer_8h_source.html#l01032">gc_free()</a>, <a class="el" href="buffer_8h_source.html#l01024">gc_new()</a>, <a class="el" href="openvpn_2error_8h_source.html#l00170">msg</a>, <a class="el" href="ssl__openssl_8c_source.html#l00080">mydata_index</a>, <a class="el" href="ssl__verify__backend_8h_source.html#l00035">SUCCESS</a>, <a class="el" href="ssl__verify_8c_source.html#l00646">verify_cert()</a>, <a class="el" href="ssl__verify__openssl_8c_source.html#l00321">x509_get_sha256_fingerprint()</a>, and <a class="el" href="ssl__verify__openssl_8c_source.html#l00331">x509_get_subject()</a>.</p>

</div>
</div>
<a id="gadeac70d67a80b44a96cbde2368dd5f3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadeac70d67a80b44a96cbde2368dd5f3c">&#9670;&nbsp;</a></span>verify_callback() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int verify_callback </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>session_obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mbedtls_x509_crt *&#160;</td>
          <td class="paramname"><em>cert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cert_depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="config-msvc_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> *&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Verify that the remote OpenVPN peer's certificate allows setting up a VPN tunnel. </p>
<p>This callback function is called when a new TLS session is being setup to determine whether the remote OpenVPN peer's certificate is allowed to connect. It is called for once for every certificate in the chain. The callback functionality is configured in the <code><a class="el" href="ssl__backend_8h.html#a8afed7d8591df5b99475f4503031bb89" title="Initialise the SSL channel part of the given key state.">key_state_ssl_init()</a></code> function, which calls the mbed TLS library's <code>mbedtls_ssl_conf_verify()</code> function with <code><a class="el" href="group__control__tls.html#gadeac70d67a80b44a96cbde2368dd5f3c" title="Verify that the remote OpenVPN peer&#39;s certificate allows setting up a VPN tunnel.">verify_callback()</a></code> as its callback argument.</p>
<p>It checks *flags and registers the certificate hash. If these steps succeed, it calls the <code><a class="el" href="ssl__verify_8c.html#a8574f9402b712d3051d9febde91cf220">verify_cert()</a></code> function, which performs OpenVPN-specific verification.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">session_obj</td><td>- The OpenVPN <code><a class="el" href="structtls__session.html" title="Security parameter state of a single session within a VPN tunnel.">tls_session</a></code> associated with this object, as set during SSL session setup. </td></tr>
    <tr><td class="paramname">cert</td><td>- The certificate used by mbed TLS. </td></tr>
    <tr><td class="paramname">cert_depth</td><td>- The depth of the current certificate in the chain, with 0 being the actual certificate. </td></tr>
    <tr><td class="paramname">flags</td><td>- Whether the remote OpenVPN peer's certificate passed verification. A value of 0 means it verified successfully, any other value means it failed. <code><a class="el" href="group__control__tls.html#gadeac70d67a80b44a96cbde2368dd5f3c" title="Verify that the remote OpenVPN peer&#39;s certificate allows setting up a VPN tunnel.">verify_callback()</a></code> is considered to have ok'ed this certificate if flags is 0 when it returns.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The return value is 0 unless a fatal error occurred. </dd></dl>

<p class="reference">Referenced by <a class="el" href="ssl__openssl_8c_source.html#l00352">tls_ctx_set_options()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
