<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OpenVPN: src/openvpn/tun.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OpenVPN
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_92f13d409beef24f5ba1b81abfed1f1c.html">openvpn</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">tun.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="tun_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *  OpenVPN -- An application to securely tunnel IP networks</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *             over a single TCP/UDP port, with support for SSL/TLS-based</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *             session authentication and key exchange,</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *             packet encryption, packet authentication, and</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *             packet compression.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *  Copyright (C) 2002-2022 OpenVPN Inc &lt;sales@openvpn.net&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *  This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *  it under the terms of the GNU General Public License version 2</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *  as published by the Free Software Foundation.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *  This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *  GNU General Public License for more details.</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> *  You should have received a copy of the GNU General Public License along</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *  with this program; if not, write to the Free Software Foundation, Inc.,</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> *  51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * Support routines for configuring and accessing TUN/TAP</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * virtual network adapters.</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * This file is based on the TUN/TAP driver interface routines</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * from VTun by Maxim Krasnyansky &lt;max_mk@yahoo.com&gt;.</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#ifdef HAVE_CONFIG_H</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="config_8h.html">config.h</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#elif defined(_MSC_VER)</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="config-msvc_8h.html">config-msvc.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="syshead_8h.html">syshead.h</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="tun_8h.html">tun.h</a>&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="fdmisc_8h.html">fdmisc.h</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="common_8h.html">common.h</a>&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="run__command_8h.html">run_command.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="socket_8h.html">socket.h</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="manage_8h.html">manage.h</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="route_8h.html">route.h</a>&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="win32_8h.html">win32.h</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="block__dns_8h.html">block_dns.h</a>&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="networking_8h.html">networking.h</a>&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="memdbg_8h.html">memdbg.h</a>&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="openvpn-msg_8h.html">openvpn-msg.h</a>&quot;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160; </div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="tun_8c.html#a186d3bab6f7316394df0fb85f079f8bf">   61</a></span>&#160;<span class="keyword">const</span> <span class="keyword">static</span> GUID <a class="code" href="tun_8c.html#a186d3bab6f7316394df0fb85f079f8bf">GUID_DEVCLASS_NET</a> = { 0x4d36e972L, 0xe325, 0x11ce, { 0xbf, 0xc1, 0x08, 0x00, 0x2b, 0xe1, 0x03, 0x18 } };</div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="tun_8c.html#a1d5d5169074921cd8315ae3b537d003d">   62</a></span>&#160;<span class="keyword">const</span> <span class="keyword">static</span> GUID <a class="code" href="tun_8c.html#a1d5d5169074921cd8315ae3b537d003d">GUID_DEVINTERFACE_NET</a> = { 0xcac88484, 0x7515, 0x4c03, { 0x82, 0xe6, 0x71, 0xa8, 0x7a, 0xba, 0xc3, 0x61 } };</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">/* #define SIMULATE_DHCP_FAILED */</span>       <span class="comment">/* simulate bad DHCP negotiation */</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="tun_8c.html#a293109fe0e2259e2e4f18f7fa85f498d">   66</a></span>&#160;<span class="preprocessor">#define NI_TEST_FIRST  (1&lt;&lt;0)</span></div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="tun_8c.html#ae4ca7b1df4a85e25a8638afedb54b6dd">   67</a></span>&#160;<span class="preprocessor">#define NI_IP_NETMASK  (1&lt;&lt;1)</span></div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="tun_8c.html#a732f35a455d3cc46d0dd3d6b94239b87">   68</a></span>&#160;<span class="preprocessor">#define NI_OPTIONS     (1&lt;&lt;2)</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="tun_8c.html#a4636ecf580e72087b1cd63dcc1375ec9">netsh_ifconfig</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap__options.html">tuntap_options</a> *to,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                           DWORD adapter_index,</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                           <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> ip,</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                           <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> netmask,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flags);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="tun_8c.html#ade2f6913cf1b1b4b6d342140d1db9f97">windows_set_mtu</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> iface_index,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                            <span class="keyword">const</span> <span class="keywordtype">short</span> family,</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                            <span class="keyword">const</span> <span class="keywordtype">int</span> mtu);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="tun_8c.html#aee87d985f2ee8faa65c3716def4b9b8c">netsh_set_dns6_servers</a>(<span class="keyword">const</span> <span class="keyword">struct</span> in6_addr *addr_list,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                                   <span class="keyword">const</span> <span class="keywordtype">int</span> addr_len,</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                                   DWORD adapter_index);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="tun_8c.html#ac0b5e1af8dfaa627162520fbc1ae5080">netsh_command</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structargv.html">argv</a> *a, <span class="keywordtype">int</span> <a class="code" href="structkey2.html#a325d016ea0977d9569d3d75fd4e7fe06">n</a>, <span class="keywordtype">int</span> msglevel);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="tun_8c.html#a1394acf0970ce11c08bba13dee682131">netsh_get_id</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node, <span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keyword">static</span> DWORD <a class="code" href="tun_8c.html#a34a5aea74b2f0d2c67da91b78de830b9">get_adapter_index_flexible</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="tun_8c.html#a11011674316342ddaaad3f76739d78e3">   91</a></span>&#160;<a class="code" href="tun_8c.html#a11011674316342ddaaad3f76739d78e3">do_address_service</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span> add, <span class="keyword">const</span> <span class="keywordtype">short</span> family, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;{</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="structack__message__t.html">ack_message_t</a> ack;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    HANDLE pipe = tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">msg_channel</a>;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <a class="code" href="structaddress__message__t.html">address_message_t</a> addr = {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        .<a class="code" href="structaddress__message__t.html#a79342a9292a5e1568fa4f036d4bdf1b5">header</a> = {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            (add ? <a class="code" href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557ca12066b3ff846ce137d1ffc0ed01d2b0a">msg_add_address</a> : <a class="code" href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557ca0224a09323cb8e271064d8a586882184">msg_del_address</a>),</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            <span class="keyword">sizeof</span>(<a class="code" href="structaddress__message__t.html">address_message_t</a>),</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            0</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        },</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        .family = family,</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        .iface = { .index = tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>, .name = <span class="stringliteral">&quot;&quot;</span> }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    };</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">if</span> (addr.<a class="code" href="structaddress__message__t.html#afd2925f26e189670d192d5709d148d7b">iface</a>.<a class="code" href="structinterface__t.html#afb924ec72cf46873e010250642116073">index</a> == <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        strncpy(addr.<a class="code" href="structaddress__message__t.html#afd2925f26e189670d192d5709d148d7b">iface</a>.<a class="code" href="structinterface__t.html#a35af930b029104225c9d7dbbb1ff90a1">name</a>, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>, <span class="keyword">sizeof</span>(addr.<a class="code" href="structaddress__message__t.html#afd2925f26e189670d192d5709d148d7b">iface</a>.<a class="code" href="structinterface__t.html#a35af930b029104225c9d7dbbb1ff90a1">name</a>));</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        addr.<a class="code" href="structaddress__message__t.html#afd2925f26e189670d192d5709d148d7b">iface</a>.<a class="code" href="structinterface__t.html#a35af930b029104225c9d7dbbb1ff90a1">name</a>[<span class="keyword">sizeof</span>(addr.<a class="code" href="structaddress__message__t.html#afd2925f26e189670d192d5709d148d7b">iface</a>.<a class="code" href="structinterface__t.html#a35af930b029104225c9d7dbbb1ff90a1">name</a>) - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    }</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">if</span> (addr.<a class="code" href="structaddress__message__t.html#a74e8c53521f06bc50b352b4088fe7c25">family</a> == AF_INET)</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        addr.<a class="code" href="structaddress__message__t.html#a69c735cc2dfca460c4d6feac313ceb65">address</a>.<a class="code" href="unioninet__address__t.html#a65d86ae3e78a199e223ca58582c6988d">ipv4</a>.s_addr = htonl(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        addr.<a class="code" href="structaddress__message__t.html#ac09a6a55808ace5712913cd498243cee">prefix_len</a> = <a class="code" href="route_8c.html#a2aee01d5c10bd617615f031180ee7062">netmask_to_netbits2</a>(tt-&gt;<a class="code" href="structtuntap.html#a9d418d686f4369092543bcced16a39ee">adapter_netmask</a>);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#a42075a3cc301bcd3575ed219c1f01a3e">D_IFCONFIG</a>, <span class="stringliteral">&quot;INET address service: %s %s/%d&quot;</span>,</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            add ? <span class="stringliteral">&quot;add&quot;</span> : <span class="stringliteral">&quot;remove&quot;</span>,</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>, 0, &amp;gc), addr.<a class="code" href="structaddress__message__t.html#ac09a6a55808ace5712913cd498243cee">prefix_len</a>);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    }</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        addr.<a class="code" href="structaddress__message__t.html#a69c735cc2dfca460c4d6feac313ceb65">address</a>.<a class="code" href="unioninet__address__t.html#a5f03e7be9b6de4597133d222d27c5716">ipv6</a> = tt-&gt;<a class="code" href="structtuntap.html#ab854704d9efd886f25b7a0083b0196c6">local_ipv6</a>;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        addr.<a class="code" href="structaddress__message__t.html#ac09a6a55808ace5712913cd498243cee">prefix_len</a> = (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>) ? 128 : tt-&gt;<a class="code" href="structtuntap.html#a481a2d64b9173bd16b80d758c478dfef">netbits_ipv6</a>;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#a42075a3cc301bcd3575ed219c1f01a3e">D_IFCONFIG</a>, <span class="stringliteral">&quot;INET6 address service: %s %s/%d&quot;</span>,</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            add ? <span class="stringliteral">&quot;add&quot;</span> : <span class="stringliteral">&quot;remove&quot;</span>,</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            <a class="code" href="socket_8c.html#a9a911c5dde4c809f7cb3eef8e5918a8e">print_in6_addr</a>(tt-&gt;<a class="code" href="structtuntap.html#ab854704d9efd886f25b7a0083b0196c6">local_ipv6</a>, 0, &amp;gc), addr.<a class="code" href="structaddress__message__t.html#ac09a6a55808ace5712913cd498243cee">prefix_len</a>);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="win32_8c.html#a7c43018c3610f281fbcd28c092d29619">send_msg_iservice</a>(pipe, &amp;addr, <span class="keyword">sizeof</span>(addr), &amp;ack, <span class="stringliteral">&quot;TUN&quot;</span>))</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">if</span> (ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a> != NO_ERROR)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;TUN: %s address failed using service: %s [status=%u if_index=%d]&quot;</span>,</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            (add ? <span class="stringliteral">&quot;adding&quot;</span> : <span class="stringliteral">&quot;deleting&quot;</span>), <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a>, &amp;gc),</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a>, addr.<a class="code" href="structaddress__message__t.html#afd2925f26e189670d192d5709d148d7b">iface</a>.<a class="code" href="structinterface__t.html#afb924ec72cf46873e010250642116073">index</a>);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;out:</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;}</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="tun_8c.html#a1c3bf6ba2997de67eb98b3be45d85721">  152</a></span>&#160;<a class="code" href="tun_8c.html#a1c3bf6ba2997de67eb98b3be45d85721">do_dns_domain_service</a>(<span class="keywordtype">bool</span> add, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;{</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="structack__message__t.html">ack_message_t</a> ack;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    HANDLE pipe = tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">msg_channel</a>;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">if</span> (!tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a79c23140e69d2545d30656f315a20665">domain</a>) <span class="comment">/* no  domain to add or delete */</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">/* Use dns_cfg_msg with addr_len = 0 for setting only the DOMAIN */</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="structdns__cfg__message__t.html">dns_cfg_message_t</a> dns = {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        .<a class="code" href="structdns__cfg__message__t.html#a6051eadfd2ad0eb640992f2f740ba000">header</a> = {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            (add ? <a class="code" href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557cab48ee16bd1edceb7a255eaf14de2025b">msg_add_dns_cfg</a> : <a class="code" href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557caebd78f318d63ad9c30e07ecf3af59916">msg_del_dns_cfg</a>),</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            <span class="keyword">sizeof</span>(<a class="code" href="structdns__cfg__message__t.html">dns_cfg_message_t</a>),</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            0</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        },</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        .iface = { .index = tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>, .name = <span class="stringliteral">&quot;&quot;</span> },</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        .domains = <span class="stringliteral">&quot;&quot;</span>,      <span class="comment">/* set below */</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        .family = AF_INET,  <span class="comment">/* unused */</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        .addr_len = 0       <span class="comment">/* add/delete only the domain, not DNS servers */</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    };</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="buffer_8h.html#acf5c0f0d704fd5b44b4d066044efb52c">strncpynt</a>(dns.<a class="code" href="structdns__cfg__message__t.html#ac1f3808caec2e43591a188bc05993d29">iface</a>.<a class="code" href="structinterface__t.html#a35af930b029104225c9d7dbbb1ff90a1">name</a>, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>, <span class="keyword">sizeof</span>(dns.<a class="code" href="structdns__cfg__message__t.html#ac1f3808caec2e43591a188bc05993d29">iface</a>.<a class="code" href="structinterface__t.html#a35af930b029104225c9d7dbbb1ff90a1">name</a>));</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <a class="code" href="buffer_8h.html#acf5c0f0d704fd5b44b4d066044efb52c">strncpynt</a>(dns.<a class="code" href="structdns__cfg__message__t.html#a26c9c4097a6aa8ed3a849c38f5990ff3">domains</a>, tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a79c23140e69d2545d30656f315a20665">domain</a>, <span class="keyword">sizeof</span>(dns.<a class="code" href="structdns__cfg__message__t.html#a26c9c4097a6aa8ed3a849c38f5990ff3">domains</a>));</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">/* truncation of domain name is not checked as it can&#39;t happen</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">     * with 512 bytes room in dns.domains.</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ad7eba86279cb00fc16742e45bfcf3187">D_LOW</a>, <span class="stringliteral">&quot;%s dns domain on &#39;%s&#39; (if_index = %d) using service&quot;</span>,</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            (add ? <span class="stringliteral">&quot;Setting&quot;</span> : <span class="stringliteral">&quot;Deleting&quot;</span>), dns.<a class="code" href="structdns__cfg__message__t.html#ac1f3808caec2e43591a188bc05993d29">iface</a>.<a class="code" href="structinterface__t.html#a35af930b029104225c9d7dbbb1ff90a1">name</a>, dns.<a class="code" href="structdns__cfg__message__t.html#ac1f3808caec2e43591a188bc05993d29">iface</a>.<a class="code" href="structinterface__t.html#afb924ec72cf46873e010250642116073">index</a>);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="win32_8c.html#a7c43018c3610f281fbcd28c092d29619">send_msg_iservice</a>(pipe, &amp;dns, <span class="keyword">sizeof</span>(dns), &amp;ack, <span class="stringliteral">&quot;TUN&quot;</span>))</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordflow">if</span> (ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a> != NO_ERROR)</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;TUN: %s dns domain failed using service: %s [status=%u if_name=%s]&quot;</span>,</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            (add ? <span class="stringliteral">&quot;adding&quot;</span> : <span class="stringliteral">&quot;deleting&quot;</span>), <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a>, &amp;gc),</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a>, dns.<a class="code" href="structdns__cfg__message__t.html#ac1f3808caec2e43591a188bc05993d29">iface</a>.<a class="code" href="structinterface__t.html#a35af930b029104225c9d7dbbb1ff90a1">name</a>);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;DNS domain %s using service&quot;</span>, (add ? <span class="stringliteral">&quot;set&quot;</span> : <span class="stringliteral">&quot;deleted&quot;</span>));</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;out:</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;}</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l00207"></a><span class="lineno"><a class="line" href="tun_8c.html#a1140731439cf4a6b364712a1ba146649">  207</a></span>&#160;<a class="code" href="tun_8c.html#a1140731439cf4a6b364712a1ba146649">do_dns_service</a>(<span class="keywordtype">bool</span> add, <span class="keyword">const</span> <span class="keywordtype">short</span> family, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;{</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <a class="code" href="structack__message__t.html">ack_message_t</a> ack;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    HANDLE pipe = tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">msg_channel</a>;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordtype">int</span> len = family == AF_INET6 ? tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a1c1812cd166c6b8069060d6005934736">dns6_len</a> : tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a143af129775b5984fa835d5c0026e75c">dns_len</a>;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordtype">int</span> addr_len = add ? len : 0;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *ip_proto_name = family == AF_INET6 ? <span class="stringliteral">&quot;IPv6&quot;</span> : <span class="stringliteral">&quot;IPv4&quot;</span>;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keywordflow">if</span> (addr_len == 0 &amp;&amp; add) <span class="comment">/* no addresses to add */</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">/* Use dns_cfg_msg with domain = &quot;&quot; for setting only the DNS servers */</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <a class="code" href="structdns__cfg__message__t.html">dns_cfg_message_t</a> dns = {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        .<a class="code" href="structdns__cfg__message__t.html#a6051eadfd2ad0eb640992f2f740ba000">header</a> = {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            (add ? <a class="code" href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557cab48ee16bd1edceb7a255eaf14de2025b">msg_add_dns_cfg</a> : <a class="code" href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557caebd78f318d63ad9c30e07ecf3af59916">msg_del_dns_cfg</a>),</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keyword">sizeof</span>(<a class="code" href="structdns__cfg__message__t.html">dns_cfg_message_t</a>),</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            0</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        },</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        .iface = { .index = tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>, .name = <span class="stringliteral">&quot;&quot;</span> },</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        .domains = <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        .family = family,</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        .addr_len = addr_len</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    };</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">/* interface name is required */</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    strncpy(dns.<a class="code" href="structdns__cfg__message__t.html#ac1f3808caec2e43591a188bc05993d29">iface</a>.<a class="code" href="structinterface__t.html#a35af930b029104225c9d7dbbb1ff90a1">name</a>, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>, <span class="keyword">sizeof</span>(dns.<a class="code" href="structdns__cfg__message__t.html#ac1f3808caec2e43591a188bc05993d29">iface</a>.<a class="code" href="structinterface__t.html#a35af930b029104225c9d7dbbb1ff90a1">name</a>));</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    dns.<a class="code" href="structdns__cfg__message__t.html#ac1f3808caec2e43591a188bc05993d29">iface</a>.<a class="code" href="structinterface__t.html#a35af930b029104225c9d7dbbb1ff90a1">name</a>[<span class="keyword">sizeof</span>(dns.<a class="code" href="structdns__cfg__message__t.html#ac1f3808caec2e43591a188bc05993d29">iface</a>.<a class="code" href="structinterface__t.html#a35af930b029104225c9d7dbbb1ff90a1">name</a>) - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span> (addr_len &gt; _countof(dns.<a class="code" href="structdns__cfg__message__t.html#aa12d8df6fd5b2ac1fdacaaa4853c2381">addr</a>))</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        addr_len = _countof(dns.<a class="code" href="structdns__cfg__message__t.html#aa12d8df6fd5b2ac1fdacaaa4853c2381">addr</a>);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        dns.<a class="code" href="structdns__cfg__message__t.html#ab60629488d832723da3a8951693296f7">addr_len</a> = addr_len;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;Number of %s DNS addresses sent to service truncated to %d&quot;</span>,</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            ip_proto_name, addr_len);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    }</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; addr_len; ++i)</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    {</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">if</span> (family == AF_INET6)</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            dns.<a class="code" href="structdns__cfg__message__t.html#aa12d8df6fd5b2ac1fdacaaa4853c2381">addr</a>[i].<a class="code" href="unioninet__address__t.html#a5f03e7be9b6de4597133d222d27c5716">ipv6</a> = tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a0ecf9d2ac33d53674fd03d741cb6e4d5">dns6</a>[i];</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        }</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            dns.<a class="code" href="structdns__cfg__message__t.html#aa12d8df6fd5b2ac1fdacaaa4853c2381">addr</a>[i].<a class="code" href="unioninet__address__t.html#a65d86ae3e78a199e223ca58582c6988d">ipv4</a>.s_addr = htonl(tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a5c59bd51c39835c98556b124f30611b6">dns</a>[i]);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    }</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ad7eba86279cb00fc16742e45bfcf3187">D_LOW</a>, <span class="stringliteral">&quot;%s %s dns servers on &#39;%s&#39; (if_index = %d) using service&quot;</span>,</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        (add ? <span class="stringliteral">&quot;Setting&quot;</span> : <span class="stringliteral">&quot;Deleting&quot;</span>), ip_proto_name, dns.<a class="code" href="structdns__cfg__message__t.html#ac1f3808caec2e43591a188bc05993d29">iface</a>.<a class="code" href="structinterface__t.html#a35af930b029104225c9d7dbbb1ff90a1">name</a>, dns.<a class="code" href="structdns__cfg__message__t.html#ac1f3808caec2e43591a188bc05993d29">iface</a>.<a class="code" href="structinterface__t.html#afb924ec72cf46873e010250642116073">index</a>);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="win32_8c.html#a7c43018c3610f281fbcd28c092d29619">send_msg_iservice</a>(pipe, &amp;dns, <span class="keyword">sizeof</span>(dns), &amp;ack, <span class="stringliteral">&quot;TUN&quot;</span>))</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">if</span> (ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a> != NO_ERROR)</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;TUN: %s %s dns failed using service: %s [status=%u if_name=%s]&quot;</span>,</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            (add ? <span class="stringliteral">&quot;adding&quot;</span> : <span class="stringliteral">&quot;deleting&quot;</span>), ip_proto_name, <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a>, &amp;gc),</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a>, dns.<a class="code" href="structdns__cfg__message__t.html#ac1f3808caec2e43591a188bc05993d29">iface</a>.<a class="code" href="structinterface__t.html#a35af930b029104225c9d7dbbb1ff90a1">name</a>);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    }</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;%s dns servers %s using service&quot;</span>, ip_proto_name, (add ? <span class="stringliteral">&quot;set&quot;</span> : <span class="stringliteral">&quot;deleted&quot;</span>));</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;out:</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;}</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160; </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l00284"></a><span class="lineno"><a class="line" href="tun_8c.html#adb24eb87f48b33a3646747ec0fb9d088">  284</a></span>&#160;<a class="code" href="tun_8c.html#adb24eb87f48b33a3646747ec0fb9d088">do_set_mtu_service</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keyword">const</span> <span class="keywordtype">short</span> family, <span class="keyword">const</span> <span class="keywordtype">int</span> mtu)</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;{</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    DWORD len;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <a class="code" href="structack__message__t.html">ack_message_t</a> ack;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    HANDLE pipe = tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">msg_channel</a>;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *family_name = (family == AF_INET6) ? <span class="stringliteral">&quot;IPv6&quot;</span> : <span class="stringliteral">&quot;IPv4&quot;</span>;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <a class="code" href="structset__mtu__message__t.html">set_mtu_message_t</a> mtu_msg = {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        .<a class="code" href="structset__mtu__message__t.html#a70d5856c01a4200f50efc3430104e7c8">header</a> = {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            <a class="code" href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557cadccc00b2f1d0259b83f17e8e778a4230">msg_set_mtu</a>,</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <span class="keyword">sizeof</span>(<a class="code" href="structset__mtu__message__t.html">set_mtu_message_t</a>),</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            0</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        },</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        .iface = {.index = tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>},</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        .mtu = mtu,</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        .family = family</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    };</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <a class="code" href="buffer_8h.html#acf5c0f0d704fd5b44b4d066044efb52c">strncpynt</a>(mtu_msg.<a class="code" href="structset__mtu__message__t.html#ac473c62a4ef12508d9a27e2ce6d8ce0b">iface</a>.<a class="code" href="structinterface__t.html#a35af930b029104225c9d7dbbb1ff90a1">name</a>, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>, <span class="keyword">sizeof</span>(mtu_msg.<a class="code" href="structset__mtu__message__t.html#ac473c62a4ef12508d9a27e2ce6d8ce0b">iface</a>.<a class="code" href="structinterface__t.html#a35af930b029104225c9d7dbbb1ff90a1">name</a>));</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">if</span> (family == AF_INET6 &amp;&amp; mtu &lt; 1280)</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;NOTE: IPv6 interface MTU &lt; 1280 conflicts with IETF standards and might not work&quot;</span>);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    }</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="win32_8c.html#a7c43018c3610f281fbcd28c092d29619">send_msg_iservice</a>(pipe, &amp;mtu_msg, <span class="keyword">sizeof</span>(mtu_msg), &amp;ack, <span class="stringliteral">&quot;Set_mtu&quot;</span>))</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">if</span> (ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a> != NO_ERROR)</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a9e1c690bc419010e6e8346d28a237941">M_NONFATAL</a>, <span class="stringliteral">&quot;TUN: setting %s mtu using service failed: %s [status=%u if_index=%d]&quot;</span>,</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            family_name, <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a>, &amp;gc), ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a>, mtu_msg.<a class="code" href="structset__mtu__message__t.html#ac473c62a4ef12508d9a27e2ce6d8ce0b">iface</a>.<a class="code" href="structinterface__t.html#afb924ec72cf46873e010250642116073">index</a>);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;%s MTU set to %d on interface %d using service&quot;</span>, family_name, mtu, mtu_msg.<a class="code" href="structset__mtu__message__t.html#ac473c62a4ef12508d9a27e2ce6d8ce0b">iface</a>.<a class="code" href="structinterface__t.html#afb924ec72cf46873e010250642116073">index</a>);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160; </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;out:</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;}</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ifdef _WIN32 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="preprocessor">#ifdef TARGET_SOLARIS</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> solaris_error_close(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structenv__set.html">env_set</a> *es, <span class="keyword">const</span> <span class="keywordtype">char</span> *actual, <span class="keywordtype">bool</span> unplumb_inet6);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="preprocessor">#include &lt;stropts.h&gt;</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160; </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="preprocessor">#if defined(TARGET_DARWIN) &amp;&amp; HAVE_NET_IF_UTUN_H</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="preprocessor">#include &lt;sys/kern_control.h&gt;</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="preprocessor">#include &lt;net/if_utun.h&gt;</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="preprocessor">#include &lt;sys/sys_domain.h&gt;</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="tun_8c.html#a12ceabb38605c3156412412d40931506">clear_tuntap</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *<a class="code" href="structtuntap.html">tuntap</a>);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160; </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l00346"></a><span class="lineno"><a class="line" href="tun_8h.html#a73e6d824b7b018e9b1d9230b0ea16137">  346</a></span>&#160;<a class="code" href="tun_8c.html#a73e6d824b7b018e9b1d9230b0ea16137">is_dev_type</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type, <span class="keyword">const</span> <span class="keywordtype">char</span> *match_type)</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;{</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(match_type);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">if</span> (!dev)</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">if</span> (dev_type)</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="keywordflow">return</span> !strcmp(dev_type, match_type);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="keywordflow">return</span> !strncmp(dev, match_type, strlen(match_type));</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;}</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160; </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l00364"></a><span class="lineno"><a class="line" href="tun_8h.html#a167ef5d50e4284066beb05f5466bd858">  364</a></span>&#160;<a class="code" href="tun_8c.html#a167ef5d50e4284066beb05f5466bd858">dev_type_enum</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type)</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;{</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tun_8c.html#a73e6d824b7b018e9b1d9230b0ea16137">is_dev_type</a>(dev, dev_type, <span class="stringliteral">&quot;tun&quot;</span>))</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    }</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="tun_8c.html#a73e6d824b7b018e9b1d9230b0ea16137">is_dev_type</a>(dev, dev_type, <span class="stringliteral">&quot;tap&quot;</span>))</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="proto_8h.html#a3e52229580f912055a75d0cad8eff3f5">DEV_TYPE_TAP</a>;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    }</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="tun_8c.html#a73e6d824b7b018e9b1d9230b0ea16137">is_dev_type</a>(dev, dev_type, <span class="stringliteral">&quot;null&quot;</span>))</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    {</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="proto_8h.html#a541255b8640c189d1bd902f1168b1ee5">DEV_TYPE_NULL</a>;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    }</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    {</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="proto_8h.html#a44def7b94effffa8c13220d78b841d68">DEV_TYPE_UNDEF</a>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    }</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;}</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a name="l00385"></a><span class="lineno"><a class="line" href="tun_8h.html#aaeb7d66a96170c82580b2e821110c745">  385</a></span>&#160;<a class="code" href="tun_8c.html#aaeb7d66a96170c82580b2e821110c745">dev_type_string</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type)</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;{</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="tun_8c.html#a167ef5d50e4284066beb05f5466bd858">dev_type_enum</a>(dev, dev_type))</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    {</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>:</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;tun&quot;</span>;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="proto_8h.html#a3e52229580f912055a75d0cad8eff3f5">DEV_TYPE_TAP</a>:</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;tap&quot;</span>;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="proto_8h.html#a541255b8640c189d1bd902f1168b1ee5">DEV_TYPE_NULL</a>:</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;null&quot;</span>;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;[unknown-dev-type]&quot;</span>;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;}</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment"> * Try to predict the actual TUN/TAP device instance name,</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment"> * before the device is actually opened.</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a name="l00408"></a><span class="lineno"><a class="line" href="tun_8h.html#ac881cca015e20fc2d4290525767642f4">  408</a></span>&#160;<a class="code" href="tun_8c.html#ac881cca015e20fc2d4290525767642f4">guess_tuntap_dev</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev,</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                 <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type,</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                 <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node,</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                 <span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;{</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> dt = <a class="code" href="tun_8c.html#a167ef5d50e4284066beb05f5466bd858">dev_type_enum</a>(dev, dev_type);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">if</span> (dt == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a> || dt == <a class="code" href="proto_8h.html#a3e52229580f912055a75d0cad8eff3f5">DEV_TYPE_TAP</a>)</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="tun_8c.html#a1394acf0970ce11c08bba13dee682131">netsh_get_id</a>(dev_node, gc);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    }</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="comment">/* default case */</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keywordflow">return</span> dev;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;}</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">/* --ifconfig-nowarn disables some options sanity checking */</span></div>
<div class="line"><a name="l00427"></a><span class="lineno"><a class="line" href="tun_8c.html#a97bbdbbbde38d89780e81c3b32ed58b2">  427</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="tun_8c.html#a97bbdbbbde38d89780e81c3b32ed58b2">ifconfig_warn_how_to_silence</a>[] = <span class="stringliteral">&quot;(silence this warning with --ifconfig-nowarn)&quot;</span>;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment"> * If !tun, make sure ifconfig_remote_netmask looks</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment"> *  like a netmask.</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"> * If tun, make sure ifconfig_remote_netmask looks</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment"> *  like an IPv4 address.</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00437"></a><span class="lineno"><a class="line" href="tun_8c.html#aa1195a441c5f31c4904e2a3f950008e6">  437</a></span>&#160;<a class="code" href="tun_8c.html#aa1195a441c5f31c4904e2a3f950008e6">ifconfig_sanity_check</a>(<span class="keywordtype">bool</span> tun, <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> addr, <span class="keywordtype">int</span> topology)</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;{</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> looks_like_netmask = ((addr &amp; 0xFF000000) == 0xFF000000);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">if</span> (tun)</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    {</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="keywordflow">if</span> (looks_like_netmask &amp;&amp; (topology == <a class="code" href="proto_8h.html#a5432683e30ddc0abd4deb132f20477df">TOP_NET30</a> || topology == <a class="code" href="proto_8h.html#ac294ee23be7863f7b64a51ad6971bfc5">TOP_P2P</a>))</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;WARNING: Since you are using --dev tun with a point-to-point topology, the second argument to --ifconfig must be an IP address.  You are using something (%s) that looks more like a netmask. %s&quot;</span>,</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(addr, 0, &amp;gc),</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                <a class="code" href="tun_8c.html#a97bbdbbbde38d89780e81c3b32ed58b2">ifconfig_warn_how_to_silence</a>);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        }</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    }</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">else</span> <span class="comment">/* tap */</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordflow">if</span> (!looks_like_netmask)</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;WARNING: Since you are using --dev tap, the second argument to --ifconfig must be a netmask, for example something like 255.255.255.0. %s&quot;</span>,</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                <a class="code" href="tun_8c.html#a97bbdbbbde38d89780e81c3b32ed58b2">ifconfig_warn_how_to_silence</a>);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        }</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    }</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;}</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment"> * Check that --local and --remote addresses do not</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment"> * clash with ifconfig addresses or subnet.</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00466"></a><span class="lineno"><a class="line" href="tun_8c.html#a3ce53f6e5b4d0e3c3d489b88b091e912">  466</a></span>&#160;<a class="code" href="tun_8c.html#a3ce53f6e5b4d0e3c3d489b88b091e912">check_addr_clash</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                 <span class="keywordtype">int</span> type,</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                 <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> <span class="keyword">public</span>,</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                 <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> local,</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                 <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> remote_netmask)</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;{</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;CHECK_ADDR_CLASH type=%d public=%s local=%s, remote_netmask=%s&quot;</span>,</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        type,</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(<span class="keyword">public</span>, 0, &amp;gc),</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(local, 0, &amp;gc),</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(remote_netmask, 0, &amp;gc));</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">public</span>)</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordflow">if</span> (type == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        {</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> test_netmask = 0xFFFFFF00;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> public_net = <span class="keyword">public</span> &amp; test_netmask;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> local_net = local &amp; test_netmask;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> remote_net = remote_netmask &amp; test_netmask;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            <span class="keywordflow">if</span> (<span class="keyword">public</span> == local || <span class="keyword">public</span> == remote_netmask)</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            {</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>,</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                    <span class="stringliteral">&quot;WARNING: --%s address [%s] conflicts with --ifconfig address pair [%s, %s]. %s&quot;</span>,</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                    name,</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                    <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(<span class="keyword">public</span>, 0, &amp;gc),</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                    <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(local, 0, &amp;gc),</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                    <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(remote_netmask, 0, &amp;gc),</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                    <a class="code" href="tun_8c.html#a97bbdbbbde38d89780e81c3b32ed58b2">ifconfig_warn_how_to_silence</a>);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            <span class="keywordflow">if</span> (public_net == local_net || public_net == remote_net)</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            {</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>,</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                    <span class="stringliteral">&quot;WARNING: potential conflict between --%s address [%s] and --ifconfig address pair [%s, %s] -- this is a warning only that is triggered when local/remote addresses exist within the same /24 subnet as --ifconfig endpoints. %s&quot;</span>,</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                    name,</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                    <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(<span class="keyword">public</span>, 0, &amp;gc),</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                    <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(local, 0, &amp;gc),</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                    <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(remote_netmask, 0, &amp;gc),</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                    <a class="code" href="tun_8c.html#a97bbdbbbde38d89780e81c3b32ed58b2">ifconfig_warn_how_to_silence</a>);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            }</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        }</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <a class="code" href="proto_8h.html#a3e52229580f912055a75d0cad8eff3f5">DEV_TYPE_TAP</a>)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> public_network = <span class="keyword">public</span> &amp; remote_netmask;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> virtual_network = local &amp; remote_netmask;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="keywordflow">if</span> (public_network == virtual_network)</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            {</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>,</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                    <span class="stringliteral">&quot;WARNING: --%s address [%s] conflicts with --ifconfig subnet [%s, %s] -- local and remote addresses cannot be inside of the --ifconfig subnet. %s&quot;</span>,</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                    name,</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                    <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(<span class="keyword">public</span>, 0, &amp;gc),</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                    <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(local, 0, &amp;gc),</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                    <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(remote_netmask, 0, &amp;gc),</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                    <a class="code" href="tun_8c.html#a97bbdbbbde38d89780e81c3b32ed58b2">ifconfig_warn_how_to_silence</a>);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            }</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    }</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;}</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160; </div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment"> * Issue a warning if ip/netmask (on the virtual IP network) conflicts with</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment"> * the settings on the local LAN.  This is designed to flag issues where</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment"> * (for example) the OpenVPN server LAN is running on 192.168.1.x, but then</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment"> * an OpenVPN client tries to connect from a public location that is also running</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment"> * off of a router set to 192.168.1.x.</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00539"></a><span class="lineno"><a class="line" href="tun_8h.html#a924d8c9818ca3d219b0fd0f1d49a5f1a">  539</a></span>&#160;<a class="code" href="tun_8c.html#a924d8c9818ca3d219b0fd0f1d49a5f1a">check_subnet_conflict</a>(<span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> ip,</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                      <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> netmask,</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                      <span class="keyword">const</span> <span class="keywordtype">char</span> *prefix)</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;{</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="preprocessor">#if 0 </span><span class="comment">/* too many false positives */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> lan_gw = 0;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> lan_netmask = 0;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160; </div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="route_8c.html#a79f572aab37f656876a0ea96120aa320">get_default_gateway</a>(&amp;lan_gw, &amp;lan_netmask) &amp;&amp; lan_netmask)</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    {</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> lan_network = lan_gw &amp; lan_netmask;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> network = ip &amp; netmask;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="comment">/* do the two subnets defined by network/netmask and lan_network/lan_netmask intersect? */</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="keywordflow">if</span> ((network &amp; lan_netmask) == lan_network</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            || (lan_network &amp; netmask) == network)</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;WARNING: potential %s subnet conflict between local LAN [%s/%s] and remote VPN [%s/%s]&quot;</span>,</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                prefix,</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(lan_network, 0, &amp;gc),</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(lan_netmask, 0, &amp;gc),</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(network, 0, &amp;gc),</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(netmask, 0, &amp;gc));</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        }</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    }</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* if 0 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;}</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00570"></a><span class="lineno"><a class="line" href="tun_8h.html#ab0f91db5420a16a2656811d0749978f4">  570</a></span>&#160;<a class="code" href="tun_8c.html#ab0f91db5420a16a2656811d0749978f4">warn_on_use_of_common_subnets</a>(<a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;{</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keyword">struct </span><a class="code" href="structroute__gateway__info.html">route_gateway_info</a> rgi;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> needed = (<a class="code" href="route_8h.html#a4616ff947eb600c95e2c725b418dd23d">RGI_ADDR_DEFINED</a>|<a class="code" href="route_8h.html#aecad0970615cbe7c7af3bbfbfc610c1e">RGI_NETMASK_DEFINED</a>);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <a class="code" href="route_8c.html#a79f572aab37f656876a0ea96120aa320">get_default_gateway</a>(&amp;rgi, ctx);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">if</span> ((rgi.<a class="code" href="structroute__gateway__info.html#a28486a8aae1940b41d6969c926446820">flags</a> &amp; needed) == needed)</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    {</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> lan_network = rgi.<a class="code" href="structroute__gateway__info.html#ab9e341920923382cc32079487eca6e62">gateway</a>.<a class="code" href="structroute__gateway__address.html#a63ded57d206c4b745e541bf51e8fd5b6">addr</a> &amp; rgi.<a class="code" href="structroute__gateway__info.html#ab9e341920923382cc32079487eca6e62">gateway</a>.<a class="code" href="structroute__gateway__address.html#a33bd1314cd069f11c22605e5e79756a0">netmask</a>;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keywordflow">if</span> (lan_network == 0xC0A80000 || lan_network == 0xC0A80100)</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        {</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;NOTE: your local LAN uses the extremely common subnet address 192.168.0.x or 192.168.1.x.  Be aware that this might create routing conflicts if you connect to the VPN server from public locations such as internet cafes that use the same subnet.&quot;</span>);</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    }</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;}</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment"> * Return a string to be used for options compatibility check</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment"> * between peers.</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a name="l00593"></a><span class="lineno"><a class="line" href="tun_8h.html#abd1ff4647b055b72492dc07cc1e25c78">  593</a></span>&#160;<a class="code" href="tun_8c.html#abd1ff4647b055b72492dc07cc1e25c78">ifconfig_options_string</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keywordtype">bool</span> remote, <span class="keywordtype">bool</span> disable, <span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;{</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keyword">struct </span><a class="code" href="structbuffer.html">buffer</a> out = <a class="code" href="buffer_8c.html#aa35bf7feb6a99bf5d364b2d4eba1195c">alloc_buf_gc</a>(256, gc);</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a8d99c6cfbc9fdf2c1466535afeebdbdb">did_ifconfig_setup</a> &amp;&amp; !disable)</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a3e52229580f912055a75d0cad8eff3f5">DEV_TYPE_TAP</a> || (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a> == <a class="code" href="proto_8h.html#af4249a88f691a14cb178b7222d35e150">TOP_SUBNET</a>))</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;out, <span class="stringliteral">&quot;%s %s&quot;</span>,</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                       <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a> &amp; tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>, 0, gc),</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                       <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>, 0, gc));</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        }</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        {</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *l, *r;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            <span class="keywordflow">if</span> (remote)</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                r = <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>, 0, gc);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                l = <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>, 0, gc);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            }</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                l = <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>, 0, gc);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                r = <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>, 0, gc);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;out, <span class="stringliteral">&quot;%s %s&quot;</span>, r, l);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        }</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        {</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;out, <span class="stringliteral">&quot;[undef]&quot;</span>);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        }</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    }</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="buffer_8h.html#a34c800967d7b9583cb64236eadab94dd">BSTR</a>(&amp;out);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;}</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment"> * Return a status string describing wait state.</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a name="l00631"></a><span class="lineno"><a class="line" href="tun_8h.html#a69a3515b1f385a59c642390602c835fd">  631</a></span>&#160;<a class="code" href="tun_8c.html#a69a3515b1f385a59c642390602c835fd">tun_stat</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rwflags, <span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;{</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keyword">struct </span><a class="code" href="structbuffer.html">buffer</a> out = <a class="code" href="buffer_8c.html#aa35bf7feb6a99bf5d364b2d4eba1195c">alloc_buf_gc</a>(64, gc);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="keywordflow">if</span> (tt)</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    {</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keywordflow">if</span> (rwflags &amp; <a class="code" href="event_8h.html#ac03f8506739d508e600347184b53e22c">EVENT_READ</a>)</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;out, <span class="stringliteral">&quot;T%s&quot;</span>,</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                       (tt-&gt;<a class="code" href="structtuntap.html#a00ce662769a347aadc467000312a51c9">rwflags_debug</a> &amp; <a class="code" href="event_8h.html#ac03f8506739d508e600347184b53e22c">EVENT_READ</a>) ? <span class="stringliteral">&quot;R&quot;</span> : <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;out, <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                       <a class="code" href="win32_8c.html#a54e5d5f1a97ec870b32b6a48fd0a69b5">overlapped_io_state_ascii</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>));</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="keywordflow">if</span> (rwflags &amp; <a class="code" href="event_8h.html#a829bcc5ff94e601cfbd30e527c82f94f">EVENT_WRITE</a>)</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        {</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;out, <span class="stringliteral">&quot;T%s&quot;</span>,</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                       (tt-&gt;<a class="code" href="structtuntap.html#a00ce662769a347aadc467000312a51c9">rwflags_debug</a> &amp; <a class="code" href="event_8h.html#a829bcc5ff94e601cfbd30e527c82f94f">EVENT_WRITE</a>) ? <span class="stringliteral">&quot;W&quot;</span> : <span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;out, <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                       <a class="code" href="win32_8c.html#a54e5d5f1a97ec870b32b6a48fd0a69b5">overlapped_io_state_ascii</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>));</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        }</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    }</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;out, <span class="stringliteral">&quot;T?&quot;</span>);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    }</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="buffer_8h.html#a34c800967d7b9583cb64236eadab94dd">BSTR</a>(&amp;out);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;}</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160; </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment"> * Return true for point-to-point topology, false for subnet topology</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l00666"></a><span class="lineno"><a class="line" href="tun_8h.html#add5885eccc02f0f7e9d7edb7e781fa02">  666</a></span>&#160;<a class="code" href="tun_8c.html#add5885eccc02f0f7e9d7edb7e781fa02">is_tun_p2p</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;{</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordtype">bool</span> tun = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a3e52229580f912055a75d0cad8eff3f5">DEV_TYPE_TAP</a></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        || (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a> == <a class="code" href="proto_8h.html#af4249a88f691a14cb178b7222d35e150">TOP_SUBNET</a>)</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        || tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a541255b8640c189d1bd902f1168b1ee5">DEV_TYPE_NULL</a>)</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    {</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        tun = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    }</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    {</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        tun = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    }</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    {</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Error: problem with tun vs. tap setting&quot;</span>); <span class="comment">/* JYFIXME -- needs to be caught earlier, in init_tun? */</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    }</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordflow">return</span> tun;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;}</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160; </div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment"> * Set the ifconfig_* environment variables, both for IPv4 and IPv6</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00692"></a><span class="lineno"><a class="line" href="tun_8h.html#ad8365278b4f196950c8a29745b361e0a">  692</a></span>&#160;<a class="code" href="tun_8c.html#ad8365278b4f196950c8a29745b361e0a">do_ifconfig_setenv</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keyword">struct</span> <a class="code" href="structenv__set.html">env_set</a> *es)</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;{</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *ifconfig_local = <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>, 0, &amp;gc);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *ifconfig_remote_netmask = <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>, 0, &amp;gc);</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160; </div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">     * Set environmental variables with ifconfig parameters.</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a8d99c6cfbc9fdf2c1466535afeebdbdb">did_ifconfig_setup</a>)</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    {</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="keywordtype">bool</span> tun = <a class="code" href="tun_8c.html#add5885eccc02f0f7e9d7edb7e781fa02">is_tun_p2p</a>(tt);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160; </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <a class="code" href="env__set_8c.html#a872620e2e324ded9c1bc8af1c253faf9">setenv_str</a>(es, <span class="stringliteral">&quot;ifconfig_local&quot;</span>, ifconfig_local);</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <span class="keywordflow">if</span> (tun)</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        {</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            <a class="code" href="env__set_8c.html#a872620e2e324ded9c1bc8af1c253faf9">setenv_str</a>(es, <span class="stringliteral">&quot;ifconfig_remote&quot;</span>, ifconfig_remote_netmask);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        }</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            <a class="code" href="env__set_8c.html#a872620e2e324ded9c1bc8af1c253faf9">setenv_str</a>(es, <span class="stringliteral">&quot;ifconfig_netmask&quot;</span>, ifconfig_remote_netmask);</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        }</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    }</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a70831f0f929eb68a2c0cdd85dc8c917c">did_ifconfig_ipv6_setup</a>)</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    {</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *ifconfig_ipv6_local = <a class="code" href="socket_8c.html#a9a911c5dde4c809f7cb3eef8e5918a8e">print_in6_addr</a>(tt-&gt;<a class="code" href="structtuntap.html#ab854704d9efd886f25b7a0083b0196c6">local_ipv6</a>, 0, &amp;gc);</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *ifconfig_ipv6_remote = <a class="code" href="socket_8c.html#a9a911c5dde4c809f7cb3eef8e5918a8e">print_in6_addr</a>(tt-&gt;<a class="code" href="structtuntap.html#a81746b4bf6278227195affed161a12c5">remote_ipv6</a>, 0, &amp;gc);</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160; </div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <a class="code" href="env__set_8c.html#a872620e2e324ded9c1bc8af1c253faf9">setenv_str</a>(es, <span class="stringliteral">&quot;ifconfig_ipv6_local&quot;</span>, ifconfig_ipv6_local);</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <a class="code" href="env__set_8c.html#a2ee1297d7cd864a08edff8440efa4143">setenv_int</a>(es, <span class="stringliteral">&quot;ifconfig_ipv6_netbits&quot;</span>, tt-&gt;<a class="code" href="structtuntap.html#a481a2d64b9173bd16b80d758c478dfef">netbits_ipv6</a>);</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <a class="code" href="env__set_8c.html#a872620e2e324ded9c1bc8af1c253faf9">setenv_str</a>(es, <span class="stringliteral">&quot;ifconfig_ipv6_remote&quot;</span>, ifconfig_ipv6_remote);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    }</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160; </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;}</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment"> * Init tun/tap object.</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment"> * Set up tuntap structure for ifconfig,</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="comment"> * but don&#39;t execute yet.</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="keyword">struct </span><a class="code" href="structtuntap.html">tuntap</a> *</div>
<div class="line"><a name="l00736"></a><span class="lineno"><a class="line" href="tun_8h.html#a655d665719a4b6b553e2b4c0a421fe17">  736</a></span>&#160;<a class="code" href="tun_8c.html#a655d665719a4b6b553e2b4c0a421fe17">init_tun</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev,        <span class="comment">/* --dev option */</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type,   <span class="comment">/* --dev-type option */</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;         <span class="keywordtype">int</span> <a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a>,           <span class="comment">/* one of the TOP_x values */</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">char</span> *ifconfig_local_parm,           <span class="comment">/* --ifconfig parm 1 */</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">char</span> *ifconfig_remote_netmask_parm,  <span class="comment">/* --ifconfig parm 2 */</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">char</span> *ifconfig_ipv6_local_parm,      <span class="comment">/* --ifconfig parm 1 IPv6 */</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;         <span class="keywordtype">int</span> ifconfig_ipv6_netbits_parm,</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">char</span> *ifconfig_ipv6_remote_parm,     <span class="comment">/* --ifconfig parm 2 IPv6 */</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;         <span class="keyword">struct</span> addrinfo *local_public,</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;         <span class="keyword">struct</span> addrinfo *remote_public,</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">bool</span> strict_warn,</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;         <span class="keyword">struct</span> <a class="code" href="structenv__set.html">env_set</a> *es,</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;         <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;{</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtuntap.html">tuntap</a> *tt;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160; </div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <a class="code" href="buffer_8h.html#a0853c66f7fd4862a436ed6306d008c4b">ALLOC_OBJ</a>(tt, <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a>);</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <a class="code" href="tun_8c.html#a12ceabb38605c3156412412d40931506">clear_tuntap</a>(tt);</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> = <a class="code" href="tun_8c.html#a167ef5d50e4284066beb05f5466bd858">dev_type_enum</a>(dev, dev_type);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a> = <a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="keywordflow">if</span> (ifconfig_local_parm &amp;&amp; ifconfig_remote_netmask_parm)</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    {</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordtype">bool</span> tun = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment">         * We only handle TUN/TAP devices here, not --dev null devices.</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        tun = <a class="code" href="tun_8c.html#add5885eccc02f0f7e9d7edb7e781fa02">is_tun_p2p</a>(tt);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment">         * Convert arguments to binary IPv4 addresses.</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160; </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a> = <a class="code" href="socket_8c.html#aed74c8b5931192c1ad5829bd90e01603">getaddr</a>(</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            <a class="code" href="socket_8h.html#ac5f109019b64ee2519d9b3bc7f56dab0">GETADDR_RESOLVE</a></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            | <a class="code" href="socket_8h.html#a5b618d8716696f3ebe96642be56bec03">GETADDR_HOST_ORDER</a></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            | <a class="code" href="socket_8h.html#a7b81d0eeab47d45f1dd40386f6910424">GETADDR_FATAL_ON_SIGNAL</a></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            | <a class="code" href="socket_8h.html#a34e86fc38f89673b7f0c8a48d96b7d6a">GETADDR_FATAL</a>,</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            ifconfig_local_parm,</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            0,</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            NULL,</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            NULL);</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160; </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a> = <a class="code" href="socket_8c.html#aed74c8b5931192c1ad5829bd90e01603">getaddr</a>(</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            (tun ? <a class="code" href="socket_8h.html#ac5f109019b64ee2519d9b3bc7f56dab0">GETADDR_RESOLVE</a> : 0)</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            | <a class="code" href="socket_8h.html#a5b618d8716696f3ebe96642be56bec03">GETADDR_HOST_ORDER</a></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            | <a class="code" href="socket_8h.html#a7b81d0eeab47d45f1dd40386f6910424">GETADDR_FATAL_ON_SIGNAL</a></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            | <a class="code" href="socket_8h.html#a34e86fc38f89673b7f0c8a48d96b7d6a">GETADDR_FATAL</a>,</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            ifconfig_remote_netmask_parm,</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            0,</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            NULL,</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            NULL);</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160; </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">         * Look for common errors in --ifconfig parms</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keywordflow">if</span> (strict_warn)</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        {</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            <span class="keyword">struct </span>addrinfo *curele;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            <a class="code" href="tun_8c.html#aa1195a441c5f31c4904e2a3f950008e6">ifconfig_sanity_check</a>(tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>, tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>, tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a>);</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160; </div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment">             * If local_public or remote_public addresses are defined,</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment">             * make sure they do not clash with our virtual subnet.</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160; </div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            <span class="keywordflow">for</span> (curele = local_public; curele; curele = curele-&gt;ai_next)</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            {</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                <span class="keywordflow">if</span> (curele-&gt;ai_family == AF_INET)</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                {</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                    <a class="code" href="tun_8c.html#a3ce53f6e5b4d0e3c3d489b88b091e912">check_addr_clash</a>(<span class="stringliteral">&quot;local&quot;</span>,</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                                     tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a>,</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                                     ((<span class="keyword">struct</span> sockaddr_in *)curele-&gt;ai_addr)-&gt;sin_addr.s_addr,</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                                     tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>,</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                                     tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                }</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            }</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160; </div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            <span class="keywordflow">for</span> (curele = remote_public; curele; curele = curele-&gt;ai_next)</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;            {</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                <span class="keywordflow">if</span> (curele-&gt;ai_family == AF_INET)</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                {</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                    <a class="code" href="tun_8c.html#a3ce53f6e5b4d0e3c3d489b88b091e912">check_addr_clash</a>(<span class="stringliteral">&quot;remote&quot;</span>,</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                                     tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a>,</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                                     ((<span class="keyword">struct</span> sockaddr_in *)curele-&gt;ai_addr)-&gt;sin_addr.s_addr,</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                                     tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>,</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                                     tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>);</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                }</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            }</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160; </div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a3e52229580f912055a75d0cad8eff3f5">DEV_TYPE_TAP</a> || (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a> == <a class="code" href="proto_8h.html#af4249a88f691a14cb178b7222d35e150">TOP_SUBNET</a>))</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            {</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                <a class="code" href="tun_8c.html#a924d8c9818ca3d219b0fd0f1d49a5f1a">check_subnet_conflict</a>(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>, tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>, <span class="stringliteral">&quot;TUN/TAP adapter&quot;</span>);</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            }</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            {</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                <a class="code" href="tun_8c.html#a924d8c9818ca3d219b0fd0f1d49a5f1a">check_subnet_conflict</a>(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>, <a class="code" href="openvpn_2basic_8h.html#a8c148c96fd9bc7ea66141a318195b6be">IPV4_NETMASK_HOST</a>, <span class="stringliteral">&quot;TUN/TAP adapter&quot;</span>);</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            }</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        }</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160; </div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">         * Make sure that both ifconfig addresses are part of the</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment">         * same .252 subnet.</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        <span class="keywordflow">if</span> (tun)</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        {</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            <a class="code" href="tun_8c.html#afe2a77f5d1c40b6ee4693b0946e452c0">verify_255_255_255_252</a>(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>, tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            tt-&gt;<a class="code" href="structtuntap.html#a9d418d686f4369092543bcced16a39ee">adapter_netmask</a> = ~3;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        }</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        {</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;            tt-&gt;<a class="code" href="structtuntap.html#a9d418d686f4369092543bcced16a39ee">adapter_netmask</a> = tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        }</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160; </div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#a8d99c6cfbc9fdf2c1466535afeebdbdb">did_ifconfig_setup</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    }</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160; </div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordflow">if</span> (ifconfig_ipv6_local_parm &amp;&amp; ifconfig_ipv6_remote_parm)</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160; </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="comment">         * Convert arguments to binary IPv6 addresses.</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160; </div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="compat-inet__pton_8c.html#acdce1d46efd09e8485a2f682b388ebc0">inet_pton</a>( AF_INET6, ifconfig_ipv6_local_parm, &amp;tt-&gt;<a class="code" href="structtuntap.html#ab854704d9efd886f25b7a0083b0196c6">local_ipv6</a> ) != 1</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            || <a class="code" href="compat-inet__pton_8c.html#acdce1d46efd09e8485a2f682b388ebc0">inet_pton</a>( AF_INET6, ifconfig_ipv6_remote_parm, &amp;tt-&gt;<a class="code" href="structtuntap.html#a81746b4bf6278227195affed161a12c5">remote_ipv6</a> ) != 1)</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        {</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>( <a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;init_tun: problem converting IPv6 ifconfig addresses %s and %s to binary&quot;</span>, ifconfig_ipv6_local_parm, ifconfig_ipv6_remote_parm );</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        }</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#a481a2d64b9173bd16b80d758c478dfef">netbits_ipv6</a> = ifconfig_ipv6_netbits_parm;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160; </div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#a70831f0f929eb68a2c0cdd85dc8c917c">did_ifconfig_ipv6_setup</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    }</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160; </div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="comment">     * Set environmental variables with ifconfig parameters.</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keywordflow">if</span> (es)</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    {</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        <a class="code" href="tun_8c.html#ad8365278b4f196950c8a29745b361e0a">do_ifconfig_setenv</a>(tt, es);</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    }</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160; </div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keywordflow">return</span> tt;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;}</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160; </div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="comment"> * Platform specific tun initializations</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00891"></a><span class="lineno"><a class="line" href="tun_8h.html#ac81775a8129068d72892557f733bc583">  891</a></span>&#160;<a class="code" href="tun_8c.html#ac81775a8129068d72892557f733bc583">init_tun_post</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt,</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;              <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structframe.html">frame</a> *<a class="code" href="structframe.html">frame</a>,</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;              <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap__options.html">tuntap_options</a> *<a class="code" href="structoptions.html">options</a>)</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;{</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a> = *<a class="code" href="structoptions.html">options</a>;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <a class="code" href="win32_8c.html#a2a97ed71e42b8d67a835dca3926dd41b">overlapped_io_init</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>, <a class="code" href="structframe.html">frame</a>, FALSE, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <a class="code" href="win32_8c.html#a2a97ed71e42b8d67a835dca3926dd41b">overlapped_io_init</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>, <a class="code" href="structframe.html">frame</a>, TRUE, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a> = <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160; </div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a859337e1a4e77338299c25b8563410ed">windows_driver</a> == <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5a2d613eaa5b7f632cbcc6c0fd16015bbc">WINDOWS_DRIVER_WINTUN</a>)</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    {</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#abad5f3a4193f4e244d55ffd2fa41b7f0">wintun_send_ring_handle</a> = CreateFileMapping(INVALID_HANDLE_VALUE, NULL,</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                                                        PAGE_READWRITE,</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                                                        0,</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                                                        <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structtun__ring.html">tun_ring</a>),</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                                                        NULL);</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#a55841b7764fd4d6945e38c8d7594c7b5">wintun_receive_ring_handle</a> = CreateFileMapping(INVALID_HANDLE_VALUE,</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                                                           NULL,</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                                                           PAGE_READWRITE,</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                                                           0,</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                                                           <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structtun__ring.html">tun_ring</a>),</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                                                           NULL);</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <span class="keywordflow">if</span> ((tt-&gt;<a class="code" href="structtuntap.html#abad5f3a4193f4e244d55ffd2fa41b7f0">wintun_send_ring_handle</a> == NULL) || (tt-&gt;<a class="code" href="structtuntap.html#a55841b7764fd4d6945e38c8d7594c7b5">wintun_receive_ring_handle</a> == NULL))</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        {</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Cannot allocate memory for ring buffer&quot;</span>);</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        }</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160; </div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#a4e17e7776e70f2df81236da3bcecccaa">rw_handle</a>.<a class="code" href="structrw__handle.html#a81c9d90f164f2f82f13b43193d7e690b">read</a> = CreateEvent(NULL, FALSE, FALSE, NULL);</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#a4e17e7776e70f2df81236da3bcecccaa">rw_handle</a>.<a class="code" href="structrw__handle.html#a0dae71c0cfb6646063148367ed15f4d1">write</a> = CreateEvent(NULL, FALSE, FALSE, NULL);</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160; </div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        <span class="keywordflow">if</span> ((tt-&gt;<a class="code" href="structtuntap.html#a4e17e7776e70f2df81236da3bcecccaa">rw_handle</a>.<a class="code" href="structrw__handle.html#a81c9d90f164f2f82f13b43193d7e690b">read</a> == NULL) || (tt-&gt;<a class="code" href="structtuntap.html#a4e17e7776e70f2df81236da3bcecccaa">rw_handle</a>.<a class="code" href="structrw__handle.html#a0dae71c0cfb6646063148367ed15f4d1">write</a> == NULL))</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        {</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Cannot create events for ring buffer&quot;</span>);</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        }</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    }</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    {</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#a4e17e7776e70f2df81236da3bcecccaa">rw_handle</a>.<a class="code" href="structrw__handle.html#a81c9d90f164f2f82f13b43193d7e690b">read</a> = tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#a41141dbe6995d7c7c65ce268d6c1b5d9">overlapped</a>.hEvent;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#a4e17e7776e70f2df81236da3bcecccaa">rw_handle</a>.<a class="code" href="structrw__handle.html#a0dae71c0cfb6646063148367ed15f4d1">write</a> = tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#a41141dbe6995d7c7c65ce268d6c1b5d9">overlapped</a>.hEvent;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ifdef _WIN32 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;}</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160; </div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="preprocessor">#if defined(_WIN32)    \</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="preprocessor">    || defined(TARGET_DARWIN) || defined(TARGET_NETBSD) || defined(TARGET_OPENBSD)</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160; </div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="comment">/* some of the platforms will auto-add a &quot;network route&quot; pointing</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="comment"> * to the interface on &quot;ifconfig tunX 2001:db8::1/64&quot;, others need</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="comment"> * an extra call to &quot;route add...&quot;</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment"> * -&gt; helper function to simplify code below</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00944"></a><span class="lineno"><a class="line" href="tun_8c.html#ab0496a8190d1914429c200aaae073b69">  944</a></span>&#160;<a class="code" href="tun_8c.html#ab0496a8190d1914429c200aaae073b69">add_route_connected_v6_net</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt,</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                           <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structenv__set.html">env_set</a> *es)</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;{</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    <span class="keyword">struct </span><a class="code" href="structroute__ipv6.html">route_ipv6</a> r6;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(r6);</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    r6.<a class="code" href="structroute__ipv6.html#a9d9f0b0a90d55aae4f2e21163f9cba94">network</a> = tt-&gt;<a class="code" href="structtuntap.html#ab854704d9efd886f25b7a0083b0196c6">local_ipv6</a>;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    r6.<a class="code" href="structroute__ipv6.html#a40dd9f967f1b9865ab733329dff9eb78">netbits</a> = tt-&gt;<a class="code" href="structtuntap.html#a481a2d64b9173bd16b80d758c478dfef">netbits_ipv6</a>;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    r6.<a class="code" href="structroute__ipv6.html#a1253ae18a7713ae72b30a669a0bf6ae5">gateway</a> = tt-&gt;<a class="code" href="structtuntap.html#ab854704d9efd886f25b7a0083b0196c6">local_ipv6</a>;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    r6.<a class="code" href="structroute__ipv6.html#ab356df748374308f70a7f7495fdb4a4c">metric</a>  = 0;                     <span class="comment">/* connected route */</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    r6.<a class="code" href="structroute__ipv6.html#a6bcf2e42012b24c9ec6897da1cea73c4">flags</a>   = <a class="code" href="route_8h.html#ad868f081f0334c1a64d0682283139425">RT_DEFINED</a> | <a class="code" href="route_8h.html#a7c86f9369806a6f86f30a7c3185d740a">RT_METRIC_DEFINED</a>;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <a class="code" href="route_8c.html#a63aa83322222f92bc2d6bfa2b183066f">add_route_ipv6</a>(&amp;r6, tt, 0, es, NULL);</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;}</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160; </div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00959"></a><span class="lineno"><a class="line" href="tun_8c.html#a8ca1bf7676b89c4f0b0648001865dfc5">  959</a></span>&#160;<a class="code" href="tun_8c.html#a8ca1bf7676b89c4f0b0648001865dfc5">delete_route_connected_v6_net</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;{</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="keyword">struct </span><a class="code" href="structroute__ipv6.html">route_ipv6</a> r6;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160; </div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(r6);</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    r6.<a class="code" href="structroute__ipv6.html#a9d9f0b0a90d55aae4f2e21163f9cba94">network</a> = tt-&gt;<a class="code" href="structtuntap.html#ab854704d9efd886f25b7a0083b0196c6">local_ipv6</a>;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    r6.<a class="code" href="structroute__ipv6.html#a40dd9f967f1b9865ab733329dff9eb78">netbits</a> = tt-&gt;<a class="code" href="structtuntap.html#a481a2d64b9173bd16b80d758c478dfef">netbits_ipv6</a>;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    r6.<a class="code" href="structroute__ipv6.html#a1253ae18a7713ae72b30a669a0bf6ae5">gateway</a> = tt-&gt;<a class="code" href="structtuntap.html#ab854704d9efd886f25b7a0083b0196c6">local_ipv6</a>;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    r6.<a class="code" href="structroute__ipv6.html#ab356df748374308f70a7f7495fdb4a4c">metric</a>  = 0;                     <span class="comment">/* connected route */</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    r6.<a class="code" href="structroute__ipv6.html#a6bcf2e42012b24c9ec6897da1cea73c4">flags</a>   = <a class="code" href="route_8h.html#ad868f081f0334c1a64d0682283139425">RT_DEFINED</a> | <a class="code" href="route_8h.html#a6ec44fb3d21f1f44426b0c4893aeefeb">RT_ADDED</a> | <a class="code" href="route_8h.html#a7c86f9369806a6f86f30a7c3185d740a">RT_METRIC_DEFINED</a>;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <a class="code" href="route_8c.html#ad7168a54dce4dd829133c755667c0c03">route_ipv6_clear_host_bits</a>(&amp;r6);</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <a class="code" href="route_8c.html#a55de672f1ddacfdf8b5a05d924e92684">delete_route_ipv6</a>(&amp;r6, tt, 0, NULL, NULL);</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;}</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* if defined(_WIN32) || defined(TARGET_DARWIN) || defined(TARGET_NETBSD) || defined(TARGET_OPENBSD) */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160; </div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="preprocessor">#if defined(TARGET_FREEBSD) || defined(TARGET_DRAGONFLY)  \</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="preprocessor">    || defined(TARGET_NETBSD) || defined(TARGET_OPENBSD)</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="comment">/* we can&#39;t use true subnet mode on tun on all platforms, as that</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="comment"> * conflicts with IPv6 (wants to use ND then, which we don&#39;t do),</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="comment"> * but the OSes want &quot;a remote address that is different from ours&quot;</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="comment"> * - so we construct one, normally the first in the subnet, but if</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="comment"> * this is the same as ours, use the second one.</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="comment"> * The actual address does not matter at all, as the tun interface</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="comment"> * is still point to point and no layer 2 resolution is done...</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160; </div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;create_arbitrary_remote( <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt )</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;{</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> remote;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160; </div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    remote = (tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a> &amp; tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>) +1;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160; </div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="keywordflow">if</span> (remote == tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>)</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    {</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        remote++;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    }</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160; </div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <span class="keywordflow">return</span> remote;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;}</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160; </div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"><a class="line" href="tun_8c.html#a1be16b7c5abd7150fdd0e65cb571d113"> 1011</a></span>&#160;<a class="code" href="tun_8c.html#a1be16b7c5abd7150fdd0e65cb571d113">do_ifconfig_ipv6</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keyword">const</span> <span class="keywordtype">char</span> *ifname, <span class="keywordtype">int</span> tun_mtu,</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                 <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structenv__set.html">env_set</a> *es, <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;{</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="preprocessor">#if !defined(TARGET_LINUX)</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *ifconfig_ipv6_local = <a class="code" href="socket_8c.html#a9a911c5dde4c809f7cb3eef8e5918a8e">print_in6_addr</a>(tt-&gt;<a class="code" href="structtuntap.html#ab854704d9efd886f25b7a0083b0196c6">local_ipv6</a>, 0, &amp;gc);</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160; </div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="preprocessor">#if defined(TARGET_LINUX)</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keywordflow">if</span> (net_iface_mtu_set(ctx, ifname, tun_mtu) &lt; 0)</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    {</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Linux can&#39;t set mtu (%d) on %s&quot;</span>, tun_mtu, ifname);</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    }</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160; </div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <span class="keywordflow">if</span> (net_iface_up(ctx, ifname, <span class="keyword">true</span>) &lt; 0)</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    {</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Linux can&#39;t bring %s up&quot;</span>, ifname);</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    }</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160; </div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <span class="keywordflow">if</span> (net_addr_v6_add(ctx, ifname, &amp;tt-&gt;<a class="code" href="structtuntap.html#ab854704d9efd886f25b7a0083b0196c6">local_ipv6</a>,</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                        tt-&gt;<a class="code" href="structtuntap.html#a481a2d64b9173bd16b80d758c478dfef">netbits_ipv6</a>) &lt; 0)</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    {</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Linux can&#39;t add IPv6 to interface %s&quot;</span>, ifname);</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    }</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="preprocessor">#elif defined(TARGET_ANDROID)</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    <span class="keywordtype">char</span> out6[64];</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160; </div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <a class="code" href="buffer_8c.html#afd2a93a0940b1ea7e093d293a05e2927">openvpn_snprintf</a>(out6, <span class="keyword">sizeof</span>(out6), <span class="stringliteral">&quot;%s/%d %d&quot;</span>,</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                     ifconfig_ipv6_local, tt-&gt;<a class="code" href="structtuntap.html#a481a2d64b9173bd16b80d758c478dfef">netbits_ipv6</a>, tun_mtu);</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    management_android_control(<a class="code" href="structmanagement.html">management</a>, <span class="stringliteral">&quot;IFCONFIG6&quot;</span>, out6);</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="preprocessor">#elif defined(TARGET_SOLARIS)</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s inet6 unplumb&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, ifname);</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, 0, NULL);</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160; </div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    {</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *ifconfig_ipv6_remote = <a class="code" href="socket_8c.html#a9a911c5dde4c809f7cb3eef8e5918a8e">print_in6_addr</a>(tt-&gt;<a class="code" href="structtuntap.html#a81746b4bf6278227195affed161a12c5">remote_ipv6</a>, 0, &amp;gc);</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160; </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s inet6 plumb %s/%d %s mtu %d up&quot;</span>,</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                    <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, ifname, ifconfig_ipv6_local,</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                    tt-&gt;<a class="code" href="structtuntap.html#a481a2d64b9173bd16b80d758c478dfef">netbits_ipv6</a>, ifconfig_ipv6_remote, tun_mtu);</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    }</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <span class="keywordflow">else</span> <span class="comment">/* tap mode */</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    {</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        <span class="comment">/* base IPv6 tap interface needs to be brought up first */</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s inet6 plumb up&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, ifname);</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160; </div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, 0,</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                                  <span class="stringliteral">&quot;Solaris ifconfig IPv6 (prepare) failed&quot;</span>))</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        {</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;            solaris_error_close(tt, es, ifname, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        }</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160; </div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        <span class="comment">/* we might need to do &quot;ifconfig %s inet6 auto-dhcp drop&quot;</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment">         * after the system has noticed the interface and fired up</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment">         * the DHCPv6 client - but this takes quite a while, and the</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment">         * server will ignore the DHCPv6 packets anyway.  So we don&#39;t.</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160; </div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;        <span class="comment">/* static IPv6 addresses need to go to a subinterface (tap0:1)</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment">         * and we cannot set an mtu here (must go to the &quot;parent&quot;)</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s inet6 addif %s/%d up&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>,</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;                    ifname, ifconfig_ipv6_local, tt-&gt;<a class="code" href="structtuntap.html#a481a2d64b9173bd16b80d758c478dfef">netbits_ipv6</a> );</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    }</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160; </div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, 0, <span class="stringliteral">&quot;Solaris ifconfig IPv6 failed&quot;</span>))</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    {</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        solaris_error_close(tt, es, ifname, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    }</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160; </div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> != <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    {</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s inet6 mtu %d&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>,</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                    ifname, tun_mtu);</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, 0, <span class="stringliteral">&quot;Solaris ifconfig IPv6 mtu failed&quot;</span>);</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    }</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="preprocessor">#elif defined(TARGET_OPENBSD) || defined(TARGET_NETBSD) \</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="preprocessor">    || defined(TARGET_DARWIN) || defined(TARGET_FREEBSD) \</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="preprocessor">    || defined(TARGET_DRAGONFLY)</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s inet6 %s/%d mtu %d up&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, ifname,</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                ifconfig_ipv6_local, tt-&gt;<a class="code" href="structtuntap.html#a481a2d64b9173bd16b80d758c478dfef">netbits_ipv6</a>, tun_mtu);</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160; </div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, <a class="code" href="run__command_8h.html#a2a6d02b9ff0a76e78bf5c76834a29d89">S_FATAL</a>,</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                         <span class="stringliteral">&quot;generic BSD ifconfig inet6 failed&quot;</span>);</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160; </div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="preprocessor">#if defined(TARGET_FREEBSD) &amp;&amp; __FreeBSD_version &gt;= 1200000</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="comment">/* On FreeBSD 12 and up, there is ipv6_activate_all_interfaces=&quot;YES&quot;</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="comment">     * in rc.conf, which is not set by default.  If it is *not* set,</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="comment">     * &quot;all new interfaces that are not already up&quot; are configured by</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="comment">     * devd + /etc/pccard_ether as &quot;inet6 ifdisabled&quot;.</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="comment">     * The &quot;is this interface already up?&quot; test is a non-zero time window</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="comment">     * which we manage to hit with our ifconfig often enough to cause</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="comment">     * frequent fails in the openvpn test environment.</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment">     * Thus: assume that the system might interfere, wait for things to</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="comment">     * settle (it&#39;s a very short time window), and remove -ifdisable again.</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="comment">     * See: https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=248172</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <a class="code" href="syshead_8h.html#a82b8e21bd452d01ad6d32a0d73fbfdc8">sleep</a>(1);</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s inet6 -ifdisabled&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, ifname);</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160; </div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, <a class="code" href="run__command_8h.html#a2a6d02b9ff0a76e78bf5c76834a29d89">S_FATAL</a>,</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                         <span class="stringliteral">&quot;FreeBSD BSD &#39;ifconfig inet6 -ifdisabled&#39; failed&quot;</span>);</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160; </div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="preprocessor">#if defined(TARGET_OPENBSD) || defined(TARGET_NETBSD) \</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="preprocessor">    || defined(TARGET_DARWIN)</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <span class="comment">/* and, hooray, we explicitly need to add a route... */</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <a class="code" href="tun_8c.html#ab0496a8190d1914429c200aaae073b69">add_route_connected_v6_net</a>(tt, es);</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="preprocessor">#elif defined(TARGET_AIX)</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s inet6 %s/%d mtu %d up&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, ifname,</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                ifconfig_ipv6_local, tt-&gt;<a class="code" href="structtuntap.html#a481a2d64b9173bd16b80d758c478dfef">netbits_ipv6</a>, tun_mtu);</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160; </div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="comment">/* AIX ifconfig will complain if it can&#39;t find ODM path in env */</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    es = <a class="code" href="env__set_8c.html#a589b54db89bdd1a4683d80b8132ce577">env_set_create</a>(NULL);</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <a class="code" href="env__set_8c.html#a8f95bd5663cdc04bc9764b429538f536">env_set_add</a>(es, <span class="stringliteral">&quot;ODMDIR=/etc/objrepos&quot;</span>);</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160; </div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, <a class="code" href="run__command_8h.html#a2a6d02b9ff0a76e78bf5c76834a29d89">S_FATAL</a>,</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                         <span class="stringliteral">&quot;generic BSD ifconfig inet6 failed&quot;</span>);</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160; </div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <a class="code" href="env__set_8c.html#a2d1a7f0ea69776000aa9df3eca186f97">env_set_destroy</a>(es);</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="preprocessor">#elif defined (_WIN32)</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ac4735c903581ca3bb0c35dbe48b4e4dd">ip_win32_type</a> == <a class="code" href="tun_8h.html#a85a39082c97534bda4e02e0ed0bfd841">IPW32_SET_MANUAL</a>)</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    {</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;******** NOTE:  Please manually set the v6 IP of &#39;%s&#39; to %s (if it is not already set)&quot;</span>,</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;            ifname, ifconfig_ipv6_local);</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    }</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">msg_channel</a>)</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    {</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        <a class="code" href="tun_8c.html#a11011674316342ddaaad3f76739d78e3">do_address_service</a>(<span class="keyword">true</span>, AF_INET6, tt);</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        {</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;            <a class="code" href="tun_8c.html#ab0496a8190d1914429c200aaae073b69">add_route_connected_v6_net</a>(tt, es);</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        }</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        <a class="code" href="tun_8c.html#a1140731439cf4a6b364712a1ba146649">do_dns_service</a>(<span class="keyword">true</span>, AF_INET6, tt);</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;        <a class="code" href="tun_8c.html#adb24eb87f48b33a3646747ec0fb9d088">do_set_mtu_service</a>(tt, AF_INET6, tun_mtu);</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        <span class="comment">/* If IPv4 is not enabled, set DNS domain here */</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        <span class="keywordflow">if</span> (!tt-&gt;<a class="code" href="structtuntap.html#a8d99c6cfbc9fdf2c1466535afeebdbdb">did_ifconfig_setup</a>)</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        {</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;           <a class="code" href="tun_8c.html#a1c3bf6ba2997de67eb98b3be45d85721">do_dns_domain_service</a>(<span class="keyword">true</span>, tt);</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        }</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    }</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    {</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        <span class="comment">/* example: netsh interface ipv6 set address 42</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="comment">         *                  2001:608:8003::d/bits store=active</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160; </div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;        <span class="comment">/* in TUN mode, we only simulate a subnet, so the interface</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="comment">         * is configured with /128 + a route to fe80::8.  In TAP mode,</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment">         * the correct netbits must be set, and no on-link route</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;        <span class="keywordtype">int</span> netbits = (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>) ? 128 : tt-&gt;<a class="code" href="structtuntap.html#a481a2d64b9173bd16b80d758c478dfef">netbits_ipv6</a>;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160; </div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s%s interface ipv6 set address %lu %s/%d store=active&quot;</span>,</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                    <a class="code" href="win32_8c.html#afa334458227a2453a4391a3a1316a0d7">get_win_sys_path</a>(), <a class="code" href="win32_8h.html#ac14f7d0f4450ca68bf7f955e42e234cf">NETSH_PATH_SUFFIX</a>, tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>,</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                    ifconfig_ipv6_local, netbits);</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        <a class="code" href="tun_8c.html#ac0b5e1af8dfaa627162520fbc1ae5080">netsh_command</a>(&amp;<a class="code" href="structargv.html">argv</a>, 4, <a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>);</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        {</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;            <a class="code" href="tun_8c.html#ab0496a8190d1914429c200aaae073b69">add_route_connected_v6_net</a>(tt, es);</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;        }</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;        <span class="comment">/* set ipv6 dns servers if any are specified */</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;        <a class="code" href="tun_8c.html#aee87d985f2ee8faa65c3716def4b9b8c">netsh_set_dns6_servers</a>(tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a0ecf9d2ac33d53674fd03d741cb6e4d5">dns6</a>, tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a1c1812cd166c6b8069060d6005934736">dns6_len</a>, tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>);</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;        <a class="code" href="tun_8c.html#ade2f6913cf1b1b4b6d342140d1db9f97">windows_set_mtu</a>(tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>, AF_INET6, tun_mtu);</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    }</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="preprocessor">#else </span><span class="comment">/* platforms we have no IPv6 code for */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Sorry, but I don&#39;t know how to do IPv6 &#39;ifconfig&#39; commands on this operating system.  You should ifconfig your TUN/TAP device manually or use an --up script.&quot;</span>);</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* outer &quot;if defined(TARGET_xxx)&quot; conditional */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160; </div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="preprocessor">#if !defined(TARGET_LINUX)</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;}</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160; </div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"><a class="line" href="tun_8c.html#a80f4326c6867bc81a083128864766ce9"> 1209</a></span>&#160;<a class="code" href="tun_8c.html#a80f4326c6867bc81a083128864766ce9">do_ifconfig_ipv4</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keyword">const</span> <span class="keywordtype">char</span> *ifname, <span class="keywordtype">int</span> tun_mtu,</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                 <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structenv__set.html">env_set</a> *es, <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;{</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="comment">     * We only handle TUN/TAP devices here, not --dev null devices.</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <span class="keywordtype">bool</span> tun = <a class="code" href="tun_8c.html#add5885eccc02f0f7e9d7edb7e781fa02">is_tun_p2p</a>(tt);</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160; </div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="preprocessor">#if !defined(TARGET_LINUX)</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *ifconfig_local = NULL;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *ifconfig_remote_netmask = NULL;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160; </div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="comment">     * Set ifconfig parameters</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    ifconfig_local = <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>, 0, &amp;gc);</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    ifconfig_remote_netmask = <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>, 0, &amp;gc);</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160; </div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="preprocessor">#if defined(TARGET_LINUX)</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <span class="keywordflow">if</span> (net_iface_mtu_set(ctx, ifname, tun_mtu) &lt; 0)</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    {</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Linux can&#39;t set mtu (%d) on %s&quot;</span>, tun_mtu, ifname);</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    }</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160; </div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <span class="keywordflow">if</span> (net_iface_up(ctx, ifname, <span class="keyword">true</span>) &lt; 0)</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    {</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Linux can&#39;t bring %s up&quot;</span>, ifname);</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    }</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160; </div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <span class="keywordflow">if</span> (tun)</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    {</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        <span class="keywordflow">if</span> (net_addr_ptp_v4_add(ctx, ifname, &amp;tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>,</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                                &amp;tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>) &lt; 0)</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        {</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Linux can&#39;t add IP to interface %s&quot;</span>, ifname);</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        }</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    }</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    {</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;        <span class="keywordflow">if</span> (net_addr_v4_add(ctx, ifname, &amp;tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>,</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                            <a class="code" href="route_8c.html#a2aee01d5c10bd617615f031180ee7062">netmask_to_netbits2</a>(tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>)) &lt; 0)</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        {</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Linux can&#39;t add IP to interface %s&quot;</span>, ifname);</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;        }</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    }</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="preprocessor">#elif defined(TARGET_ANDROID)</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="keywordtype">char</span> out[64];</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160; </div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    <span class="keywordtype">char</span> *top;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="keywordflow">switch</span> (tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a>)</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    {</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="proto_8h.html#a5432683e30ddc0abd4deb132f20477df">TOP_NET30</a>:</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;            top = <span class="stringliteral">&quot;net30&quot;</span>;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160; </div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="proto_8h.html#ac294ee23be7863f7b64a51ad6971bfc5">TOP_P2P</a>:</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;            top = <span class="stringliteral">&quot;p2p&quot;</span>;</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160; </div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="proto_8h.html#af4249a88f691a14cb178b7222d35e150">TOP_SUBNET</a>:</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;            top = <span class="stringliteral">&quot;subnet&quot;</span>;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160; </div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;            top = <span class="stringliteral">&quot;undef&quot;</span>;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    }</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160; </div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <a class="code" href="buffer_8c.html#afd2a93a0940b1ea7e093d293a05e2927">openvpn_snprintf</a>(out, <span class="keyword">sizeof</span>(out), <span class="stringliteral">&quot;%s %s %d %s&quot;</span>, ifconfig_local,</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;                     ifconfig_remote_netmask, tun_mtu, top);</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    management_android_control(<a class="code" href="structmanagement.html">management</a>, <span class="stringliteral">&quot;IFCONFIG&quot;</span>, out);</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160; </div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="preprocessor">#elif defined(TARGET_SOLARIS)</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <span class="comment">/* Solaris 2.6 (and 7?) cannot set all parameters in one go...</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="comment">     * example:</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="comment">     *    ifconfig tun2 10.2.0.2 10.2.0.1 mtu 1450 up</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="comment">     *    ifconfig tun2 netmask 255.255.255.255</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <span class="keywordflow">if</span> (tun)</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    {</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s %s %s mtu %d up&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, ifname,</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;                    ifconfig_local, ifconfig_remote_netmask, tun_mtu);</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160; </div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;        <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, 0, <span class="stringliteral">&quot;Solaris ifconfig phase-1 failed&quot;</span>))</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        {</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;            solaris_error_close(tt, es, ifname, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        }</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160; </div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s netmask 255.255.255.255&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>,</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;                    ifname);</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    }</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a> == <a class="code" href="proto_8h.html#af4249a88f691a14cb178b7222d35e150">TOP_SUBNET</a>)</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    {</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s %s %s netmask %s mtu %d up&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>,</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;                    ifname, ifconfig_local, ifconfig_local,</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;                    ifconfig_remote_netmask, tun_mtu);</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    }</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    {</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s %s netmask %s up&quot;</span>,</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;                    <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, ifname, ifconfig_local,</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;                    ifconfig_remote_netmask);</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    }</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160; </div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, 0, <span class="stringliteral">&quot;Solaris ifconfig phase-2 failed&quot;</span>))</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    {</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        solaris_error_close(tt, es, ifname, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    }</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160; </div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="keywordflow">if</span> (!tun &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a> == <a class="code" href="proto_8h.html#af4249a88f691a14cb178b7222d35e150">TOP_SUBNET</a>)</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    {</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;        <span class="comment">/* Add a network route for the local tun interface */</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;        <span class="keyword">struct </span><a class="code" href="structroute__ipv4.html">route_ipv4</a> r;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(r);</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;        r.<a class="code" href="structroute__ipv4.html#aefec4e9a3022ad0d5e6f8c68905d2ad7">flags</a> = <a class="code" href="route_8h.html#ad868f081f0334c1a64d0682283139425">RT_DEFINED</a> | <a class="code" href="route_8h.html#a7c86f9369806a6f86f30a7c3185d740a">RT_METRIC_DEFINED</a>;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        r.<a class="code" href="structroute__ipv4.html#ab38b0a2ab01c05b74c40c32b9b486e96">network</a> = tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a> &amp; tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        r.<a class="code" href="structroute__ipv4.html#ac423abdde955f3da899a72382763b470">netmask</a> = tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>;</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        r.<a class="code" href="structroute__ipv4.html#ad7a3c222084b1c670a62dc6d3d0f2fb5">gateway</a> = tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>;</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        r.<a class="code" href="structroute__ipv4.html#a05f41b340e53a6c8292fefc84204ea74">metric</a> = 0;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        <a class="code" href="route_8c.html#a993077e75f7841305cf71aa248e287cb">add_route</a>(&amp;r, tt, 0, NULL, es, NULL);</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    }</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160; </div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="preprocessor">#elif defined(TARGET_OPENBSD)</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160; </div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> remote_end;           <span class="comment">/* for &quot;virtual&quot; subnet topology */</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160; </div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="comment">     * On OpenBSD, tun interfaces are persistent if created with</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment">     * &quot;ifconfig tunX create&quot;, and auto-destroyed if created by</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment">     * opening &quot;/dev/tunX&quot; (so we just use the /dev/tunX)</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160; </div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <span class="comment">/* example: ifconfig tun2 10.2.0.2 10.2.0.1 mtu 1450 netmask 255.255.255.255 up */</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <span class="keywordflow">if</span> (tun)</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    {</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>,</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                    <span class="stringliteral">&quot;%s %s %s %s mtu %d netmask 255.255.255.255 up -link0&quot;</span>,</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                    <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, ifname, ifconfig_local,</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                    ifconfig_remote_netmask, tun_mtu);</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    }</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a> == <a class="code" href="proto_8h.html#af4249a88f691a14cb178b7222d35e150">TOP_SUBNET</a>)</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    {</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        remote_end = create_arbitrary_remote( tt );</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s %s %s mtu %d netmask %s up -link0&quot;</span>,</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                    <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, ifname, ifconfig_local,</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;                    <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(remote_end, 0, &amp;gc), tun_mtu,</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;                    ifconfig_remote_netmask);</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    }</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    {</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s %s netmask %s mtu %d link0&quot;</span>,</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;                    <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, ifname, ifconfig_local,</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                    ifconfig_remote_netmask, tun_mtu);</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    }</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, <a class="code" href="run__command_8h.html#a2a6d02b9ff0a76e78bf5c76834a29d89">S_FATAL</a>, <span class="stringliteral">&quot;OpenBSD ifconfig failed&quot;</span>);</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160; </div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <span class="comment">/* Add a network route for the local tun interface */</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    <span class="keywordflow">if</span> (!tun &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a> == <a class="code" href="proto_8h.html#af4249a88f691a14cb178b7222d35e150">TOP_SUBNET</a>)</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    {</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        <span class="keyword">struct </span><a class="code" href="structroute__ipv4.html">route_ipv4</a> r;</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;        <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(r);</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;        r.<a class="code" href="structroute__ipv4.html#aefec4e9a3022ad0d5e6f8c68905d2ad7">flags</a> = <a class="code" href="route_8h.html#ad868f081f0334c1a64d0682283139425">RT_DEFINED</a>;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;        r.<a class="code" href="structroute__ipv4.html#ab38b0a2ab01c05b74c40c32b9b486e96">network</a> = tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a> &amp; tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        r.<a class="code" href="structroute__ipv4.html#ac423abdde955f3da899a72382763b470">netmask</a> = tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>;</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;        r.<a class="code" href="structroute__ipv4.html#ad7a3c222084b1c670a62dc6d3d0f2fb5">gateway</a> = remote_end;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        <a class="code" href="route_8c.html#a993077e75f7841305cf71aa248e287cb">add_route</a>(&amp;r, tt, 0, NULL, es, NULL);</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    }</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160; </div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="preprocessor">#elif defined(TARGET_NETBSD)</span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> remote_end;           <span class="comment">/* for &quot;virtual&quot; subnet topology */</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160; </div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    <span class="keywordflow">if</span> (tun)</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    {</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s %s %s mtu %d netmask 255.255.255.255 up&quot;</span>,</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;                    <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, ifname, ifconfig_local,</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;                    ifconfig_remote_netmask, tun_mtu);</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    }</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a> == <a class="code" href="proto_8h.html#af4249a88f691a14cb178b7222d35e150">TOP_SUBNET</a>)</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    {</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;        remote_end = create_arbitrary_remote(tt);</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s %s %s mtu %d netmask %s up&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>,</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;                    ifname, ifconfig_local, <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(remote_end, 0, &amp;gc),</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;                    tun_mtu, ifconfig_remote_netmask);</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    }</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    {</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="comment">         * NetBSD has distinct tun and tap devices</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="comment">         * so we don&#39;t need the &quot;link0&quot; extra parameter to specify we want to do</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="comment">         * tunneling at the ethernet level</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s %s netmask %s mtu %d&quot;</span>,</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;                    <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, ifname, ifconfig_local,</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;                    ifconfig_remote_netmask, tun_mtu);</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    }</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, <a class="code" href="run__command_8h.html#a2a6d02b9ff0a76e78bf5c76834a29d89">S_FATAL</a>, <span class="stringliteral">&quot;NetBSD ifconfig failed&quot;</span>);</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160; </div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <span class="comment">/* Add a network route for the local tun interface */</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <span class="keywordflow">if</span> (!tun &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a> == <a class="code" href="proto_8h.html#af4249a88f691a14cb178b7222d35e150">TOP_SUBNET</a>)</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    {</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        <span class="keyword">struct </span><a class="code" href="structroute__ipv4.html">route_ipv4</a> r;</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;        <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(r);</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        r.<a class="code" href="structroute__ipv4.html#aefec4e9a3022ad0d5e6f8c68905d2ad7">flags</a> = <a class="code" href="route_8h.html#ad868f081f0334c1a64d0682283139425">RT_DEFINED</a>;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;        r.<a class="code" href="structroute__ipv4.html#ab38b0a2ab01c05b74c40c32b9b486e96">network</a> = tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a> &amp; tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;        r.<a class="code" href="structroute__ipv4.html#ac423abdde955f3da899a72382763b470">netmask</a> = tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>;</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        r.<a class="code" href="structroute__ipv4.html#ad7a3c222084b1c670a62dc6d3d0f2fb5">gateway</a> = remote_end;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;        <a class="code" href="route_8c.html#a993077e75f7841305cf71aa248e287cb">add_route</a>(&amp;r, tt, 0, NULL, es, NULL);</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    }</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160; </div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="preprocessor">#elif defined(TARGET_DARWIN)</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="comment">     * Darwin (i.e. Mac OS X) seems to exhibit similar behaviour to OpenBSD...</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160; </div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s delete&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, ifname);</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, 0, NULL);</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>,</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;        <span class="stringliteral">&quot;NOTE: Tried to delete pre-existing tun/tap instance -- No Problem if failure&quot;</span>);</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160; </div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160; </div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    <span class="comment">/* example: ifconfig tun2 10.2.0.2 10.2.0.1 mtu 1450 netmask 255.255.255.255 up */</span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    <span class="keywordflow">if</span> (tun)</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    {</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s %s %s mtu %d netmask 255.255.255.255 up&quot;</span>,</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;                    <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, ifname, ifconfig_local,</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;                    ifconfig_remote_netmask, tun_mtu);</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    }</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    {</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a> == <a class="code" href="proto_8h.html#af4249a88f691a14cb178b7222d35e150">TOP_SUBNET</a>)</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;        {</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;            <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s %s %s netmask %s mtu %d up&quot;</span>,</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;                        <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, ifname, ifconfig_local, ifconfig_local,</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;                        ifconfig_remote_netmask, tun_mtu);</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        }</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        {</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;            <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s %s netmask %s mtu %d up&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>,</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;                        ifname, ifconfig_local, ifconfig_remote_netmask,</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;                        tun_mtu);</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        }</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    }</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160; </div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, <a class="code" href="run__command_8h.html#a2a6d02b9ff0a76e78bf5c76834a29d89">S_FATAL</a>, <span class="stringliteral">&quot;Mac OS X ifconfig failed&quot;</span>);</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160; </div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <span class="comment">/* Add a network route for the local tun interface */</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <span class="keywordflow">if</span> (!tun &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a> == <a class="code" href="proto_8h.html#af4249a88f691a14cb178b7222d35e150">TOP_SUBNET</a>)</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    {</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;        <span class="keyword">struct </span><a class="code" href="structroute__ipv4.html">route_ipv4</a> r;</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;        <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(r);</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;        r.<a class="code" href="structroute__ipv4.html#aefec4e9a3022ad0d5e6f8c68905d2ad7">flags</a> = <a class="code" href="route_8h.html#ad868f081f0334c1a64d0682283139425">RT_DEFINED</a>;</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        r.<a class="code" href="structroute__ipv4.html#ab38b0a2ab01c05b74c40c32b9b486e96">network</a> = tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a> &amp; tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        r.<a class="code" href="structroute__ipv4.html#ac423abdde955f3da899a72382763b470">netmask</a> = tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>;</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        r.<a class="code" href="structroute__ipv4.html#ad7a3c222084b1c670a62dc6d3d0f2fb5">gateway</a> = tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>;</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        <a class="code" href="route_8c.html#a993077e75f7841305cf71aa248e287cb">add_route</a>(&amp;r, tt, 0, NULL, es, NULL);</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    }</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160; </div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="preprocessor">#elif defined(TARGET_FREEBSD) || defined(TARGET_DRAGONFLY)</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160; </div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> remote_end;           <span class="comment">/* for &quot;virtual&quot; subnet topology */</span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160; </div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    <span class="comment">/* example: ifconfig tun2 10.2.0.2 10.2.0.1 mtu 1450 netmask 255.255.255.255 up */</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    <span class="keywordflow">if</span> (tun)</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    {</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s %s %s mtu %d netmask 255.255.255.255 up&quot;</span>,</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;                    <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, ifname, ifconfig_local,</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;                    ifconfig_remote_netmask, tun_mtu);</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    }</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a> == <a class="code" href="proto_8h.html#af4249a88f691a14cb178b7222d35e150">TOP_SUBNET</a>)</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    {</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        remote_end = create_arbitrary_remote( tt );</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s %s %s mtu %d netmask %s up&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>,</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;                    ifname, ifconfig_local, <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(remote_end, 0, &amp;gc),</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;                    tun_mtu, ifconfig_remote_netmask);</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    }</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    {</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s %s netmask %s mtu %d up&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>,</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;                    ifname, ifconfig_local, ifconfig_remote_netmask, tun_mtu);</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    }</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160; </div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, <a class="code" href="run__command_8h.html#a2a6d02b9ff0a76e78bf5c76834a29d89">S_FATAL</a>, <span class="stringliteral">&quot;FreeBSD ifconfig failed&quot;</span>);</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160; </div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="comment">/* Add a network route for the local tun interface */</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="keywordflow">if</span> (!tun &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a> == <a class="code" href="proto_8h.html#af4249a88f691a14cb178b7222d35e150">TOP_SUBNET</a>)</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    {</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        <span class="keyword">struct </span><a class="code" href="structroute__ipv4.html">route_ipv4</a> r;</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(r);</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        r.<a class="code" href="structroute__ipv4.html#aefec4e9a3022ad0d5e6f8c68905d2ad7">flags</a> = <a class="code" href="route_8h.html#ad868f081f0334c1a64d0682283139425">RT_DEFINED</a>;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;        r.<a class="code" href="structroute__ipv4.html#ab38b0a2ab01c05b74c40c32b9b486e96">network</a> = tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a> &amp; tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>;</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        r.<a class="code" href="structroute__ipv4.html#ac423abdde955f3da899a72382763b470">netmask</a> = tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;        r.<a class="code" href="structroute__ipv4.html#ad7a3c222084b1c670a62dc6d3d0f2fb5">gateway</a> = remote_end;</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;        <a class="code" href="route_8c.html#a993077e75f7841305cf71aa248e287cb">add_route</a>(&amp;r, tt, 0, NULL, es, NULL);</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    }</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160; </div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="preprocessor">#elif defined(TARGET_AIX)</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    {</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        <span class="comment">/* AIX ifconfig will complain if it can&#39;t find ODM path in env */</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        <span class="keyword">struct </span><a class="code" href="structenv__set.html">env_set</a> *aix_es = <a class="code" href="env__set_8c.html#a589b54db89bdd1a4683d80b8132ce577">env_set_create</a>(NULL);</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        <a class="code" href="env__set_8c.html#a8f95bd5663cdc04bc9764b429538f536">env_set_add</a>( aix_es, <span class="stringliteral">&quot;ODMDIR=/etc/objrepos&quot;</span> );</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160; </div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        <span class="keywordflow">if</span> (tun)</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        {</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;no tun support on AIX (canthappen)&quot;</span>);</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        }</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160; </div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        <span class="comment">/* example: ifconfig tap0 172.30.1.1 netmask 255.255.254.0 up */</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s %s netmask %s mtu %d up&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>,</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;                    ifname, ifconfig_local, ifconfig_remote_netmask, tun_mtu);</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160; </div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;        <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, aix_es, <a class="code" href="run__command_8h.html#a2a6d02b9ff0a76e78bf5c76834a29d89">S_FATAL</a>, <span class="stringliteral">&quot;AIX ifconfig failed&quot;</span>);</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160; </div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        <a class="code" href="env__set_8c.html#a2d1a7f0ea69776000aa9df3eca186f97">env_set_destroy</a>(aix_es);</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    }</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="preprocessor">#elif defined (_WIN32)</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ac4735c903581ca3bb0c35dbe48b4e4dd">ip_win32_type</a> == <a class="code" href="tun_8h.html#a85a39082c97534bda4e02e0ed0bfd841">IPW32_SET_MANUAL</a>)</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    {</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>,</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;            <span class="stringliteral">&quot;******** NOTE:  Please manually set the IP/netmask of &#39;%s&#39; to %s/%s (if it is not already set)&quot;</span>,</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;            ifname, ifconfig_local,</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;            <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#a9d418d686f4369092543bcced16a39ee">adapter_netmask</a>, 0, &amp;<a class="code" href="structenv__set.html#ac1f5edea620699ff13763b84a008e365">gc</a>));</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    }</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ac4735c903581ca3bb0c35dbe48b4e4dd">ip_win32_type</a> == <a class="code" href="tun_8h.html#a53b8d43ac0464c0ad92cb7dc1ad2cb34">IPW32_SET_DHCP_MASQ</a> || tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ac4735c903581ca3bb0c35dbe48b4e4dd">ip_win32_type</a> == <a class="code" href="tun_8h.html#a23ccb7500379bdc9c5944b9e02e74b5c">IPW32_SET_ADAPTIVE</a>)</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    {</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;        <span class="comment">/* Let the DHCP configure the interface. */</span></div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    }</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">msg_channel</a>)</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    {</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;        <a class="code" href="tun_8c.html#a11011674316342ddaaad3f76739d78e3">do_address_service</a>(<span class="keyword">true</span>, AF_INET, tt);</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;        <a class="code" href="tun_8c.html#a1140731439cf4a6b364712a1ba146649">do_dns_service</a>(<span class="keyword">true</span>, AF_INET, tt);</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;        <a class="code" href="tun_8c.html#a1c3bf6ba2997de67eb98b3be45d85721">do_dns_domain_service</a>(<span class="keyword">true</span>, tt);</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    }</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ac4735c903581ca3bb0c35dbe48b4e4dd">ip_win32_type</a> == <a class="code" href="tun_8h.html#a14ab5cbbb86cd3bb1cfd7e0691ab4eab">IPW32_SET_NETSH</a>)</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    {</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        <a class="code" href="tun_8c.html#a4636ecf580e72087b1cd63dcc1375ec9">netsh_ifconfig</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>, tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>, tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>,</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;                       tt-&gt;<a class="code" href="structtuntap.html#a9d418d686f4369092543bcced16a39ee">adapter_netmask</a>, <a class="code" href="tun_8c.html#ae4ca7b1df4a85e25a8638afedb54b6dd">NI_IP_NETMASK</a>|<a class="code" href="tun_8c.html#a732f35a455d3cc46d0dd3d6b94239b87">NI_OPTIONS</a>);</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    }</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">msg_channel</a>)</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    {</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;        <a class="code" href="tun_8c.html#adb24eb87f48b33a3646747ec0fb9d088">do_set_mtu_service</a>(tt, AF_INET, tun_mtu);</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    }</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    {</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;        <a class="code" href="tun_8c.html#ade2f6913cf1b1b4b6d342140d1db9f97">windows_set_mtu</a>(tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>, AF_INET, tun_mtu);</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    }</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;<span class="preprocessor">#else  </span><span class="comment">/* if defined(TARGET_LINUX) */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Sorry, but I don&#39;t know how to do &#39;ifconfig&#39; commands on this operating system.  You should ifconfig your TUN/TAP device manually or use an --up script.&quot;</span>);</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* if defined(TARGET_LINUX) */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160; </div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;<span class="preprocessor">#if !defined(TARGET_LINUX)</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;<a class="code" href="structenv__set.html#ac1f5edea620699ff13763b84a008e365">gc</a>);</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;}</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160; </div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="comment">/* execute the ifconfig command through the shell */</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"><a class="line" href="tun_8h.html#a93c06e46676d0c56871eb1a71fc0c58e"> 1576</a></span>&#160;<a class="code" href="tun_8c.html#a93c06e46676d0c56871eb1a71fc0c58e">do_ifconfig</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keyword">const</span> <span class="keywordtype">char</span> *ifname, <span class="keywordtype">int</span> tun_mtu,</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;            <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structenv__set.html">env_set</a> *es, <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;{</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ad7eba86279cb00fc16742e45bfcf3187">D_LOW</a>, <span class="stringliteral">&quot;do_ifconfig, ipv4=%d, ipv6=%d&quot;</span>, tt-&gt;<a class="code" href="structtuntap.html#a8d99c6cfbc9fdf2c1466535afeebdbdb">did_ifconfig_setup</a>,</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#a70831f0f929eb68a2c0cdd85dc8c917c">did_ifconfig_ipv6_setup</a>);</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160; </div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;<span class="preprocessor">#ifdef ENABLE_MANAGEMENT</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structmanagement.html">management</a>)</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    {</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;        <a class="code" href="manage_8c.html#a8ad93473fd4ba6402ecea847d69afae1">management_set_state</a>(<a class="code" href="structmanagement.html">management</a>,</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                             <a class="code" href="manage_8h.html#ab76907c773f31afd5043b6c6f7a9d54d">OPENVPN_STATE_ASSIGN_IP</a>,</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;                             NULL,</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;                             &amp;tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>,</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;                             &amp;tt-&gt;<a class="code" href="structtuntap.html#ab854704d9efd886f25b7a0083b0196c6">local_ipv6</a>,</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;                             NULL,</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;                             NULL);</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    }</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160; </div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a8d99c6cfbc9fdf2c1466535afeebdbdb">did_ifconfig_setup</a>)</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    {</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;        <a class="code" href="tun_8c.html#a80f4326c6867bc81a083128864766ce9">do_ifconfig_ipv4</a>(tt, ifname, tun_mtu, es, ctx);</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    }</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160; </div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a70831f0f929eb68a2c0cdd85dc8c917c">did_ifconfig_ipv6_setup</a>)</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    {</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        <a class="code" href="tun_8c.html#a1be16b7c5abd7150fdd0e65cb571d113">do_ifconfig_ipv6</a>(tt, ifname, tun_mtu, es, ctx);</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;    }</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160; </div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <span class="comment">/* release resources potentially allocated during interface setup */</span></div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <a class="code" href="networking_8h.html#af9f3186469845cfed931bb7a741054eb">net_ctx_free</a>(ctx);</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;}</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160; </div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"><a class="line" href="tun_8c.html#a12ceabb38605c3156412412d40931506"> 1610</a></span>&#160;<a class="code" href="tun_8c.html#a12ceabb38605c3156412412d40931506">clear_tuntap</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *<a class="code" href="structtuntap.html">tuntap</a>)</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;{</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(*<a class="code" href="structtuntap.html">tuntap</a>);</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    <a class="code" href="structtuntap.html">tuntap</a>-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a> = NULL;</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    <a class="code" href="structtuntap.html">tuntap</a>-&gt;fd = -1;</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="preprocessor">#ifdef TARGET_SOLARIS</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    <a class="code" href="structtuntap.html">tuntap</a>-&gt;ip_fd = -1;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;}</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160; </div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"><a class="line" href="tun_8c.html#a86337d8f968065ef71dc084645056fe0"> 1624</a></span>&#160;<a class="code" href="tun_8c.html#a86337d8f968065ef71dc084645056fe0">open_null</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;{</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a> = <a class="code" href="buffer_8c.html#a06e0220403278399596a7a1b6b601fca">string_alloc</a>(<span class="stringliteral">&quot;null&quot;</span>, NULL);</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;}</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160; </div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160; </div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;<span class="preprocessor">#if defined (TARGET_OPENBSD) || (defined(TARGET_DARWIN) &amp;&amp; HAVE_NET_IF_UTUN_H)</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160; </div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;<span class="comment"> * OpenBSD and Mac OS X when using utun</span></div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;<span class="comment"> * have a slightly incompatible TUN device from</span></div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="comment"> * the rest of the world, in that it prepends a</span></div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;<span class="comment"> * uint32 to the beginning of the IP header</span></div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;<span class="comment"> * to designate the protocol (why not just</span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;<span class="comment"> * look at the version field in the IP header to</span></div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;<span class="comment"> * determine v4 or v6?).</span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="comment"> * We strip off this field on reads and</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="comment"> * put it back on writes.</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;<span class="comment"> * I have not tested TAP devices on OpenBSD,</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;<span class="comment"> * but I have conditionalized the special</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="comment"> * TUN handling code described above to</span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="comment"> * go away for TAP devices.</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160; </div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;<span class="preprocessor">#include &lt;netinet/ip.h&gt;</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;<span class="preprocessor">#include &lt;sys/uio.h&gt;</span></div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160; </div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;header_modify_read_write_return(<span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;{</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    <span class="keywordflow">if</span> (len &gt; 0)</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    {</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        <span class="keywordflow">return</span> len &gt; <span class="keyword">sizeof</span>(u_int32_t) ? len - <span class="keyword">sizeof</span>(u_int32_t) : 0;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    }</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;    {</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        <span class="keywordflow">return</span> len;</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    }</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;}</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160; </div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;write_tun_header(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;{</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    {</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        u_int32_t type;</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        <span class="keyword">struct </span>iovec iv[2];</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;        <span class="keyword">struct </span><a class="code" href="structopenvpn__iphdr.html">openvpn_iphdr</a> *iph;</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160; </div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;        iph = (<span class="keyword">struct </span><a class="code" href="structopenvpn__iphdr.html">openvpn_iphdr</a> *) buf;</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160; </div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="proto_8h.html#ab6b5bc35bc49835a9d79ad0a160d6396">OPENVPN_IPH_GET_VER</a>(iph-&gt;<a class="code" href="structopenvpn__iphdr.html#af3c74339e4e6ab5c8edbb5b8d1ab3fa6">version_len</a>) == 6)</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        {</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;            type = htonl(AF_INET6);</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;        }</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;        {</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;            type = htonl(AF_INET);</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;        }</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160; </div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;        iv[0].iov_base = &amp;type;</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;        iv[0].iov_len = <span class="keyword">sizeof</span>(type);</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;        iv[1].iov_base = buf;</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;        iv[1].iov_len = len;</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160; </div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;        <span class="keywordflow">return</span> header_modify_read_write_return(writev(tt-&gt;fd, iv, 2));</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;    }</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    {</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aae835b662be01cdc3752f7db84529cca">write</a>(tt-&gt;fd, buf, len);</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    }</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;}</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160; </div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;read_tun_header(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;{</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    {</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;        u_int32_t type;</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;        <span class="keyword">struct </span>iovec iv[2];</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160; </div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;        iv[0].iov_base = &amp;type;</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;        iv[0].iov_len = <span class="keyword">sizeof</span>(type);</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;        iv[1].iov_base = buf;</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;        iv[1].iov_len = len;</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160; </div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;        <span class="keywordflow">return</span> header_modify_read_write_return(readv(tt-&gt;fd, iv, 2));</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    }</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    {</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aea7c12cb3031ad9e88104ce9859ce1c5">read</a>(tt-&gt;fd, buf, len);</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    }</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;}</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* if defined (TARGET_OPENBSD) || (defined(TARGET_DARWIN) &amp;&amp; HAVE_NET_IF_UTUN_H) */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160; </div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160; </div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;<span class="preprocessor">#if !(defined(_WIN32) || defined(TARGET_LINUX))</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;open_tun_generic(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node,</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;                 <span class="keywordtype">bool</span> dynamic, <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;{</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    <span class="keywordtype">char</span> tunname[256];</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    <span class="keywordtype">char</span> dynamic_name[256];</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    <span class="keywordtype">bool</span> dynamic_opened = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160; </div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a541255b8640c189d1bd902f1168b1ee5">DEV_TYPE_NULL</a>)</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    {</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;        <a class="code" href="tun_8c.html#a86337d8f968065ef71dc084645056fe0">open_null</a>(tt);</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    }</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;    {</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="comment">         * --dev-node specified, so open an explicit device node</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        <span class="keywordflow">if</span> (dev_node)</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;        {</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;            <a class="code" href="buffer_8c.html#afd2a93a0940b1ea7e093d293a05e2927">openvpn_snprintf</a>(tunname, <span class="keyword">sizeof</span>(tunname), <span class="stringliteral">&quot;%s&quot;</span>, dev_node);</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;        }</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;        {</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="comment">             * dynamic open is indicated by --dev specified without</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="comment">             * explicit unit number.  Try opening /dev/[dev]n</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="comment">             * where n = [0, 255].</span></div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="preprocessor">#ifdef TARGET_NETBSD</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;            <span class="comment">/* on NetBSD, tap (but not tun) devices are opened by</span></div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;<span class="comment">             * opening /dev/tap and then querying the system about the</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;<span class="comment">             * actual device name (tap0, tap1, ...) assigned</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;            <span class="keywordflow">if</span> (dynamic &amp;&amp; strcmp( dev, <span class="stringliteral">&quot;tap&quot;</span> ) == 0)</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;            {</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;                <span class="keyword">struct </span>ifreq ifr;</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;                <span class="keywordflow">if</span> ((tt-&gt;fd = open( <span class="stringliteral">&quot;/dev/tap&quot;</span>, O_RDWR)) &lt; 0)</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;                {</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;                    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Cannot allocate NetBSD TAP dev dynamically&quot;</span>);</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;                }</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;                <span class="keywordflow">if</span> (ioctl( tt-&gt;fd, TAPGIFNAME, (<span class="keywordtype">void</span> *)&amp;ifr ) &lt; 0)</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;                {</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;                    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Cannot query NetBSD TAP device name&quot;</span>);</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;                }</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;                <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(dynamic_name);</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;                strncpy( dynamic_name, ifr.ifr_name, <span class="keyword">sizeof</span>(dynamic_name)-1 );</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;                dynamic_opened = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;                <a class="code" href="buffer_8c.html#afd2a93a0940b1ea7e093d293a05e2927">openvpn_snprintf</a>(tunname, <span class="keyword">sizeof</span>(tunname), <span class="stringliteral">&quot;/dev/%s&quot;</span>, dynamic_name );</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;            }</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160; </div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;            <span class="keywordflow">if</span> (dynamic &amp;&amp; !<a class="code" href="buffer_8h.html#a65b6eb18e921471079b1cff89fe0db39">has_digit</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)dev))</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;            {</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;                <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;                <span class="keywordflow">for</span> (i = 0; i &lt; 256; ++i)</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;                {</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;                    <a class="code" href="buffer_8c.html#afd2a93a0940b1ea7e093d293a05e2927">openvpn_snprintf</a>(tunname, <span class="keyword">sizeof</span>(tunname),</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;                                     <span class="stringliteral">&quot;/dev/%s%d&quot;</span>, dev, i);</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;                    <a class="code" href="buffer_8c.html#afd2a93a0940b1ea7e093d293a05e2927">openvpn_snprintf</a>(dynamic_name, <span class="keyword">sizeof</span>(dynamic_name),</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;                                     <span class="stringliteral">&quot;%s%d&quot;</span>, dev, i);</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;                    <span class="keywordflow">if</span> ((tt-&gt;fd = open(tunname, O_RDWR)) &gt; 0)</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;                    {</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;                        dynamic_opened = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;                    }</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;                    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#abe74dee3b7a9490bbbf2e9ce72f3718a">D_READ_WRITE</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;Tried opening %s (failed)&quot;</span>, tunname);</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;                }</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;                <span class="keywordflow">if</span> (!dynamic_opened)</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;                {</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;                    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Cannot allocate TUN/TAP dev dynamically&quot;</span>);</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;                }</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;            }</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="comment">             * explicit unit number specified</span></div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;            {</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;                <a class="code" href="buffer_8c.html#afd2a93a0940b1ea7e093d293a05e2927">openvpn_snprintf</a>(tunname, <span class="keyword">sizeof</span>(tunname), <span class="stringliteral">&quot;/dev/%s&quot;</span>, dev);</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;            }</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;        }</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160; </div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;        <span class="keywordflow">if</span> (!dynamic_opened)</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        {</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;            <span class="comment">/* has named device existed before? if so, don&#39;t destroy at end */</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;            <span class="keywordflow">if</span> (if_nametoindex( dev ) &gt; 0)</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;            {</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;TUN/TAP device %s exists previously, keep at program end&quot;</span>, dev );</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;                tt-&gt;<a class="code" href="structtuntap.html#afd4a0397ced0c1118162c669228dfc58">persistent_if</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;            }</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160; </div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;            <span class="keywordflow">if</span> ((tt-&gt;fd = open(tunname, O_RDWR)) &lt; 0)</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;            {</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Cannot open TUN/TAP dev %s&quot;</span>, tunname);</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;            }</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;        }</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160; </div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;        <a class="code" href="fdmisc_8c.html#a4bd55f9b59d6c9123787beb7431dac85">set_nonblock</a>(tt-&gt;fd);</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;        <a class="code" href="fdmisc_8c.html#a09193ec56615d682308eff8c491fc791">set_cloexec</a>(tt-&gt;fd); <span class="comment">/* don&#39;t pass fd to scripts */</span></div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;TUN/TAP device %s opened&quot;</span>, tunname);</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160; </div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;        <span class="comment">/* tt-&gt;actual_name is passed to up and down scripts and used as the ifconfig dev name */</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a> = <a class="code" href="buffer_8c.html#a06e0220403278399596a7a1b6b601fca">string_alloc</a>(dynamic_opened ? dynamic_name : dev, NULL);</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    }</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;}</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !_WIN32 &amp;&amp; !TARGET_LINUX */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160; </div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="preprocessor">#if !defined(_WIN32)</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;close_tun_generic(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;{</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;fd &gt;= 0)</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    {</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;        close(tt-&gt;fd);</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;    }</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>)</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    {</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;        free(tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>);</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;    }</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    <a class="code" href="tun_8c.html#a12ceabb38605c3156412412d40931506">clear_tuntap</a>(tt);</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;}</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !_WIN32 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160; </div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="preprocessor">#if defined (TARGET_ANDROID)</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;<a class="code" href="tun_8c.html#a8ed81f24edc25b83eba293057754830b">open_tun</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node, <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;{</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="preprocessor">#define ANDROID_TUNNAME &quot;vpnservice-tun&quot;</span></div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;    <span class="keyword">struct </span><a class="code" href="structuser__pass.html">user_pass</a> up;</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    <span class="keywordtype">bool</span> opentun;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160; </div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    <span class="keywordtype">int</span> oldtunfd = tt-&gt;fd;</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160; </div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    <span class="comment">/* Prefer IPv6 DNS servers,</span></div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;<span class="comment">     * Android will use the DNS server in the order we specify*/</span></div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a1c1812cd166c6b8069060d6005934736">dns6_len</a>; i++)</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    {</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;        management_android_control(<a class="code" href="structmanagement.html">management</a>, <span class="stringliteral">&quot;DNS6SERVER&quot;</span>,</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;                                   <a class="code" href="socket_8c.html#a9a911c5dde4c809f7cb3eef8e5918a8e">print_in6_addr</a>(tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a0ecf9d2ac33d53674fd03d741cb6e4d5">dns6</a>[i], 0, &amp;gc));</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;    }</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160; </div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a143af129775b5984fa835d5c0026e75c">dns_len</a>; i++)</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    {</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;        management_android_control(<a class="code" href="structmanagement.html">management</a>, <span class="stringliteral">&quot;DNSSERVER&quot;</span>,</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;                                   <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a5c59bd51c39835c98556b124f30611b6">dns</a>[i], 0, &amp;gc));</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    }</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160; </div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a79c23140e69d2545d30656f315a20665">domain</a>)</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    {</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;        management_android_control(<a class="code" href="structmanagement.html">management</a>, <span class="stringliteral">&quot;DNSDOMAIN&quot;</span>, tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a79c23140e69d2545d30656f315a20665">domain</a>);</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    }</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160; </div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    <span class="keywordtype">int</span> android_method = managment_android_persisttun_action(<a class="code" href="structmanagement.html">management</a>);</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160; </div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    <span class="comment">/* Android 4.4 workaround */</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    <span class="keywordflow">if</span> (oldtunfd &gt;=0 &amp;&amp; android_method == ANDROID_OPEN_AFTER_CLOSE)</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    {</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        close(oldtunfd);</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;        <a class="code" href="manage_8c.html#af07a56f96cec84856d0bf97899a4d460">management_sleep</a>(2);</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    }</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160; </div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    <span class="keywordflow">if</span> (oldtunfd &gt;=0  &amp;&amp; android_method == ANDROID_KEEP_OLD_TUN)</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    {</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        <span class="comment">/* keep the old fd */</span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;        opentun = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;    }</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;    {</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;        opentun = management_android_control(<a class="code" href="structmanagement.html">management</a>, <span class="stringliteral">&quot;OPENTUN&quot;</span>, dev);</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;        <span class="comment">/* Pick up the fd from management interface after calling the</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment">         * OPENTUN command */</span></div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;        tt-&gt;fd = <a class="code" href="structmanagement.html">management</a>-&gt;<a class="code" href="structmanagement.html#a2c35df935673267d011c9112a05e45d2">connection</a>.lastfdreceived;</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;        <a class="code" href="structmanagement.html">management</a>-&gt;<a class="code" href="structmanagement.html#a2c35df935673267d011c9112a05e45d2">connection</a>.lastfdreceived = -1;</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;    }</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160; </div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    <span class="keywordflow">if</span> (oldtunfd&gt;=0 &amp;&amp; android_method == ANDROID_OPEN_BEFORE_CLOSE)</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    {</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;        close(oldtunfd);</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;    }</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160; </div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    <span class="comment">/* Set the actual name to a dummy name */</span></div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a> = <a class="code" href="buffer_8c.html#a06e0220403278399596a7a1b6b601fca">string_alloc</a>(ANDROID_TUNNAME, NULL);</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160; </div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    <span class="keywordflow">if</span> ((tt-&gt;fd &lt; 0) || !opentun)</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    {</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;ERROR: Cannot open TUN&quot;</span>);</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    }</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160; </div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;}</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160; </div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<a class="code" href="tun_8c.html#aa160989ccb62fe8390475d34bda3d2f8">close_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;{</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(tt);</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160; </div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    close_tun_generic(tt);</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    free(tt);</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;}</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160; </div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;<a class="code" href="tun_8h.html#afdac6b3217749dccb863f9dc39818b9d">write_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;{</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aae835b662be01cdc3752f7db84529cca">write</a>(tt-&gt;fd, buf, len);</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;}</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160; </div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;<a class="code" href="tun_8h.html#ac75f33ac5fe746f7bf5733d9e8c67bf2">read_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;{</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aea7c12cb3031ad9e88104ce9859ce1c5">read</a>(tt-&gt;fd, buf, len);</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;}</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160; </div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;<span class="preprocessor">#elif defined(TARGET_LINUX)</span></div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160; </div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;<span class="preprocessor">#ifndef HAVE_LINUX_SOCKIOS_H</span></div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="preprocessor">#error header file linux/sockios.h required</span></div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160; </div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;<span class="preprocessor">#if !PEDANTIC</span></div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160; </div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;<a class="code" href="tun_8c.html#a8ed81f24edc25b83eba293057754830b">open_tun</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node, <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;{</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    <span class="keyword">struct </span>ifreq ifr;</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160; </div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;<span class="comment">     * We handle --dev null specially, we do not open /dev/null for this.</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a541255b8640c189d1bd902f1168b1ee5">DEV_TYPE_NULL</a>)</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    {</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;        <a class="code" href="tun_8c.html#a86337d8f968065ef71dc084645056fe0">open_null</a>(tt);</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    }</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;    {</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;<span class="comment">         * Process --dev-node</span></div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *node = dev_node;</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;        <span class="keywordflow">if</span> (!node)</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;        {</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;            node = <span class="stringliteral">&quot;/dev/net/tun&quot;</span>;</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;        }</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160; </div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;<span class="comment">         * Open the interface</span></div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;        <span class="keywordflow">if</span> ((tt-&gt;fd = open(node, O_RDWR)) &lt; 0)</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;        {</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;ERROR: Cannot open TUN/TAP dev %s&quot;</span>, node);</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;        }</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160; </div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;<span class="comment">         * Process --tun-ipv6</span></div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(ifr);</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;        ifr.ifr_flags = IFF_NO_PI;</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160; </div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;<span class="preprocessor">#if defined(IFF_ONE_QUEUE) &amp;&amp; defined(SIOCSIFTXQLEN)</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;        ifr.ifr_flags |= IFF_ONE_QUEUE;</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160; </div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;<span class="comment">         * Figure out if tun or tap device</span></div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;        {</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;            ifr.ifr_flags |= IFF_TUN;</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;        }</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a3e52229580f912055a75d0cad8eff3f5">DEV_TYPE_TAP</a>)</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;        {</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;            ifr.ifr_flags |= IFF_TAP;</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;        }</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;        {</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;I don&#39;t recognize device %s as a tun or tap device&quot;</span>,</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;                dev);</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;        }</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160; </div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;<span class="comment">         * Set an explicit name, if --dev is not tun or tap</span></div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;        <span class="keywordflow">if</span> (strcmp(dev, <span class="stringliteral">&quot;tun&quot;</span>) &amp;&amp; strcmp(dev, <span class="stringliteral">&quot;tap&quot;</span>))</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;        {</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;            <a class="code" href="buffer_8h.html#acf5c0f0d704fd5b44b4d066044efb52c">strncpynt</a>(ifr.ifr_name, dev, IFNAMSIZ);</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;        }</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160; </div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;<span class="comment">         * Use special ioctl that configures tun/tap device with the parms</span></div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;<span class="comment">         * we set in ifr</span></div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;        <span class="keywordflow">if</span> (ioctl(tt-&gt;fd, TUNSETIFF, (<span class="keywordtype">void</span> *) &amp;ifr) &lt; 0)</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;        {</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;ERROR: Cannot ioctl TUNSETIFF %s&quot;</span>, dev);</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;        }</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160; </div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;TUN/TAP device %s opened&quot;</span>, ifr.ifr_name);</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160; </div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="comment">         * Try making the TX send queue bigger</span></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;<span class="preprocessor">#if defined(IFF_ONE_QUEUE) &amp;&amp; defined(SIOCSIFTXQLEN)</span></div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.txqueuelen)</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;        {</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;            <span class="keyword">struct </span>ifreq netifr;</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;            <span class="keywordtype">int</span> ctl_fd;</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160; </div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;            <span class="keywordflow">if</span> ((ctl_fd = socket(AF_INET, SOCK_DGRAM, 0)) &gt;= 0)</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;            {</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;                <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(netifr);</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;                <a class="code" href="buffer_8h.html#acf5c0f0d704fd5b44b4d066044efb52c">strncpynt</a>(netifr.ifr_name, ifr.ifr_name, IFNAMSIZ);</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;                netifr.ifr_qlen = tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.txqueuelen;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;                <span class="keywordflow">if</span> (ioctl(ctl_fd, SIOCSIFTXQLEN, (<span class="keywordtype">void</span> *) &amp;netifr) &gt;= 0)</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;                {</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;                    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ac0efab1649521180bddeb20e44419a06">D_OSBUF</a>, <span class="stringliteral">&quot;TUN/TAP TX queue length set to %d&quot;</span>, tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.txqueuelen);</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;                }</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;                {</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;                    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;Note: Cannot set tx queue length on %s&quot;</span>, ifr.ifr_name);</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;                }</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;                close(ctl_fd);</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;            }</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;            {</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;Note: Cannot open control socket on %s&quot;</span>, ifr.ifr_name);</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;            }</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;        }</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* if defined(IFF_ONE_QUEUE) &amp;&amp; defined(SIOCSIFTXQLEN) */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160; </div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;        <a class="code" href="fdmisc_8c.html#a4bd55f9b59d6c9123787beb7431dac85">set_nonblock</a>(tt-&gt;fd);</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;        <a class="code" href="fdmisc_8c.html#a09193ec56615d682308eff8c491fc791">set_cloexec</a>(tt-&gt;fd);</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a> = <a class="code" href="buffer_8c.html#a06e0220403278399596a7a1b6b601fca">string_alloc</a>(ifr.ifr_name, NULL);</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    }</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;}</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160; </div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;<span class="preprocessor">#else  </span><span class="comment">/* if !PEDANTIC */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160; </div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;<a class="code" href="tun_8c.html#a8ed81f24edc25b83eba293057754830b">open_tun</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node, <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;{</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(0);</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;}</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160; </div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !PEDANTIC */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160; </div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;<span class="preprocessor">#ifdef ENABLE_FEATURE_TUN_PERSIST</span></div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160; </div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;<span class="comment">/* TUNSETGROUP appeared in 2.6.23 */</span></div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;<span class="preprocessor">#ifndef TUNSETGROUP</span></div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;<span class="preprocessor"># define TUNSETGROUP   _IOW(&#39;T&#39;, 206, int)</span></div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160; </div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;<a class="code" href="tun_8h.html#afef2adbc3d7467cec1a651e1d513f227">tuncfg</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node,</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;       <span class="keywordtype">int</span> persist_mode, <span class="keyword">const</span> <span class="keywordtype">char</span> *username, <span class="keyword">const</span> <span class="keywordtype">char</span> *groupname,</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;       <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap__options.html">tuntap_options</a> *<a class="code" href="structoptions.html">options</a>, <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;{</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtuntap.html">tuntap</a> *tt;</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160; </div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    <a class="code" href="buffer_8h.html#a0853c66f7fd4862a436ed6306d008c4b">ALLOC_OBJ</a>(tt, <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a>);</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;    <a class="code" href="tun_8c.html#a12ceabb38605c3156412412d40931506">clear_tuntap</a>(tt);</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> = <a class="code" href="tun_8c.html#a167ef5d50e4284066beb05f5466bd858">dev_type_enum</a>(dev, dev_type);</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;    tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a> = *<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>;</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;    <a class="code" href="tun_8c.html#a8ed81f24edc25b83eba293057754830b">open_tun</a>(dev, dev_type, dev_node, tt);</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;    <span class="keywordflow">if</span> (ioctl(tt-&gt;fd, TUNSETPERSIST, persist_mode) &lt; 0)</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;    {</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Cannot ioctl TUNSETPERSIST(%d) %s&quot;</span>, persist_mode, dev);</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;    }</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    <span class="keywordflow">if</span> (username != NULL)</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    {</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;        <span class="keyword">struct </span><a class="code" href="structplatform__state__user.html">platform_state_user</a> <a class="code" href="structplatform__state__user.html">platform_state_user</a>;</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160; </div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="platform_8c.html#a52d59a56eff6b981f01eff915af4fad8">platform_user_get</a>(username, &amp;<a class="code" href="structplatform__state__user.html">platform_state_user</a>))</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;        {</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Cannot get user entry for %s&quot;</span>, username);</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;        }</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ioctl(tt-&gt;fd, TUNSETOWNER, <a class="code" href="structplatform__state__user.html">platform_state_user</a>.pw-&gt;pw_uid) &lt; 0)</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;        {</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Cannot ioctl TUNSETOWNER(%s) %s&quot;</span>, username, dev);</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;        }</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    }</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;    <span class="keywordflow">if</span> (groupname != NULL)</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;    {</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;        <span class="keyword">struct </span><a class="code" href="structplatform__state__group.html">platform_state_group</a> <a class="code" href="structplatform__state__group.html">platform_state_group</a>;</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160; </div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="platform_8c.html#ac9360f2b8017f5885191fd52e3192ddd">platform_group_get</a>(groupname, &amp;<a class="code" href="structplatform__state__group.html">platform_state_group</a>))</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;        {</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Cannot get group entry for %s&quot;</span>, groupname);</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;        }</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ioctl(tt-&gt;fd, TUNSETGROUP, <a class="code" href="structplatform__state__group.html">platform_state_group</a>.gr-&gt;gr_gid) &lt; 0)</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;        {</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Cannot ioctl TUNSETGROUP(%s) %s&quot;</span>, groupname, dev);</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;        }</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;    }</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;    <a class="code" href="tun_8c.html#aa160989ccb62fe8390475d34bda3d2f8">close_tun</a>(tt, ctx);</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;Persist state set to: %s&quot;</span>, (persist_mode ? <span class="stringliteral">&quot;ON&quot;</span> : <span class="stringliteral">&quot;OFF&quot;</span>));</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;}</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160; </div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ENABLE_FEATURE_TUN_PERSIST */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160; </div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;undo_ifconfig_ipv4(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;{</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;<span class="preprocessor">#if defined(TARGET_LINUX)</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;    <span class="keywordtype">int</span> netbits = <a class="code" href="route_8c.html#a2aee01d5c10bd617615f031180ee7062">netmask_to_netbits2</a>(tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>);</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160; </div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tun_8c.html#add5885eccc02f0f7e9d7edb7e781fa02">is_tun_p2p</a>(tt))</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;    {</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;        <span class="keywordflow">if</span> (net_addr_ptp_v4_del(ctx, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>, &amp;tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>,</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;                                &amp;tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>) &lt; 0)</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;        {</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;Linux can&#39;t del IP from iface %s&quot;</span>,</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;                tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>);</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;        }</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    }</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    {</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;        <span class="keywordflow">if</span> (net_addr_v4_del(ctx, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>, &amp;tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>, netbits) &lt; 0)</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;        {</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;Linux can&#39;t del IP from iface %s&quot;</span>,</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;                tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>);</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;        }</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;    }</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;<span class="preprocessor">#else  </span><span class="comment">/* ifndef TARGET_LINUX */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;    <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160; </div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;    <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s 0.0.0.0&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>);</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160; </div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, NULL, 0, <span class="stringliteral">&quot;Generic ip addr del failed&quot;</span>);</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160; </div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;    <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ifdef TARGET_LINUX */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;}</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160; </div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;undo_ifconfig_ipv6(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;{</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;<span class="preprocessor">#if defined(TARGET_LINUX)</span></div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    <span class="keywordflow">if</span> (net_addr_v6_del(ctx, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>, &amp;tt-&gt;<a class="code" href="structtuntap.html#ab854704d9efd886f25b7a0083b0196c6">local_ipv6</a>,</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;                        tt-&gt;<a class="code" href="structtuntap.html#a481a2d64b9173bd16b80d758c478dfef">netbits_ipv6</a>) &lt; 0)</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;    {</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;Linux can&#39;t del IPv6 from iface %s&quot;</span>, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>);</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    }</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;<span class="preprocessor">#else  </span><span class="comment">/* ifndef TARGET_LINUX */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *ifconfig_ipv6_local = <a class="code" href="socket_8c.html#a9a911c5dde4c809f7cb3eef8e5918a8e">print_in6_addr</a>(tt-&gt;<a class="code" href="structtuntap.html#ab854704d9efd886f25b7a0083b0196c6">local_ipv6</a>, 0, gc);</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160; </div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;    <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s del %s/%d&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>,</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;                ifconfig_ipv6_local, tt-&gt;<a class="code" href="structtuntap.html#a481a2d64b9173bd16b80d758c478dfef">netbits_ipv6</a>);</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160; </div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, NULL, 0, <span class="stringliteral">&quot;Linux ip -6 addr del failed&quot;</span>);</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160; </div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;<a class="code" href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">gc</a>);</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ifdef TARGET_LINUX */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;}</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160; </div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;<a class="code" href="tun_8c.html#aa160989ccb62fe8390475d34bda3d2f8">close_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;{</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(tt);</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160; </div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> != <a class="code" href="proto_8h.html#a541255b8640c189d1bd902f1168b1ee5">DEV_TYPE_NULL</a>)</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;    {</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a8d99c6cfbc9fdf2c1466535afeebdbdb">did_ifconfig_setup</a>)</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;        {</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;            undo_ifconfig_ipv4(tt, ctx);</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;        }</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160; </div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a70831f0f929eb68a2c0cdd85dc8c917c">did_ifconfig_ipv6_setup</a>)</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;        {</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;            undo_ifconfig_ipv6(tt, ctx);</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;        }</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160; </div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;        <span class="comment">/* release resources potentially allocated during undo */</span></div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;        <a class="code" href="networking_8h.html#a5cf2c27b115c79e964fc24ee1f51580a">net_ctx_reset</a>(ctx);</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;    }</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160; </div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;    close_tun_generic(tt);</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;    free(tt);</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;}</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160; </div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;<a class="code" href="tun_8h.html#afdac6b3217749dccb863f9dc39818b9d">write_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;{</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aae835b662be01cdc3752f7db84529cca">write</a>(tt-&gt;fd, buf, len);</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;}</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160; </div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;<a class="code" href="tun_8h.html#ac75f33ac5fe746f7bf5733d9e8c67bf2">read_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;{</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aea7c12cb3031ad9e88104ce9859ce1c5">read</a>(tt-&gt;fd, buf, len);</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;}</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160; </div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;<span class="preprocessor">#elif defined(TARGET_SOLARIS)</span></div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160; </div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;<span class="preprocessor">#ifndef TUNNEWPPA</span></div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;<span class="preprocessor">#error I need the symbol TUNNEWPPA from net/if_tun.h</span></div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160; </div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;<a class="code" href="tun_8c.html#a8ed81f24edc25b83eba293057754830b">open_tun</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node, <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;{</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;    <span class="keywordtype">int</span> if_fd, ip_muxid, arp_muxid, arp_fd, ppa = -1;</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    <span class="keyword">struct </span>lifreq ifr;</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr;</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *ip_node, *arp_node;</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_tuntap_type;</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;    <span class="keywordtype">int</span> link_type;</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    <span class="keywordtype">bool</span> is_tun;</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;    <span class="keyword">struct </span>strioctl strioc_if, strioc_ppa;</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160; </div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;    <span class="comment">/* improved generic TUN/TAP driver from</span></div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;<span class="comment">     * http://www.whiteboard.ne.jp/~admin2/tuntap/</span></div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;<span class="comment">     * has IPv6 support</span></div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;    <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(ifr);</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160; </div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a541255b8640c189d1bd902f1168b1ee5">DEV_TYPE_NULL</a>)</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;    {</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;        <a class="code" href="tun_8c.html#a86337d8f968065ef71dc084645056fe0">open_null</a>(tt);</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;    }</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160; </div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;    {</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;        ip_node = <span class="stringliteral">&quot;/dev/udp&quot;</span>;</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;        <span class="keywordflow">if</span> (!dev_node)</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;        {</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;            dev_node = <span class="stringliteral">&quot;/dev/tun&quot;</span>;</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;        }</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;        dev_tuntap_type = <span class="stringliteral">&quot;tun&quot;</span>;</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;        link_type = I_PLINK;</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;        is_tun = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;    }</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a3e52229580f912055a75d0cad8eff3f5">DEV_TYPE_TAP</a>)</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;    {</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;        ip_node = <span class="stringliteral">&quot;/dev/udp&quot;</span>;</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;        <span class="keywordflow">if</span> (!dev_node)</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;        {</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;            dev_node = <span class="stringliteral">&quot;/dev/tap&quot;</span>;</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;        }</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;        arp_node = dev_node;</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;        dev_tuntap_type = <span class="stringliteral">&quot;tap&quot;</span>;</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;        link_type = I_PLINK; <span class="comment">/* was: I_LINK */</span></div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;        is_tun = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;    }</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;    {</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;I don&#39;t recognize device %s as a tun or tap device&quot;</span>,</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;            dev);</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;    }</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160; </div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;    <span class="keywordflow">if</span> ((tt-&gt;ip_fd = open(ip_node, O_RDWR, 0)) &lt; 0)</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;    {</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Can&#39;t open %s&quot;</span>, ip_node);</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;    }</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160; </div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;    <span class="keywordflow">if</span> ((tt-&gt;fd = open(dev_node, O_RDWR, 0)) &lt; 0)</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;    {</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Can&#39;t open %s&quot;</span>, dev_node);</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    }</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160; </div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;    <span class="comment">/* get unit number */</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    <span class="keywordflow">if</span> (*dev)</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;    {</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;        ptr = dev;</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;        <span class="keywordflow">while</span> (*ptr &amp;&amp; !isdigit((<span class="keywordtype">int</span>) *ptr))</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;        {</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;            ptr++;</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;        }</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;        ppa = atoi(ptr);</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;    }</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160; </div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;    <span class="comment">/* Assign a new PPA and get its unit number. */</span></div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;    strioc_ppa.ic_cmd = TUNNEWPPA;</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;    strioc_ppa.ic_timout = 0;</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;    strioc_ppa.ic_len = <span class="keyword">sizeof</span>(ppa);</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;    strioc_ppa.ic_dp = (<span class="keywordtype">char</span> *)&amp;ppa;</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160; </div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;    <span class="keywordflow">if</span> (*ptr == <span class="charliteral">&#39;\0&#39;</span>)           <span class="comment">/* no number given, try dynamic */</span></div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;    {</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;        <span class="keywordtype">bool</span> found_one = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;        <span class="keywordflow">while</span> (!found_one &amp;&amp; ppa &lt; 64)</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;        {</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;            <span class="keywordtype">int</span> new_ppa = ioctl(tt-&gt;fd, I_STR, &amp;strioc_ppa);</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;            <span class="keywordflow">if</span> (new_ppa &gt;= 0)</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;            {</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>( <a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;open_tun: got dynamic interface &#39;%s%d&#39;&quot;</span>, dev_tuntap_type, new_ppa );</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;                ppa = new_ppa;</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;                found_one = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;            }</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;            <span class="keywordflow">if</span> (errno != EEXIST)</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;            {</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;open_tun: unexpected error trying to find free %s interface&quot;</span>, dev_tuntap_type );</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;            }</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;            ppa++;</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;        }</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;        <span class="keywordflow">if</span> (!found_one)</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;        {</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;open_tun: could not find free %s interface, give up.&quot;</span>, dev_tuntap_type );</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;        }</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;    }</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;    <span class="keywordflow">else</span>                        <span class="comment">/* try this particular one */</span></div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;    {</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;        <span class="keywordflow">if</span> ((ppa = ioctl(tt-&gt;fd, I_STR, &amp;strioc_ppa)) &lt; 0)</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;        {</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Can&#39;t assign PPA for new interface (%s%d)&quot;</span>, dev_tuntap_type, ppa );</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;        }</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;    }</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160; </div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;    <span class="keywordflow">if</span> ((if_fd = open(dev_node, O_RDWR, 0)) &lt; 0)</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;    {</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Can&#39;t open %s (2)&quot;</span>, dev_node);</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;    }</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160; </div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;    <span class="keywordflow">if</span> (ioctl(if_fd, I_PUSH, <span class="stringliteral">&quot;ip&quot;</span>) &lt; 0)</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    {</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Can&#39;t push IP module&quot;</span>);</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;    }</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160; </div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    {</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;        <span class="comment">/* Assign ppa according to the unit number returned by tun device */</span></div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;        <span class="keywordflow">if</span> (ioctl(if_fd, IF_UNITSEL, (<span class="keywordtype">char</span> *) &amp;ppa) &lt; 0)</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;        {</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Can&#39;t set PPA %d&quot;</span>, ppa);</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;        }</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;    }</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160; </div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;    tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a> = (<span class="keywordtype">char</span> *) malloc(32);</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;    <a class="code" href="buffer_8h.html#a4396d308d54951fef1d209e9d60b7eb4">check_malloc_return</a>(tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>);</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160; </div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;    <a class="code" href="buffer_8c.html#afd2a93a0940b1ea7e093d293a05e2927">openvpn_snprintf</a>(tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>, 32, <span class="stringliteral">&quot;%s%d&quot;</span>, dev_tuntap_type, ppa);</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160; </div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a3e52229580f912055a75d0cad8eff3f5">DEV_TYPE_TAP</a>)</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;    {</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;        <span class="keywordflow">if</span> (ioctl(if_fd, SIOCGLIFFLAGS, &amp;ifr) &lt; 0)</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;        {</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Can&#39;t get flags\n&quot;</span>);</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;        }</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;        <a class="code" href="buffer_8h.html#acf5c0f0d704fd5b44b4d066044efb52c">strncpynt</a>(ifr.lifr_name, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>, <span class="keyword">sizeof</span>(ifr.lifr_name));</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;        ifr.lifr_ppa = ppa;</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;        <span class="comment">/* Assign ppa according to the unit number returned by tun device */</span></div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;        <span class="keywordflow">if</span> (ioctl(if_fd, SIOCSLIFNAME, &amp;ifr) &lt; 0)</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;        {</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Can&#39;t set PPA %d&quot;</span>, ppa);</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;        }</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;        <span class="keywordflow">if</span> (ioctl(if_fd, SIOCGLIFFLAGS, &amp;ifr) &lt;0)</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;        {</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Can&#39;t get flags\n&quot;</span>);</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;        }</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;        <span class="comment">/* Push arp module to if_fd */</span></div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;        <span class="keywordflow">if</span> (ioctl(if_fd, I_PUSH, <span class="stringliteral">&quot;arp&quot;</span>) &lt; 0)</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;        {</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Can&#39;t push ARP module&quot;</span>);</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;        }</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160; </div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;        <span class="comment">/* Pop any modules on the stream */</span></div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;        <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;        {</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;            <span class="keywordflow">if</span> (ioctl(tt-&gt;ip_fd, I_POP, NULL) &lt; 0)</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;            {</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;            }</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;        }</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;        <span class="comment">/* Push arp module to ip_fd */</span></div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;        <span class="keywordflow">if</span> (ioctl(tt-&gt;ip_fd, I_PUSH, <span class="stringliteral">&quot;arp&quot;</span>) &lt; 0)</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;        {</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Can&#39;t push ARP module\n&quot;</span>);</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;        }</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160; </div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;        <span class="comment">/* Open arp_fd */</span></div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;        <span class="keywordflow">if</span> ((arp_fd = open(arp_node, O_RDWR, 0)) &lt; 0)</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;        {</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Can&#39;t open %s\n&quot;</span>, arp_node);</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;        }</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;        <span class="comment">/* Push arp module to arp_fd */</span></div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;        <span class="keywordflow">if</span> (ioctl(arp_fd, I_PUSH, <span class="stringliteral">&quot;arp&quot;</span>) &lt; 0)</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;        {</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Can&#39;t push ARP module\n&quot;</span>);</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;        }</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160; </div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;        <span class="comment">/* Set ifname to arp */</span></div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;        strioc_if.ic_cmd = SIOCSLIFNAME;</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;        strioc_if.ic_timout = 0;</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;        strioc_if.ic_len = <span class="keyword">sizeof</span>(ifr);</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;        strioc_if.ic_dp = (<span class="keywordtype">char</span> *)&amp;ifr;</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;        <span class="keywordflow">if</span> (ioctl(arp_fd, I_STR, &amp;strioc_if) &lt; 0)</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;        {</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Can&#39;t set ifname to arp\n&quot;</span>);</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;        }</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;    }</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160; </div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;    <span class="keywordflow">if</span> ((ip_muxid = ioctl(tt-&gt;ip_fd, link_type, if_fd)) &lt; 0)</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;    {</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Can&#39;t link %s device to IP&quot;</span>, dev_tuntap_type);</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;    }</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160; </div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a3e52229580f912055a75d0cad8eff3f5">DEV_TYPE_TAP</a>)</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;    {</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;        <span class="keywordflow">if</span> ((arp_muxid = ioctl(tt-&gt;ip_fd, link_type, arp_fd)) &lt; 0)</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;        {</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Can&#39;t link %s device to ARP&quot;</span>, dev_tuntap_type);</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;        }</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;        close(arp_fd);</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;    }</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160; </div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;    <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(ifr);</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;    <a class="code" href="buffer_8h.html#acf5c0f0d704fd5b44b4d066044efb52c">strncpynt</a>(ifr.lifr_name, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>, <span class="keyword">sizeof</span>(ifr.lifr_name));</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;    ifr.lifr_ip_muxid  = ip_muxid;</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a3e52229580f912055a75d0cad8eff3f5">DEV_TYPE_TAP</a>)</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;    {</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;        ifr.lifr_arp_muxid = arp_muxid;</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;    }</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160; </div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;    <span class="keywordflow">if</span> (ioctl(tt-&gt;ip_fd, SIOCSLIFMUXID, &amp;ifr) &lt; 0)</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;    {</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a3e52229580f912055a75d0cad8eff3f5">DEV_TYPE_TAP</a>)</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;        {</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;            ioctl(tt-&gt;ip_fd, I_PUNLINK, arp_muxid);</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;        }</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;        ioctl(tt-&gt;ip_fd, I_PUNLINK, ip_muxid);</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Can&#39;t set multiplexor id&quot;</span>);</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;    }</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160; </div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;    <a class="code" href="fdmisc_8c.html#a4bd55f9b59d6c9123787beb7431dac85">set_nonblock</a>(tt-&gt;fd);</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;    <a class="code" href="fdmisc_8c.html#a09193ec56615d682308eff8c491fc791">set_cloexec</a>(tt-&gt;fd);</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;    <a class="code" href="fdmisc_8c.html#a09193ec56615d682308eff8c491fc791">set_cloexec</a>(tt-&gt;ip_fd);</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160; </div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;TUN/TAP device %s opened&quot;</span>, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>);</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;}</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160; </div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;solaris_close_tun(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;{</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;    <span class="comment">/* IPv6 interfaces need to be &#39;manually&#39; de-configured */</span></div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a70831f0f929eb68a2c0cdd85dc8c917c">did_ifconfig_ipv6_setup</a>)</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;    {</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;        <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>( &amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s inet6 unplumb&quot;</span>,</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;                     <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a> );</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;        <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;        <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, NULL, 0, <span class="stringliteral">&quot;Solaris ifconfig inet6 unplumb failed&quot;</span>);</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;        <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;    }</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160; </div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;ip_fd &gt;= 0)</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;    {</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;        <span class="keyword">struct </span>lifreq ifr;</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;        <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(ifr);</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;        <a class="code" href="buffer_8h.html#acf5c0f0d704fd5b44b4d066044efb52c">strncpynt</a>(ifr.lifr_name, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>, <span class="keyword">sizeof</span>(ifr.lifr_name));</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160; </div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;        <span class="keywordflow">if</span> (ioctl(tt-&gt;ip_fd, SIOCGLIFFLAGS, &amp;ifr) &lt; 0)</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;        {</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;Can&#39;t get iface flags&quot;</span>);</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;        }</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160; </div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;        <span class="keywordflow">if</span> (ioctl(tt-&gt;ip_fd, SIOCGLIFMUXID, &amp;ifr) &lt; 0)</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;        {</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;Can&#39;t get multiplexor id&quot;</span>);</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;        }</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160; </div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a3e52229580f912055a75d0cad8eff3f5">DEV_TYPE_TAP</a>)</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;        {</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;            <span class="keywordflow">if</span> (ioctl(tt-&gt;ip_fd, I_PUNLINK, ifr.lifr_arp_muxid) &lt; 0)</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;            {</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;Can&#39;t unlink interface(arp)&quot;</span>);</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;            }</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;        }</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160; </div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;        <span class="keywordflow">if</span> (ioctl(tt-&gt;ip_fd, I_PUNLINK, ifr.lifr_ip_muxid) &lt; 0)</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;        {</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;Can&#39;t unlink interface(ip)&quot;</span>);</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;        }</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160; </div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;        close(tt-&gt;ip_fd);</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;        tt-&gt;ip_fd = -1;</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;    }</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160; </div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;fd &gt;= 0)</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;    {</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;        close(tt-&gt;fd);</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;        tt-&gt;fd = -1;</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;    }</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;}</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160; </div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;<span class="comment"> * Close TUN device.</span></div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;<a class="code" href="tun_8c.html#aa160989ccb62fe8390475d34bda3d2f8">close_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;{</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(tt);</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160; </div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;    solaris_close_tun(tt);</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160; </div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>)</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;    {</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;        free(tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>);</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;    }</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160; </div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <a class="code" href="tun_8c.html#a12ceabb38605c3156412412d40931506">clear_tuntap</a>(tt);</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;    free(tt);</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;}</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160; </div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;solaris_error_close(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structenv__set.html">env_set</a> *es,</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">char</span> *actual, <span class="keywordtype">bool</span> unplumb_inet6 )</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;{</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;    <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160; </div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;    <span class="keywordflow">if</span> (unplumb_inet6)</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;    {</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>( &amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s inet6 unplumb&quot;</span>,</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;                     <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, actual );</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;        <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;        <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, 0, <span class="stringliteral">&quot;Solaris ifconfig inet6 unplumb failed&quot;</span>);</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;    }</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160; </div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;    <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>,</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;                <span class="stringliteral">&quot;%s %s unplumb&quot;</span>,</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;                <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>,</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;                actual);</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160; </div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, 0, <span class="stringliteral">&quot;Solaris ifconfig unplumb failed&quot;</span>);</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;    <a class="code" href="tun_8c.html#aa160989ccb62fe8390475d34bda3d2f8">close_tun</a>(tt, NULL);</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Solaris ifconfig failed&quot;</span>);</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;    <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;}</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160; </div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;<a class="code" href="tun_8h.html#afdac6b3217749dccb863f9dc39818b9d">write_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;{</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;    <span class="keyword">struct </span>strbuf sbuf;</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;    sbuf.len = len;</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;    sbuf.buf = (<span class="keywordtype">char</span> *)buf;</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;    <span class="keywordflow">return</span> putmsg(tt-&gt;fd, NULL, &amp;sbuf, 0) &gt;= 0 ? sbuf.len : -1;</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;}</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160; </div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;<a class="code" href="tun_8h.html#ac75f33ac5fe746f7bf5733d9e8c67bf2">read_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;{</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;    <span class="keyword">struct </span>strbuf sbuf;</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespacehttp-client.html#aadb490246e2a9943d5fe72016ff60d19">f</a> = 0;</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160; </div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;    sbuf.maxlen = len;</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;    sbuf.buf = (<span class="keywordtype">char</span> *)buf;</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;    <span class="keywordflow">return</span> getmsg(tt-&gt;fd, NULL, &amp;sbuf, &amp;<a class="code" href="namespacehttp-client.html#aadb490246e2a9943d5fe72016ff60d19">f</a>) &gt;= 0 ? sbuf.len : -1;</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;}</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160; </div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;<span class="preprocessor">#elif defined(TARGET_OPENBSD)</span></div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160; </div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;<a class="code" href="tun_8c.html#a8ed81f24edc25b83eba293057754830b">open_tun</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node, <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;{</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;    open_tun_generic(dev, dev_type, dev_node, <span class="keyword">true</span>, tt);</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160; </div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;    <span class="comment">/* Enable multicast on the interface */</span></div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;fd &gt;= 0)</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;    {</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;        <span class="keyword">struct </span>tuninfo info;</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160; </div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;        <span class="keywordflow">if</span> (ioctl(tt-&gt;fd, TUNGIFINFO, &amp;info) &lt; 0)</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;        {</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;Can&#39;t get interface info&quot;</span>);</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;        }</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160; </div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;<span class="preprocessor">#ifdef IFF_MULTICAST </span><span class="comment">/* openbsd 4.x doesn&#39;t have this */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;        info.flags |= IFF_MULTICAST;</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160; </div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;        <span class="keywordflow">if</span> (ioctl(tt-&gt;fd, TUNSIFINFO, &amp;info) &lt; 0)</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;        {</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;Can&#39;t set interface info&quot;</span>);</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;        }</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;    }</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;}</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160; </div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;<span class="comment">/* tun(4): &quot;If the device was created by opening /dev/tunN, it will be</span></div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;<span class="comment"> *          automatically destroyed.  Devices created via ifconfig(8) are</span></div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;<span class="comment"> *          only marked as not running and traffic will be dropped</span></div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;<span class="comment"> *          returning EHOSTDOWN.&quot;</span></div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;<span class="comment"> * --&gt; no special handling should be needed - *but* OpenBSD is misbehaving</span></div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;<span class="comment"> * here: if the interface was put in tap mode (&quot;ifconfig tunN link0&quot;), it</span></div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;<span class="comment"> * *will* stay around, and needs to be cleaned up manually</span></div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160; </div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;<a class="code" href="tun_8c.html#aa160989ccb62fe8390475d34bda3d2f8">close_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;{</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(tt);</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160; </div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;    <span class="comment">/* only *TAP* devices need destroying, tun devices auto-self-destruct</span></div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a> || tt-&gt;<a class="code" href="structtuntap.html#afd4a0397ced0c1118162c669228dfc58">persistent_if</a>)</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;    {</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;        close_tun_generic(tt);</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;        free(tt);</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;    }</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160; </div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;    <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160; </div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;    <span class="comment">/* setup command, close tun dev (clears tt-&gt;actual_name!), run command</span></div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160; </div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;    <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s destroy&quot;</span>,</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;                <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>);</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160; </div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;    close_tun_generic(tt);</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160; </div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, NULL, 0, <span class="stringliteral">&quot;OpenBSD &#39;destroy tun interface&#39; failed (non-critical)&quot;</span>);</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160; </div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;    free(tt);</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;    <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;}</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160; </div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;<a class="code" href="tun_8h.html#afdac6b3217749dccb863f9dc39818b9d">write_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;{</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;    <span class="keywordflow">return</span> write_tun_header(tt, buf, len);</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;}</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160; </div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;<a class="code" href="tun_8h.html#ac75f33ac5fe746f7bf5733d9e8c67bf2">read_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;{</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;    <span class="keywordflow">return</span> read_tun_header(tt, buf, len);</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;}</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160; </div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;<span class="preprocessor">#elif defined(TARGET_NETBSD)</span></div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160; </div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;<span class="comment"> * NetBSD before 4.0 does not support IPv6 on tun out of the box,</span></div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;<span class="comment"> * but there exists a patch (sys/net/if_tun.c, 1.79-&gt;1.80, see PR 32944).</span></div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;<span class="comment"> * NetBSD 4.0 and up do, but we need to put the tun interface into</span></div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;<span class="comment"> * &quot;multi_af&quot; mode, which will prepend the address family to all packets</span></div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;<span class="comment"> * (same as OpenBSD and FreeBSD).  If this is not enabled, the kernel</span></div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;<span class="comment"> * silently drops all IPv6 packets on output and gets confused on input.</span></div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;<span class="comment"> * On earlier versions, multi_af is not available at all, so we have</span></div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;<span class="comment"> * two different NetBSD code variants here :-(</span></div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160; </div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;<a class="code" href="tun_8c.html#a8ed81f24edc25b83eba293057754830b">open_tun</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node, <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;{</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;    open_tun_generic(dev, dev_type, dev_node, <span class="keyword">true</span>, tt);</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160; </div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;fd &gt;= 0)</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;    {</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;        <span class="keywordtype">int</span> i = IFF_POINTOPOINT|IFF_MULTICAST;</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;        ioctl(tt-&gt;fd, TUNSIFMODE, &amp;i);   <span class="comment">/* multicast on */</span></div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;        i = 0;</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;        ioctl(tt-&gt;fd, TUNSLMODE, &amp;i);    <span class="comment">/* link layer mode off */</span></div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160; </div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;        {</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;            i = 1;</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;            <span class="keywordflow">if</span> (ioctl(tt-&gt;fd, TUNSIFHEAD, &amp;i) &lt; 0)      <span class="comment">/* multi-af mode on */</span></div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;            {</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;ioctl(TUNSIFHEAD)&quot;</span>);</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;            }</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;        }</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;    }</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;}</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160; </div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;<span class="comment">/* the current way OpenVPN handles tun devices on NetBSD leads to</span></div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;<span class="comment"> * lingering tunX interfaces after close -&gt; for a full cleanup, they</span></div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;<span class="comment"> * need to be explicitly destroyed</span></div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;<a class="code" href="tun_8c.html#aa160989ccb62fe8390475d34bda3d2f8">close_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;{</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(tt);</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160; </div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;    <span class="comment">/* only tun devices need destroying, tap devices auto-self-destruct</span></div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> != <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a> || tt-&gt;<a class="code" href="structtuntap.html#afd4a0397ced0c1118162c669228dfc58">persistent_if</a>)</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;    {</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;        close_tun_generic(tt);</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;        free(tt);</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;    }</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160; </div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;    <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160; </div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;    <span class="comment">/* setup command, close tun dev (clears tt-&gt;actual_name!), run command</span></div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160; </div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s destroy&quot;</span>,</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;                <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>);</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160; </div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;    close_tun_generic(tt);</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160; </div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, NULL, 0, <span class="stringliteral">&quot;NetBSD &#39;destroy tun interface&#39; failed (non-critical)&quot;</span>);</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160; </div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;    free(tt);</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;    <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;}</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160; </div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;netbsd_modify_read_write_return(<span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;{</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;    <span class="keywordflow">if</span> (len &gt; 0)</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;    {</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;        <span class="keywordflow">return</span> len &gt; <span class="keyword">sizeof</span>(u_int32_t) ? len - <span class="keyword">sizeof</span>(u_int32_t) : 0;</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;    }</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;    {</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;        <span class="keywordflow">return</span> len;</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;    }</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;}</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160; </div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;<a class="code" href="tun_8h.html#afdac6b3217749dccb863f9dc39818b9d">write_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;{</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;    {</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;        u_int32_t type;</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;        <span class="keyword">struct </span>iovec iv[2];</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;        <span class="keyword">struct </span><a class="code" href="structopenvpn__iphdr.html">openvpn_iphdr</a> *iph;</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160; </div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;        iph = (<span class="keyword">struct </span><a class="code" href="structopenvpn__iphdr.html">openvpn_iphdr</a> *) buf;</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160; </div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="proto_8h.html#ab6b5bc35bc49835a9d79ad0a160d6396">OPENVPN_IPH_GET_VER</a>(iph-&gt;<a class="code" href="structopenvpn__iphdr.html#af3c74339e4e6ab5c8edbb5b8d1ab3fa6">version_len</a>) == 6)</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;        {</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;            type = htonl(AF_INET6);</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;        }</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;        {</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;            type = htonl(AF_INET);</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;        }</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160; </div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;        iv[0].iov_base = (<span class="keywordtype">char</span> *)&amp;type;</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;        iv[0].iov_len = <span class="keyword">sizeof</span>(type);</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;        iv[1].iov_base = buf;</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;        iv[1].iov_len = len;</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160; </div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;        <span class="keywordflow">return</span> netbsd_modify_read_write_return(writev(tt-&gt;fd, iv, 2));</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;    }</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;    {</div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aae835b662be01cdc3752f7db84529cca">write</a>(tt-&gt;fd, buf, len);</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;    }</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;}</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160; </div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;<a class="code" href="tun_8h.html#ac75f33ac5fe746f7bf5733d9e8c67bf2">read_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;{</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;    {</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;        u_int32_t type;</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;        <span class="keyword">struct </span>iovec iv[2];</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160; </div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;        iv[0].iov_base = (<span class="keywordtype">char</span> *)&amp;type;</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;        iv[0].iov_len = <span class="keyword">sizeof</span>(type);</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;        iv[1].iov_base = buf;</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;        iv[1].iov_len = len;</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160; </div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;        <span class="keywordflow">return</span> netbsd_modify_read_write_return(readv(tt-&gt;fd, iv, 2));</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;    }</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;    {</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aea7c12cb3031ad9e88104ce9859ce1c5">read</a>(tt-&gt;fd, buf, len);</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;    }</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;}</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160; </div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;<span class="preprocessor">#elif defined(TARGET_FREEBSD)</span></div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160; </div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;freebsd_modify_read_write_return(<span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;{</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;    <span class="keywordflow">if</span> (len &gt; 0)</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;    {</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;        <span class="keywordflow">return</span> len &gt; <span class="keyword">sizeof</span>(u_int32_t) ? len - <span class="keyword">sizeof</span>(u_int32_t) : 0;</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;    }</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;    {</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;        <span class="keywordflow">return</span> len;</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;    }</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;}</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160; </div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;<a class="code" href="tun_8c.html#a8ed81f24edc25b83eba293057754830b">open_tun</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node, <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;{</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;    open_tun_generic(dev, dev_type, dev_node, <span class="keyword">true</span>, tt);</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160; </div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;fd &gt;= 0 &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;    {</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;        <span class="keywordtype">int</span> i = IFF_POINTOPOINT | IFF_MULTICAST;</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160; </div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;        <span class="keywordflow">if</span> (ioctl(tt-&gt;fd, TUNSIFMODE, &amp;i) &lt; 0)</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;        {</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;ioctl(TUNSIFMODE)&quot;</span>);</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;        }</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;        i = 1;</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;        <span class="keywordflow">if</span> (ioctl(tt-&gt;fd, TUNSIFHEAD, &amp;i) &lt; 0)</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;        {</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;ioctl(TUNSIFHEAD)&quot;</span>);</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;        }</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;    }</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;}</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160; </div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;<span class="comment">/* tun(4): &quot;These network interfaces persist until the if_tun.ko module is</span></div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;<span class="comment"> *          unloaded, or until removed with the ifconfig(8) command.&quot;</span></div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;<span class="comment"> *          (verified for FreeBSD 6.3, 7.4, 8.2 and 9, same for tap(4))</span></div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;<span class="comment"> * so, to avoid lingering tun/tap interfaces after OpenVPN quits,</span></div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;<span class="comment"> * we need to call &quot;ifconfig ... destroy&quot; for cleanup</span></div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;<a class="code" href="tun_8c.html#aa160989ccb62fe8390475d34bda3d2f8">close_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;{</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(tt);</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160; </div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#afd4a0397ced0c1118162c669228dfc58">persistent_if</a>)        <span class="comment">/* keep pre-existing if around */</span></div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;    {</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;        close_tun_generic(tt);</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;        free(tt);</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;    }</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160; </div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;    <span class="comment">/* close and destroy */</span></div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;    <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160; </div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;    <span class="comment">/* setup command, close tun dev (clears tt-&gt;actual_name!), run command</span></div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160; </div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;    <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s destroy&quot;</span>,</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;                <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>);</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160; </div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;    close_tun_generic(tt);</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160; </div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, NULL, 0,</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;                         <span class="stringliteral">&quot;FreeBSD &#39;destroy tun interface&#39; failed (non-critical)&quot;</span>);</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160; </div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;    free(tt);</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;    <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;}</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160; </div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;<a class="code" href="tun_8h.html#afdac6b3217749dccb863f9dc39818b9d">write_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;{</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;    {</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;        u_int32_t type;</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;        <span class="keyword">struct </span>iovec iv[2];</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;        <span class="keyword">struct </span>ip *iph;</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160; </div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;        iph = (<span class="keyword">struct </span>ip *) buf;</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160; </div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;        <span class="keywordflow">if</span> (iph-&gt;ip_v == 6)</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;        {</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;            type = htonl(AF_INET6);</div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;        }</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;        {</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;            type = htonl(AF_INET);</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;        }</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160; </div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;        iv[0].iov_base = (<span class="keywordtype">char</span> *)&amp;type;</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;        iv[0].iov_len = <span class="keyword">sizeof</span>(type);</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;        iv[1].iov_base = buf;</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;        iv[1].iov_len = len;</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160; </div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;        <span class="keywordflow">return</span> freebsd_modify_read_write_return(writev(tt-&gt;fd, iv, 2));</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;    }</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;    {</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aae835b662be01cdc3752f7db84529cca">write</a>(tt-&gt;fd, buf, len);</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;    }</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;}</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160; </div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;<a class="code" href="tun_8h.html#ac75f33ac5fe746f7bf5733d9e8c67bf2">read_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;{</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;    {</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;        u_int32_t type;</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;        <span class="keyword">struct </span>iovec iv[2];</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160; </div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;        iv[0].iov_base = (<span class="keywordtype">char</span> *)&amp;type;</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;        iv[0].iov_len = <span class="keyword">sizeof</span>(type);</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;        iv[1].iov_base = buf;</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;        iv[1].iov_len = len;</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160; </div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;        <span class="keywordflow">return</span> freebsd_modify_read_write_return(readv(tt-&gt;fd, iv, 2));</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;    }</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;    {</div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aea7c12cb3031ad9e88104ce9859ce1c5">read</a>(tt-&gt;fd, buf, len);</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;    }</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;}</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160; </div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;<span class="preprocessor">#elif defined(TARGET_DRAGONFLY)</span></div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160; </div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;dragonfly_modify_read_write_return(<span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;{</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;    <span class="keywordflow">if</span> (len &gt; 0)</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;    {</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;        <span class="keywordflow">return</span> len &gt; <span class="keyword">sizeof</span>(u_int32_t) ? len - <span class="keyword">sizeof</span>(u_int32_t) : 0;</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;    }</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;    {</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;        <span class="keywordflow">return</span> len;</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;    }</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;}</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160; </div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;<a class="code" href="tun_8c.html#a8ed81f24edc25b83eba293057754830b">open_tun</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node, <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;{</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    open_tun_generic(dev, dev_type, dev_node, <span class="keyword">true</span>, tt);</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160; </div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;fd &gt;= 0)</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;    {</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;        <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160; </div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;        <span class="comment">/* Disable extended modes */</span></div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;        ioctl(tt-&gt;fd, TUNSLMODE, &amp;i);</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;        i = 1;</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;        ioctl(tt-&gt;fd, TUNSIFHEAD, &amp;i);</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;    }</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;}</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160; </div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;<a class="code" href="tun_8c.html#aa160989ccb62fe8390475d34bda3d2f8">close_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;{</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(tt);</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160; </div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;    close_tun_generic(tt);</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;    free(tt);</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;}</div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160; </div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;<a class="code" href="tun_8h.html#afdac6b3217749dccb863f9dc39818b9d">write_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;{</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;    {</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;        u_int32_t type;</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;        <span class="keyword">struct </span>iovec iv[2];</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;        <span class="keyword">struct </span>ip *iph;</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160; </div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;        iph = (<span class="keyword">struct </span>ip *) buf;</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160; </div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;        <span class="keywordflow">if</span> (iph-&gt;ip_v == 6)</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;        {</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;            type = htonl(AF_INET6);</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;        }</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;        {</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;            type = htonl(AF_INET);</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;        }</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160; </div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;        iv[0].iov_base = (<span class="keywordtype">char</span> *)&amp;type;</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;        iv[0].iov_len = <span class="keyword">sizeof</span>(type);</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;        iv[1].iov_base = buf;</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;        iv[1].iov_len = len;</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160; </div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;        <span class="keywordflow">return</span> dragonfly_modify_read_write_return(writev(tt-&gt;fd, iv, 2));</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;    }</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;    {</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aae835b662be01cdc3752f7db84529cca">write</a>(tt-&gt;fd, buf, len);</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;    }</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;}</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160; </div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;<a class="code" href="tun_8h.html#ac75f33ac5fe746f7bf5733d9e8c67bf2">read_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;{</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    {</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;        u_int32_t type;</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;        <span class="keyword">struct </span>iovec iv[2];</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160; </div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;        iv[0].iov_base = (<span class="keywordtype">char</span> *)&amp;type;</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;        iv[0].iov_len = <span class="keyword">sizeof</span>(type);</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;        iv[1].iov_base = buf;</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;        iv[1].iov_len = len;</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160; </div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;        <span class="keywordflow">return</span> dragonfly_modify_read_write_return(readv(tt-&gt;fd, iv, 2));</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;    }</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;    {</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aea7c12cb3031ad9e88104ce9859ce1c5">read</a>(tt-&gt;fd, buf, len);</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;    }</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;}</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160; </div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;<span class="preprocessor">#elif defined(TARGET_DARWIN)</span></div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160; </div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;<span class="comment">/* Darwin (MacOS X) is mostly &quot;just use the generic stuff&quot;, but there</span></div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;<span class="comment"> * is always one caveat...:</span></div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;<span class="comment"> * If IPv6 is configured, and the tun device is closed, the IPv6 address</span></div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;<span class="comment"> * configured to the tun interface changes to a lingering /128 route</span></div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;<span class="comment"> * pointing to lo0.  Need to unconfigure...  (observed on 10.5)</span></div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160; </div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;<span class="comment"> * utun is the native Darwin tun driver present since at least 10.7</span></div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;<span class="comment"> * Thanks goes to Jonathan Levin for providing an example how to utun</span></div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;<span class="comment"> * (http://newosxbook.com/src.jl?tree=listings&amp;file=17-15-utun.c)</span></div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160; </div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;<span class="preprocessor">#ifdef HAVE_NET_IF_UTUN_H</span></div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160; </div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;<span class="comment">/* Helper functions that tries to open utun device</span></div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;<span class="comment"> * return -2 on early initialization failures (utun not supported</span></div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;<span class="comment"> * at all (old OS X) and -1 on initlization failure of utun</span></div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;<span class="comment"> * device (utun works but utunX is already used */</span></div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;<span class="keyword">static</span></div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;utun_open_helper(<span class="keyword">struct</span> ctl_info ctlInfo, <span class="keywordtype">int</span> utunnum)</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;{</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;    <span class="keyword">struct </span>sockaddr_ctl sc;</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;    <span class="keywordtype">int</span> fd;</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160; </div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;    fd = socket(PF_SYSTEM, SOCK_DGRAM, SYSPROTO_CONTROL);</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160; </div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;    <span class="keywordflow">if</span> (fd &lt; 0)</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;    {</div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;Opening utun%d failed (socket(SYSPROTO_CONTROL))&quot;</span>,</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;            utunnum);</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;        <span class="keywordflow">return</span> -2;</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;    }</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160; </div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;    <span class="keywordflow">if</span> (ioctl(fd, CTLIOCGINFO, &amp;ctlInfo) == -1)</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;    {</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;        close(fd);</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;Opening utun%d failed (ioctl(CTLIOCGINFO))&quot;</span>,</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;            utunnum);</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;        <span class="keywordflow">return</span> -2;</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;    }</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160; </div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160; </div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;    sc.sc_id = ctlInfo.ctl_id;</div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;    sc.sc_len = <span class="keyword">sizeof</span>(sc);</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;    sc.sc_family = AF_SYSTEM;</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;    sc.ss_sysaddr = AF_SYS_CONTROL;</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160; </div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;    sc.sc_unit = utunnum+1;</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160; </div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160; </div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;    <span class="comment">/* If the connect is successful, a utun%d device will be created, where &quot;%d&quot;</span></div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;<span class="comment">     * is (sc.sc_unit - 1) */</span></div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160; </div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;    <span class="keywordflow">if</span> (connect(fd, (<span class="keyword">struct</span> sockaddr *)&amp;sc, <span class="keyword">sizeof</span>(sc)) &lt; 0)</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;    {</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;Opening utun%d failed (connect(AF_SYS_CONTROL))&quot;</span>,</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;            utunnum);</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;        close(fd);</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;    }</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160; </div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;    <a class="code" href="fdmisc_8c.html#a4bd55f9b59d6c9123787beb7431dac85">set_nonblock</a>(fd);</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;    <a class="code" href="fdmisc_8c.html#a09193ec56615d682308eff8c491fc791">set_cloexec</a>(fd); <span class="comment">/* don&#39;t pass fd to scripts */</span></div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160; </div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;    <span class="keywordflow">return</span> fd;</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;}</div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160; </div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;open_darwin_utun(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node, <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;{</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;    <span class="keyword">struct </span>ctl_info ctlInfo;</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;    <span class="keywordtype">int</span> fd;</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;    <span class="keywordtype">char</span> utunname[20];</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;    <span class="keywordtype">int</span> utunnum = -1;</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;    socklen_t utunname_len = <span class="keyword">sizeof</span>(utunname);</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160; </div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;    <span class="comment">/* dev_node is simply utun, do the normal dynamic utun</span></div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;<span class="comment">     * otherwise try to parse the utun number */</span></div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;    <span class="keywordflow">if</span> (dev_node &amp;&amp; (strcmp(<span class="stringliteral">&quot;utun&quot;</span>, dev_node) != 0 ))</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;    {</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;        <span class="keywordflow">if</span> (sscanf(dev_node, <span class="stringliteral">&quot;utun%d&quot;</span>, &amp;utunnum) != 1)</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;        {</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Cannot parse &#39;dev-node %s&#39; please use &#39;dev-node utunX&#39;&quot;</span></div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;                <span class="stringliteral">&quot;to use a utun device number X&quot;</span>, dev_node);</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;        }</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;    }</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160; </div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160; </div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160; </div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;    <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(ctlInfo);</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;    <span class="keywordflow">if</span> (strlcpy(ctlInfo.ctl_name, UTUN_CONTROL_NAME, <span class="keyword">sizeof</span>(ctlInfo.ctl_name)) &gt;=</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;        <span class="keyword">sizeof</span>(ctlInfo.ctl_name))</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;    {</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Opening utun: UTUN_CONTROL_NAME too long&quot;</span>);</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;    }</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160; </div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;    <span class="comment">/* try to open first available utun device if no specific utun is requested */</span></div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;    <span class="keywordflow">if</span> (utunnum == -1)</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;    {</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;        <span class="keywordflow">for</span> (utunnum = 0; utunnum &lt; 255; utunnum++)</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;        {</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;            <span class="keywordtype">char</span> ifname[20];</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;            <span class="comment">/* if the interface exists silently skip it */</span></div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;            <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(<a class="code" href="config-msvc_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ifname, <span class="keyword">sizeof</span>(ifname), <span class="stringliteral">&quot;utun%d&quot;</span>, utunnum) &gt; 0);</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;            <span class="keywordflow">if</span> (if_nametoindex(ifname))</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;            {</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;            }</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;            fd = utun_open_helper(ctlInfo, utunnum);</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;            <span class="comment">/* Break if the fd is valid,</span></div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;<span class="comment">             * or if early initialization failed (-2) */</span></div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;            <span class="keywordflow">if</span> (fd !=-1)</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;            {</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;            }</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;        }</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;    }</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;    {</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;        fd = utun_open_helper(ctlInfo, utunnum);</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;    }</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160; </div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;    <span class="comment">/* opening an utun device failed */</span></div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;    tt-&gt;fd = fd;</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160; </div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;    <span class="keywordflow">if</span> (fd &lt; 0)</div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;    {</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;    }</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160; </div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;    <span class="comment">/* Retrieve the assigned interface name. */</span></div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    <span class="keywordflow">if</span> (getsockopt(fd, SYSPROTO_CONTROL, UTUN_OPT_IFNAME, utunname, &amp;utunname_len))</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;    {</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;Error retrieving utun interface name&quot;</span>);</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;    }</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160; </div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;    tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a> = <a class="code" href="buffer_8c.html#a06e0220403278399596a7a1b6b601fca">string_alloc</a>(utunname, NULL);</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160; </div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;Opened utun device %s&quot;</span>, utunname);</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;    tt-&gt;is_utun = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;}</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160; </div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ifdef HAVE_NET_IF_UTUN_H */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160; </div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;<a class="code" href="tun_8c.html#a8ed81f24edc25b83eba293057754830b">open_tun</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node, <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;{</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;<span class="preprocessor">#ifdef HAVE_NET_IF_UTUN_H</span></div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;    <span class="comment">/* If dev_node does not start start with utun assume regular tun/tap */</span></div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;    <span class="keywordflow">if</span> ((!dev_node &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a>==<a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;        || (dev_node &amp;&amp; !strncmp(dev_node, <span class="stringliteral">&quot;utun&quot;</span>, 4)))</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;    {</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160; </div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;        <span class="comment">/* Check if user has specific dev_type tap and forced utun with</span></div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;<span class="comment">         * dev-node utun */</span></div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a>!=<a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;        {</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Cannot use utun devices with --dev-type %s&quot;</span>,</div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;                <a class="code" href="tun_8c.html#aaeb7d66a96170c82580b2e821110c745">dev_type_string</a>(dev, dev_type));</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;        }</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160; </div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;        <span class="comment">/* Try utun first and fall back to normal tun if utun fails</span></div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;<span class="comment">         * and dev_node is not specified */</span></div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;        open_darwin_utun(dev, dev_type, dev_node, tt);</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160; </div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;        <span class="keywordflow">if</span> (!tt-&gt;is_utun)</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;        {</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;            <span class="keywordflow">if</span> (!dev_node)</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;            {</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;                <span class="comment">/* No explicit utun and utun failed, try the generic way) */</span></div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;Failed to open utun device. Falling back to /dev/tun device&quot;</span>);</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;                open_tun_generic(dev, dev_type, NULL, <span class="keyword">true</span>, tt);</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;            }</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;            {</div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;                <span class="comment">/* Specific utun device or generic utun request with no tun</span></div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;<span class="comment">                 * fall back failed, consider this a fatal failure */</span></div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Cannot open utun device&quot;</span>);</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;            }</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;        }</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;    }</div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ifdef HAVE_NET_IF_UTUN_H */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;    {</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160; </div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;        <span class="comment">/* Use plain dev-node tun to select /dev/tun style</span></div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;<span class="comment">         * Unset dev_node variable prior to passing to open_tun_generic to</span></div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;<span class="comment">         * let open_tun_generic pick the first available tun device */</span></div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160; </div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;        <span class="keywordflow">if</span> (dev_node &amp;&amp; strcmp(dev_node, <span class="stringliteral">&quot;tun&quot;</span>)==0)</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;        {</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;            dev_node = NULL;</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;        }</div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160; </div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;        open_tun_generic(dev, dev_type, dev_node, <span class="keyword">true</span>, tt);</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;    }</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;}</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160; </div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;<a class="code" href="tun_8c.html#aa160989ccb62fe8390475d34bda3d2f8">close_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;{</div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(tt);</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160; </div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;    <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160; </div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a70831f0f929eb68a2c0cdd85dc8c917c">did_ifconfig_ipv6_setup</a>)</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;    {</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *ifconfig_ipv6_local =</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;            <a class="code" href="socket_8c.html#a9a911c5dde4c809f7cb3eef8e5918a8e">print_in6_addr</a>(tt-&gt;<a class="code" href="structtuntap.html#ab854704d9efd886f25b7a0083b0196c6">local_ipv6</a>, 0, &amp;<a class="code" href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">gc</a>);</div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160; </div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s delete -inet6 %s&quot;</span>,</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;                    <a class="code" href="config_8h.html#a792edd69443b63f4317d0c55908ce3f2">ROUTE_PATH</a>, ifconfig_ipv6_local );</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;        <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;        <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, NULL, 0, <span class="stringliteral">&quot;MacOS X &#39;remove inet6 route&#39; failed (non-critical)&quot;</span>);</div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;    }</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160; </div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;    close_tun_generic(tt);</div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;    free(tt);</div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;    <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;<a class="code" href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">gc</a>);</div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;}</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160; </div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;<a class="code" href="tun_8h.html#afdac6b3217749dccb863f9dc39818b9d">write_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;{</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;<span class="preprocessor">#ifdef HAVE_NET_IF_UTUN_H</span></div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;is_utun)</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;    {</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;        <span class="keywordflow">return</span> write_tun_header(tt, buf, len);</div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;    }</div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aae835b662be01cdc3752f7db84529cca">write</a>(tt-&gt;fd, buf, len);</div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;}</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160; </div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;<a class="code" href="tun_8h.html#ac75f33ac5fe746f7bf5733d9e8c67bf2">read_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;{</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;<span class="preprocessor">#ifdef HAVE_NET_IF_UTUN_H</span></div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;is_utun)</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;    {</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;        <span class="keywordflow">return</span> read_tun_header(tt, buf, len);</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;    }</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aea7c12cb3031ad9e88104ce9859ce1c5">read</a>(tt-&gt;fd, buf, len);</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;}</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160; </div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;<span class="preprocessor">#elif defined(TARGET_AIX)</span></div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160; </div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;<a class="code" href="tun_8c.html#a8ed81f24edc25b83eba293057754830b">open_tun</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node, <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;{</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;    <span class="keywordtype">char</span> tunname[256];</div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;    <span class="keywordtype">char</span> dynamic_name[20];</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *p;</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160; </div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a541255b8640c189d1bd902f1168b1ee5">DEV_TYPE_NULL</a>)</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;    {</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;        <a class="code" href="tun_8c.html#a86337d8f968065ef71dc084645056fe0">open_null</a>(tt);</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;    }</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160; </div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;    {</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;no support for &#39;tun&#39; devices on AIX&quot;</span> );</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;    }</div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160; </div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;    <span class="keywordflow">if</span> (strncmp( dev, <span class="stringliteral">&quot;tap&quot;</span>, 3 ) != 0 || dev_node)</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;    {</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;&#39;--dev %s&#39; and/or &#39;--dev-node&#39; not supported on AIX, use &#39;--dev tap0&#39;, &#39;tap1&#39;, etc.&quot;</span>, dev );</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;    }</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160; </div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;    <span class="keywordflow">if</span> (strcmp( dev, <span class="stringliteral">&quot;tap&quot;</span> ) == 0)              <span class="comment">/* find first free tap dev */</span></div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;    {                                           <span class="comment">/* (= no /dev/tapN node) */</span></div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;        <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;        <span class="keywordflow">for</span> (i = 0; i&lt;99; i++)</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;        {</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;            <a class="code" href="buffer_8c.html#afd2a93a0940b1ea7e093d293a05e2927">openvpn_snprintf</a>(tunname, <span class="keyword">sizeof</span>(tunname), <span class="stringliteral">&quot;/dev/tap%d&quot;</span>, i);</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;            <span class="keywordflow">if</span> (access( tunname, <a class="code" href="config-msvc_8h.html#af837744613408b57dc3654fbc3bcf900">F_OK</a> ) &lt; 0 &amp;&amp; errno == ENOENT)</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;            {</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;            }</div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;        }</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;        <span class="keywordflow">if</span> (i &gt;= 99)</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;        {</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>( <a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;cannot find unused tap device&quot;</span> );</div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;        }</div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160; </div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;        <a class="code" href="buffer_8c.html#afd2a93a0940b1ea7e093d293a05e2927">openvpn_snprintf</a>( dynamic_name, <span class="keyword">sizeof</span>(dynamic_name), <span class="stringliteral">&quot;tap%d&quot;</span>, i );</div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;        dev = dynamic_name;</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;    }</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;    <span class="keywordflow">else</span>                                        <span class="comment">/* name given, sanity check */</span></div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;    {</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;        <span class="comment">/* ensure that dev name is &quot;tap+&lt;digits&gt;&quot; *only* */</span></div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;        p = &amp;dev[3];</div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;        <span class="keywordflow">while</span> (isdigit(*p) )</div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;        {</div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;            p++;</div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;        }</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;        <span class="keywordflow">if</span> (*p != <span class="charliteral">&#39;\0&#39;</span>)</div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;        {</div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>( <a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;TAP device name must be &#39;--dev tapNNNN&#39;&quot;</span> );</div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;        }</div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160; </div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;        <a class="code" href="buffer_8c.html#afd2a93a0940b1ea7e093d293a05e2927">openvpn_snprintf</a>(tunname, <span class="keyword">sizeof</span>(tunname), <span class="stringliteral">&quot;/dev/%s&quot;</span>, dev);</div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;    }</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160; </div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;    <span class="comment">/* pre-existing device?</span></div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;    <span class="keywordflow">if</span> (access( tunname, <a class="code" href="config-msvc_8h.html#af837744613408b57dc3654fbc3bcf900">F_OK</a> ) &lt; 0 &amp;&amp; errno == ENOENT)</div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;    {</div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160; </div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;        <span class="comment">/* tunnel device must be created with &#39;ifconfig tapN create&#39;</span></div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;        <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;        <span class="keyword">struct </span><a class="code" href="structenv__set.html">env_set</a> *es = <a class="code" href="env__set_8c.html#a589b54db89bdd1a4683d80b8132ce577">env_set_create</a>(NULL);</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s create&quot;</span>, <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, dev);</div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;        <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;        <a class="code" href="env__set_8c.html#a8f95bd5663cdc04bc9764b429538f536">env_set_add</a>( es, <span class="stringliteral">&quot;ODMDIR=/etc/objrepos&quot;</span> );</div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;        <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, <a class="code" href="run__command_8h.html#a2a6d02b9ff0a76e78bf5c76834a29d89">S_FATAL</a>, <span class="stringliteral">&quot;AIX &#39;create tun interface&#39; failed&quot;</span>);</div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;        <a class="code" href="env__set_8c.html#a2d1a7f0ea69776000aa9df3eca186f97">env_set_destroy</a>(es);</div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;        <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;    }</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;    {</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;        <span class="comment">/* we didn&#39;t make it, we&#39;re not going to break it */</span></div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#afd4a0397ced0c1118162c669228dfc58">persistent_if</a> = TRUE;</div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;    }</div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160; </div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;    <span class="keywordflow">if</span> ((tt-&gt;fd = open(tunname, O_RDWR)) &lt; 0)</div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;    {</div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Cannot open TAP device &#39;%s&#39;&quot;</span>, tunname);</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;    }</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160; </div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;    <a class="code" href="fdmisc_8c.html#a4bd55f9b59d6c9123787beb7431dac85">set_nonblock</a>(tt-&gt;fd);</div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;    <a class="code" href="fdmisc_8c.html#a09193ec56615d682308eff8c491fc791">set_cloexec</a>(tt-&gt;fd); <span class="comment">/* don&#39;t pass fd to scripts */</span></div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;TUN/TAP device %s opened&quot;</span>, tunname);</div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160; </div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;    <span class="comment">/* tt-&gt;actual_name is passed to up and down scripts and used as the ifconfig dev name */</span></div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;    tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a> = <a class="code" href="buffer_8c.html#a06e0220403278399596a7a1b6b601fca">string_alloc</a>(dev, NULL);</div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;}</div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160; </div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;<span class="comment">/* tap devices need to be manually destroyed on AIX</span></div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;<a class="code" href="tun_8c.html#aa160989ccb62fe8390475d34bda3d2f8">close_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;{</div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(tt);</div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160; </div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;    <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;    <span class="keyword">struct </span><a class="code" href="structenv__set.html">env_set</a> *es = <a class="code" href="env__set_8c.html#a589b54db89bdd1a4683d80b8132ce577">env_set_create</a>(NULL);</div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160; </div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;    <span class="comment">/* persistent devices need IP address unconfig, others need destroyal</span></div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#afd4a0397ced0c1118162c669228dfc58">persistent_if</a>)</div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;    {</div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s 0.0.0.0 down&quot;</span>,</div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;                    <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>);</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;    }</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;    {</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s %s destroy&quot;</span>,</div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;                    <a class="code" href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a>, tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>);</div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;    }</div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160; </div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;    close_tun_generic(tt);</div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;    <a class="code" href="env__set_8c.html#a8f95bd5663cdc04bc9764b429538f536">env_set_add</a>( es, <span class="stringliteral">&quot;ODMDIR=/etc/objrepos&quot;</span> );</div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, 0, <span class="stringliteral">&quot;AIX &#39;destroy tap interface&#39; failed (non-critical)&quot;</span>);</div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160; </div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;    free(tt);</div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;    <a class="code" href="env__set_8c.html#a2d1a7f0ea69776000aa9df3eca186f97">env_set_destroy</a>(es);</div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;    <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;}</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160; </div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;<a class="code" href="tun_8h.html#afdac6b3217749dccb863f9dc39818b9d">write_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;{</div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aae835b662be01cdc3752f7db84529cca">write</a>(tt-&gt;fd, buf, len);</div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;}</div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160; </div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;<a class="code" href="tun_8h.html#ac75f33ac5fe746f7bf5733d9e8c67bf2">read_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;{</div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aea7c12cb3031ad9e88104ce9859ce1c5">read</a>(tt-&gt;fd, buf, len);</div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;}</div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160; </div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;<span class="preprocessor">#elif defined(_WIN32)</span></div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160; </div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a name="l03420"></a><span class="lineno"><a class="line" href="tun_8c.html#a010dca1493549f9daf185b9eb421ecf4"> 3420</a></span>&#160;<a class="code" href="tun_8c.html#a010dca1493549f9daf185b9eb421ecf4">print_windows_driver</a>(<span class="keyword">enum</span> <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5">windows_driver_type</a> windows_driver)</div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;{</div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;    <span class="keywordflow">switch</span> (windows_driver)</div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;    {</div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5af42c0a58f6f53f325f4a7443ee430922">WINDOWS_DRIVER_TAP_WINDOWS6</a>:</div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;tap-windows6&quot;</span>;</div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160; </div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5a2d613eaa5b7f632cbcc6c0fd16015bbc">WINDOWS_DRIVER_WINTUN</a>:</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;wintun&quot;</span>;</div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160; </div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;unspecified&quot;</span>;</div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;    }</div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;}</div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160; </div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l03436"></a><span class="lineno"><a class="line" href="tun_8h.html#ac4222076d82f58b4420bd8bd1c2c5aa9"> 3436</a></span>&#160;<a class="code" href="tun_8c.html#ac4222076d82f58b4420bd8bd1c2c5aa9">tun_read_queue</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keywordtype">int</span> maxsize)</div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;{</div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#ace488a5d44d5d2fb48eb52acb5b49c20">iostate</a> == <a class="code" href="win32_8h.html#a5d6accbac4ed5455a785b9d509e9f593">IOSTATE_INITIAL</a>)</div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;    {</div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;        DWORD len;</div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;        BOOL <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>;</div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;        <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160; </div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;        <span class="comment">/* reset buf to its initial state */</span></div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#a2b99716d4793c43eaa1584eb73e644f1">buf</a> = tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#a5f59337f35e730d2e38df7dc6261b0c8">buf_init</a>;</div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160; </div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;        len = maxsize ? maxsize : <a class="code" href="buffer_8h.html#ab7be565801383d9f7371ab9a6aa99077">BLEN</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#a2b99716d4793c43eaa1584eb73e644f1">buf</a>);</div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;        <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(len &lt;= <a class="code" href="buffer_8h.html#ab7be565801383d9f7371ab9a6aa99077">BLEN</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#a2b99716d4793c43eaa1584eb73e644f1">buf</a>));</div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160; </div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;        <span class="comment">/* the overlapped read will signal this event on I/O completion */</span></div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;        <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(ResetEvent(tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#a41141dbe6995d7c7c65ce268d6c1b5d9">overlapped</a>.hEvent));</div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160; </div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;        <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = ReadFile(</div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;            tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a>,</div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;            <a class="code" href="buffer_8h.html#a3be0c11aee0e4d7fe9e0b15235668c43">BPTR</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#a2b99716d4793c43eaa1584eb73e644f1">buf</a>),</div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;            len,</div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;            &amp;tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#a409152b5e8b53ea2b0d09dd7a9588334">size</a>,</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;            &amp;tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#a41141dbe6995d7c7c65ce268d6c1b5d9">overlapped</a></div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;            );</div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160; </div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>) <span class="comment">/* operation completed immediately? */</span></div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;        {</div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;            <span class="comment">/* since we got an immediate return, we must signal the event object ourselves */</span></div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;            <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(SetEvent(tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#a41141dbe6995d7c7c65ce268d6c1b5d9">overlapped</a>.hEvent));</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160; </div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;            tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#ace488a5d44d5d2fb48eb52acb5b49c20">iostate</a> = <a class="code" href="win32_8h.html#a26b3e132c1f135136ef00f53ff0756a2">IOSTATE_IMMEDIATE_RETURN</a>;</div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;            tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#af7dc2174454add437fc9031f79cdc174">status</a> = 0;</div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160; </div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a7b242eaaa97c7e6473a58b26e83fe06d">D_WIN32_IO</a>, <span class="stringliteral">&quot;WIN32 I/O: TAP Read immediate return [%d,%d]&quot;</span>,</div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;                 (<span class="keywordtype">int</span>) len,</div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;                 (<span class="keywordtype">int</span>) tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#a409152b5e8b53ea2b0d09dd7a9588334">size</a>);</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;        }</div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;        {</div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;            err = GetLastError();</div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;            <span class="keywordflow">if</span> (err == ERROR_IO_PENDING) <span class="comment">/* operation queued? */</span></div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;            {</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;                tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#ace488a5d44d5d2fb48eb52acb5b49c20">iostate</a> = <a class="code" href="win32_8h.html#a796aff3281e7e20d2e63b0daeb050d82">IOSTATE_QUEUED</a>;</div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;                tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#af7dc2174454add437fc9031f79cdc174">status</a> = err;</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a7b242eaaa97c7e6473a58b26e83fe06d">D_WIN32_IO</a>, <span class="stringliteral">&quot;WIN32 I/O: TAP Read queued [%d]&quot;</span>,</div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;                     (<span class="keywordtype">int</span>) len);</div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;            }</div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;            <span class="keywordflow">else</span> <span class="comment">/* error occurred */</span></div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;            {</div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;                <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;                <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(SetEvent(tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#a41141dbe6995d7c7c65ce268d6c1b5d9">overlapped</a>.hEvent));</div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;                tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#ace488a5d44d5d2fb48eb52acb5b49c20">iostate</a> = <a class="code" href="win32_8h.html#a26b3e132c1f135136ef00f53ff0756a2">IOSTATE_IMMEDIATE_RETURN</a>;</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;                tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#af7dc2174454add437fc9031f79cdc174">status</a> = err;</div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a7b242eaaa97c7e6473a58b26e83fe06d">D_WIN32_IO</a>, <span class="stringliteral">&quot;WIN32 I/O: TAP Read error [%d] : %s&quot;</span>,</div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;                     (<span class="keywordtype">int</span>) len,</div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;                     <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>, &amp;gc));</div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;                <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;            }</div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;        }</div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;    }</div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;    <span class="keywordflow">return</span> tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>.<a class="code" href="structoverlapped__io.html#ace488a5d44d5d2fb48eb52acb5b49c20">iostate</a>;</div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;}</div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160; </div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l03500"></a><span class="lineno"><a class="line" href="tun_8h.html#a8452b544a2f27a1d2cb0518b3c091c04"> 3500</a></span>&#160;<a class="code" href="tun_8c.html#a8452b544a2f27a1d2cb0518b3c091c04">tun_write_queue</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keyword">struct</span> <a class="code" href="structbuffer.html">buffer</a> *buf)</div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;{</div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#ace488a5d44d5d2fb48eb52acb5b49c20">iostate</a> == <a class="code" href="win32_8h.html#a5d6accbac4ed5455a785b9d509e9f593">IOSTATE_INITIAL</a>)</div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;    {</div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;        BOOL <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>;</div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;        <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160; </div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;        <span class="comment">/* make a private copy of buf */</span></div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#a2b99716d4793c43eaa1584eb73e644f1">buf</a> = tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#a5f59337f35e730d2e38df7dc6261b0c8">buf_init</a>;</div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#a2b99716d4793c43eaa1584eb73e644f1">buf</a>.<a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a> = 0;</div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;        <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(<a class="code" href="buffer_8h.html#a3917d4f93343d7a095b63cd7f6bd9497">buf_copy</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#a2b99716d4793c43eaa1584eb73e644f1">buf</a>, buf));</div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160; </div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;        <span class="comment">/* the overlapped write will signal this event on I/O completion */</span></div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;        <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(ResetEvent(tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#a41141dbe6995d7c7c65ce268d6c1b5d9">overlapped</a>.hEvent));</div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160; </div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;        <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = WriteFile(</div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;            tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a>,</div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;            <a class="code" href="buffer_8h.html#a3be0c11aee0e4d7fe9e0b15235668c43">BPTR</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#a2b99716d4793c43eaa1584eb73e644f1">buf</a>),</div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;            <a class="code" href="buffer_8h.html#ab7be565801383d9f7371ab9a6aa99077">BLEN</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#a2b99716d4793c43eaa1584eb73e644f1">buf</a>),</div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;            &amp;tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#a409152b5e8b53ea2b0d09dd7a9588334">size</a>,</div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;            &amp;tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#a41141dbe6995d7c7c65ce268d6c1b5d9">overlapped</a></div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;            );</div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160; </div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>) <span class="comment">/* operation completed immediately? */</span></div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;        {</div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;            tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#ace488a5d44d5d2fb48eb52acb5b49c20">iostate</a> = <a class="code" href="win32_8h.html#a26b3e132c1f135136ef00f53ff0756a2">IOSTATE_IMMEDIATE_RETURN</a>;</div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160; </div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;            <span class="comment">/* since we got an immediate return, we must signal the event object ourselves */</span></div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;            <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(SetEvent(tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#a41141dbe6995d7c7c65ce268d6c1b5d9">overlapped</a>.hEvent));</div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160; </div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;            tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#af7dc2174454add437fc9031f79cdc174">status</a> = 0;</div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160; </div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a7b242eaaa97c7e6473a58b26e83fe06d">D_WIN32_IO</a>, <span class="stringliteral">&quot;WIN32 I/O: TAP Write immediate return [%d,%d]&quot;</span>,</div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;                 <a class="code" href="buffer_8h.html#ab7be565801383d9f7371ab9a6aa99077">BLEN</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#a2b99716d4793c43eaa1584eb73e644f1">buf</a>),</div>
<div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;                 (<span class="keywordtype">int</span>) tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#a409152b5e8b53ea2b0d09dd7a9588334">size</a>);</div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;        }</div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;        {</div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;            err = GetLastError();</div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;            <span class="keywordflow">if</span> (err == ERROR_IO_PENDING) <span class="comment">/* operation queued? */</span></div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;            {</div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;                tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#ace488a5d44d5d2fb48eb52acb5b49c20">iostate</a> = <a class="code" href="win32_8h.html#a796aff3281e7e20d2e63b0daeb050d82">IOSTATE_QUEUED</a>;</div>
<div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;                tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#af7dc2174454add437fc9031f79cdc174">status</a> = err;</div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a7b242eaaa97c7e6473a58b26e83fe06d">D_WIN32_IO</a>, <span class="stringliteral">&quot;WIN32 I/O: TAP Write queued [%d]&quot;</span>,</div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;                     <a class="code" href="buffer_8h.html#ab7be565801383d9f7371ab9a6aa99077">BLEN</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#a2b99716d4793c43eaa1584eb73e644f1">buf</a>));</div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;            }</div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;            <span class="keywordflow">else</span> <span class="comment">/* error occurred */</span></div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;            {</div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;                <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;                <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(SetEvent(tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#a41141dbe6995d7c7c65ce268d6c1b5d9">overlapped</a>.hEvent));</div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;                tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#ace488a5d44d5d2fb48eb52acb5b49c20">iostate</a> = <a class="code" href="win32_8h.html#a26b3e132c1f135136ef00f53ff0756a2">IOSTATE_IMMEDIATE_RETURN</a>;</div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;                tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#af7dc2174454add437fc9031f79cdc174">status</a> = err;</div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a7b242eaaa97c7e6473a58b26e83fe06d">D_WIN32_IO</a>, <span class="stringliteral">&quot;WIN32 I/O: TAP Write error [%d] : %s&quot;</span>,</div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;                     <a class="code" href="buffer_8h.html#ab7be565801383d9f7371ab9a6aa99077">BLEN</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#a2b99716d4793c43eaa1584eb73e644f1">buf</a>),</div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;                     <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(err, &amp;gc));</div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;                <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;            }</div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;        }</div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;    }</div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;    <span class="keywordflow">return</span> tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>.<a class="code" href="structoverlapped__io.html#ace488a5d44d5d2fb48eb52acb5b49c20">iostate</a>;</div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;}</div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160; </div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l03563"></a><span class="lineno"><a class="line" href="tun_8h.html#a4752aab14c79cbf33afc053aa6a28713"> 3563</a></span>&#160;<a class="code" href="tun_8c.html#a4752aab14c79cbf33afc053aa6a28713">tun_finalize</a>(</div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;    HANDLE h,</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;    <span class="keyword">struct</span> <a class="code" href="structoverlapped__io.html">overlapped_io</a> *io,</div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;    <span class="keyword">struct</span> <a class="code" href="structbuffer.html">buffer</a> *buf)</div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;{</div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;    <span class="keywordtype">int</span> ret = -1;</div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;    BOOL <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>;</div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160; </div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;    <span class="keywordflow">switch</span> (io-&gt;<a class="code" href="structoverlapped__io.html#ace488a5d44d5d2fb48eb52acb5b49c20">iostate</a>)</div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;    {</div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="win32_8h.html#a796aff3281e7e20d2e63b0daeb050d82">IOSTATE_QUEUED</a>:</div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;            <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = GetOverlappedResult(</div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;                h,</div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;                &amp;io-&gt;<a class="code" href="structoverlapped__io.html#a41141dbe6995d7c7c65ce268d6c1b5d9">overlapped</a>,</div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;                &amp;io-&gt;<a class="code" href="structoverlapped__io.html#a409152b5e8b53ea2b0d09dd7a9588334">size</a>,</div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;                FALSE</div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;                );</div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>)</div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;            {</div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;                <span class="comment">/* successful return for a queued operation */</span></div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;                <span class="keywordflow">if</span> (buf)</div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;                {</div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;                    *buf = io-&gt;<a class="code" href="structoverlapped__io.html#a2b99716d4793c43eaa1584eb73e644f1">buf</a>;</div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;                }</div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;                ret = io-&gt;<a class="code" href="structoverlapped__io.html#a409152b5e8b53ea2b0d09dd7a9588334">size</a>;</div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;                io-&gt;<a class="code" href="structoverlapped__io.html#ace488a5d44d5d2fb48eb52acb5b49c20">iostate</a> = <a class="code" href="win32_8h.html#a5d6accbac4ed5455a785b9d509e9f593">IOSTATE_INITIAL</a>;</div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;                <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(ResetEvent(io-&gt;<a class="code" href="structoverlapped__io.html#a41141dbe6995d7c7c65ce268d6c1b5d9">overlapped</a>.hEvent));</div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a7b242eaaa97c7e6473a58b26e83fe06d">D_WIN32_IO</a>, <span class="stringliteral">&quot;WIN32 I/O: TAP Completion success [%d]&quot;</span>, ret);</div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;            }</div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;            {</div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;                <span class="comment">/* error during a queued operation */</span></div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;                ret = -1;</div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;                <span class="keywordflow">if</span> (GetLastError() != ERROR_IO_INCOMPLETE)</div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;                {</div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;                    <span class="comment">/* if no error (i.e. just not finished yet),</span></div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;<span class="comment">                     * then DON&#39;T execute this code */</span></div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;                    io-&gt;<a class="code" href="structoverlapped__io.html#ace488a5d44d5d2fb48eb52acb5b49c20">iostate</a> = <a class="code" href="win32_8h.html#a5d6accbac4ed5455a785b9d509e9f593">IOSTATE_INITIAL</a>;</div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;                    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(ResetEvent(io-&gt;<a class="code" href="structoverlapped__io.html#a41141dbe6995d7c7c65ce268d6c1b5d9">overlapped</a>.hEvent));</div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;                    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#a7b242eaaa97c7e6473a58b26e83fe06d">D_WIN32_IO</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;WIN32 I/O: TAP Completion error&quot;</span>);</div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;                }</div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;            }</div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160; </div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="win32_8h.html#a26b3e132c1f135136ef00f53ff0756a2">IOSTATE_IMMEDIATE_RETURN</a>:</div>
<div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;            io-&gt;<a class="code" href="structoverlapped__io.html#ace488a5d44d5d2fb48eb52acb5b49c20">iostate</a> = <a class="code" href="win32_8h.html#a5d6accbac4ed5455a785b9d509e9f593">IOSTATE_INITIAL</a>;</div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;            <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(ResetEvent(io-&gt;<a class="code" href="structoverlapped__io.html#a41141dbe6995d7c7c65ce268d6c1b5d9">overlapped</a>.hEvent));</div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;            <span class="keywordflow">if</span> (io-&gt;<a class="code" href="structoverlapped__io.html#af7dc2174454add437fc9031f79cdc174">status</a>)</div>
<div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;            {</div>
<div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;                <span class="comment">/* error return for a non-queued operation */</span></div>
<div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;                SetLastError(io-&gt;<a class="code" href="structoverlapped__io.html#af7dc2174454add437fc9031f79cdc174">status</a>);</div>
<div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;                ret = -1;</div>
<div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#a7b242eaaa97c7e6473a58b26e83fe06d">D_WIN32_IO</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;WIN32 I/O: TAP Completion non-queued error&quot;</span>);</div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;            }</div>
<div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;            {</div>
<div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;                <span class="comment">/* successful return for a non-queued operation */</span></div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;                <span class="keywordflow">if</span> (buf)</div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;                {</div>
<div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;                    *buf = io-&gt;<a class="code" href="structoverlapped__io.html#a2b99716d4793c43eaa1584eb73e644f1">buf</a>;</div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;                }</div>
<div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;                ret = io-&gt;<a class="code" href="structoverlapped__io.html#a409152b5e8b53ea2b0d09dd7a9588334">size</a>;</div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a7b242eaaa97c7e6473a58b26e83fe06d">D_WIN32_IO</a>, <span class="stringliteral">&quot;WIN32 I/O: TAP Completion non-queued success [%d]&quot;</span>, ret);</div>
<div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;            }</div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160; </div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="win32_8h.html#a5d6accbac4ed5455a785b9d509e9f593">IOSTATE_INITIAL</a>: <span class="comment">/* were we called without proper queueing? */</span></div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;            SetLastError(ERROR_INVALID_FUNCTION);</div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;            ret = -1;</div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a7b242eaaa97c7e6473a58b26e83fe06d">D_WIN32_IO</a>, <span class="stringliteral">&quot;WIN32 I/O: TAP Completion BAD STATE&quot;</span>);</div>
<div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160; </div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;            <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(0);</div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;    }</div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160; </div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;    <span class="keywordflow">if</span> (buf)</div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;    {</div>
<div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;        buf-&gt;<a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a> = ret;</div>
<div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;    }</div>
<div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;}</div>
<div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160; </div>
<div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdevice__instance__id__interface.html">device_instance_id_interface</a> *</div>
<div class="line"><a name="l03647"></a><span class="lineno"><a class="line" href="tun_8c.html#ade54ed872f97bdf6e1499010b64c01cd"> 3647</a></span>&#160;<a class="code" href="tun_8c.html#ade54ed872f97bdf6e1499010b64c01cd">get_device_instance_id_interface</a>(<span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;{</div>
<div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;    HDEVINFO dev_info_set;</div>
<div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;    DWORD err;</div>
<div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;    <span class="keyword">struct </span><a class="code" href="structdevice__instance__id__interface.html">device_instance_id_interface</a> *first = NULL;</div>
<div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;    <span class="keyword">struct </span><a class="code" href="structdevice__instance__id__interface.html">device_instance_id_interface</a> *last = NULL;</div>
<div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160; </div>
<div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;    dev_info_set = SetupDiGetClassDevsEx(&amp;<a class="code" href="tun_8c.html#a186d3bab6f7316394df0fb85f079f8bf">GUID_DEVCLASS_NET</a>, NULL, NULL, DIGCF_PRESENT, NULL, NULL, NULL);</div>
<div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;    <span class="keywordflow">if</span> (dev_info_set == INVALID_HANDLE_VALUE)</div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;    {</div>
<div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;        err = GetLastError();</div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Error [%u] opening device information set key: %s&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)err, <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(err, gc));</div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;    }</div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160; </div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;    <span class="keywordflow">for</span> (DWORD i = 0;; ++i)</div>
<div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;    {</div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;        SP_DEVINFO_DATA device_info_data;</div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;        BOOL res;</div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;        HKEY dev_key;</div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;        <span class="keywordtype">char</span> net_cfg_instance_id_string[] = <span class="stringliteral">&quot;NetCfgInstanceId&quot;</span>;</div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;        <span class="keywordtype">char</span> <a class="code" href="structdevice__instance__id__interface.html#aedb7d2661a86a92e9ff1663731117acb">net_cfg_instance_id</a>[256];</div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;        <span class="keywordtype">char</span> device_instance_id[256];</div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;        DWORD len;</div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;        DWORD data_type;</div>
<div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;        LONG <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>;</div>
<div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;        ULONG dev_interface_list_size;</div>
<div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;        CONFIGRET cr;</div>
<div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;        <span class="keyword">struct </span><a class="code" href="structbuffer.html">buffer</a> dev_interface_list;</div>
<div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160; </div>
<div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;        ZeroMemory(&amp;device_info_data, <span class="keyword">sizeof</span>(SP_DEVINFO_DATA));</div>
<div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;        device_info_data.cbSize = <span class="keyword">sizeof</span>(SP_DEVINFO_DATA);</div>
<div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;        res = SetupDiEnumDeviceInfo(dev_info_set, i, &amp;device_info_data);</div>
<div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;        <span class="keywordflow">if</span> (!res)</div>
<div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;        {</div>
<div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;            <span class="keywordflow">if</span> (GetLastError() == ERROR_NO_MORE_ITEMS)</div>
<div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;            {</div>
<div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;            }</div>
<div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;            {</div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;            }</div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;        }</div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160; </div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;        dev_key = SetupDiOpenDevRegKey(dev_info_set, &amp;device_info_data, DICS_FLAG_GLOBAL, 0, DIREG_DRV, KEY_QUERY_VALUE);</div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;        <span class="keywordflow">if</span> (dev_key == INVALID_HANDLE_VALUE)</div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;        {</div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;        }</div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160; </div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;        <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a> = <span class="keyword">sizeof</span>(net_cfg_instance_id);</div>
<div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;        data_type = REG_SZ;</div>
<div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;        <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = RegQueryValueEx(dev_key,</div>
<div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;                                 net_cfg_instance_id_string,</div>
<div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;                                 NULL,</div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;                                 &amp;data_type,</div>
<div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;                                 net_cfg_instance_id,</div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;                                 &amp;<a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>);</div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> != ERROR_SUCCESS)</div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;        {</div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;            <span class="keywordflow">goto</span> next;</div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;        }</div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160; </div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;        <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a> = <span class="keyword">sizeof</span>(device_instance_id);</div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;        res = SetupDiGetDeviceInstanceId(dev_info_set, &amp;device_info_data, device_instance_id, <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>, &amp;<a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>);</div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;        <span class="keywordflow">if</span> (!res)</div>
<div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;        {</div>
<div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;            <span class="keywordflow">goto</span> next;</div>
<div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;        }</div>
<div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160; </div>
<div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;        cr = CM_Get_Device_Interface_List_Size(&amp;dev_interface_list_size,</div>
<div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;                                               (LPGUID)&amp;<a class="code" href="tun_8c.html#a1d5d5169074921cd8315ae3b537d003d">GUID_DEVINTERFACE_NET</a>,</div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;                                               device_instance_id,</div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;                                               CM_GET_DEVICE_INTERFACE_LIST_PRESENT);</div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160; </div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;        <span class="keywordflow">if</span> (cr != CR_SUCCESS)</div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;        {</div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;            <span class="keywordflow">goto</span> next;</div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;        }</div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160; </div>
<div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;        dev_interface_list = <a class="code" href="buffer_8c.html#aa35bf7feb6a99bf5d364b2d4eba1195c">alloc_buf_gc</a>(dev_interface_list_size, gc);</div>
<div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;        cr = CM_Get_Device_Interface_List((LPGUID)&amp;<a class="code" href="tun_8c.html#a1d5d5169074921cd8315ae3b537d003d">GUID_DEVINTERFACE_NET</a>, device_instance_id,</div>
<div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;                                          <a class="code" href="buffer_8h.html#a3be0c11aee0e4d7fe9e0b15235668c43">BPTR</a>(&amp;dev_interface_list),</div>
<div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;                                          dev_interface_list_size,</div>
<div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;                                          CM_GET_DEVICE_INTERFACE_LIST_PRESENT);</div>
<div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;        <span class="keywordflow">if</span> (cr != CR_SUCCESS)</div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;        {</div>
<div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;            <span class="keywordflow">goto</span> next;</div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;        }</div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160; </div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;        <span class="keyword">struct </span><a class="code" href="structdevice__instance__id__interface.html">device_instance_id_interface</a> *dev_if;</div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;        <a class="code" href="buffer_8h.html#ab4491b7f3124ff7b050e37c38c2e620b">ALLOC_OBJ_CLEAR_GC</a>(dev_if, <span class="keyword">struct</span> <a class="code" href="structdevice__instance__id__interface.html">device_instance_id_interface</a>, gc);</div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;        dev_if-&gt;<a class="code" href="structdevice__instance__id__interface.html#aedb7d2661a86a92e9ff1663731117acb">net_cfg_instance_id</a> = <a class="code" href="buffer_8c.html#a06e0220403278399596a7a1b6b601fca">string_alloc</a>(<a class="code" href="structdevice__instance__id__interface.html#aedb7d2661a86a92e9ff1663731117acb">net_cfg_instance_id</a>, gc);</div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;        dev_if-&gt;<a class="code" href="structdevice__instance__id__interface.html#a7dbe478850f0a2e0773ca2e82163d5d3">device_interface_list</a> = <a class="code" href="buffer_8c.html#a06e0220403278399596a7a1b6b601fca">string_alloc</a>(<a class="code" href="buffer_8h.html#a34c800967d7b9583cb64236eadab94dd">BSTR</a>(&amp;dev_interface_list), gc);</div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160; </div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;        <span class="comment">/* link into return list */</span></div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;        <span class="keywordflow">if</span> (!first)</div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;        {</div>
<div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;            first = dev_if;</div>
<div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;        }</div>
<div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;        <span class="keywordflow">if</span> (last)</div>
<div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;        {</div>
<div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;            last-&gt;<a class="code" href="structdevice__instance__id__interface.html#ad6406b583eb3aa6dd03b66a22252640e">next</a> = dev_if;</div>
<div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;        }</div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;        last = dev_if;</div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160; </div>
<div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;<a class="code" href="structdevice__instance__id__interface.html#ad6406b583eb3aa6dd03b66a22252640e">next</a>:</div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;        RegCloseKey(dev_key);</div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;    }</div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160; </div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;    SetupDiDestroyDeviceInfoList(dev_info_set);</div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160; </div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;    <span class="keywordflow">return</span> first;</div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;}</div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160; </div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtap__reg.html">tap_reg</a> *</div>
<div class="line"><a name="l03763"></a><span class="lineno"><a class="line" href="tun_8c.html#ab6ace179866b796f9a2962093e36ba71"> 3763</a></span>&#160;<a class="code" href="tun_8c.html#ab6ace179866b796f9a2962093e36ba71">get_tap_reg</a>(<span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;{</div>
<div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;    HKEY adapter_key;</div>
<div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;    LONG <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>;</div>
<div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;    DWORD len;</div>
<div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtap__reg.html">tap_reg</a> *first = NULL;</div>
<div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtap__reg.html">tap_reg</a> *last = NULL;</div>
<div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;    <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160; </div>
<div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;    <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = RegOpenKeyEx(</div>
<div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;        HKEY_LOCAL_MACHINE,</div>
<div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;        ADAPTER_KEY,</div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;        0,</div>
<div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;        KEY_READ,</div>
<div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;        &amp;adapter_key);</div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160; </div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> != ERROR_SUCCESS)</div>
<div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;    {</div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Error opening registry key: %s&quot;</span>, ADAPTER_KEY);</div>
<div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;    }</div>
<div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160; </div>
<div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;    {</div>
<div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;        <span class="keywordtype">char</span> enum_name[256];</div>
<div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;        <span class="keywordtype">char</span> unit_string[256];</div>
<div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;        HKEY unit_key;</div>
<div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;        <span class="keywordtype">char</span> component_id_string[] = <span class="stringliteral">&quot;ComponentId&quot;</span>;</div>
<div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;        <span class="keywordtype">char</span> component_id[256];</div>
<div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;        <span class="keywordtype">char</span> net_cfg_instance_id_string[] = <span class="stringliteral">&quot;NetCfgInstanceId&quot;</span>;</div>
<div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;        <span class="keywordtype">char</span> net_cfg_instance_id[256];</div>
<div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;        DWORD data_type;</div>
<div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160; </div>
<div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;        len = <span class="keyword">sizeof</span>(enum_name);</div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;        <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = RegEnumKeyEx(</div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;            adapter_key,</div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;            i,</div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;            enum_name,</div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;            &amp;len,</div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;            NULL,</div>
<div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;            NULL,</div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;            NULL,</div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;            NULL);</div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> == ERROR_NO_MORE_ITEMS)</div>
<div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;        {</div>
<div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;        }</div>
<div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> != ERROR_SUCCESS)</div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;        {</div>
<div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Error enumerating registry subkeys of key: %s&quot;</span>,</div>
<div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;                ADAPTER_KEY);</div>
<div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;        }</div>
<div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160; </div>
<div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;        <a class="code" href="buffer_8c.html#afd2a93a0940b1ea7e093d293a05e2927">openvpn_snprintf</a>(unit_string, <span class="keyword">sizeof</span>(unit_string), <span class="stringliteral">&quot;%s\\%s&quot;</span>,</div>
<div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;                         ADAPTER_KEY, enum_name);</div>
<div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160; </div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;        <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = RegOpenKeyEx(</div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;            HKEY_LOCAL_MACHINE,</div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;            unit_string,</div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;            0,</div>
<div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;            KEY_READ,</div>
<div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;            &amp;unit_key);</div>
<div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160; </div>
<div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> != ERROR_SUCCESS)</div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;        {</div>
<div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a162e523d0aa5dd0877a1b019364c35ce">D_REGISTRY</a>, <span class="stringliteral">&quot;Error opening registry key: %s&quot;</span>, unit_string);</div>
<div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;        }</div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;        {</div>
<div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;            len = <span class="keyword">sizeof</span>(component_id);</div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;            <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = RegQueryValueEx(</div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;                unit_key,</div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;                component_id_string,</div>
<div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;                NULL,</div>
<div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;                &amp;data_type,</div>
<div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;                component_id,</div>
<div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;                &amp;len);</div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160; </div>
<div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> != ERROR_SUCCESS || data_type != REG_SZ)</div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;            {</div>
<div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a162e523d0aa5dd0877a1b019364c35ce">D_REGISTRY</a>, <span class="stringliteral">&quot;Error opening registry key: %s\\%s&quot;</span>,</div>
<div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;                     unit_string, component_id_string);</div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;            }</div>
<div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;            {</div>
<div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;                len = <span class="keyword">sizeof</span>(net_cfg_instance_id);</div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;                <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = RegQueryValueEx(</div>
<div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;                    unit_key,</div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;                    net_cfg_instance_id_string,</div>
<div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;                    NULL,</div>
<div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;                    &amp;data_type,</div>
<div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;                    net_cfg_instance_id,</div>
<div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;                    &amp;len);</div>
<div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160; </div>
<div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> == ERROR_SUCCESS &amp;&amp; data_type == REG_SZ)</div>
<div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;                {</div>
<div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;                    <span class="comment">/* Is this adapter supported? */</span></div>
<div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;                    <span class="keyword">enum</span> <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5">windows_driver_type</a> <a class="code" href="structtap__reg.html#a9a2c6fa4ca2b0380309be23ed13092fa">windows_driver</a> = <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5a84774ae3fbc0453084663006f3f21835">WINDOWS_DRIVER_UNSPECIFIED</a>;</div>
<div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="config-msvc_8h.html#ac99ec3f1036620727a68aa8c25a8963c">strcasecmp</a>(component_id, <a class="code" href="config-msvc-version_8h.html#a5a757f94d1c48e85c5ed83947ae1f519">TAP_WIN_COMPONENT_ID</a>) == 0</div>
<div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;                        || <a class="code" href="config-msvc_8h.html#ac99ec3f1036620727a68aa8c25a8963c">strcasecmp</a>(component_id, <span class="stringliteral">&quot;root\\&quot;</span> <a class="code" href="config-msvc-version_8h.html#a5a757f94d1c48e85c5ed83947ae1f519">TAP_WIN_COMPONENT_ID</a>) == 0)</div>
<div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;                    {</div>
<div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;                        <a class="code" href="structtap__reg.html#a9a2c6fa4ca2b0380309be23ed13092fa">windows_driver</a> = <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5af42c0a58f6f53f325f4a7443ee430922">WINDOWS_DRIVER_TAP_WINDOWS6</a>;</div>
<div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;                    }</div>
<div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="config-msvc_8h.html#ac99ec3f1036620727a68aa8c25a8963c">strcasecmp</a>(component_id, <a class="code" href="tun_8h.html#a737f411b0d45e255f39036f37f29f332">WINTUN_COMPONENT_ID</a>) == 0)</div>
<div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;                    {</div>
<div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;                        <a class="code" href="structtap__reg.html#a9a2c6fa4ca2b0380309be23ed13092fa">windows_driver</a> = <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5a2d613eaa5b7f632cbcc6c0fd16015bbc">WINDOWS_DRIVER_WINTUN</a>;</div>
<div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;                    }</div>
<div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160; </div>
<div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="structtap__reg.html#a9a2c6fa4ca2b0380309be23ed13092fa">windows_driver</a> != <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5a84774ae3fbc0453084663006f3f21835">WINDOWS_DRIVER_UNSPECIFIED</a>)</div>
<div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;                    {</div>
<div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;                        <span class="keyword">struct </span><a class="code" href="structtap__reg.html">tap_reg</a> *reg;</div>
<div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;                        <a class="code" href="buffer_8h.html#ab4491b7f3124ff7b050e37c38c2e620b">ALLOC_OBJ_CLEAR_GC</a>(reg, <span class="keyword">struct</span> <a class="code" href="structtap__reg.html">tap_reg</a>, gc);</div>
<div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;                        reg-&gt;<a class="code" href="structtap__reg.html#acc79514082663502b07faba4b3838057">guid</a> = <a class="code" href="buffer_8c.html#a06e0220403278399596a7a1b6b601fca">string_alloc</a>(net_cfg_instance_id, gc);</div>
<div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;                        reg-&gt;<a class="code" href="structtap__reg.html#a9a2c6fa4ca2b0380309be23ed13092fa">windows_driver</a> = <a class="code" href="structtap__reg.html#a9a2c6fa4ca2b0380309be23ed13092fa">windows_driver</a>;</div>
<div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160; </div>
<div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;                        <span class="comment">/* link into return list */</span></div>
<div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;                        <span class="keywordflow">if</span> (!first)</div>
<div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;                        {</div>
<div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;                            first = reg;</div>
<div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;                        }</div>
<div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;                        <span class="keywordflow">if</span> (last)</div>
<div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;                        {</div>
<div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;                            last-&gt;<a class="code" href="structtap__reg.html#a6db66ed21486695174b3c550d832ba97">next</a> = reg;</div>
<div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;                        }</div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;                        last = reg;</div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;                    }</div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;                }</div>
<div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;            }</div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;            RegCloseKey(unit_key);</div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;        }</div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;        ++i;</div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;    }</div>
<div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160; </div>
<div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;    RegCloseKey(adapter_key);</div>
<div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;    <span class="keywordflow">return</span> first;</div>
<div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;}</div>
<div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160; </div>
<div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structpanel__reg.html">panel_reg</a> *</div>
<div class="line"><a name="l03900"></a><span class="lineno"><a class="line" href="tun_8c.html#aae4bf389fe2e79e5cca5b3b67a4290b3"> 3900</a></span>&#160;<a class="code" href="tun_8c.html#aae4bf389fe2e79e5cca5b3b67a4290b3">get_panel_reg</a>(<span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;{</div>
<div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;    LONG <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>;</div>
<div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;    HKEY network_connections_key;</div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;    DWORD len;</div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;    <span class="keyword">struct </span><a class="code" href="structpanel__reg.html">panel_reg</a> *first = NULL;</div>
<div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;    <span class="keyword">struct </span><a class="code" href="structpanel__reg.html">panel_reg</a> *last = NULL;</div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;    <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160; </div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;    <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = RegOpenKeyEx(</div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;        HKEY_LOCAL_MACHINE,</div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;        NETWORK_CONNECTIONS_KEY,</div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;        0,</div>
<div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;        KEY_READ,</div>
<div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;        &amp;network_connections_key);</div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160; </div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> != ERROR_SUCCESS)</div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;    {</div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Error opening registry key: %s&quot;</span>, NETWORK_CONNECTIONS_KEY);</div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;    }</div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160; </div>
<div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;    {</div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;        <span class="keywordtype">char</span> enum_name[256];</div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;        <span class="keywordtype">char</span> connection_string[256];</div>
<div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;        HKEY connection_key;</div>
<div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;        WCHAR name_data[256];</div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;        DWORD name_type;</div>
<div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;        <span class="keyword">const</span> WCHAR name_string[] = L<span class="stringliteral">&quot;Name&quot;</span>;</div>
<div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160; </div>
<div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;        len = <span class="keyword">sizeof</span>(enum_name);</div>
<div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;        <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = RegEnumKeyEx(</div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;            network_connections_key,</div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;            i,</div>
<div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;            enum_name,</div>
<div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;            &amp;len,</div>
<div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;            NULL,</div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;            NULL,</div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;            NULL,</div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;            NULL);</div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> == ERROR_NO_MORE_ITEMS)</div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;        {</div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;        }</div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> != ERROR_SUCCESS)</div>
<div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;        {</div>
<div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Error enumerating registry subkeys of key: %s&quot;</span>,</div>
<div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;                NETWORK_CONNECTIONS_KEY);</div>
<div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;        }</div>
<div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160; </div>
<div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;        <a class="code" href="buffer_8c.html#afd2a93a0940b1ea7e093d293a05e2927">openvpn_snprintf</a>(connection_string, <span class="keyword">sizeof</span>(connection_string),</div>
<div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;                         <span class="stringliteral">&quot;%s\\%s\\Connection&quot;</span>,</div>
<div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;                         NETWORK_CONNECTIONS_KEY, enum_name);</div>
<div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160; </div>
<div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;        <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = RegOpenKeyEx(</div>
<div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;            HKEY_LOCAL_MACHINE,</div>
<div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;            connection_string,</div>
<div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;            0,</div>
<div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;            KEY_READ,</div>
<div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;            &amp;connection_key);</div>
<div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160; </div>
<div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> != ERROR_SUCCESS)</div>
<div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;        {</div>
<div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a162e523d0aa5dd0877a1b019364c35ce">D_REGISTRY</a>, <span class="stringliteral">&quot;Error opening registry key: %s&quot;</span>, connection_string);</div>
<div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;        }</div>
<div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;        {</div>
<div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;            len = <span class="keyword">sizeof</span>(name_data);</div>
<div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;            <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = RegQueryValueExW(</div>
<div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;                connection_key,</div>
<div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;                name_string,</div>
<div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;                NULL,</div>
<div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;                &amp;name_type,</div>
<div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;                (LPBYTE) name_data,</div>
<div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;                &amp;len);</div>
<div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160; </div>
<div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> != ERROR_SUCCESS || name_type != REG_SZ)</div>
<div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;            {</div>
<div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a162e523d0aa5dd0877a1b019364c35ce">D_REGISTRY</a>, <span class="stringliteral">&quot;Error opening registry key: %s\\%s\\%ls&quot;</span>,</div>
<div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;                     NETWORK_CONNECTIONS_KEY, connection_string, name_string);</div>
<div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;            }</div>
<div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;            {</div>
<div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;                <span class="keywordtype">int</span> n;</div>
<div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;                LPSTR <a class="code" href="structpanel__reg.html#a9ad43c42e641e3144cef76af1a67e6dd">name</a>;</div>
<div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;                <span class="keyword">struct </span><a class="code" href="structpanel__reg.html">panel_reg</a> *reg;</div>
<div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160; </div>
<div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;                <a class="code" href="buffer_8h.html#ab4491b7f3124ff7b050e37c38c2e620b">ALLOC_OBJ_CLEAR_GC</a>(reg, <span class="keyword">struct</span> <a class="code" href="structpanel__reg.html">panel_reg</a>, gc);</div>
<div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;                n = WideCharToMultiByte(CP_UTF8, 0, name_data, -1, NULL, 0, NULL, NULL);</div>
<div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;                <a class="code" href="structpanel__reg.html#a9ad43c42e641e3144cef76af1a67e6dd">name</a> = <a class="code" href="buffer_8c.html#a67f7dec7f86e113dc0744584fd80b621">gc_malloc</a>(n, <span class="keyword">false</span>, gc);</div>
<div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;                WideCharToMultiByte(CP_UTF8, 0, name_data, -1, <a class="code" href="structpanel__reg.html#a9ad43c42e641e3144cef76af1a67e6dd">name</a>, n, NULL, NULL);</div>
<div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;                reg-&gt;<a class="code" href="structpanel__reg.html#a9ad43c42e641e3144cef76af1a67e6dd">name</a> = <a class="code" href="structpanel__reg.html#a9ad43c42e641e3144cef76af1a67e6dd">name</a>;</div>
<div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;                reg-&gt;<a class="code" href="structpanel__reg.html#ab429b6e90735e653301755d009b0b9ec">guid</a> = <a class="code" href="buffer_8c.html#a06e0220403278399596a7a1b6b601fca">string_alloc</a>(enum_name, gc);</div>
<div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160; </div>
<div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;                <span class="comment">/* link into return list */</span></div>
<div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;                <span class="keywordflow">if</span> (!first)</div>
<div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;                {</div>
<div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;                    first = reg;</div>
<div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;                }</div>
<div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;                <span class="keywordflow">if</span> (last)</div>
<div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;                {</div>
<div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;                    last-&gt;<a class="code" href="structpanel__reg.html#a56c42f64937f34d553ad09e612d5c796">next</a> = reg;</div>
<div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;                }</div>
<div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;                last = reg;</div>
<div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;            }</div>
<div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;            RegCloseKey(connection_key);</div>
<div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;        }</div>
<div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;        ++i;</div>
<div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;    }</div>
<div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160; </div>
<div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;    RegCloseKey(network_connections_key);</div>
<div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160; </div>
<div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;    <span class="keywordflow">return</span> first;</div>
<div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;}</div>
<div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160; </div>
<div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;<span class="comment"> * Check that two addresses are part of the same 255.255.255.252 subnet.</span></div>
<div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l04019"></a><span class="lineno"><a class="line" href="tun_8h.html#afe2a77f5d1c40b6ee4693b0946e452c0"> 4019</a></span>&#160;<a class="code" href="tun_8c.html#afe2a77f5d1c40b6ee4693b0946e452c0">verify_255_255_255_252</a>(<a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> local, <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> remote)</div>
<div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;{</div>
<div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mask = 3;</div>
<div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *err = NULL;</div>
<div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160; </div>
<div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;    <span class="keywordflow">if</span> (local == remote)</div>
<div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;    {</div>
<div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;        err = <span class="stringliteral">&quot;must be different&quot;</span>;</div>
<div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;        <span class="keywordflow">goto</span> error;</div>
<div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;    }</div>
<div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;    <span class="keywordflow">if</span> ((local &amp; (~mask)) != (remote &amp; (~mask)))</div>
<div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;    {</div>
<div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;        err = <span class="stringliteral">&quot;must exist within the same 255.255.255.252 subnet.  This is a limitation of --dev tun when used with the TAP-WIN32 driver&quot;</span>;</div>
<div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;        <span class="keywordflow">goto</span> error;</div>
<div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;    }</div>
<div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;    <span class="keywordflow">if</span> ((local &amp; mask) == 0</div>
<div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;        || (local &amp; mask) == 3</div>
<div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;        || (remote &amp; mask) == 0</div>
<div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;        || (remote &amp; mask) == 3)</div>
<div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;    {</div>
<div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;        err = <span class="stringliteral">&quot;cannot use the first or last address within a given 255.255.255.252 subnet.  This is a limitation of --dev tun when used with the TAP-WIN32 driver&quot;</span>;</div>
<div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;        <span class="keywordflow">goto</span> error;</div>
<div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;    }</div>
<div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160; </div>
<div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160; </div>
<div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;error:</div>
<div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;There is a problem in your selection of --ifconfig endpoints [local=%s, remote=%s].  The local and remote VPN endpoints %s.  Try &#39;&quot;</span> <a class="code" href="config-msvc-version_8h.html#aca8570fb706c81df371b7f9bc454ae03">PACKAGE</a> <span class="stringliteral">&quot; --show-valid-subnets&#39; option for more info.&quot;</span>,</div>
<div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;        <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(local, 0, &amp;gc),</div>
<div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;        <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(remote, 0, &amp;gc),</div>
<div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;        err);</div>
<div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;}</div>
<div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160; </div>
<div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l04056"></a><span class="lineno"><a class="line" href="tun_8h.html#ae4f3096dcc7613fe579be2b052443395"> 4056</a></span>&#160;<a class="code" href="tun_8c.html#ae4f3096dcc7613fe579be2b052443395">show_valid_win32_tun_subnets</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;{</div>
<div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;    <span class="keywordtype">int</span> col = 0;</div>
<div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160; </div>
<div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;    printf(<span class="stringliteral">&quot;On Windows, point-to-point IP support (i.e. --dev tun)\n&quot;</span>);</div>
<div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;    printf(<span class="stringliteral">&quot;is emulated by the TAP-Windows driver.  The major limitation\n&quot;</span>);</div>
<div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;    printf(<span class="stringliteral">&quot;imposed by this approach is that the --ifconfig local and\n&quot;</span>);</div>
<div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;    printf(<span class="stringliteral">&quot;remote endpoints must be part of the same 255.255.255.252\n&quot;</span>);</div>
<div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;    printf(<span class="stringliteral">&quot;subnet.  The following list shows examples of endpoint\n&quot;</span>);</div>
<div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;    printf(<span class="stringliteral">&quot;pairs which satisfy this requirement.  Only the final\n&quot;</span>);</div>
<div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;    printf(<span class="stringliteral">&quot;component of the IP address pairs is at issue.\n\n&quot;</span>);</div>
<div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;    printf(<span class="stringliteral">&quot;As an example, the following option would be correct:\n&quot;</span>);</div>
<div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;    printf(<span class="stringliteral">&quot;    --ifconfig 10.7.0.5 10.7.0.6 (on host A)\n&quot;</span>);</div>
<div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;    printf(<span class="stringliteral">&quot;    --ifconfig 10.7.0.6 10.7.0.5 (on host B)\n&quot;</span>);</div>
<div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;    printf(<span class="stringliteral">&quot;because [5,6] is part of the below list.\n\n&quot;</span>);</div>
<div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160; </div>
<div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; 256; i += 4)</div>
<div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;    {</div>
<div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;        printf(<span class="stringliteral">&quot;[%3d,%3d] &quot;</span>, i+1, i+2);</div>
<div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;        <span class="keywordflow">if</span> (++col &gt; 4)</div>
<div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;        {</div>
<div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;            col = 0;</div>
<div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;            printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;        }</div>
<div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;    }</div>
<div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;    <span class="keywordflow">if</span> (col)</div>
<div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;    {</div>
<div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;    }</div>
<div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;}</div>
<div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160; </div>
<div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l04089"></a><span class="lineno"><a class="line" href="tun_8h.html#a5c807605be4532ee930f54e179b0a7ec"> 4089</a></span>&#160;<a class="code" href="tun_8c.html#a5c807605be4532ee930f54e179b0a7ec">show_tap_win_adapters</a>(<span class="keywordtype">int</span> msglev, <span class="keywordtype">int</span> warnlev)</div>
<div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;{</div>
<div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160; </div>
<div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;    <span class="keywordtype">bool</span> warn_panel_null = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;    <span class="keywordtype">bool</span> warn_panel_dup = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;    <span class="keywordtype">bool</span> warn_tap_dup = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160; </div>
<div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;    <span class="keywordtype">int</span> links;</div>
<div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160; </div>
<div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtap__reg.html">tap_reg</a> *tr;</div>
<div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtap__reg.html">tap_reg</a> *tr1;</div>
<div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structpanel__reg.html">panel_reg</a> *pr;</div>
<div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160; </div>
<div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtap__reg.html">tap_reg</a> *<a class="code" href="structtap__reg.html">tap_reg</a> = <a class="code" href="tun_8c.html#ab6ace179866b796f9a2962093e36ba71">get_tap_reg</a>(&amp;gc);</div>
<div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structpanel__reg.html">panel_reg</a> *<a class="code" href="structpanel__reg.html">panel_reg</a> = <a class="code" href="tun_8c.html#aae4bf389fe2e79e5cca5b3b67a4290b3">get_panel_reg</a>(&amp;gc);</div>
<div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160; </div>
<div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(msglev, <span class="stringliteral">&quot;Available TAP-WIN32 / Wintun adapters [name, GUID, driver]:&quot;</span>);</div>
<div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160; </div>
<div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;    <span class="comment">/* loop through each TAP-Windows adapter registry entry */</span></div>
<div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;    <span class="keywordflow">for</span> (tr = <a class="code" href="structtap__reg.html">tap_reg</a>; tr != NULL; tr = tr-&gt;<a class="code" href="structtap__reg.html#a6db66ed21486695174b3c550d832ba97">next</a>)</div>
<div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;    {</div>
<div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;        links = 0;</div>
<div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160; </div>
<div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;        <span class="comment">/* loop through each network connections entry in the control panel */</span></div>
<div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;        <span class="keywordflow">for</span> (pr = <a class="code" href="structpanel__reg.html">panel_reg</a>; pr != NULL; pr = pr-&gt;<a class="code" href="structpanel__reg.html#a56c42f64937f34d553ad09e612d5c796">next</a>)</div>
<div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;        {</div>
<div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;            <span class="keywordflow">if</span> (!strcmp(tr-&gt;<a class="code" href="structtap__reg.html#acc79514082663502b07faba4b3838057">guid</a>, pr-&gt;<a class="code" href="structpanel__reg.html#ab429b6e90735e653301755d009b0b9ec">guid</a>))</div>
<div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;            {</div>
<div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(msglev, <span class="stringliteral">&quot;&#39;%s&#39; %s %s&quot;</span>, pr-&gt;<a class="code" href="structpanel__reg.html#a9ad43c42e641e3144cef76af1a67e6dd">name</a>, tr-&gt;<a class="code" href="structtap__reg.html#acc79514082663502b07faba4b3838057">guid</a>, <a class="code" href="tun_8c.html#a010dca1493549f9daf185b9eb421ecf4">print_windows_driver</a>(tr-&gt;<a class="code" href="structtap__reg.html#a9a2c6fa4ca2b0380309be23ed13092fa">windows_driver</a>));</div>
<div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;                ++links;</div>
<div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;            }</div>
<div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;        }</div>
<div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160; </div>
<div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;        <span class="keywordflow">if</span> (links &gt; 1)</div>
<div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;        {</div>
<div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;            warn_panel_dup = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;        }</div>
<div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (links == 0)</div>
<div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;        {</div>
<div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;            <span class="comment">/* a TAP adapter exists without a link from the network</span></div>
<div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;<span class="comment">             * connections control panel */</span></div>
<div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;            warn_panel_null = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(msglev, <span class="stringliteral">&quot;[NULL] %s&quot;</span>, tr-&gt;<a class="code" href="structtap__reg.html#acc79514082663502b07faba4b3838057">guid</a>);</div>
<div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;        }</div>
<div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;    }</div>
<div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160; </div>
<div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;    <span class="comment">/* check for TAP-Windows adapter duplicated GUIDs */</span></div>
<div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;    <span class="keywordflow">for</span> (tr = <a class="code" href="structtap__reg.html">tap_reg</a>; tr != NULL; tr = tr-&gt;<a class="code" href="structtap__reg.html#a6db66ed21486695174b3c550d832ba97">next</a>)</div>
<div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;    {</div>
<div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;        <span class="keywordflow">for</span> (tr1 = <a class="code" href="structtap__reg.html">tap_reg</a>; tr1 != NULL; tr1 = tr1-&gt;<a class="code" href="structtap__reg.html#a6db66ed21486695174b3c550d832ba97">next</a>)</div>
<div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;        {</div>
<div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;            <span class="keywordflow">if</span> (tr != tr1 &amp;&amp; !strcmp(tr-&gt;<a class="code" href="structtap__reg.html#acc79514082663502b07faba4b3838057">guid</a>, tr1-&gt;<a class="code" href="structtap__reg.html#acc79514082663502b07faba4b3838057">guid</a>))</div>
<div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;            {</div>
<div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;                warn_tap_dup = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;            }</div>
<div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;        }</div>
<div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;    }</div>
<div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160; </div>
<div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;    <span class="comment">/* warn on registry inconsistencies */</span></div>
<div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;    <span class="keywordflow">if</span> (warn_tap_dup)</div>
<div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;    {</div>
<div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(warnlev, <span class="stringliteral">&quot;WARNING: Some TAP-Windows adapters have duplicate GUIDs&quot;</span>);</div>
<div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;    }</div>
<div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160; </div>
<div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;    <span class="keywordflow">if</span> (warn_panel_dup)</div>
<div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;    {</div>
<div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(warnlev, <span class="stringliteral">&quot;WARNING: Some TAP-Windows adapters have duplicate links from the Network Connections control panel&quot;</span>);</div>
<div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;    }</div>
<div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160; </div>
<div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;    <span class="keywordflow">if</span> (warn_panel_null)</div>
<div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;    {</div>
<div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(warnlev, <span class="stringliteral">&quot;WARNING: Some TAP-Windows adapters have no link from the Network Connections control panel&quot;</span>);</div>
<div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;    }</div>
<div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160; </div>
<div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;}</div>
<div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160; </div>
<div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;<span class="comment"> * Lookup a TAP-Windows or Wintun adapter by GUID.</span></div>
<div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtap__reg.html">tap_reg</a> *</div>
<div class="line"><a name="l04171"></a><span class="lineno"><a class="line" href="tun_8c.html#af145af3d388cb497273e84ffc575c76f"> 4171</a></span>&#160;<a class="code" href="tun_8c.html#af145af3d388cb497273e84ffc575c76f">get_adapter_by_guid</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structtap__reg.html#acc79514082663502b07faba4b3838057">guid</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtap__reg.html">tap_reg</a> *<a class="code" href="structtap__reg.html">tap_reg</a>)</div>
<div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;{</div>
<div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtap__reg.html">tap_reg</a> *tr;</div>
<div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160; </div>
<div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;    <span class="keywordflow">for</span> (tr = <a class="code" href="structtap__reg.html">tap_reg</a>; tr != NULL; tr = tr-&gt;<a class="code" href="structtap__reg.html#a6db66ed21486695174b3c550d832ba97">next</a>)</div>
<div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;    {</div>
<div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="structtap__reg.html#acc79514082663502b07faba4b3838057">guid</a> &amp;&amp; !strcmp(tr-&gt;<a class="code" href="structtap__reg.html#acc79514082663502b07faba4b3838057">guid</a>, <a class="code" href="structtap__reg.html#acc79514082663502b07faba4b3838057">guid</a>))</div>
<div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;        {</div>
<div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;            <span class="keywordflow">return</span> tr;</div>
<div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;        }</div>
<div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;    }</div>
<div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160; </div>
<div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;}</div>
<div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160; </div>
<div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a name="l04187"></a><span class="lineno"><a class="line" href="tun_8c.html#af1c4c80553da39f760e51787ba2defb1"> 4187</a></span>&#160;<a class="code" href="tun_8c.html#af1c4c80553da39f760e51787ba2defb1">guid_to_name</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structtap__reg.html#acc79514082663502b07faba4b3838057">guid</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structpanel__reg.html">panel_reg</a> *<a class="code" href="structpanel__reg.html">panel_reg</a>)</div>
<div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;{</div>
<div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structpanel__reg.html">panel_reg</a> *pr;</div>
<div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160; </div>
<div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;    <span class="keywordflow">for</span> (pr = <a class="code" href="structpanel__reg.html">panel_reg</a>; pr != NULL; pr = pr-&gt;<a class="code" href="structpanel__reg.html#a56c42f64937f34d553ad09e612d5c796">next</a>)</div>
<div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;    {</div>
<div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="structpanel__reg.html#ab429b6e90735e653301755d009b0b9ec">guid</a> &amp;&amp; !strcmp(pr-&gt;<a class="code" href="structpanel__reg.html#ab429b6e90735e653301755d009b0b9ec">guid</a>, <a class="code" href="structpanel__reg.html#ab429b6e90735e653301755d009b0b9ec">guid</a>))</div>
<div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;        {</div>
<div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;            <span class="keywordflow">return</span> pr-&gt;<a class="code" href="structpanel__reg.html#a9ad43c42e641e3144cef76af1a67e6dd">name</a>;</div>
<div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;        }</div>
<div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;    }</div>
<div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160; </div>
<div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;}</div>
<div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160; </div>
<div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtap__reg.html">tap_reg</a> *</div>
<div class="line"><a name="l04203"></a><span class="lineno"><a class="line" href="tun_8c.html#a2850ffc60ed5bc65df05ead16a4e8bc3"> 4203</a></span>&#160;<a class="code" href="tun_8c.html#a2850ffc60ed5bc65df05ead16a4e8bc3">get_adapter_by_name</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtap__reg.html">tap_reg</a> *<a class="code" href="structtap__reg.html">tap_reg</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structpanel__reg.html">panel_reg</a> *<a class="code" href="structpanel__reg.html">panel_reg</a>)</div>
<div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;{</div>
<div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structpanel__reg.html">panel_reg</a> *pr;</div>
<div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160; </div>
<div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;    <span class="keywordflow">for</span> (pr = <a class="code" href="structpanel__reg.html">panel_reg</a>; pr != NULL; pr = pr-&gt;<a class="code" href="structpanel__reg.html#a56c42f64937f34d553ad09e612d5c796">next</a>)</div>
<div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;    {</div>
<div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="structpanel__reg.html#a9ad43c42e641e3144cef76af1a67e6dd">name</a> &amp;&amp; !strcmp(pr-&gt;<a class="code" href="structpanel__reg.html#a9ad43c42e641e3144cef76af1a67e6dd">name</a>, <a class="code" href="structpanel__reg.html#a9ad43c42e641e3144cef76af1a67e6dd">name</a>))</div>
<div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;        {</div>
<div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="tun_8c.html#af145af3d388cb497273e84ffc575c76f">get_adapter_by_guid</a>(pr-&gt;<a class="code" href="structpanel__reg.html#ab429b6e90735e653301755d009b0b9ec">guid</a>, <a class="code" href="structtap__reg.html">tap_reg</a>);</div>
<div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;        }</div>
<div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;    }</div>
<div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160; </div>
<div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;}</div>
<div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160; </div>
<div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l04219"></a><span class="lineno"><a class="line" href="tun_8c.html#aaed8ba449c46f58edb6cc252c652d229"> 4219</a></span>&#160;<a class="code" href="tun_8c.html#aaed8ba449c46f58edb6cc252c652d229">at_least_one_tap_win</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtap__reg.html">tap_reg</a> *<a class="code" href="structtap__reg.html">tap_reg</a>)</div>
<div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;{</div>
<div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="structtap__reg.html">tap_reg</a>)</div>
<div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;    {</div>
<div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;There are no TAP-Windows nor Wintun adapters on this system.  You should be able to create an adapter by using tapctl.exe utility.&quot;</span>);</div>
<div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;    }</div>
<div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;}</div>
<div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160; </div>
<div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;<span class="comment"> * Get an adapter GUID and optional actual_name from the</span></div>
<div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;<span class="comment"> * registry for the TAP device # = device_number.</span></div>
<div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a name="l04232"></a><span class="lineno"><a class="line" href="tun_8c.html#a54b32700415233e75316fe78594bf8be"> 4232</a></span>&#160;<a class="code" href="tun_8c.html#a54b32700415233e75316fe78594bf8be">get_unspecified_device_guid</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> device_number,</div>
<div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;                            <span class="keywordtype">char</span> *actual_name,</div>
<div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;                            <span class="keywordtype">int</span> actual_name_size,</div>
<div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;                            <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtap__reg.html">tap_reg</a> *tap_reg_src,</div>
<div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;                            <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structpanel__reg.html">panel_reg</a> *panel_reg_src,</div>
<div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;                            <span class="keyword">enum</span> <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5">windows_driver_type</a> *windows_driver,</div>
<div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;                            <span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;{</div>
<div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtap__reg.html">tap_reg</a> *<a class="code" href="structtap__reg.html">tap_reg</a> = tap_reg_src;</div>
<div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;    <span class="keyword">struct </span><a class="code" href="structbuffer.html">buffer</a> ret = <a class="code" href="buffer_8h.html#a37e343f627ab3e406db7b39cd96716d8">clear_buf</a>();</div>
<div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;    <span class="keyword">struct </span><a class="code" href="structbuffer.html">buffer</a> actual = <a class="code" href="buffer_8h.html#a37e343f627ab3e406db7b39cd96716d8">clear_buf</a>();</div>
<div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160; </div>
<div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(device_number &gt;= 0);</div>
<div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160; </div>
<div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;    <span class="comment">/* Make sure we have at least one TAP adapter */</span></div>
<div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="structtap__reg.html">tap_reg</a>)</div>
<div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;    {</div>
<div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;    }</div>
<div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160; </div>
<div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;    <span class="comment">/* The actual_name output buffer may be NULL */</span></div>
<div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;    <span class="keywordflow">if</span> (actual_name)</div>
<div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;    {</div>
<div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;        <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(actual_name_size &gt; 0);</div>
<div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;        <a class="code" href="buffer_8h.html#a6650c2b4f43dbc6f7db7839d8c8baa94">buf_set_write</a>(&amp;actual, actual_name, actual_name_size);</div>
<div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;    }</div>
<div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160; </div>
<div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;    <span class="comment">/* Move on to specified device number */</span></div>
<div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; device_number; i++)</div>
<div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;    {</div>
<div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;        <a class="code" href="structtap__reg.html">tap_reg</a> = <a class="code" href="structtap__reg.html">tap_reg</a>-&gt;<a class="code" href="structtap__reg.html#a6db66ed21486695174b3c550d832ba97">next</a>;</div>
<div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="structtap__reg.html">tap_reg</a>)</div>
<div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;        {</div>
<div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;            <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;        }</div>
<div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;    }</div>
<div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160; </div>
<div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;    <span class="comment">/* Save Network Panel name (if exists) in actual_name */</span></div>
<div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;    <span class="keywordflow">if</span> (actual_name)</div>
<div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;    {</div>
<div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *act = <a class="code" href="tun_8c.html#af1c4c80553da39f760e51787ba2defb1">guid_to_name</a>(<a class="code" href="structtap__reg.html">tap_reg</a>-&gt;<a class="code" href="structtap__reg.html#acc79514082663502b07faba4b3838057">guid</a>, panel_reg_src);</div>
<div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;        <span class="keywordflow">if</span> (act)</div>
<div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;        {</div>
<div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;actual, <span class="stringliteral">&quot;%s&quot;</span>, act);</div>
<div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;        }</div>
<div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;        {</div>
<div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;actual, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="structtap__reg.html">tap_reg</a>-&gt;<a class="code" href="structtap__reg.html#acc79514082663502b07faba4b3838057">guid</a>);</div>
<div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;        }</div>
<div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;    }</div>
<div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160; </div>
<div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;    <span class="comment">/* Save GUID for return value */</span></div>
<div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;    ret = <a class="code" href="buffer_8c.html#aa35bf7feb6a99bf5d364b2d4eba1195c">alloc_buf_gc</a>(256, gc);</div>
<div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;    <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;ret, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="structtap__reg.html">tap_reg</a>-&gt;<a class="code" href="structtap__reg.html#acc79514082663502b07faba4b3838057">guid</a>);</div>
<div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;    <span class="keywordflow">if</span> (windows_driver != NULL)</div>
<div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;    {</div>
<div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;        *windows_driver = <a class="code" href="structtap__reg.html">tap_reg</a>-&gt;<a class="code" href="structtap__reg.html#a9a2c6fa4ca2b0380309be23ed13092fa">windows_driver</a>;</div>
<div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;    }</div>
<div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="buffer_8h.html#a34c800967d7b9583cb64236eadab94dd">BSTR</a>(&amp;ret);</div>
<div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;}</div>
<div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160; </div>
<div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;<span class="comment"> * Lookup a --dev-node adapter name in the registry</span></div>
<div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;<span class="comment"> * returning the GUID and optional actual_name and device type</span></div>
<div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a name="l04299"></a><span class="lineno"><a class="line" href="tun_8c.html#a6c7f0760429559528db611dcd91bb8b2"> 4299</a></span>&#160;<a class="code" href="tun_8c.html#a6c7f0760429559528db611dcd91bb8b2">get_device_guid</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,</div>
<div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;                <span class="keywordtype">char</span> *actual_name,</div>
<div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;                <span class="keywordtype">int</span> actual_name_size,</div>
<div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;                <span class="keyword">enum</span> <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5">windows_driver_type</a> *windows_driver,</div>
<div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;                <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtap__reg.html">tap_reg</a> *<a class="code" href="structtap__reg.html">tap_reg</a>,</div>
<div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;                <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structpanel__reg.html">panel_reg</a> *<a class="code" href="structpanel__reg.html">panel_reg</a>,</div>
<div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;                <span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;{</div>
<div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;    <span class="keyword">struct </span><a class="code" href="structbuffer.html">buffer</a> ret = <a class="code" href="buffer_8c.html#aa35bf7feb6a99bf5d364b2d4eba1195c">alloc_buf_gc</a>(256, gc);</div>
<div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;    <span class="keyword">struct </span><a class="code" href="structbuffer.html">buffer</a> actual = <a class="code" href="buffer_8h.html#a37e343f627ab3e406db7b39cd96716d8">clear_buf</a>();</div>
<div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtap__reg.html">tap_reg</a> *tr;</div>
<div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160; </div>
<div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;    <span class="comment">/* Make sure we have at least one TAP adapter */</span></div>
<div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="structtap__reg.html">tap_reg</a>)</div>
<div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;    {</div>
<div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;    }</div>
<div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160; </div>
<div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;    <span class="comment">/* The actual_name output buffer may be NULL */</span></div>
<div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;    <span class="keywordflow">if</span> (actual_name)</div>
<div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;    {</div>
<div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;        <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(actual_name_size &gt; 0);</div>
<div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;        <a class="code" href="buffer_8h.html#a6650c2b4f43dbc6f7db7839d8c8baa94">buf_set_write</a>(&amp;actual, actual_name, actual_name_size);</div>
<div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;    }</div>
<div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160; </div>
<div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;    <span class="comment">/* Check if GUID was explicitly specified as --dev-node parameter */</span></div>
<div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;    tr = <a class="code" href="tun_8c.html#af145af3d388cb497273e84ffc575c76f">get_adapter_by_guid</a>(name, <a class="code" href="structtap__reg.html">tap_reg</a>);</div>
<div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;    <span class="keywordflow">if</span> (tr)</div>
<div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;    {</div>
<div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *act = <a class="code" href="tun_8c.html#af1c4c80553da39f760e51787ba2defb1">guid_to_name</a>(name, <a class="code" href="structpanel__reg.html">panel_reg</a>);</div>
<div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;        <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;ret, <span class="stringliteral">&quot;%s&quot;</span>, name);</div>
<div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;        <span class="keywordflow">if</span> (act)</div>
<div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;        {</div>
<div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;actual, <span class="stringliteral">&quot;%s&quot;</span>, act);</div>
<div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;        }</div>
<div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;        {</div>
<div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;actual, <span class="stringliteral">&quot;%s&quot;</span>, name);</div>
<div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;        }</div>
<div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="structtap__reg.html#a9a2c6fa4ca2b0380309be23ed13092fa">windows_driver</a>)</div>
<div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;        {</div>
<div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;            *<a class="code" href="structtap__reg.html#a9a2c6fa4ca2b0380309be23ed13092fa">windows_driver</a> = tr-&gt;<a class="code" href="structtap__reg.html#a9a2c6fa4ca2b0380309be23ed13092fa">windows_driver</a>;</div>
<div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;        }</div>
<div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="buffer_8h.html#a34c800967d7b9583cb64236eadab94dd">BSTR</a>(&amp;ret);</div>
<div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;    }</div>
<div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160; </div>
<div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;    <span class="comment">/* Lookup TAP adapter in network connections list */</span></div>
<div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;    {</div>
<div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;        tr = <a class="code" href="tun_8c.html#a2850ffc60ed5bc65df05ead16a4e8bc3">get_adapter_by_name</a>(name, <a class="code" href="structtap__reg.html">tap_reg</a>, <a class="code" href="structpanel__reg.html">panel_reg</a>);</div>
<div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;        <span class="keywordflow">if</span> (tr)</div>
<div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;        {</div>
<div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;actual, <span class="stringliteral">&quot;%s&quot;</span>, name);</div>
<div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="structtap__reg.html#a9a2c6fa4ca2b0380309be23ed13092fa">windows_driver</a>)</div>
<div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;            {</div>
<div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;                *<a class="code" href="structtap__reg.html#a9a2c6fa4ca2b0380309be23ed13092fa">windows_driver</a> = tr-&gt;<a class="code" href="structtap__reg.html#a9a2c6fa4ca2b0380309be23ed13092fa">windows_driver</a>;</div>
<div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;            }</div>
<div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;ret, <span class="stringliteral">&quot;%s&quot;</span>, tr-&gt;<a class="code" href="structtap__reg.html#acc79514082663502b07faba4b3838057">guid</a>);</div>
<div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="buffer_8h.html#a34c800967d7b9583cb64236eadab94dd">BSTR</a>(&amp;ret);</div>
<div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;        }</div>
<div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;    }</div>
<div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160; </div>
<div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;}</div>
<div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160; </div>
<div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;<span class="comment"> * Get adapter info list</span></div>
<div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;<span class="keyword">const</span> IP_ADAPTER_INFO *</div>
<div class="line"><a name="l04367"></a><span class="lineno"><a class="line" href="tun_8h.html#ab80c97a1474ca6badb604921d8ddd534"> 4367</a></span>&#160;<a class="code" href="tun_8c.html#ab80c97a1474ca6badb604921d8ddd534">get_adapter_info_list</a>(<span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;{</div>
<div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;    ULONG size = 0;</div>
<div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;    IP_ADAPTER_INFO *pi = NULL;</div>
<div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;    DWORD <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>;</div>
<div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160; </div>
<div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = GetAdaptersInfo(NULL, &amp;size)) != ERROR_BUFFER_OVERFLOW)</div>
<div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;    {</div>
<div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;GetAdaptersInfo #1 failed (status=%u) : %s&quot;</span>,</div>
<div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>,</div>
<div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;            <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>, gc));</div>
<div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;    }</div>
<div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;    {</div>
<div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;        pi = (PIP_ADAPTER_INFO) <a class="code" href="buffer_8c.html#a67f7dec7f86e113dc0744584fd80b621">gc_malloc</a>(size, <span class="keyword">false</span>, gc);</div>
<div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = GetAdaptersInfo(pi, &amp;size)) != NO_ERROR)</div>
<div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;        {</div>
<div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;GetAdaptersInfo #2 failed (status=%u) : %s&quot;</span>,</div>
<div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;                (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>,</div>
<div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;                <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>, gc));</div>
<div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;            pi = NULL;</div>
<div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;        }</div>
<div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;    }</div>
<div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;    <span class="keywordflow">return</span> pi;</div>
<div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;}</div>
<div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160; </div>
<div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;<span class="keyword">const</span> IP_PER_ADAPTER_INFO *</div>
<div class="line"><a name="l04394"></a><span class="lineno"><a class="line" href="tun_8h.html#ae969bd5eb66f71a6730e6bcdde34749e"> 4394</a></span>&#160;<a class="code" href="tun_8c.html#ae969bd5eb66f71a6730e6bcdde34749e">get_per_adapter_info</a>(<span class="keyword">const</span> DWORD index, <span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;{</div>
<div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;    ULONG size = 0;</div>
<div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;    IP_PER_ADAPTER_INFO *pi = NULL;</div>
<div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;    DWORD <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>;</div>
<div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160; </div>
<div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;    <span class="keywordflow">if</span> (index != <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>)</div>
<div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;    {</div>
<div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = GetPerAdapterInfo(index, NULL, &amp;size)) != ERROR_BUFFER_OVERFLOW)</div>
<div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;        {</div>
<div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;GetPerAdapterInfo #1 failed (status=%u) : %s&quot;</span>,</div>
<div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;                (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>,</div>
<div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;                <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>, gc));</div>
<div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;        }</div>
<div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;        {</div>
<div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;            pi = (PIP_PER_ADAPTER_INFO) <a class="code" href="buffer_8c.html#a67f7dec7f86e113dc0744584fd80b621">gc_malloc</a>(size, <span class="keyword">false</span>, gc);</div>
<div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = GetPerAdapterInfo((ULONG)index, pi, &amp;size)) == ERROR_SUCCESS)</div>
<div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;            {</div>
<div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;                <span class="keywordflow">return</span> pi;</div>
<div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;            }</div>
<div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;            {</div>
<div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;GetPerAdapterInfo #2 failed (status=%u) : %s&quot;</span>,</div>
<div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;                    (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>,</div>
<div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;                    <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>, gc));</div>
<div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;            }</div>
<div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;        }</div>
<div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;    }</div>
<div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;    <span class="keywordflow">return</span> pi;</div>
<div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;}</div>
<div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160; </div>
<div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> IP_INTERFACE_INFO *</div>
<div class="line"><a name="l04427"></a><span class="lineno"><a class="line" href="tun_8c.html#a29fc84a25e53c69d1354851d52e91986"> 4427</a></span>&#160;<a class="code" href="tun_8c.html#a29fc84a25e53c69d1354851d52e91986">get_interface_info_list</a>(<span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;{</div>
<div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;    ULONG size = 0;</div>
<div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;    IP_INTERFACE_INFO *ii = NULL;</div>
<div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;    DWORD <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>;</div>
<div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160; </div>
<div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = GetInterfaceInfo(NULL, &amp;size)) != ERROR_INSUFFICIENT_BUFFER)</div>
<div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;    {</div>
<div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;GetInterfaceInfo #1 failed (status=%u) : %s&quot;</span>,</div>
<div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>,</div>
<div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;            <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>, gc));</div>
<div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;    }</div>
<div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;    {</div>
<div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;        ii = (PIP_INTERFACE_INFO) <a class="code" href="buffer_8c.html#a67f7dec7f86e113dc0744584fd80b621">gc_malloc</a>(size, <span class="keyword">false</span>, gc);</div>
<div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = GetInterfaceInfo(ii, &amp;size)) == NO_ERROR)</div>
<div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;        {</div>
<div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;            <span class="keywordflow">return</span> ii;</div>
<div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;        }</div>
<div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;        {</div>
<div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;GetInterfaceInfo #2 failed (status=%u) : %s&quot;</span>,</div>
<div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;                (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>,</div>
<div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;                <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>, gc));</div>
<div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;        }</div>
<div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;    }</div>
<div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;    <span class="keywordflow">return</span> ii;</div>
<div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;}</div>
<div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160; </div>
<div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> IP_ADAPTER_INDEX_MAP *</div>
<div class="line"><a name="l04457"></a><span class="lineno"><a class="line" href="tun_8c.html#a9843a3cf47989b67f86b5e3cfa9c844a"> 4457</a></span>&#160;<a class="code" href="tun_8c.html#a9843a3cf47989b67f86b5e3cfa9c844a">get_interface_info</a>(DWORD index, <span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;{</div>
<div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;    <span class="keyword">const</span> IP_INTERFACE_INFO *list = <a class="code" href="tun_8c.html#a29fc84a25e53c69d1354851d52e91986">get_interface_info_list</a>(gc);</div>
<div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;    <span class="keywordflow">if</span> (list)</div>
<div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;    {</div>
<div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;        <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; list-&gt;NumAdapters; ++i)</div>
<div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;        {</div>
<div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;            <span class="keyword">const</span> IP_ADAPTER_INDEX_MAP *inter = &amp;list-&gt;Adapter[i];</div>
<div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;            <span class="keywordflow">if</span> (index == inter-&gt;Index)</div>
<div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;            {</div>
<div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;                <span class="keywordflow">return</span> inter;</div>
<div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;            }</div>
<div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;        }</div>
<div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;    }</div>
<div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;}</div>
<div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160; </div>
<div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;<span class="comment"> * Given an adapter index, return a pointer to the</span></div>
<div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;<span class="comment"> * IP_ADAPTER_INFO structure for that adapter.</span></div>
<div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160; </div>
<div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;<span class="keyword">const</span> IP_ADAPTER_INFO *</div>
<div class="line"><a name="l04481"></a><span class="lineno"><a class="line" href="tun_8h.html#a2a9e358835e9587fbd460b69afbdae9b"> 4481</a></span>&#160;<a class="code" href="tun_8c.html#a2a9e358835e9587fbd460b69afbdae9b">get_adapter</a>(<span class="keyword">const</span> IP_ADAPTER_INFO *ai, DWORD index)</div>
<div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;{</div>
<div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;    <span class="keywordflow">if</span> (ai &amp;&amp; index != <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>)</div>
<div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;    {</div>
<div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;        <span class="keyword">const</span> IP_ADAPTER_INFO *a;</div>
<div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160; </div>
<div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;        <span class="comment">/* find index in the linked list */</span></div>
<div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;        <span class="keywordflow">for</span> (a = ai; a != NULL; a = a-&gt;Next)</div>
<div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;        {</div>
<div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;            <span class="keywordflow">if</span> (a-&gt;Index == index)</div>
<div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;            {</div>
<div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;                <span class="keywordflow">return</span> a;</div>
<div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;            }</div>
<div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;        }</div>
<div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;    }</div>
<div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;}</div>
<div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160; </div>
<div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;<span class="keyword">const</span> IP_ADAPTER_INFO *</div>
<div class="line"><a name="l04500"></a><span class="lineno"><a class="line" href="tun_8h.html#a1fbaac744435d6838da41f0d336ab313"> 4500</a></span>&#160;<a class="code" href="tun_8c.html#a1fbaac744435d6838da41f0d336ab313">get_adapter_info</a>(DWORD index, <span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;{</div>
<div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="tun_8c.html#a2a9e358835e9587fbd460b69afbdae9b">get_adapter</a>(<a class="code" href="tun_8c.html#ab80c97a1474ca6badb604921d8ddd534">get_adapter_info_list</a>(gc), index);</div>
<div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;}</div>
<div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160; </div>
<div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l04506"></a><span class="lineno"><a class="line" href="tun_8c.html#ae17202e36b0cd27ca27324f5fcd08c10"> 4506</a></span>&#160;<a class="code" href="tun_8c.html#ae17202e36b0cd27ca27324f5fcd08c10">get_adapter_n_ip_netmask</a>(<span class="keyword">const</span> IP_ADAPTER_INFO *ai)</div>
<div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;{</div>
<div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;    <span class="keywordflow">if</span> (ai)</div>
<div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;    {</div>
<div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;        <span class="keywordtype">int</span> n = 0;</div>
<div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;        <span class="keyword">const</span> IP_ADDR_STRING *ip = &amp;ai-&gt;IpAddressList;</div>
<div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160; </div>
<div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;        <span class="keywordflow">while</span> (ip)</div>
<div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;        {</div>
<div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;            ++n;</div>
<div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;            ip = ip-&gt;Next;</div>
<div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;        }</div>
<div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;        <span class="keywordflow">return</span> n;</div>
<div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;    }</div>
<div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;    {</div>
<div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;    }</div>
<div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;}</div>
<div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160; </div>
<div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l04527"></a><span class="lineno"><a class="line" href="tun_8c.html#a4f3ffb2db7a5081fb0beafdb32804821"> 4527</a></span>&#160;<a class="code" href="tun_8c.html#a4f3ffb2db7a5081fb0beafdb32804821">get_adapter_ip_netmask</a>(<span class="keyword">const</span> IP_ADAPTER_INFO *ai, <span class="keyword">const</span> <span class="keywordtype">int</span> n, <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> *ip, <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> *netmask)</div>
<div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;{</div>
<div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;    <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;    *ip = 0;</div>
<div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;    *netmask = 0;</div>
<div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160; </div>
<div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;    <span class="keywordflow">if</span> (ai)</div>
<div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;    {</div>
<div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;        <span class="keyword">const</span> IP_ADDR_STRING *iplist = &amp;ai-&gt;IpAddressList;</div>
<div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;        <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160; </div>
<div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;        <span class="keywordflow">while</span> (iplist)</div>
<div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;        {</div>
<div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;            <span class="keywordflow">if</span> (i == n)</div>
<div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;            {</div>
<div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;            }</div>
<div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;            ++i;</div>
<div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;            iplist = iplist-&gt;Next;</div>
<div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;        }</div>
<div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160; </div>
<div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;        <span class="keywordflow">if</span> (iplist)</div>
<div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;        {</div>
<div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> getaddr_flags = <a class="code" href="socket_8h.html#a5b618d8716696f3ebe96642be56bec03">GETADDR_HOST_ORDER</a>;</div>
<div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *ip_str = iplist-&gt;IpAddress.String;</div>
<div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *netmask_str = iplist-&gt;IpMask.String;</div>
<div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;            <span class="keywordtype">bool</span> succeed1 = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;            <span class="keywordtype">bool</span> succeed2 = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160; </div>
<div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;            <span class="keywordflow">if</span> (ip_str &amp;&amp; netmask_str &amp;&amp; strlen(ip_str) &amp;&amp; strlen(netmask_str))</div>
<div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;            {</div>
<div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;                *ip = <a class="code" href="socket_8c.html#aed74c8b5931192c1ad5829bd90e01603">getaddr</a>(getaddr_flags, ip_str, 0, &amp;succeed1, NULL);</div>
<div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;                *netmask = <a class="code" href="socket_8c.html#aed74c8b5931192c1ad5829bd90e01603">getaddr</a>(getaddr_flags, netmask_str, 0, &amp;succeed2, NULL);</div>
<div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;                ret = (succeed1 == <span class="keyword">true</span> &amp;&amp; succeed2 == <span class="keyword">true</span>);</div>
<div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;            }</div>
<div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;        }</div>
<div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;    }</div>
<div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160; </div>
<div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;}</div>
<div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160; </div>
<div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l04569"></a><span class="lineno"><a class="line" href="tun_8c.html#a19e929a4cd46aa14eecd013c21c20b25"> 4569</a></span>&#160;<a class="code" href="tun_8c.html#a19e929a4cd46aa14eecd013c21c20b25">test_adapter_ip_netmask</a>(<span class="keyword">const</span> IP_ADAPTER_INFO *ai, <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> ip, <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> netmask)</div>
<div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;{</div>
<div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;    <span class="keywordflow">if</span> (ai)</div>
<div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;    {</div>
<div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;        <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> ip_adapter = 0;</div>
<div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;        <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> netmask_adapter = 0;</div>
<div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = <a class="code" href="tun_8c.html#a4f3ffb2db7a5081fb0beafdb32804821">get_adapter_ip_netmask</a>(ai, 0, &amp;ip_adapter, &amp;netmask_adapter);</div>
<div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;        <span class="keywordflow">return</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> &amp;&amp; ip_adapter == ip &amp;&amp; netmask_adapter == netmask);</div>
<div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;    }</div>
<div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;    {</div>
<div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;    }</div>
<div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;}</div>
<div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160; </div>
<div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;<span class="keyword">const</span> IP_ADAPTER_INFO *</div>
<div class="line"><a name="l04585"></a><span class="lineno"><a class="line" href="tun_8h.html#aae4f18240f6eee1938e487a7add67e61"> 4585</a></span>&#160;<a class="code" href="tun_8c.html#aae4f18240f6eee1938e487a7add67e61">get_tun_adapter</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keyword">const</span> IP_ADAPTER_INFO *list)</div>
<div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;{</div>
<div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;    <span class="keywordflow">if</span> (list &amp;&amp; tt)</div>
<div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;    {</div>
<div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="tun_8c.html#a2a9e358835e9587fbd460b69afbdae9b">get_adapter</a>(list, tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>);</div>
<div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;    }</div>
<div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;    {</div>
<div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;    }</div>
<div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;}</div>
<div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160; </div>
<div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l04598"></a><span class="lineno"><a class="line" href="tun_8h.html#a3d4b225536d0e9c462a59e47f6542c3f"> 4598</a></span>&#160;<a class="code" href="tun_8c.html#a3d4b225536d0e9c462a59e47f6542c3f">is_adapter_up</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keyword">const</span> IP_ADAPTER_INFO *list)</div>
<div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;{</div>
<div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;    <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160; </div>
<div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;    <span class="keyword">const</span> IP_ADAPTER_INFO *ai = <a class="code" href="tun_8c.html#aae4f18240f6eee1938e487a7add67e61">get_tun_adapter</a>(tt, list);</div>
<div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160; </div>
<div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;    <span class="keywordflow">if</span> (ai)</div>
<div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;    {</div>
<div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> n = <a class="code" href="tun_8c.html#ae17202e36b0cd27ca27324f5fcd08c10">get_adapter_n_ip_netmask</a>(ai);</div>
<div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160; </div>
<div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;        <span class="comment">/* loop once for every IP/netmask assigned to adapter */</span></div>
<div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;        {</div>
<div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;            <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> ip, netmask;</div>
<div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="tun_8c.html#a4f3ffb2db7a5081fb0beafdb32804821">get_adapter_ip_netmask</a>(ai, i, &amp;ip, &amp;netmask))</div>
<div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;            {</div>
<div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;                <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a9d418d686f4369092543bcced16a39ee">adapter_netmask</a>)</div>
<div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;                {</div>
<div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;                    <span class="comment">/* wait for our --ifconfig parms to match the actual adapter parms */</span></div>
<div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;                    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a> == ip &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a9d418d686f4369092543bcced16a39ee">adapter_netmask</a> == netmask)</div>
<div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;                    {</div>
<div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;                        ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;                    }</div>
<div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;                }</div>
<div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;                {</div>
<div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;                    <span class="comment">/* --ifconfig was not defined, maybe using a real DHCP server */</span></div>
<div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;                    <span class="keywordflow">if</span> (ip &amp;&amp; netmask)</div>
<div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;                    {</div>
<div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;                        ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;                    }</div>
<div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;                }</div>
<div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;            }</div>
<div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;        }</div>
<div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;    }</div>
<div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;    {</div>
<div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;        ret = <span class="keyword">true</span>; <span class="comment">/* this can occur when TAP adapter is bridged */</span></div>
<div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160; </div>
<div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;    }</div>
<div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;}</div>
<div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160; </div>
<div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l04643"></a><span class="lineno"><a class="line" href="tun_8h.html#a6880ab19d254481c82ca863b6bfeca47"> 4643</a></span>&#160;<a class="code" href="tun_8c.html#a6880ab19d254481c82ca863b6bfeca47">is_ip_in_adapter_subnet</a>(<span class="keyword">const</span> IP_ADAPTER_INFO *ai, <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> ip, <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> *highest_netmask)</div>
<div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;{</div>
<div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;    <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160; </div>
<div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;    <span class="keywordflow">if</span> (highest_netmask)</div>
<div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;    {</div>
<div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;        *highest_netmask = 0;</div>
<div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;    }</div>
<div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160; </div>
<div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;    <span class="keywordflow">if</span> (ai)</div>
<div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;    {</div>
<div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> n = <a class="code" href="tun_8c.html#ae17202e36b0cd27ca27324f5fcd08c10">get_adapter_n_ip_netmask</a>(ai);</div>
<div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;        {</div>
<div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;            <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> adapter_ip, adapter_netmask;</div>
<div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="tun_8c.html#a4f3ffb2db7a5081fb0beafdb32804821">get_adapter_ip_netmask</a>(ai, i, &amp;adapter_ip, &amp;adapter_netmask))</div>
<div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;            {</div>
<div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;                <span class="keywordflow">if</span> (adapter_ip &amp;&amp; adapter_netmask &amp;&amp; (ip &amp; adapter_netmask) == (adapter_ip &amp; adapter_netmask))</div>
<div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;                {</div>
<div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;                    <span class="keywordflow">if</span> (highest_netmask &amp;&amp; adapter_netmask &gt; *highest_netmask)</div>
<div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;                    {</div>
<div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;                        *highest_netmask = adapter_netmask;</div>
<div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;                    }</div>
<div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;                    ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;                }</div>
<div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;            }</div>
<div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;        }</div>
<div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;    }</div>
<div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;}</div>
<div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160; </div>
<div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;DWORD</div>
<div class="line"><a name="l04676"></a><span class="lineno"><a class="line" href="tun_8h.html#afac3ea5517cd7f5c7bf41adf2295fc13"> 4676</a></span>&#160;<a class="code" href="tun_8c.html#afac3ea5517cd7f5c7bf41adf2295fc13">adapter_index_of_ip</a>(<span class="keyword">const</span> IP_ADAPTER_INFO *list,</div>
<div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;                    <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> ip,</div>
<div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;                    <span class="keywordtype">int</span> *count,</div>
<div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;                    <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> *netmask)</div>
<div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;{</div>
<div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;    DWORD ret = <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>;</div>
<div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;    <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> highest_netmask = 0;</div>
<div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;    <span class="keywordtype">int</span> lowest_metric = INT_MAX;</div>
<div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;    <span class="keywordtype">bool</span> first = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160; </div>
<div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;    <span class="keywordflow">if</span> (count)</div>
<div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;    {</div>
<div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;        *count = 0;</div>
<div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;    }</div>
<div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160; </div>
<div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="structgc__arena.html#a88f958412dce42ad5ab9ca27bfb40d4f">list</a>)</div>
<div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;    {</div>
<div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;        <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> hn;</div>
<div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160; </div>
<div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tun_8c.html#a6880ab19d254481c82ca863b6bfeca47">is_ip_in_adapter_subnet</a>(<a class="code" href="structgc__arena.html#a88f958412dce42ad5ab9ca27bfb40d4f">list</a>, ip, &amp;hn))</div>
<div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;        {</div>
<div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;            <span class="keywordtype">int</span> metric = <a class="code" href="block__dns_8c.html#a00bdb3a9f928789a8044011b7e6f11dc">get_interface_metric</a>(<a class="code" href="structgc__arena.html#a88f958412dce42ad5ab9ca27bfb40d4f">list</a>-&gt;Index, AF_INET, NULL);</div>
<div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;            <span class="keywordflow">if</span> (first || hn &gt; highest_netmask)</div>
<div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;            {</div>
<div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;                highest_netmask = hn;</div>
<div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;                <span class="keywordflow">if</span> (metric &gt;= 0)</div>
<div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;                {</div>
<div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;                    lowest_metric = metric;</div>
<div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;                }</div>
<div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;                <span class="keywordflow">if</span> (count)</div>
<div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;                {</div>
<div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;                    *count = 1;</div>
<div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;                }</div>
<div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;                ret = <a class="code" href="structgc__arena.html#a88f958412dce42ad5ab9ca27bfb40d4f">list</a>-&gt;Index;</div>
<div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;                first = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;            }</div>
<div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hn == highest_netmask)</div>
<div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;            {</div>
<div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;                <span class="keywordflow">if</span> (count)</div>
<div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;                {</div>
<div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;                    ++*count;</div>
<div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;                }</div>
<div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;                <span class="keywordflow">if</span> (metric &gt;= 0 &amp;&amp; metric &lt; lowest_metric)</div>
<div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;                {</div>
<div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;                    ret = <a class="code" href="structgc__arena.html#a88f958412dce42ad5ab9ca27bfb40d4f">list</a>-&gt;Index;</div>
<div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;                    lowest_metric = metric;</div>
<div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;                }</div>
<div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;            }</div>
<div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;        }</div>
<div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;        <a class="code" href="structgc__arena.html#a88f958412dce42ad5ab9ca27bfb40d4f">list</a> = <a class="code" href="structgc__arena.html#a88f958412dce42ad5ab9ca27bfb40d4f">list</a>-&gt;Next;</div>
<div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;    }</div>
<div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160; </div>
<div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a4b1b340ab75c81b27e427d091d6f2e50">D_ROUTE_DEBUG</a>, <span class="stringliteral">&quot;DEBUG: IP Locate: ip=%s nm=%s index=%d count=%d metric=%d&quot;</span>,</div>
<div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;         <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(ip, 0, &amp;gc),</div>
<div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;         <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(highest_netmask, 0, &amp;gc),</div>
<div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;         (<span class="keywordtype">int</span>)ret,</div>
<div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;         count ? *count : -1,</div>
<div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;         lowest_metric);</div>
<div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160; </div>
<div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;    <span class="keywordflow">if</span> (ret == <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a> &amp;&amp; count)</div>
<div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;    {</div>
<div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;        *count = 0;</div>
<div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;    }</div>
<div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160; </div>
<div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;    <span class="keywordflow">if</span> (netmask)</div>
<div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;    {</div>
<div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;        *netmask = highest_netmask;</div>
<div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;    }</div>
<div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160; </div>
<div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;}</div>
<div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160; </div>
<div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;<span class="comment"> * Given an adapter index, return true if the adapter</span></div>
<div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;<span class="comment"> * is DHCP disabled.</span></div>
<div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160; </div>
<div class="line"><a name="l04755"></a><span class="lineno"><a class="line" href="tun_8c.html#a75b3bd013e5e9b81909d42916092b486"> 4755</a></span>&#160;<span class="preprocessor">#define DHCP_STATUS_UNDEF     0</span></div>
<div class="line"><a name="l04756"></a><span class="lineno"><a class="line" href="tun_8c.html#a7d1277b47f2707be257eb74a1a85a61e"> 4756</a></span>&#160;<span class="preprocessor">#define DHCP_STATUS_ENABLED   1</span></div>
<div class="line"><a name="l04757"></a><span class="lineno"><a class="line" href="tun_8c.html#a658237b01d9cd3e4597232c10e4c8ef3"> 4757</a></span>&#160;<span class="preprocessor">#define DHCP_STATUS_DISABLED  2</span></div>
<div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160; </div>
<div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l04760"></a><span class="lineno"><a class="line" href="tun_8c.html#aa4d13b2206b5e03c343f1fc9484b67eb"> 4760</a></span>&#160;<a class="code" href="tun_8c.html#aa4d13b2206b5e03c343f1fc9484b67eb">dhcp_status</a>(DWORD index)</div>
<div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;{</div>
<div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;    <span class="keywordtype">int</span> ret = <a class="code" href="tun_8c.html#a75b3bd013e5e9b81909d42916092b486">DHCP_STATUS_UNDEF</a>;</div>
<div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;    <span class="keywordflow">if</span> (index != <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>)</div>
<div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;    {</div>
<div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;        <span class="keyword">const</span> IP_ADAPTER_INFO *ai = <a class="code" href="tun_8c.html#a1fbaac744435d6838da41f0d336ab313">get_adapter_info</a>(index, &amp;gc);</div>
<div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160; </div>
<div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;        <span class="keywordflow">if</span> (ai)</div>
<div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;        {</div>
<div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;            <span class="keywordflow">if</span> (ai-&gt;DhcpEnabled)</div>
<div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;            {</div>
<div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;                ret = <a class="code" href="tun_8c.html#a7d1277b47f2707be257eb74a1a85a61e">DHCP_STATUS_ENABLED</a>;</div>
<div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;            }</div>
<div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;            {</div>
<div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;                ret = <a class="code" href="tun_8c.html#a658237b01d9cd3e4597232c10e4c8ef3">DHCP_STATUS_DISABLED</a>;</div>
<div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;            }</div>
<div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;        }</div>
<div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;    }</div>
<div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;}</div>
<div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160; </div>
<div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;<span class="comment"> * Delete all temporary address/netmask pairs which were added</span></div>
<div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;<span class="comment"> * to adapter (given by index) by previous calls to AddIPAddress.</span></div>
<div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l04789"></a><span class="lineno"><a class="line" href="tun_8c.html#a6b1909af4bc0f83c57cdde3649cc50b8"> 4789</a></span>&#160;<a class="code" href="tun_8c.html#a6b1909af4bc0f83c57cdde3649cc50b8">delete_temp_addresses</a>(DWORD index)</div>
<div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;{</div>
<div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;    <span class="keyword">const</span> IP_ADAPTER_INFO *a = <a class="code" href="tun_8c.html#a1fbaac744435d6838da41f0d336ab313">get_adapter_info</a>(index, &amp;gc);</div>
<div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160; </div>
<div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;    <span class="keywordflow">if</span> (a)</div>
<div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;    {</div>
<div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;        <span class="keyword">const</span> IP_ADDR_STRING *ip = &amp;a-&gt;IpAddressList;</div>
<div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;        <span class="keywordflow">while</span> (ip)</div>
<div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;        {</div>
<div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;            DWORD <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>;</div>
<div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;            <span class="keyword">const</span> DWORD <a class="code" href="structcontext.html">context</a> = ip-&gt;Context;</div>
<div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160; </div>
<div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = DeleteIPAddress((ULONG) <a class="code" href="structcontext.html">context</a>)) == NO_ERROR)</div>
<div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;            {</div>
<div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;Successfully deleted previously set dynamic IP/netmask: %s/%s&quot;</span>,</div>
<div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;                    ip-&gt;IpAddress.String,</div>
<div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;                    ip-&gt;IpMask.String);</div>
<div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;            }</div>
<div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;            {</div>
<div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">char</span> *empty = <span class="stringliteral">&quot;0.0.0.0&quot;</span>;</div>
<div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;                <span class="keywordflow">if</span> (strcmp(ip-&gt;IpAddress.String, empty)</div>
<div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;                    || strcmp(ip-&gt;IpMask.String, empty))</div>
<div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;                {</div>
<div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;                    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;NOTE: could not delete previously set dynamic IP/netmask: %s/%s (status=%u)&quot;</span>,</div>
<div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;                        ip-&gt;IpAddress.String,</div>
<div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;                        ip-&gt;IpMask.String,</div>
<div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;                        (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>);</div>
<div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;                }</div>
<div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;            }</div>
<div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;            ip = ip-&gt;Next;</div>
<div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;        }</div>
<div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;    }</div>
<div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;}</div>
<div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160; </div>
<div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;<span class="comment"> * Get interface index for use with IP Helper API functions.</span></div>
<div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;<span class="keyword">static</span> DWORD</div>
<div class="line"><a name="l04830"></a><span class="lineno"><a class="line" href="tun_8c.html#a0bca45c9dee09e24d57e40e7fb87b5a8"> 4830</a></span>&#160;<a class="code" href="tun_8c.html#a0bca45c9dee09e24d57e40e7fb87b5a8">get_adapter_index_method_1</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *guid)</div>
<div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;{</div>
<div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;    DWORD index;</div>
<div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;    ULONG aindex;</div>
<div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;    <span class="keywordtype">wchar_t</span> wbuf[256];</div>
<div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;    <a class="code" href="win32_8c.html#a0ceac6773e93261ea0f56021ddcb4445">openvpn_swprintf</a>(wbuf, <a class="code" href="openvpn_2basic_8h.html#afd2537d19a3cb6556b0f727580ec6ee7">SIZE</a>(wbuf), L<span class="stringliteral">&quot;\\DEVICE\\TCPIP_%S&quot;</span>, guid);</div>
<div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;    <span class="keywordflow">if</span> (GetAdapterIndex(wbuf, &amp;aindex) != NO_ERROR)</div>
<div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;    {</div>
<div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;        index = <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>;</div>
<div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;    }</div>
<div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;    {</div>
<div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;        index = (DWORD)aindex;</div>
<div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;    }</div>
<div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;    <span class="keywordflow">return</span> index;</div>
<div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;}</div>
<div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160; </div>
<div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;<span class="keyword">static</span> DWORD</div>
<div class="line"><a name="l04848"></a><span class="lineno"><a class="line" href="tun_8c.html#aa40f049e49c31523d033dbcefec70255"> 4848</a></span>&#160;<a class="code" href="tun_8c.html#aa40f049e49c31523d033dbcefec70255">get_adapter_index_method_2</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *guid)</div>
<div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;{</div>
<div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;    DWORD index = <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>;</div>
<div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160; </div>
<div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;    <span class="keyword">const</span> IP_ADAPTER_INFO *<a class="code" href="structgc__arena.html#a88f958412dce42ad5ab9ca27bfb40d4f">list</a> = <a class="code" href="tun_8c.html#ab80c97a1474ca6badb604921d8ddd534">get_adapter_info_list</a>(&amp;gc);</div>
<div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160; </div>
<div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="structgc__arena.html#a88f958412dce42ad5ab9ca27bfb40d4f">list</a>)</div>
<div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;    {</div>
<div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;        <span class="keywordflow">if</span> (!strcmp(guid, <a class="code" href="structgc__arena.html#a88f958412dce42ad5ab9ca27bfb40d4f">list</a>-&gt;AdapterName))</div>
<div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;        {</div>
<div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;            index = <a class="code" href="structgc__arena.html#a88f958412dce42ad5ab9ca27bfb40d4f">list</a>-&gt;Index;</div>
<div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;        }</div>
<div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;        <a class="code" href="structgc__arena.html#a88f958412dce42ad5ab9ca27bfb40d4f">list</a> = <a class="code" href="structgc__arena.html#a88f958412dce42ad5ab9ca27bfb40d4f">list</a>-&gt;Next;</div>
<div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;    }</div>
<div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160; </div>
<div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;    <span class="keywordflow">return</span> index;</div>
<div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;}</div>
<div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160; </div>
<div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;<span class="keyword">static</span> DWORD</div>
<div class="line"><a name="l04870"></a><span class="lineno"><a class="line" href="tun_8c.html#a4625d174217c9a90173e9dc03782200e"> 4870</a></span>&#160;<a class="code" href="tun_8c.html#a4625d174217c9a90173e9dc03782200e">get_adapter_index</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *guid)</div>
<div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;{</div>
<div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;    DWORD index;</div>
<div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;    index = <a class="code" href="tun_8c.html#a0bca45c9dee09e24d57e40e7fb87b5a8">get_adapter_index_method_1</a>(guid);</div>
<div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;    <span class="keywordflow">if</span> (index == <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>)</div>
<div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;    {</div>
<div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;        index = <a class="code" href="tun_8c.html#aa40f049e49c31523d033dbcefec70255">get_adapter_index_method_2</a>(guid);</div>
<div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;    }</div>
<div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;    <span class="keywordflow">if</span> (index == <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>)</div>
<div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;    {</div>
<div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;NOTE: could not get adapter index for %s&quot;</span>, guid);</div>
<div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;    }</div>
<div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;    <span class="keywordflow">return</span> index;</div>
<div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;}</div>
<div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160; </div>
<div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;<span class="keyword">static</span> DWORD</div>
<div class="line"><a name="l04886"></a><span class="lineno"><a class="line" href="tun_8c.html#a34a5aea74b2f0d2c67da91b78de830b9"> 4886</a></span>&#160;<a class="code" href="tun_8c.html#a34a5aea74b2f0d2c67da91b78de830b9">get_adapter_index_flexible</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)  <span class="comment">/* actual name or GUID */</span></div>
<div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;{</div>
<div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;    DWORD index;</div>
<div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;    index = <a class="code" href="tun_8c.html#a0bca45c9dee09e24d57e40e7fb87b5a8">get_adapter_index_method_1</a>(name);</div>
<div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;    <span class="keywordflow">if</span> (index == <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>)</div>
<div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;    {</div>
<div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;        index = <a class="code" href="tun_8c.html#aa40f049e49c31523d033dbcefec70255">get_adapter_index_method_2</a>(name);</div>
<div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;    }</div>
<div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;    <span class="keywordflow">if</span> (index == <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>)</div>
<div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;    {</div>
<div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;        <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtap__reg.html">tap_reg</a> *<a class="code" href="structtap__reg.html">tap_reg</a> = <a class="code" href="tun_8c.html#ab6ace179866b796f9a2962093e36ba71">get_tap_reg</a>(&amp;gc);</div>
<div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;        <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structpanel__reg.html">panel_reg</a> *<a class="code" href="structpanel__reg.html">panel_reg</a> = <a class="code" href="tun_8c.html#aae4bf389fe2e79e5cca5b3b67a4290b3">get_panel_reg</a>(&amp;gc);</div>
<div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;        <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtap__reg.html">tap_reg</a> *tr = <a class="code" href="tun_8c.html#a2850ffc60ed5bc65df05ead16a4e8bc3">get_adapter_by_name</a>(name, <a class="code" href="structtap__reg.html">tap_reg</a>, <a class="code" href="structpanel__reg.html">panel_reg</a>);</div>
<div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;        <span class="keywordflow">if</span> (tr)</div>
<div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;        {</div>
<div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;            index = <a class="code" href="tun_8c.html#a0bca45c9dee09e24d57e40e7fb87b5a8">get_adapter_index_method_1</a>(tr-&gt;<a class="code" href="structtap__reg.html#acc79514082663502b07faba4b3838057">guid</a>);</div>
<div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;            <span class="keywordflow">if</span> (index == <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>)</div>
<div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;            {</div>
<div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;                index = <a class="code" href="tun_8c.html#aa40f049e49c31523d033dbcefec70255">get_adapter_index_method_2</a>(tr-&gt;<a class="code" href="structtap__reg.html#acc79514082663502b07faba4b3838057">guid</a>);</div>
<div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;            }</div>
<div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;        }</div>
<div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;    }</div>
<div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;    <span class="keywordflow">if</span> (index == <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>)</div>
<div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;    {</div>
<div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;NOTE: could not get adapter index for name/GUID &#39;%s&#39;&quot;</span>, name);</div>
<div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;    }</div>
<div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;    <span class="keywordflow">return</span> index;</div>
<div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;}</div>
<div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160; </div>
<div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;<span class="comment"> * Return a string representing a PIP_ADDR_STRING</span></div>
<div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a name="l04921"></a><span class="lineno"><a class="line" href="tun_8c.html#a45b0f91a5600efc891c040645f0db6b1"> 4921</a></span>&#160;<a class="code" href="tun_8c.html#a45b0f91a5600efc891c040645f0db6b1">format_ip_addr_string</a>(<span class="keyword">const</span> IP_ADDR_STRING *ip, <span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;{</div>
<div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;    <span class="keyword">struct </span><a class="code" href="structbuffer.html">buffer</a> out = <a class="code" href="buffer_8c.html#aa35bf7feb6a99bf5d364b2d4eba1195c">alloc_buf_gc</a>(256, gc);</div>
<div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;    <span class="keywordflow">while</span> (ip)</div>
<div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;    {</div>
<div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;        <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;out, <span class="stringliteral">&quot;%s&quot;</span>, ip-&gt;IpAddress.String);</div>
<div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;        <span class="keywordflow">if</span> (strlen(ip-&gt;IpMask.String))</div>
<div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;        {</div>
<div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;out, <span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;out, <span class="stringliteral">&quot;%s&quot;</span>, ip-&gt;IpMask.String);</div>
<div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;        }</div>
<div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;        <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;out, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;        ip = ip-&gt;Next;</div>
<div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;    }</div>
<div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="buffer_8h.html#a34c800967d7b9583cb64236eadab94dd">BSTR</a>(&amp;out);</div>
<div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;}</div>
<div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160; </div>
<div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;<span class="comment"> * Show info for a single adapter</span></div>
<div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l04942"></a><span class="lineno"><a class="line" href="tun_8c.html#a549a2ea6b968762682a1ef92d8de628f"> 4942</a></span>&#160;<a class="code" href="tun_8c.html#a549a2ea6b968762682a1ef92d8de628f">show_adapter</a>(<span class="keywordtype">int</span> msglev, <span class="keyword">const</span> IP_ADAPTER_INFO *a, <span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;{</div>
<div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(msglev, <span class="stringliteral">&quot;%s&quot;</span>, a-&gt;Description);</div>
<div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(msglev, <span class="stringliteral">&quot;  Index = %d&quot;</span>, (<span class="keywordtype">int</span>)a-&gt;Index);</div>
<div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(msglev, <span class="stringliteral">&quot;  GUID = %s&quot;</span>, a-&gt;AdapterName);</div>
<div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(msglev, <span class="stringliteral">&quot;  IP = %s&quot;</span>, <a class="code" href="tun_8c.html#a45b0f91a5600efc891c040645f0db6b1">format_ip_addr_string</a>(&amp;a-&gt;IpAddressList, gc));</div>
<div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(msglev, <span class="stringliteral">&quot;  MAC = %s&quot;</span>, <a class="code" href="buffer_8c.html#a765c29b346cf601c5e0be2fd2c935a8d">format_hex_ex</a>(a-&gt;Address, a-&gt;AddressLength, 0, 1, <span class="stringliteral">&quot;:&quot;</span>, gc));</div>
<div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(msglev, <span class="stringliteral">&quot;  GATEWAY = %s&quot;</span>, <a class="code" href="tun_8c.html#a45b0f91a5600efc891c040645f0db6b1">format_ip_addr_string</a>(&amp;a-&gt;GatewayList, gc));</div>
<div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;    <span class="keywordflow">if</span> (a-&gt;DhcpEnabled)</div>
<div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;    {</div>
<div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(msglev, <span class="stringliteral">&quot;  DHCP SERV = %s&quot;</span>, <a class="code" href="tun_8c.html#a45b0f91a5600efc891c040645f0db6b1">format_ip_addr_string</a>(&amp;a-&gt;DhcpServer, gc));</div>
<div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(msglev, <span class="stringliteral">&quot;  DHCP LEASE OBTAINED = %s&quot;</span>, <a class="code" href="otime_8c.html#a3235fa9248297a37174fafc4522bdbac">time_string</a>(a-&gt;LeaseObtained, 0, <span class="keyword">false</span>, gc));</div>
<div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(msglev, <span class="stringliteral">&quot;  DHCP LEASE EXPIRES  = %s&quot;</span>, <a class="code" href="otime_8c.html#a3235fa9248297a37174fafc4522bdbac">time_string</a>(a-&gt;LeaseExpires, 0, <span class="keyword">false</span>, gc));</div>
<div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;    }</div>
<div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;    <span class="keywordflow">if</span> (a-&gt;HaveWins)</div>
<div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;    {</div>
<div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(msglev, <span class="stringliteral">&quot;  PRI WINS = %s&quot;</span>, <a class="code" href="tun_8c.html#a45b0f91a5600efc891c040645f0db6b1">format_ip_addr_string</a>(&amp;a-&gt;PrimaryWinsServer, gc));</div>
<div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(msglev, <span class="stringliteral">&quot;  SEC WINS = %s&quot;</span>, <a class="code" href="tun_8c.html#a45b0f91a5600efc891c040645f0db6b1">format_ip_addr_string</a>(&amp;a-&gt;SecondaryWinsServer, gc));</div>
<div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;    }</div>
<div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160; </div>
<div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;    {</div>
<div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;        <span class="keyword">const</span> IP_PER_ADAPTER_INFO *pai = <a class="code" href="tun_8c.html#ae969bd5eb66f71a6730e6bcdde34749e">get_per_adapter_info</a>(a-&gt;Index, gc);</div>
<div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;        <span class="keywordflow">if</span> (pai)</div>
<div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;        {</div>
<div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(msglev, <span class="stringliteral">&quot;  DNS SERV = %s&quot;</span>, <a class="code" href="tun_8c.html#a45b0f91a5600efc891c040645f0db6b1">format_ip_addr_string</a>(&amp;pai-&gt;DnsServerList, gc));</div>
<div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;        }</div>
<div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;    }</div>
<div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;}</div>
<div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160; </div>
<div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;<span class="comment"> * Show current adapter list</span></div>
<div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l04975"></a><span class="lineno"><a class="line" href="tun_8h.html#a6f5544632174db40d087aaf55d70f5c6"> 4975</a></span>&#160;<a class="code" href="tun_8c.html#a6f5544632174db40d087aaf55d70f5c6">show_adapters</a>(<span class="keywordtype">int</span> msglev)</div>
<div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;{</div>
<div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;    <span class="keyword">const</span> IP_ADAPTER_INFO *ai = <a class="code" href="tun_8c.html#ab80c97a1474ca6badb604921d8ddd534">get_adapter_info_list</a>(&amp;gc);</div>
<div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160; </div>
<div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(msglev, <span class="stringliteral">&quot;SYSTEM ADAPTER LIST&quot;</span>);</div>
<div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;    <span class="keywordflow">if</span> (ai)</div>
<div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;    {</div>
<div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;        <span class="keyword">const</span> IP_ADAPTER_INFO *a;</div>
<div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160; </div>
<div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;        <span class="comment">/* find index in the linked list */</span></div>
<div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;        <span class="keywordflow">for</span> (a = ai; a != NULL; a = a-&gt;Next)</div>
<div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;        {</div>
<div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;            <a class="code" href="tun_8c.html#a549a2ea6b968762682a1ef92d8de628f">show_adapter</a>(msglev, a, &amp;gc);</div>
<div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;        }</div>
<div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;    }</div>
<div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;}</div>
<div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160; </div>
<div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;<span class="comment"> * Set a particular TAP-Windows adapter (or all of them if</span></div>
<div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;<span class="comment"> * adapter_name == NULL) to allow it to be opened from</span></div>
<div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;<span class="comment"> * a non-admin account.  This setting will only persist</span></div>
<div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;<span class="comment"> * for the lifetime of the device object.</span></div>
<div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160; </div>
<div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l05002"></a><span class="lineno"><a class="line" href="tun_8c.html#ae9ddbb387adc74d75e7d0f5e65b07e69"> 5002</a></span>&#160;<a class="code" href="tun_8c.html#ae9ddbb387adc74d75e7d0f5e65b07e69">tap_allow_nonadmin_access_handle</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *device_path, HANDLE hand)</div>
<div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;{</div>
<div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;    <span class="keyword">struct </span><a class="code" href="structsecurity__attributes.html">security_attributes</a> <a class="code" href="structsecurity__attributes.html#a4a215d7812252afa2a9037fc95ba04df">sa</a>;</div>
<div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;    BOOL <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>;</div>
<div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160; </div>
<div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="win32_8c.html#aef221066442b594355d1ed2ac80a3736">init_security_attributes_allow_all</a>(&amp;<a class="code" href="structsecurity__attributes.html#a4a215d7812252afa2a9037fc95ba04df">sa</a>))</div>
<div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;    {</div>
<div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;Error: init SA failed&quot;</span>);</div>
<div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;    }</div>
<div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160; </div>
<div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;    <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = SetKernelObjectSecurity(hand, DACL_SECURITY_INFORMATION, &amp;<a class="code" href="structsecurity__attributes.html#a4a215d7812252afa2a9037fc95ba04df">sa</a>.sd);</div>
<div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>)</div>
<div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;    {</div>
<div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;Error: SetKernelObjectSecurity failed on %s&quot;</span>, device_path);</div>
<div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;    }</div>
<div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;    {</div>
<div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>|<a class="code" href="openvpn_2error_8h.html#a39772a2bdab0bd56c1b6dd518a65c2c3">M_NOPREFIX</a>, <span class="stringliteral">&quot;TAP-Windows device: %s [Non-admin access allowed]&quot;</span>, device_path);</div>
<div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;    }</div>
<div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;}</div>
<div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160; </div>
<div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l05024"></a><span class="lineno"><a class="line" href="tun_8h.html#aaafe36001ab32673614b12083322ba55"> 5024</a></span>&#160;<a class="code" href="tun_8c.html#aaafe36001ab32673614b12083322ba55">tap_allow_nonadmin_access</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node)</div>
<div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;{</div>
<div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtap__reg.html">tap_reg</a> *<a class="code" href="structtap__reg.html">tap_reg</a> = <a class="code" href="tun_8c.html#ab6ace179866b796f9a2962093e36ba71">get_tap_reg</a>(&amp;gc);</div>
<div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structpanel__reg.html">panel_reg</a> *<a class="code" href="structpanel__reg.html">panel_reg</a> = <a class="code" href="tun_8c.html#aae4bf389fe2e79e5cca5b3b67a4290b3">get_panel_reg</a>(&amp;gc);</div>
<div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *device_guid = NULL;</div>
<div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;    HANDLE hand;</div>
<div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;    <span class="keywordtype">char</span> actual_buffer[256];</div>
<div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;    <span class="keywordtype">char</span> device_path[256];</div>
<div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160; </div>
<div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;    <a class="code" href="tun_8c.html#aaed8ba449c46f58edb6cc252c652d229">at_least_one_tap_win</a>(<a class="code" href="structtap__reg.html">tap_reg</a>);</div>
<div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160; </div>
<div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;    <span class="keywordflow">if</span> (dev_node)</div>
<div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;    {</div>
<div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;        <span class="comment">/* Get the device GUID for the device specified with --dev-node. */</span></div>
<div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;        device_guid = <a class="code" href="tun_8c.html#a6c7f0760429559528db611dcd91bb8b2">get_device_guid</a>(dev_node, actual_buffer, <span class="keyword">sizeof</span>(actual_buffer), NULL, <a class="code" href="structtap__reg.html">tap_reg</a>, <a class="code" href="structpanel__reg.html">panel_reg</a>, &amp;gc);</div>
<div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160; </div>
<div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;        <span class="keywordflow">if</span> (!device_guid)</div>
<div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;        {</div>
<div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;TAP-Windows adapter &#39;%s&#39; not found&quot;</span>, dev_node);</div>
<div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;        }</div>
<div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160; </div>
<div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;        <span class="comment">/* Open Windows TAP-Windows adapter */</span></div>
<div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;        <a class="code" href="buffer_8c.html#afd2a93a0940b1ea7e093d293a05e2927">openvpn_snprintf</a>(device_path, <span class="keyword">sizeof</span>(device_path), <span class="stringliteral">&quot;%s%s%s&quot;</span>,</div>
<div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;                         USERMODEDEVICEDIR,</div>
<div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;                         device_guid,</div>
<div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;                         TAP_WIN_SUFFIX);</div>
<div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160; </div>
<div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;        hand = CreateFile(</div>
<div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;            device_path,</div>
<div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;            MAXIMUM_ALLOWED,</div>
<div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;            0,              <span class="comment">/* was: FILE_SHARE_READ */</span></div>
<div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;            0,</div>
<div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;            OPEN_EXISTING,</div>
<div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;            FILE_ATTRIBUTE_SYSTEM | FILE_FLAG_OVERLAPPED,</div>
<div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;            0</div>
<div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;            );</div>
<div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160; </div>
<div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;        <span class="keywordflow">if</span> (hand == INVALID_HANDLE_VALUE)</div>
<div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;        {</div>
<div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a>, <span class="stringliteral">&quot;CreateFile failed on TAP device: %s&quot;</span>, device_path);</div>
<div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;        }</div>
<div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160; </div>
<div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;        <a class="code" href="tun_8c.html#ae9ddbb387adc74d75e7d0f5e65b07e69">tap_allow_nonadmin_access_handle</a>(device_path, hand);</div>
<div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;        CloseHandle(hand);</div>
<div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;    }</div>
<div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;    {</div>
<div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;        <span class="keywordtype">int</span> device_number = 0;</div>
<div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160; </div>
<div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;        <span class="comment">/* Try opening all TAP devices */</span></div>
<div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;        <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;        {</div>
<div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;            device_guid = <a class="code" href="tun_8c.html#a54b32700415233e75316fe78594bf8be">get_unspecified_device_guid</a>(device_number,</div>
<div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;                                                      actual_buffer,</div>
<div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;                                                      <span class="keyword">sizeof</span>(actual_buffer),</div>
<div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;                                                      <a class="code" href="structtap__reg.html">tap_reg</a>,</div>
<div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;                                                      <a class="code" href="structpanel__reg.html">panel_reg</a>,</div>
<div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;                                                      NULL,</div>
<div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;                                                      &amp;gc);</div>
<div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160; </div>
<div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;            <span class="keywordflow">if</span> (!device_guid)</div>
<div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;            {</div>
<div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;            }</div>
<div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160; </div>
<div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;            <span class="comment">/* Open Windows TAP-Windows adapter */</span></div>
<div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;            <a class="code" href="buffer_8c.html#afd2a93a0940b1ea7e093d293a05e2927">openvpn_snprintf</a>(device_path, <span class="keyword">sizeof</span>(device_path), <span class="stringliteral">&quot;%s%s%s&quot;</span>,</div>
<div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;                             USERMODEDEVICEDIR,</div>
<div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;                             device_guid,</div>
<div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;                             TAP_WIN_SUFFIX);</div>
<div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160; </div>
<div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;            hand = CreateFile(</div>
<div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;                device_path,</div>
<div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;                MAXIMUM_ALLOWED,</div>
<div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;                0,              <span class="comment">/* was: FILE_SHARE_READ */</span></div>
<div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;                0,</div>
<div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;                OPEN_EXISTING,</div>
<div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;                FILE_ATTRIBUTE_SYSTEM | FILE_FLAG_OVERLAPPED,</div>
<div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;                0</div>
<div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;                );</div>
<div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160; </div>
<div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;            <span class="keywordflow">if</span> (hand == INVALID_HANDLE_VALUE)</div>
<div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;            {</div>
<div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;CreateFile failed on TAP device: %s&quot;</span>, device_path);</div>
<div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;            }</div>
<div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;            {</div>
<div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;                <a class="code" href="tun_8c.html#ae9ddbb387adc74d75e7d0f5e65b07e69">tap_allow_nonadmin_access_handle</a>(device_path, hand);</div>
<div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;                CloseHandle(hand);</div>
<div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;            }</div>
<div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160; </div>
<div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;            device_number++;</div>
<div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;        }</div>
<div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;    }</div>
<div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;}</div>
<div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160; </div>
<div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;<span class="comment"> * DHCP release/renewal</span></div>
<div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l05126"></a><span class="lineno"><a class="line" href="tun_8h.html#a8973fb27cde0e97c9b1f62669f7030b0"> 5126</a></span>&#160;<a class="code" href="tun_8c.html#a8973fb27cde0e97c9b1f62669f7030b0">dhcp_release_by_adapter_index</a>(<span class="keyword">const</span> DWORD adapter_index)</div>
<div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;{</div>
<div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;    <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;    <span class="keyword">const</span> IP_ADAPTER_INDEX_MAP *inter = <a class="code" href="tun_8c.html#a9843a3cf47989b67f86b5e3cfa9c844a">get_interface_info</a>(adapter_index, &amp;gc);</div>
<div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160; </div>
<div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;    <span class="keywordflow">if</span> (inter)</div>
<div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;    {</div>
<div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;        DWORD <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = IpReleaseAddress((IP_ADAPTER_INDEX_MAP *)inter);</div>
<div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> == NO_ERROR)</div>
<div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;        {</div>
<div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#a80d57c8e34010c9b942bbb9f3171050b">D_TUNTAP_INFO</a>, <span class="stringliteral">&quot;TAP: DHCP address released&quot;</span>);</div>
<div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;            ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;        }</div>
<div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;        {</div>
<div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;NOTE: Release of DHCP-assigned IP address lease on TAP-Windows adapter failed: %s (code=%u)&quot;</span>,</div>
<div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;                <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>, &amp;gc),</div>
<div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;                (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>);</div>
<div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;        }</div>
<div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;    }</div>
<div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160; </div>
<div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;}</div>
<div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160; </div>
<div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l05153"></a><span class="lineno"><a class="line" href="tun_8c.html#a48f484ccef829bc66fef2d6734e0a3eb"> 5153</a></span>&#160;<a class="code" href="tun_8c.html#a48f484ccef829bc66fef2d6734e0a3eb">dhcp_release</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;{</div>
<div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;    <span class="keywordflow">if</span> (tt &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ac4735c903581ca3bb0c35dbe48b4e4dd">ip_win32_type</a> == <a class="code" href="tun_8h.html#a53b8d43ac0464c0ad92cb7dc1ad2cb34">IPW32_SET_DHCP_MASQ</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a> != <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>)</div>
<div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;    {</div>
<div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="tun_8c.html#a8973fb27cde0e97c9b1f62669f7030b0">dhcp_release_by_adapter_index</a>(tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>);</div>
<div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;    }</div>
<div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;    {</div>
<div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;    }</div>
<div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;}</div>
<div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160; </div>
<div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l05166"></a><span class="lineno"><a class="line" href="tun_8h.html#a34e614562ee36319cb88ad134de7d12c"> 5166</a></span>&#160;<a class="code" href="tun_8c.html#a34e614562ee36319cb88ad134de7d12c">dhcp_renew_by_adapter_index</a>(<span class="keyword">const</span> DWORD adapter_index)</div>
<div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;{</div>
<div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;    <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;    <span class="keyword">const</span> IP_ADAPTER_INDEX_MAP *inter = <a class="code" href="tun_8c.html#a9843a3cf47989b67f86b5e3cfa9c844a">get_interface_info</a>(adapter_index, &amp;gc);</div>
<div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160; </div>
<div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;    <span class="keywordflow">if</span> (inter)</div>
<div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;    {</div>
<div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;        DWORD <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = IpRenewAddress((IP_ADAPTER_INDEX_MAP *)inter);</div>
<div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> == NO_ERROR)</div>
<div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;        {</div>
<div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#a80d57c8e34010c9b942bbb9f3171050b">D_TUNTAP_INFO</a>, <span class="stringliteral">&quot;TAP: DHCP address renewal succeeded&quot;</span>);</div>
<div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;            ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;        }</div>
<div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;        {</div>
<div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;WARNING: Failed to renew DHCP IP address lease on TAP-Windows adapter: %s (code=%u)&quot;</span>,</div>
<div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;                <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>, &amp;gc),</div>
<div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;                (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>);</div>
<div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;        }</div>
<div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;    }</div>
<div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;}</div>
<div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160; </div>
<div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l05192"></a><span class="lineno"><a class="line" href="tun_8c.html#abab0251811d3e8ef1e4891ca107d1f2e"> 5192</a></span>&#160;<a class="code" href="tun_8c.html#abab0251811d3e8ef1e4891ca107d1f2e">dhcp_renew</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;{</div>
<div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;    <span class="keywordflow">if</span> (tt &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ac4735c903581ca3bb0c35dbe48b4e4dd">ip_win32_type</a> == <a class="code" href="tun_8h.html#a53b8d43ac0464c0ad92cb7dc1ad2cb34">IPW32_SET_DHCP_MASQ</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a> != <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>)</div>
<div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;    {</div>
<div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="tun_8c.html#a34e614562ee36319cb88ad134de7d12c">dhcp_renew_by_adapter_index</a>(tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>);</div>
<div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;    }</div>
<div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;    {</div>
<div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;    }</div>
<div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;}</div>
<div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160; </div>
<div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;<span class="comment"> * netsh functions</span></div>
<div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160; </div>
<div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l05209"></a><span class="lineno"><a class="line" href="tun_8c.html#ac0b5e1af8dfaa627162520fbc1ae5080"> 5209</a></span>&#160;<a class="code" href="tun_8c.html#ac0b5e1af8dfaa627162520fbc1ae5080">netsh_command</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structargv.html">argv</a> *a, <span class="keywordtype">int</span> n, <span class="keywordtype">int</span> msglevel)</div>
<div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;{</div>
<div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;    {</div>
<div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>;</div>
<div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;        <a class="code" href="manage_8c.html#af07a56f96cec84856d0bf97899a4d460">management_sleep</a>(0);</div>
<div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;        <a class="code" href="win32_8c.html#acc83a5e3ac577a6c50fff6d71f232e41">netcmd_semaphore_lock</a>();</div>
<div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;        <a class="code" href="argv_8c.html#a58d2724394ee9bc29ac5d5ac2c1da102">argv_msg_prefix</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, a, <span class="stringliteral">&quot;NETSH&quot;</span>);</div>
<div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;        <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(a, NULL, 0, <span class="stringliteral">&quot;ERROR: netsh command failed&quot;</span>);</div>
<div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;        <a class="code" href="win32_8c.html#a80193dd282dced7ba53888ff38688594">netcmd_semaphore_release</a>();</div>
<div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>)</div>
<div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;        {</div>
<div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;        }</div>
<div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;        <a class="code" href="manage_8c.html#af07a56f96cec84856d0bf97899a4d460">management_sleep</a>(4);</div>
<div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;    }</div>
<div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(msglevel, <span class="stringliteral">&quot;NETSH: command failed&quot;</span>);</div>
<div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;}</div>
<div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160; </div>
<div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l05230"></a><span class="lineno"><a class="line" href="tun_8h.html#a0a364acc6be1969d05b108d0449b241b"> 5230</a></span>&#160;<a class="code" href="tun_8c.html#a0a364acc6be1969d05b108d0449b241b">ipconfig_register_dns</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structenv__set.html">env_set</a> *es)</div>
<div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;{</div>
<div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;    <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> err[] = <span class="stringliteral">&quot;ERROR: Windows ipconfig command failed&quot;</span>;</div>
<div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160; </div>
<div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#a80d57c8e34010c9b942bbb9f3171050b">D_TUNTAP_INFO</a>, <span class="stringliteral">&quot;Start ipconfig commands for register-dns...&quot;</span>);</div>
<div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;    <a class="code" href="win32_8c.html#acc83a5e3ac577a6c50fff6d71f232e41">netcmd_semaphore_lock</a>();</div>
<div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160; </div>
<div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;    <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s%s /flushdns&quot;</span>,</div>
<div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;                <a class="code" href="win32_8c.html#afa334458227a2453a4391a3a1316a0d7">get_win_sys_path</a>(),</div>
<div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;                <a class="code" href="win32_8h.html#a50dbc454ca7e3e55e1960dc710630548">WIN_IPCONFIG_PATH_SUFFIX</a>);</div>
<div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#a80d57c8e34010c9b942bbb9f3171050b">D_TUNTAP_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, 0, err);</div>
<div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160; </div>
<div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;    <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s%s /registerdns&quot;</span>,</div>
<div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;                <a class="code" href="win32_8c.html#afa334458227a2453a4391a3a1316a0d7">get_win_sys_path</a>(),</div>
<div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;                <a class="code" href="win32_8h.html#a50dbc454ca7e3e55e1960dc710630548">WIN_IPCONFIG_PATH_SUFFIX</a>);</div>
<div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;    <a class="code" href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a>(<a class="code" href="errlevel_8h.html#a80d57c8e34010c9b942bbb9f3171050b">D_TUNTAP_INFO</a>, &amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;    <a class="code" href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a>(&amp;<a class="code" href="structargv.html">argv</a>, es, 0, err);</div>
<div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;    <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160; </div>
<div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;    <a class="code" href="win32_8c.html#a80193dd282dced7ba53888ff38688594">netcmd_semaphore_release</a>();</div>
<div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#a80d57c8e34010c9b942bbb9f3171050b">D_TUNTAP_INFO</a>, <span class="stringliteral">&quot;End ipconfig commands for register-dns...&quot;</span>);</div>
<div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;}</div>
<div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160; </div>
<div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l05256"></a><span class="lineno"><a class="line" href="tun_8c.html#aea0fe0cbe4d20881b8378db9c6226066"> 5256</a></span>&#160;<a class="code" href="tun_8c.html#aea0fe0cbe4d20881b8378db9c6226066">ip_addr_string_to_array</a>(<a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> *<a class="code" href="compat-lz4_8h.html#aedfbaa502c9c447fc19b72fec8fc48e0">dest</a>, <span class="keywordtype">int</span> *dest_len, <span class="keyword">const</span> IP_ADDR_STRING *src)</div>
<div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;{</div>
<div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;    <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;    <span class="keywordflow">while</span> (src)</div>
<div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;    {</div>
<div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> getaddr_flags = <a class="code" href="socket_8h.html#a5b618d8716696f3ebe96642be56bec03">GETADDR_HOST_ORDER</a>;</div>
<div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *ip_str = src-&gt;IpAddress.String;</div>
<div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;        <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> ip = 0;</div>
<div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;        <span class="keywordtype">bool</span> succeed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160; </div>
<div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;        <span class="keywordflow">if</span> (i &gt;= *dest_len)</div>
<div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;        {</div>
<div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;        }</div>
<div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;        <span class="keywordflow">if</span> (!ip_str || !strlen(ip_str))</div>
<div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;        {</div>
<div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;        }</div>
<div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160; </div>
<div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;        ip = <a class="code" href="socket_8c.html#aed74c8b5931192c1ad5829bd90e01603">getaddr</a>(getaddr_flags, ip_str, 0, &amp;succeed, NULL);</div>
<div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;        <span class="keywordflow">if</span> (!succeed)</div>
<div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;        {</div>
<div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;        }</div>
<div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;        <a class="code" href="compat-lz4_8h.html#aedfbaa502c9c447fc19b72fec8fc48e0">dest</a>[i++] = ip;</div>
<div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160; </div>
<div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;        src = src-&gt;Next;</div>
<div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;    }</div>
<div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;    *dest_len = i;</div>
<div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160; </div>
<div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;    {</div>
<div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160;        <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;ip_addr_string_to_array [%d]&quot;</span>, *dest_len);</div>
<div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; *dest_len; ++i)</div>
<div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;        {</div>
<div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(<a class="code" href="compat-lz4_8h.html#aedfbaa502c9c447fc19b72fec8fc48e0">dest</a>[i], 0, &amp;gc));</div>
<div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;        }</div>
<div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;        <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;    }</div>
<div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;}</div>
<div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160; </div>
<div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l05300"></a><span class="lineno"><a class="line" href="tun_8c.html#afe5451b56f9b07e0f10dd8e9958a6981"> 5300</a></span>&#160;<a class="code" href="tun_8c.html#afe5451b56f9b07e0f10dd8e9958a6981">ip_addr_one_to_one</a>(<span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> *a1, <span class="keyword">const</span> <span class="keywordtype">int</span> a1len, <span class="keyword">const</span> IP_ADDR_STRING *ias)</div>
<div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160;{</div>
<div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;    <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> a2[8];</div>
<div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;    <span class="keywordtype">int</span> a2len = <a class="code" href="openvpn_2basic_8h.html#afd2537d19a3cb6556b0f727580ec6ee7">SIZE</a>(a2);</div>
<div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160; </div>
<div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;    <a class="code" href="tun_8c.html#aea0fe0cbe4d20881b8378db9c6226066">ip_addr_string_to_array</a>(a2, &amp;a2len, ias);</div>
<div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;    <span class="comment">/*msg (M_INFO, &quot;a1len=%d a2len=%d&quot;, a1len, a2len);*/</span></div>
<div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;    <span class="keywordflow">if</span> (a1len != a2len)</div>
<div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;    {</div>
<div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;    }</div>
<div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160; </div>
<div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; a1len; ++i)</div>
<div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;    {</div>
<div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;        <span class="keywordflow">if</span> (a1[i] != a2[i])</div>
<div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;        {</div>
<div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;        }</div>
<div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;    }</div>
<div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;}</div>
<div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160; </div>
<div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l05324"></a><span class="lineno"><a class="line" href="tun_8c.html#aad0d234fc1f354196625f68246c0cf17"> 5324</a></span>&#160;<a class="code" href="tun_8c.html#aad0d234fc1f354196625f68246c0cf17">ip_addr_member_of</a>(<span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> addr, <span class="keyword">const</span> IP_ADDR_STRING *ias)</div>
<div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;{</div>
<div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;    <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> aa[8];</div>
<div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;    <span class="keywordtype">int</span> len = <a class="code" href="openvpn_2basic_8h.html#afd2537d19a3cb6556b0f727580ec6ee7">SIZE</a>(aa);</div>
<div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160; </div>
<div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;    <a class="code" href="tun_8c.html#aea0fe0cbe4d20881b8378db9c6226066">ip_addr_string_to_array</a>(aa, &amp;len, ias);</div>
<div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; len; ++i)</div>
<div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;    {</div>
<div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;        <span class="keywordflow">if</span> (addr == aa[i])</div>
<div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;        {</div>
<div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;        }</div>
<div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;    }</div>
<div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;}</div>
<div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160; </div>
<div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l05347"></a><span class="lineno"><a class="line" href="tun_8c.html#aee87d985f2ee8faa65c3716def4b9b8c"> 5347</a></span>&#160;<a class="code" href="tun_8c.html#aee87d985f2ee8faa65c3716def4b9b8c">netsh_set_dns6_servers</a>(<span class="keyword">const</span> <span class="keyword">struct</span> in6_addr *addr_list,</div>
<div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;                       <span class="keyword">const</span> <span class="keywordtype">int</span> addr_len,</div>
<div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;                       DWORD adapter_index)</div>
<div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160;{</div>
<div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;    <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160; </div>
<div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;    <span class="comment">/* delete existing DNS settings from TAP interface */</span></div>
<div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;    <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s%s interface ipv6 delete dns %lu all&quot;</span>,</div>
<div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;                <a class="code" href="win32_8c.html#afa334458227a2453a4391a3a1316a0d7">get_win_sys_path</a>(),</div>
<div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160;                <a class="code" href="win32_8h.html#ac14f7d0f4450ca68bf7f955e42e234cf">NETSH_PATH_SUFFIX</a>,</div>
<div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;                adapter_index);</div>
<div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160;    <a class="code" href="tun_8c.html#ac0b5e1af8dfaa627162520fbc1ae5080">netsh_command</a>(&amp;<a class="code" href="structargv.html">argv</a>, 2, <a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>);</div>
<div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160; </div>
<div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; addr_len; ++i)</div>
<div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160;    {</div>
<div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt = (i == 0) ?</div>
<div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;                          <span class="stringliteral">&quot;%s%s interface ipv6 set dns %lu static %s&quot;</span></div>
<div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;                          : <span class="stringliteral">&quot;%s%s interface ipv6 add dns %lu %s&quot;</span>;</div>
<div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, fmt, <a class="code" href="win32_8c.html#afa334458227a2453a4391a3a1316a0d7">get_win_sys_path</a>(),</div>
<div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;                    <a class="code" href="win32_8h.html#ac14f7d0f4450ca68bf7f955e42e234cf">NETSH_PATH_SUFFIX</a>, adapter_index,</div>
<div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;                    <a class="code" href="socket_8c.html#a9a911c5dde4c809f7cb3eef8e5918a8e">print_in6_addr</a>(addr_list[i], 0, &amp;<a class="code" href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">gc</a>));</div>
<div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160; </div>
<div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;        <span class="comment">/* disable slow address validation on Windows 7 and higher */</span></div>
<div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="win32_8c.html#a427612d1943aca2700313306c34c9ee3">win32_version_info</a>() &gt;= <a class="code" href="win32_8h.html#a98f0672ee8fd0bfd7224d357f6b30408">WIN_7</a>)</div>
<div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;        {</div>
<div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;            <a class="code" href="argv_8c.html#ad62a50a5c6133eaea0422cee6ba840cf">argv_printf_cat</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;validate=no&quot;</span>);</div>
<div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;        }</div>
<div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160; </div>
<div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;        <span class="comment">/* Treat errors while adding as non-fatal as we do not check for duplicates */</span></div>
<div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;        <a class="code" href="tun_8c.html#ac0b5e1af8dfaa627162520fbc1ae5080">netsh_command</a>(&amp;<a class="code" href="structargv.html">argv</a>, 1, (i==0) ? <a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a> : <a class="code" href="openvpn_2error_8h.html#a9e1c690bc419010e6e8346d28a237941">M_NONFATAL</a>);</div>
<div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;    }</div>
<div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160; </div>
<div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;    <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;<a class="code" href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">gc</a>);</div>
<div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;}</div>
<div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160; </div>
<div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l05385"></a><span class="lineno"><a class="line" href="tun_8c.html#a7d64323e3d927c3ddbf359d4ccab0893"> 5385</a></span>&#160;<a class="code" href="tun_8c.html#a7d64323e3d927c3ddbf359d4ccab0893">netsh_ifconfig_options</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *type,</div>
<div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;                       <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> *addr_list,</div>
<div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;                       <span class="keyword">const</span> <span class="keywordtype">int</span> addr_len,</div>
<div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160;                       <span class="keyword">const</span> IP_ADDR_STRING *current,</div>
<div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160;                       DWORD adapter_index,</div>
<div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160;                       <span class="keyword">const</span> <span class="keywordtype">bool</span> test_first)</div>
<div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160;{</div>
<div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l05393"></a><span class="lineno"> 5393</span>&#160;    <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;    <span class="keywordtype">bool</span> delete_first = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;    <span class="keywordtype">bool</span> is_dns = !strcmp(type, <span class="stringliteral">&quot;dns&quot;</span>);</div>
<div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160; </div>
<div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;    <span class="comment">/* first check if we should delete existing DNS/WINS settings from TAP interface */</span></div>
<div class="line"><a name="l05398"></a><span class="lineno"> 5398</span>&#160;    <span class="keywordflow">if</span> (test_first)</div>
<div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;    {</div>
<div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="tun_8c.html#afe5451b56f9b07e0f10dd8e9958a6981">ip_addr_one_to_one</a>(addr_list, addr_len, current))</div>
<div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;        {</div>
<div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160;            delete_first = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;        }</div>
<div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;    }</div>
<div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;    {</div>
<div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;        delete_first = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;    }</div>
<div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160; </div>
<div class="line"><a name="l05410"></a><span class="lineno"> 5410</span>&#160;    <span class="comment">/* delete existing DNS/WINS settings from TAP interface */</span></div>
<div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;    <span class="keywordflow">if</span> (delete_first)</div>
<div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160;    {</div>
<div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s%s interface ip delete %s %lu all&quot;</span>,</div>
<div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;                    <a class="code" href="win32_8c.html#afa334458227a2453a4391a3a1316a0d7">get_win_sys_path</a>(),</div>
<div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;                    <a class="code" href="win32_8h.html#ac14f7d0f4450ca68bf7f955e42e234cf">NETSH_PATH_SUFFIX</a>,</div>
<div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160;                    type,</div>
<div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;                    adapter_index);</div>
<div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;        <a class="code" href="tun_8c.html#ac0b5e1af8dfaa627162520fbc1ae5080">netsh_command</a>(&amp;<a class="code" href="structargv.html">argv</a>, 2, <a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>);</div>
<div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160;    }</div>
<div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160; </div>
<div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160;    <span class="comment">/* add new DNS/WINS settings to TAP interface */</span></div>
<div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160;    {</div>
<div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;        <span class="keywordtype">int</span> count = 0;</div>
<div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160;        <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; addr_len; ++i)</div>
<div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160;        {</div>
<div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;            <span class="keywordflow">if</span> (delete_first || !test_first || !<a class="code" href="tun_8c.html#aad0d234fc1f354196625f68246c0cf17">ip_addr_member_of</a>(addr_list[i], current))</div>
<div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;            {</div>
<div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt = count ?</div>
<div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;                                  <span class="stringliteral">&quot;%s%s interface ip add %s %lu %s&quot;</span></div>
<div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;                                  : <span class="stringliteral">&quot;%s%s interface ip set %s %lu static %s&quot;</span>;</div>
<div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160; </div>
<div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;                <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, fmt,</div>
<div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;                            <a class="code" href="win32_8c.html#afa334458227a2453a4391a3a1316a0d7">get_win_sys_path</a>(),</div>
<div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;                            <a class="code" href="win32_8h.html#ac14f7d0f4450ca68bf7f955e42e234cf">NETSH_PATH_SUFFIX</a>,</div>
<div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;                            type,</div>
<div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;                            adapter_index,</div>
<div class="line"><a name="l05438"></a><span class="lineno"> 5438</span>&#160;                            <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(addr_list[i], 0, &amp;<a class="code" href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">gc</a>));</div>
<div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160; </div>
<div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;                <span class="comment">/* disable slow address validation on Windows 7 and higher */</span></div>
<div class="line"><a name="l05441"></a><span class="lineno"> 5441</span>&#160;                <span class="comment">/* only for DNS */</span></div>
<div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160;                <span class="keywordflow">if</span> (is_dns &amp;&amp; <a class="code" href="win32_8c.html#a427612d1943aca2700313306c34c9ee3">win32_version_info</a>() &gt;= <a class="code" href="win32_8h.html#a98f0672ee8fd0bfd7224d357f6b30408">WIN_7</a>)</div>
<div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;                {</div>
<div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;                    <a class="code" href="argv_8c.html#ad62a50a5c6133eaea0422cee6ba840cf">argv_printf_cat</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;validate=no&quot;</span>);</div>
<div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;                }</div>
<div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160; </div>
<div class="line"><a name="l05447"></a><span class="lineno"> 5447</span>&#160;                <a class="code" href="tun_8c.html#ac0b5e1af8dfaa627162520fbc1ae5080">netsh_command</a>(&amp;<a class="code" href="structargv.html">argv</a>, 2, <a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>);</div>
<div class="line"><a name="l05448"></a><span class="lineno"> 5448</span>&#160; </div>
<div class="line"><a name="l05449"></a><span class="lineno"> 5449</span>&#160;                ++count;</div>
<div class="line"><a name="l05450"></a><span class="lineno"> 5450</span>&#160;            }</div>
<div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;            {</div>
<div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;NETSH: %lu %s %s [already set]&quot;</span>,</div>
<div class="line"><a name="l05454"></a><span class="lineno"> 5454</span>&#160;                    adapter_index,</div>
<div class="line"><a name="l05455"></a><span class="lineno"> 5455</span>&#160;                    type,</div>
<div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;                    <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(addr_list[i], 0, &amp;<a class="code" href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">gc</a>));</div>
<div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;            }</div>
<div class="line"><a name="l05458"></a><span class="lineno"> 5458</span>&#160;        }</div>
<div class="line"><a name="l05459"></a><span class="lineno"> 5459</span>&#160;    }</div>
<div class="line"><a name="l05460"></a><span class="lineno"> 5460</span>&#160; </div>
<div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;    <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;<a class="code" href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">gc</a>);</div>
<div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;}</div>
<div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160; </div>
<div class="line"><a name="l05465"></a><span class="lineno"> 5465</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l05466"></a><span class="lineno"><a class="line" href="tun_8c.html#a90b586c642a83689dfc52c77ca91cf3a"> 5466</a></span>&#160;<a class="code" href="tun_8c.html#a90b586c642a83689dfc52c77ca91cf3a">init_ip_addr_string2</a>(IP_ADDR_STRING *<a class="code" href="compat-lz4_8h.html#aedfbaa502c9c447fc19b72fec8fc48e0">dest</a>, <span class="keyword">const</span> IP_ADDR_STRING *src1, <span class="keyword">const</span> IP_ADDR_STRING *src2)</div>
<div class="line"><a name="l05467"></a><span class="lineno"> 5467</span>&#160;{</div>
<div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;    <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(<a class="code" href="compat-lz4_8h.html#aedfbaa502c9c447fc19b72fec8fc48e0">dest</a>[0]);</div>
<div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;    <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(<a class="code" href="compat-lz4_8h.html#aedfbaa502c9c447fc19b72fec8fc48e0">dest</a>[1]);</div>
<div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;    <span class="keywordflow">if</span> (src1)</div>
<div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;    {</div>
<div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;        <a class="code" href="compat-lz4_8h.html#aedfbaa502c9c447fc19b72fec8fc48e0">dest</a>[0] = *src1;</div>
<div class="line"><a name="l05473"></a><span class="lineno"> 5473</span>&#160;        <a class="code" href="compat-lz4_8h.html#aedfbaa502c9c447fc19b72fec8fc48e0">dest</a>[0].Next = NULL;</div>
<div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160;    }</div>
<div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;    <span class="keywordflow">if</span> (src2)</div>
<div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;    {</div>
<div class="line"><a name="l05477"></a><span class="lineno"> 5477</span>&#160;        <a class="code" href="compat-lz4_8h.html#aedfbaa502c9c447fc19b72fec8fc48e0">dest</a>[1] = *src2;</div>
<div class="line"><a name="l05478"></a><span class="lineno"> 5478</span>&#160;        <a class="code" href="compat-lz4_8h.html#aedfbaa502c9c447fc19b72fec8fc48e0">dest</a>[0].Next = &amp;<a class="code" href="compat-lz4_8h.html#aedfbaa502c9c447fc19b72fec8fc48e0">dest</a>[1];</div>
<div class="line"><a name="l05479"></a><span class="lineno"> 5479</span>&#160;        <a class="code" href="compat-lz4_8h.html#aedfbaa502c9c447fc19b72fec8fc48e0">dest</a>[1].Next = NULL;</div>
<div class="line"><a name="l05480"></a><span class="lineno"> 5480</span>&#160;    }</div>
<div class="line"><a name="l05481"></a><span class="lineno"> 5481</span>&#160;}</div>
<div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160; </div>
<div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l05484"></a><span class="lineno"><a class="line" href="tun_8c.html#a4636ecf580e72087b1cd63dcc1375ec9"> 5484</a></span>&#160;<a class="code" href="tun_8c.html#a4636ecf580e72087b1cd63dcc1375ec9">netsh_ifconfig</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap__options.html">tuntap_options</a> *to,</div>
<div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;               DWORD adapter_index,</div>
<div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;               <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> ip,</div>
<div class="line"><a name="l05487"></a><span class="lineno"> 5487</span>&#160;               <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> netmask,</div>
<div class="line"><a name="l05488"></a><span class="lineno"> 5488</span>&#160;               <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flags)</div>
<div class="line"><a name="l05489"></a><span class="lineno"> 5489</span>&#160;{</div>
<div class="line"><a name="l05490"></a><span class="lineno"> 5490</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;    <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;    <span class="keyword">const</span> IP_ADAPTER_INFO *ai = NULL;</div>
<div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160;    <span class="keyword">const</span> IP_PER_ADAPTER_INFO *pai = NULL;</div>
<div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160; </div>
<div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;    <span class="keywordflow">if</span> (flags &amp; <a class="code" href="tun_8c.html#a293109fe0e2259e2e4f18f7fa85f498d">NI_TEST_FIRST</a>)</div>
<div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;    {</div>
<div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;        <span class="keyword">const</span> IP_ADAPTER_INFO *list = <a class="code" href="tun_8c.html#ab80c97a1474ca6badb604921d8ddd534">get_adapter_info_list</a>(&amp;<a class="code" href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">gc</a>);</div>
<div class="line"><a name="l05498"></a><span class="lineno"> 5498</span>&#160;        ai = <a class="code" href="tun_8c.html#a2a9e358835e9587fbd460b69afbdae9b">get_adapter</a>(list, adapter_index);</div>
<div class="line"><a name="l05499"></a><span class="lineno"> 5499</span>&#160;        pai = <a class="code" href="tun_8c.html#ae969bd5eb66f71a6730e6bcdde34749e">get_per_adapter_info</a>(adapter_index, &amp;<a class="code" href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">gc</a>);</div>
<div class="line"><a name="l05500"></a><span class="lineno"> 5500</span>&#160;    }</div>
<div class="line"><a name="l05501"></a><span class="lineno"> 5501</span>&#160; </div>
<div class="line"><a name="l05502"></a><span class="lineno"> 5502</span>&#160;    <span class="keywordflow">if</span> (flags &amp; <a class="code" href="tun_8c.html#ae4ca7b1df4a85e25a8638afedb54b6dd">NI_IP_NETMASK</a>)</div>
<div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;    {</div>
<div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tun_8c.html#a19e929a4cd46aa14eecd013c21c20b25">test_adapter_ip_netmask</a>(ai, ip, netmask))</div>
<div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;        {</div>
<div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;NETSH: %lu %s/%s [already set]&quot;</span>,</div>
<div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;                adapter_index,</div>
<div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160;                <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(ip, 0, &amp;<a class="code" href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">gc</a>),</div>
<div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160;                <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(netmask, 0, &amp;<a class="code" href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">gc</a>));</div>
<div class="line"><a name="l05510"></a><span class="lineno"> 5510</span>&#160;        }</div>
<div class="line"><a name="l05511"></a><span class="lineno"> 5511</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l05512"></a><span class="lineno"> 5512</span>&#160;        {</div>
<div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;            <span class="comment">/* example: netsh interface ip set address 42 static 10.3.0.1 255.255.255.0 */</span></div>
<div class="line"><a name="l05514"></a><span class="lineno"> 5514</span>&#160;            <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>, <span class="stringliteral">&quot;%s%s interface ip set address %lu static %s %s&quot;</span>,</div>
<div class="line"><a name="l05515"></a><span class="lineno"> 5515</span>&#160;                        <a class="code" href="win32_8c.html#afa334458227a2453a4391a3a1316a0d7">get_win_sys_path</a>(),</div>
<div class="line"><a name="l05516"></a><span class="lineno"> 5516</span>&#160;                        <a class="code" href="win32_8h.html#ac14f7d0f4450ca68bf7f955e42e234cf">NETSH_PATH_SUFFIX</a>,</div>
<div class="line"><a name="l05517"></a><span class="lineno"> 5517</span>&#160;                        adapter_index,</div>
<div class="line"><a name="l05518"></a><span class="lineno"> 5518</span>&#160;                        <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(ip, 0, &amp;<a class="code" href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">gc</a>),</div>
<div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;                        <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(netmask, 0, &amp;<a class="code" href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">gc</a>));</div>
<div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160; </div>
<div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;            <a class="code" href="tun_8c.html#ac0b5e1af8dfaa627162520fbc1ae5080">netsh_command</a>(&amp;<a class="code" href="structargv.html">argv</a>, 4, <a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>);</div>
<div class="line"><a name="l05522"></a><span class="lineno"> 5522</span>&#160;        }</div>
<div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160;    }</div>
<div class="line"><a name="l05524"></a><span class="lineno"> 5524</span>&#160; </div>
<div class="line"><a name="l05525"></a><span class="lineno"> 5525</span>&#160;    <span class="comment">/* set WINS/DNS options */</span></div>
<div class="line"><a name="l05526"></a><span class="lineno"> 5526</span>&#160;    <span class="keywordflow">if</span> (flags &amp; <a class="code" href="tun_8c.html#a732f35a455d3cc46d0dd3d6b94239b87">NI_OPTIONS</a>)</div>
<div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;    {</div>
<div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;        IP_ADDR_STRING wins[2];</div>
<div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;        <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(wins[0]);</div>
<div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;        <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(wins[1]);</div>
<div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160; </div>
<div class="line"><a name="l05532"></a><span class="lineno"> 5532</span>&#160;        <a class="code" href="tun_8c.html#a7d64323e3d927c3ddbf359d4ccab0893">netsh_ifconfig_options</a>(<span class="stringliteral">&quot;dns&quot;</span>,</div>
<div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;                               to-&gt;<a class="code" href="structtuntap__options.html#a5c59bd51c39835c98556b124f30611b6">dns</a>,</div>
<div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160;                               to-&gt;<a class="code" href="structtuntap__options.html#a143af129775b5984fa835d5c0026e75c">dns_len</a>,</div>
<div class="line"><a name="l05535"></a><span class="lineno"> 5535</span>&#160;                               pai ? &amp;pai-&gt;DnsServerList : NULL,</div>
<div class="line"><a name="l05536"></a><span class="lineno"> 5536</span>&#160;                               adapter_index,</div>
<div class="line"><a name="l05537"></a><span class="lineno"> 5537</span>&#160;                               <a class="code" href="openvpn_2basic_8h.html#a94fd7e422c6111004392c9a1bd7242c9">BOOL_CAST</a>(flags &amp; <a class="code" href="tun_8c.html#a293109fe0e2259e2e4f18f7fa85f498d">NI_TEST_FIRST</a>));</div>
<div class="line"><a name="l05538"></a><span class="lineno"> 5538</span>&#160;        <span class="keywordflow">if</span> (ai &amp;&amp; ai-&gt;HaveWins)</div>
<div class="line"><a name="l05539"></a><span class="lineno"> 5539</span>&#160;        {</div>
<div class="line"><a name="l05540"></a><span class="lineno"> 5540</span>&#160;            <a class="code" href="tun_8c.html#a90b586c642a83689dfc52c77ca91cf3a">init_ip_addr_string2</a>(wins, &amp;ai-&gt;PrimaryWinsServer, &amp;ai-&gt;SecondaryWinsServer);</div>
<div class="line"><a name="l05541"></a><span class="lineno"> 5541</span>&#160;        }</div>
<div class="line"><a name="l05542"></a><span class="lineno"> 5542</span>&#160; </div>
<div class="line"><a name="l05543"></a><span class="lineno"> 5543</span>&#160;        <a class="code" href="tun_8c.html#a7d64323e3d927c3ddbf359d4ccab0893">netsh_ifconfig_options</a>(<span class="stringliteral">&quot;wins&quot;</span>,</div>
<div class="line"><a name="l05544"></a><span class="lineno"> 5544</span>&#160;                               to-&gt;<a class="code" href="structtuntap__options.html#a30def869016af7778723a529b548e820">wins</a>,</div>
<div class="line"><a name="l05545"></a><span class="lineno"> 5545</span>&#160;                               to-&gt;<a class="code" href="structtuntap__options.html#a033f8e542a5ad3c4680d4203687d8bea">wins_len</a>,</div>
<div class="line"><a name="l05546"></a><span class="lineno"> 5546</span>&#160;                               ai ? wins : NULL,</div>
<div class="line"><a name="l05547"></a><span class="lineno"> 5547</span>&#160;                               adapter_index,</div>
<div class="line"><a name="l05548"></a><span class="lineno"> 5548</span>&#160;                               <a class="code" href="openvpn_2basic_8h.html#a94fd7e422c6111004392c9a1bd7242c9">BOOL_CAST</a>(flags &amp; <a class="code" href="tun_8c.html#a293109fe0e2259e2e4f18f7fa85f498d">NI_TEST_FIRST</a>));</div>
<div class="line"><a name="l05549"></a><span class="lineno"> 5549</span>&#160;    }</div>
<div class="line"><a name="l05550"></a><span class="lineno"> 5550</span>&#160; </div>
<div class="line"><a name="l05551"></a><span class="lineno"> 5551</span>&#160;    <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;<a class="code" href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">gc</a>);</div>
<div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160;}</div>
<div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160; </div>
<div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l05556"></a><span class="lineno"><a class="line" href="tun_8c.html#a2758a9aa8e7fdef2a6db76f248150b46"> 5556</a></span>&#160;<a class="code" href="tun_8c.html#a2758a9aa8e7fdef2a6db76f248150b46">netsh_enable_dhcp</a>(DWORD adapter_index)</div>
<div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;{</div>
<div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;    <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160; </div>
<div class="line"><a name="l05560"></a><span class="lineno"> 5560</span>&#160;    <span class="comment">/* example: netsh interface ip set address 42 dhcp */</span></div>
<div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160;    <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>,</div>
<div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160;                <span class="stringliteral">&quot;%s%s interface ip set address %lu dhcp&quot;</span>,</div>
<div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;                <a class="code" href="win32_8c.html#afa334458227a2453a4391a3a1316a0d7">get_win_sys_path</a>(),</div>
<div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;                <a class="code" href="win32_8h.html#ac14f7d0f4450ca68bf7f955e42e234cf">NETSH_PATH_SUFFIX</a>,</div>
<div class="line"><a name="l05565"></a><span class="lineno"> 5565</span>&#160;                adapter_index);</div>
<div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160; </div>
<div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160;    <a class="code" href="tun_8c.html#ac0b5e1af8dfaa627162520fbc1ae5080">netsh_command</a>(&amp;<a class="code" href="structargv.html">argv</a>, 4, <a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>);</div>
<div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160; </div>
<div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;    <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;}</div>
<div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160; </div>
<div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160;<span class="comment">/* Enable dhcp on tap adapter using iservice */</span></div>
<div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l05574"></a><span class="lineno"><a class="line" href="tun_8c.html#a36d0521b47e5eb91b126afdd0a949420"> 5574</a></span>&#160;<a class="code" href="tun_8c.html#a36d0521b47e5eb91b126afdd0a949420">service_enable_dhcp</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160;{</div>
<div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;    <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160;    <a class="code" href="structack__message__t.html">ack_message_t</a> ack;</div>
<div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;    HANDLE pipe = tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">msg_channel</a>;</div>
<div class="line"><a name="l05580"></a><span class="lineno"> 5580</span>&#160; </div>
<div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;    <a class="code" href="structenable__dhcp__message__t.html">enable_dhcp_message_t</a> <a class="code" href="structdhcp.html">dhcp</a> = {</div>
<div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;        .header = {</div>
<div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;            <a class="code" href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557ca1c71f37d2e905659f1330446b04e6625">msg_enable_dhcp</a>,</div>
<div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;            <span class="keyword">sizeof</span>(<a class="code" href="structenable__dhcp__message__t.html">enable_dhcp_message_t</a>),</div>
<div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;            0</div>
<div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;        },</div>
<div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160;        .iface = { .index = tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>, .name = <span class="stringliteral">&quot;&quot;</span> }</div>
<div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160;    };</div>
<div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160; </div>
<div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="win32_8c.html#a7c43018c3610f281fbcd28c092d29619">send_msg_iservice</a>(pipe, &amp;<a class="code" href="structdhcp.html">dhcp</a>, <span class="keyword">sizeof</span>(<a class="code" href="structdhcp.html">dhcp</a>), &amp;ack, <span class="stringliteral">&quot;Enable_dhcp&quot;</span>))</div>
<div class="line"><a name="l05591"></a><span class="lineno"> 5591</span>&#160;    {</div>
<div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l05593"></a><span class="lineno"> 5593</span>&#160;    }</div>
<div class="line"><a name="l05594"></a><span class="lineno"> 5594</span>&#160; </div>
<div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;    <span class="keywordflow">if</span> (ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a> != NO_ERROR)</div>
<div class="line"><a name="l05596"></a><span class="lineno"> 5596</span>&#160;    {</div>
<div class="line"><a name="l05597"></a><span class="lineno"> 5597</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a9e1c690bc419010e6e8346d28a237941">M_NONFATAL</a>, <span class="stringliteral">&quot;TUN: enabling dhcp using service failed: %s [status=%u if_index=%d]&quot;</span>,</div>
<div class="line"><a name="l05598"></a><span class="lineno"> 5598</span>&#160;            <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a>, &amp;gc), ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a>, <a class="code" href="structdhcp.html">dhcp</a>.iface.index);</div>
<div class="line"><a name="l05599"></a><span class="lineno"> 5599</span>&#160;    }</div>
<div class="line"><a name="l05600"></a><span class="lineno"> 5600</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05601"></a><span class="lineno"> 5601</span>&#160;    {</div>
<div class="line"><a name="l05602"></a><span class="lineno"> 5602</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;DHCP enabled on interface %d using service&quot;</span>, <a class="code" href="structdhcp.html">dhcp</a>.iface.index);</div>
<div class="line"><a name="l05603"></a><span class="lineno"> 5603</span>&#160;        ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05604"></a><span class="lineno"> 5604</span>&#160;    }</div>
<div class="line"><a name="l05605"></a><span class="lineno"> 5605</span>&#160; </div>
<div class="line"><a name="l05606"></a><span class="lineno"> 5606</span>&#160;out:</div>
<div class="line"><a name="l05607"></a><span class="lineno"> 5607</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l05608"></a><span class="lineno"> 5608</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l05609"></a><span class="lineno"> 5609</span>&#160;}</div>
<div class="line"><a name="l05610"></a><span class="lineno"> 5610</span>&#160; </div>
<div class="line"><a name="l05611"></a><span class="lineno"> 5611</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l05612"></a><span class="lineno"><a class="line" href="tun_8c.html#ade2f6913cf1b1b4b6d342140d1db9f97"> 5612</a></span>&#160;<a class="code" href="tun_8c.html#ade2f6913cf1b1b4b6d342140d1db9f97">windows_set_mtu</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> iface_index, <span class="keyword">const</span> <span class="keywordtype">short</span> family,</div>
<div class="line"><a name="l05613"></a><span class="lineno"> 5613</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> mtu)</div>
<div class="line"><a name="l05614"></a><span class="lineno"> 5614</span>&#160;{</div>
<div class="line"><a name="l05615"></a><span class="lineno"> 5615</span>&#160;    DWORD err = 0;</div>
<div class="line"><a name="l05616"></a><span class="lineno"> 5616</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l05617"></a><span class="lineno"> 5617</span>&#160;    MIB_IPINTERFACE_ROW ipiface;</div>
<div class="line"><a name="l05618"></a><span class="lineno"> 5618</span>&#160;    InitializeIpInterfaceEntry(&amp;ipiface);</div>
<div class="line"><a name="l05619"></a><span class="lineno"> 5619</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *family_name = (family == AF_INET6) ? <span class="stringliteral">&quot;IPv6&quot;</span> : <span class="stringliteral">&quot;IPv4&quot;</span>;</div>
<div class="line"><a name="l05620"></a><span class="lineno"> 5620</span>&#160;    ipiface.Family = family;</div>
<div class="line"><a name="l05621"></a><span class="lineno"> 5621</span>&#160;    ipiface.InterfaceIndex = iface_index;</div>
<div class="line"><a name="l05622"></a><span class="lineno"> 5622</span>&#160;    <span class="keywordflow">if</span> (family == AF_INET6 &amp;&amp; mtu &lt; 1280)</div>
<div class="line"><a name="l05623"></a><span class="lineno"> 5623</span>&#160;    {</div>
<div class="line"><a name="l05624"></a><span class="lineno"> 5624</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;NOTE: IPv6 interface MTU &lt; 1280 conflicts with IETF standards and might not work&quot;</span>);</div>
<div class="line"><a name="l05625"></a><span class="lineno"> 5625</span>&#160;    }</div>
<div class="line"><a name="l05626"></a><span class="lineno"> 5626</span>&#160; </div>
<div class="line"><a name="l05627"></a><span class="lineno"> 5627</span>&#160;    err = GetIpInterfaceEntry(&amp;ipiface);</div>
<div class="line"><a name="l05628"></a><span class="lineno"> 5628</span>&#160;    <span class="keywordflow">if</span> (err == NO_ERROR)</div>
<div class="line"><a name="l05629"></a><span class="lineno"> 5629</span>&#160;    {</div>
<div class="line"><a name="l05630"></a><span class="lineno"> 5630</span>&#160;        <span class="keywordflow">if</span> (family == AF_INET)</div>
<div class="line"><a name="l05631"></a><span class="lineno"> 5631</span>&#160;        {</div>
<div class="line"><a name="l05632"></a><span class="lineno"> 5632</span>&#160;            ipiface.SitePrefixLength = 0;</div>
<div class="line"><a name="l05633"></a><span class="lineno"> 5633</span>&#160;        }</div>
<div class="line"><a name="l05634"></a><span class="lineno"> 5634</span>&#160;        ipiface.NlMtu = mtu;</div>
<div class="line"><a name="l05635"></a><span class="lineno"> 5635</span>&#160;        err = SetIpInterfaceEntry(&amp;ipiface);</div>
<div class="line"><a name="l05636"></a><span class="lineno"> 5636</span>&#160;    }</div>
<div class="line"><a name="l05637"></a><span class="lineno"> 5637</span>&#160; </div>
<div class="line"><a name="l05638"></a><span class="lineno"> 5638</span>&#160;    <span class="keywordflow">if</span> (err != NO_ERROR)</div>
<div class="line"><a name="l05639"></a><span class="lineno"> 5639</span>&#160;    {</div>
<div class="line"><a name="l05640"></a><span class="lineno"> 5640</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;TUN: Setting %s mtu failed: %s [status=%u if_index=%d]&quot;</span>,</div>
<div class="line"><a name="l05641"></a><span class="lineno"> 5641</span>&#160;            family_name, <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(err, &amp;gc), err, iface_index);</div>
<div class="line"><a name="l05642"></a><span class="lineno"> 5642</span>&#160;    }</div>
<div class="line"><a name="l05643"></a><span class="lineno"> 5643</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05644"></a><span class="lineno"> 5644</span>&#160;    {</div>
<div class="line"><a name="l05645"></a><span class="lineno"> 5645</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;%s MTU set to %d on interface %d using SetIpInterfaceEntry()&quot;</span>, family_name, mtu, iface_index);</div>
<div class="line"><a name="l05646"></a><span class="lineno"> 5646</span>&#160;    }</div>
<div class="line"><a name="l05647"></a><span class="lineno"> 5647</span>&#160;}</div>
<div class="line"><a name="l05648"></a><span class="lineno"> 5648</span>&#160; </div>
<div class="line"><a name="l05649"></a><span class="lineno"> 5649</span>&#160; </div>
<div class="line"><a name="l05650"></a><span class="lineno"> 5650</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l05651"></a><span class="lineno"> 5651</span>&#160;<span class="comment"> * Return a TAP name for netsh commands.</span></div>
<div class="line"><a name="l05652"></a><span class="lineno"> 5652</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l05653"></a><span class="lineno"> 5653</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a name="l05654"></a><span class="lineno"><a class="line" href="tun_8c.html#a1394acf0970ce11c08bba13dee682131"> 5654</a></span>&#160;<a class="code" href="tun_8c.html#a1394acf0970ce11c08bba13dee682131">netsh_get_id</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node, <span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l05655"></a><span class="lineno"> 5655</span>&#160;{</div>
<div class="line"><a name="l05656"></a><span class="lineno"> 5656</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtap__reg.html">tap_reg</a> *<a class="code" href="structtap__reg.html">tap_reg</a> = <a class="code" href="tun_8c.html#ab6ace179866b796f9a2962093e36ba71">get_tap_reg</a>(gc);</div>
<div class="line"><a name="l05657"></a><span class="lineno"> 5657</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structpanel__reg.html">panel_reg</a> *<a class="code" href="structpanel__reg.html">panel_reg</a> = <a class="code" href="tun_8c.html#aae4bf389fe2e79e5cca5b3b67a4290b3">get_panel_reg</a>(gc);</div>
<div class="line"><a name="l05658"></a><span class="lineno"> 5658</span>&#160;    <span class="keyword">struct </span><a class="code" href="structbuffer.html">buffer</a> actual = <a class="code" href="buffer_8c.html#aa35bf7feb6a99bf5d364b2d4eba1195c">alloc_buf_gc</a>(256, gc);</div>
<div class="line"><a name="l05659"></a><span class="lineno"> 5659</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *guid;</div>
<div class="line"><a name="l05660"></a><span class="lineno"> 5660</span>&#160; </div>
<div class="line"><a name="l05661"></a><span class="lineno"> 5661</span>&#160;    <a class="code" href="tun_8c.html#aaed8ba449c46f58edb6cc252c652d229">at_least_one_tap_win</a>(<a class="code" href="structtap__reg.html">tap_reg</a>);</div>
<div class="line"><a name="l05662"></a><span class="lineno"> 5662</span>&#160; </div>
<div class="line"><a name="l05663"></a><span class="lineno"> 5663</span>&#160;    <span class="keywordflow">if</span> (dev_node)</div>
<div class="line"><a name="l05664"></a><span class="lineno"> 5664</span>&#160;    {</div>
<div class="line"><a name="l05665"></a><span class="lineno"> 5665</span>&#160;        guid = <a class="code" href="tun_8c.html#a6c7f0760429559528db611dcd91bb8b2">get_device_guid</a>(dev_node, <a class="code" href="buffer_8h.html#a3be0c11aee0e4d7fe9e0b15235668c43">BPTR</a>(&amp;actual), <a class="code" href="buffer_8h.html#ac08c75bf761b2c048b14e5b6cbf2c8f3">BCAP</a>(&amp;actual), NULL, <a class="code" href="structtap__reg.html">tap_reg</a>, <a class="code" href="structpanel__reg.html">panel_reg</a>, gc);</div>
<div class="line"><a name="l05666"></a><span class="lineno"> 5666</span>&#160;    }</div>
<div class="line"><a name="l05667"></a><span class="lineno"> 5667</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05668"></a><span class="lineno"> 5668</span>&#160;    {</div>
<div class="line"><a name="l05669"></a><span class="lineno"> 5669</span>&#160;        guid = <a class="code" href="tun_8c.html#a54b32700415233e75316fe78594bf8be">get_unspecified_device_guid</a>(0, <a class="code" href="buffer_8h.html#a3be0c11aee0e4d7fe9e0b15235668c43">BPTR</a>(&amp;actual), <a class="code" href="buffer_8h.html#ac08c75bf761b2c048b14e5b6cbf2c8f3">BCAP</a>(&amp;actual), <a class="code" href="structtap__reg.html">tap_reg</a>, <a class="code" href="structpanel__reg.html">panel_reg</a>, NULL, gc);</div>
<div class="line"><a name="l05670"></a><span class="lineno"> 5670</span>&#160; </div>
<div class="line"><a name="l05671"></a><span class="lineno"> 5671</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tun_8c.html#a54b32700415233e75316fe78594bf8be">get_unspecified_device_guid</a>(1, NULL, 0, <a class="code" href="structtap__reg.html">tap_reg</a>, <a class="code" href="structpanel__reg.html">panel_reg</a>, NULL, gc)) <span class="comment">/* ambiguous if more than one TAP-Windows adapter */</span></div>
<div class="line"><a name="l05672"></a><span class="lineno"> 5672</span>&#160;        {</div>
<div class="line"><a name="l05673"></a><span class="lineno"> 5673</span>&#160;            guid = NULL;</div>
<div class="line"><a name="l05674"></a><span class="lineno"> 5674</span>&#160;        }</div>
<div class="line"><a name="l05675"></a><span class="lineno"> 5675</span>&#160;    }</div>
<div class="line"><a name="l05676"></a><span class="lineno"> 5676</span>&#160; </div>
<div class="line"><a name="l05677"></a><span class="lineno"> 5677</span>&#160;    <span class="keywordflow">if</span> (!guid)</div>
<div class="line"><a name="l05678"></a><span class="lineno"> 5678</span>&#160;    {</div>
<div class="line"><a name="l05679"></a><span class="lineno"> 5679</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;NULL&quot;</span>;     <span class="comment">/* not found */</span></div>
<div class="line"><a name="l05680"></a><span class="lineno"> 5680</span>&#160;    }</div>
<div class="line"><a name="l05681"></a><span class="lineno"> 5681</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<a class="code" href="buffer_8h.html#a3be0c11aee0e4d7fe9e0b15235668c43">BPTR</a>(&amp;actual), <span class="stringliteral">&quot;NULL&quot;</span>))</div>
<div class="line"><a name="l05682"></a><span class="lineno"> 5682</span>&#160;    {</div>
<div class="line"><a name="l05683"></a><span class="lineno"> 5683</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="buffer_8h.html#a3be0c11aee0e4d7fe9e0b15235668c43">BPTR</a>(&amp;actual); <span class="comment">/* control panel name */</span></div>
<div class="line"><a name="l05684"></a><span class="lineno"> 5684</span>&#160;    }</div>
<div class="line"><a name="l05685"></a><span class="lineno"> 5685</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05686"></a><span class="lineno"> 5686</span>&#160;    {</div>
<div class="line"><a name="l05687"></a><span class="lineno"> 5687</span>&#160;        <span class="keywordflow">return</span> guid;       <span class="comment">/* no control panel name, return GUID instead */</span></div>
<div class="line"><a name="l05688"></a><span class="lineno"> 5688</span>&#160;    }</div>
<div class="line"><a name="l05689"></a><span class="lineno"> 5689</span>&#160;}</div>
<div class="line"><a name="l05690"></a><span class="lineno"> 5690</span>&#160; </div>
<div class="line"><a name="l05691"></a><span class="lineno"> 5691</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l05692"></a><span class="lineno"> 5692</span>&#160;<span class="comment"> * Called iteratively on TAP-Windows wait-for-initialization polling loop</span></div>
<div class="line"><a name="l05693"></a><span class="lineno"> 5693</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l05694"></a><span class="lineno"> 5694</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l05695"></a><span class="lineno"><a class="line" href="tun_8h.html#ae4aac9803755917377784cb752dcd6e0"> 5695</a></span>&#160;<a class="code" href="tun_8c.html#ae4aac9803755917377784cb752dcd6e0">tun_standby_init</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l05696"></a><span class="lineno"> 5696</span>&#160;{</div>
<div class="line"><a name="l05697"></a><span class="lineno"> 5697</span>&#160;    tt-&gt;<a class="code" href="structtuntap.html#a4a42bdeae414d636860da3fb1c68b800">standby_iter</a> = 0;</div>
<div class="line"><a name="l05698"></a><span class="lineno"> 5698</span>&#160;}</div>
<div class="line"><a name="l05699"></a><span class="lineno"> 5699</span>&#160; </div>
<div class="line"><a name="l05700"></a><span class="lineno"> 5700</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l05701"></a><span class="lineno"><a class="line" href="tun_8h.html#a8d41f70f3abefc2979af2d62ee30be6a"> 5701</a></span>&#160;<a class="code" href="tun_8c.html#a8d41f70f3abefc2979af2d62ee30be6a">tun_standby</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l05702"></a><span class="lineno"> 5702</span>&#160;{</div>
<div class="line"><a name="l05703"></a><span class="lineno"> 5703</span>&#160;    <span class="keywordtype">bool</span> ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05704"></a><span class="lineno"> 5704</span>&#160;    ++tt-&gt;<a class="code" href="structtuntap.html#a4a42bdeae414d636860da3fb1c68b800">standby_iter</a>;</div>
<div class="line"><a name="l05705"></a><span class="lineno"> 5705</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ac4735c903581ca3bb0c35dbe48b4e4dd">ip_win32_type</a> == <a class="code" href="tun_8h.html#a23ccb7500379bdc9c5944b9e02e74b5c">IPW32_SET_ADAPTIVE</a>)</div>
<div class="line"><a name="l05706"></a><span class="lineno"> 5706</span>&#160;    {</div>
<div class="line"><a name="l05707"></a><span class="lineno"> 5707</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a4a42bdeae414d636860da3fb1c68b800">standby_iter</a> == <a class="code" href="tun_8h.html#a70fbb81d58b252b61ac28785673bac06">IPW32_SET_ADAPTIVE_TRY_NETSH</a>)</div>
<div class="line"><a name="l05708"></a><span class="lineno"> 5708</span>&#160;        {</div>
<div class="line"><a name="l05709"></a><span class="lineno"> 5709</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;NOTE: now trying netsh (this may take some time)&quot;</span>);</div>
<div class="line"><a name="l05710"></a><span class="lineno"> 5710</span>&#160;            <a class="code" href="tun_8c.html#a4636ecf580e72087b1cd63dcc1375ec9">netsh_ifconfig</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>,</div>
<div class="line"><a name="l05711"></a><span class="lineno"> 5711</span>&#160;                           tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>,</div>
<div class="line"><a name="l05712"></a><span class="lineno"> 5712</span>&#160;                           tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>,</div>
<div class="line"><a name="l05713"></a><span class="lineno"> 5713</span>&#160;                           tt-&gt;<a class="code" href="structtuntap.html#a9d418d686f4369092543bcced16a39ee">adapter_netmask</a>,</div>
<div class="line"><a name="l05714"></a><span class="lineno"> 5714</span>&#160;                           <a class="code" href="tun_8c.html#a293109fe0e2259e2e4f18f7fa85f498d">NI_TEST_FIRST</a>|<a class="code" href="tun_8c.html#ae4ca7b1df4a85e25a8638afedb54b6dd">NI_IP_NETMASK</a>|<a class="code" href="tun_8c.html#a732f35a455d3cc46d0dd3d6b94239b87">NI_OPTIONS</a>);</div>
<div class="line"><a name="l05715"></a><span class="lineno"> 5715</span>&#160;        }</div>
<div class="line"><a name="l05716"></a><span class="lineno"> 5716</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a4a42bdeae414d636860da3fb1c68b800">standby_iter</a> &gt;= <a class="code" href="tun_8h.html#a70fbb81d58b252b61ac28785673bac06">IPW32_SET_ADAPTIVE_TRY_NETSH</a>*2)</div>
<div class="line"><a name="l05717"></a><span class="lineno"> 5717</span>&#160;        {</div>
<div class="line"><a name="l05718"></a><span class="lineno"> 5718</span>&#160;            ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05719"></a><span class="lineno"> 5719</span>&#160;        }</div>
<div class="line"><a name="l05720"></a><span class="lineno"> 5720</span>&#160;    }</div>
<div class="line"><a name="l05721"></a><span class="lineno"> 5721</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l05722"></a><span class="lineno"> 5722</span>&#160;}</div>
<div class="line"><a name="l05723"></a><span class="lineno"> 5723</span>&#160; </div>
<div class="line"><a name="l05724"></a><span class="lineno"> 5724</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l05725"></a><span class="lineno"> 5725</span>&#160;<span class="comment"> * Convert DHCP options from the command line / config file</span></div>
<div class="line"><a name="l05726"></a><span class="lineno"> 5726</span>&#160;<span class="comment"> * into a raw DHCP-format options string.</span></div>
<div class="line"><a name="l05727"></a><span class="lineno"> 5727</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l05728"></a><span class="lineno"> 5728</span>&#160; </div>
<div class="line"><a name="l05729"></a><span class="lineno"> 5729</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l05730"></a><span class="lineno"><a class="line" href="tun_8c.html#a458e8718bca8248f5bee910d2f714040"> 5730</a></span>&#160;<a class="code" href="tun_8c.html#a458e8718bca8248f5bee910d2f714040">write_dhcp_u8</a>(<span class="keyword">struct</span> <a class="code" href="structbuffer.html">buffer</a> *buf, <span class="keyword">const</span> <span class="keywordtype">int</span> type, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="structbuffer.html#a5d2300c691699fd563f7a1a280c2c2d6">data</a>, <span class="keywordtype">bool</span> *error)</div>
<div class="line"><a name="l05731"></a><span class="lineno"> 5731</span>&#160;{</div>
<div class="line"><a name="l05732"></a><span class="lineno"> 5732</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="buffer_8h.html#ad1d928b086002a3ea744cc0dcbe3b524">buf_safe</a>(buf, 3))</div>
<div class="line"><a name="l05733"></a><span class="lineno"> 5733</span>&#160;    {</div>
<div class="line"><a name="l05734"></a><span class="lineno"> 5734</span>&#160;        *error = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05735"></a><span class="lineno"> 5735</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;write_dhcp_u8: buffer overflow building DHCP options&quot;</span>);</div>
<div class="line"><a name="l05736"></a><span class="lineno"> 5736</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05737"></a><span class="lineno"> 5737</span>&#160;    }</div>
<div class="line"><a name="l05738"></a><span class="lineno"> 5738</span>&#160;    <a class="code" href="buffer_8h.html#a8d2e5ac5ab176c02deae6440bd89bb49">buf_write_u8</a>(buf, type);</div>
<div class="line"><a name="l05739"></a><span class="lineno"> 5739</span>&#160;    <a class="code" href="buffer_8h.html#a8d2e5ac5ab176c02deae6440bd89bb49">buf_write_u8</a>(buf, 1);</div>
<div class="line"><a name="l05740"></a><span class="lineno"> 5740</span>&#160;    <a class="code" href="buffer_8h.html#a8d2e5ac5ab176c02deae6440bd89bb49">buf_write_u8</a>(buf, <a class="code" href="structbuffer.html#a5d2300c691699fd563f7a1a280c2c2d6">data</a>);</div>
<div class="line"><a name="l05741"></a><span class="lineno"> 5741</span>&#160;}</div>
<div class="line"><a name="l05742"></a><span class="lineno"> 5742</span>&#160; </div>
<div class="line"><a name="l05743"></a><span class="lineno"> 5743</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l05744"></a><span class="lineno"><a class="line" href="tun_8c.html#abee93e70e0d1c09bd532b699ba926fd2"> 5744</a></span>&#160;<a class="code" href="tun_8c.html#abee93e70e0d1c09bd532b699ba926fd2">write_dhcp_u32_array</a>(<span class="keyword">struct</span> <a class="code" href="structbuffer.html">buffer</a> *buf, <span class="keyword">const</span> <span class="keywordtype">int</span> type, <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> *<a class="code" href="structbuffer.html#a5d2300c691699fd563f7a1a280c2c2d6">data</a>, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>, <span class="keywordtype">bool</span> *error)</div>
<div class="line"><a name="l05745"></a><span class="lineno"> 5745</span>&#160;{</div>
<div class="line"><a name="l05746"></a><span class="lineno"> 5746</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a> &gt; 0)</div>
<div class="line"><a name="l05747"></a><span class="lineno"> 5747</span>&#160;    {</div>
<div class="line"><a name="l05748"></a><span class="lineno"> 5748</span>&#160;        <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l05749"></a><span class="lineno"> 5749</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> size = <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a> * <span class="keyword">sizeof</span>(<a class="code" href="config-msvc_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a>);</div>
<div class="line"><a name="l05750"></a><span class="lineno"> 5750</span>&#160; </div>
<div class="line"><a name="l05751"></a><span class="lineno"> 5751</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="buffer_8h.html#ad1d928b086002a3ea744cc0dcbe3b524">buf_safe</a>(buf, 2 + size))</div>
<div class="line"><a name="l05752"></a><span class="lineno"> 5752</span>&#160;        {</div>
<div class="line"><a name="l05753"></a><span class="lineno"> 5753</span>&#160;            *error = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05754"></a><span class="lineno"> 5754</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;write_dhcp_u32_array: buffer overflow building DHCP options&quot;</span>);</div>
<div class="line"><a name="l05755"></a><span class="lineno"> 5755</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05756"></a><span class="lineno"> 5756</span>&#160;        }</div>
<div class="line"><a name="l05757"></a><span class="lineno"> 5757</span>&#160;        <span class="keywordflow">if</span> (size &lt; 1 || size &gt; 255)</div>
<div class="line"><a name="l05758"></a><span class="lineno"> 5758</span>&#160;        {</div>
<div class="line"><a name="l05759"></a><span class="lineno"> 5759</span>&#160;            *error = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05760"></a><span class="lineno"> 5760</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;write_dhcp_u32_array: size (%d) must be &gt; 0 and &lt;= 255&quot;</span>, size);</div>
<div class="line"><a name="l05761"></a><span class="lineno"> 5761</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05762"></a><span class="lineno"> 5762</span>&#160;        }</div>
<div class="line"><a name="l05763"></a><span class="lineno"> 5763</span>&#160;        <a class="code" href="buffer_8h.html#a8d2e5ac5ab176c02deae6440bd89bb49">buf_write_u8</a>(buf, type);</div>
<div class="line"><a name="l05764"></a><span class="lineno"> 5764</span>&#160;        <a class="code" href="buffer_8h.html#a8d2e5ac5ab176c02deae6440bd89bb49">buf_write_u8</a>(buf, size);</div>
<div class="line"><a name="l05765"></a><span class="lineno"> 5765</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>; ++i)</div>
<div class="line"><a name="l05766"></a><span class="lineno"> 5766</span>&#160;        {</div>
<div class="line"><a name="l05767"></a><span class="lineno"> 5767</span>&#160;            <a class="code" href="buffer_8h.html#ad1033b5ae87e5c0b5ffe402ac6ef1b1d">buf_write_u32</a>(buf, <a class="code" href="structbuffer.html#a5d2300c691699fd563f7a1a280c2c2d6">data</a>[i]);</div>
<div class="line"><a name="l05768"></a><span class="lineno"> 5768</span>&#160;        }</div>
<div class="line"><a name="l05769"></a><span class="lineno"> 5769</span>&#160;    }</div>
<div class="line"><a name="l05770"></a><span class="lineno"> 5770</span>&#160;}</div>
<div class="line"><a name="l05771"></a><span class="lineno"> 5771</span>&#160; </div>
<div class="line"><a name="l05772"></a><span class="lineno"> 5772</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l05773"></a><span class="lineno"><a class="line" href="tun_8c.html#a9ed37827909cba4c086efb61bc50300f"> 5773</a></span>&#160;<a class="code" href="tun_8c.html#a9ed37827909cba4c086efb61bc50300f">write_dhcp_str</a>(<span class="keyword">struct</span> <a class="code" href="structbuffer.html">buffer</a> *buf, <span class="keyword">const</span> <span class="keywordtype">int</span> type, <span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">bool</span> *error)</div>
<div class="line"><a name="l05774"></a><span class="lineno"> 5774</span>&#160;{</div>
<div class="line"><a name="l05775"></a><span class="lineno"> 5775</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a> = strlen(str);</div>
<div class="line"><a name="l05776"></a><span class="lineno"> 5776</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="buffer_8h.html#ad1d928b086002a3ea744cc0dcbe3b524">buf_safe</a>(buf, 2 + <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>))</div>
<div class="line"><a name="l05777"></a><span class="lineno"> 5777</span>&#160;    {</div>
<div class="line"><a name="l05778"></a><span class="lineno"> 5778</span>&#160;        *error = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05779"></a><span class="lineno"> 5779</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;write_dhcp_str: buffer overflow building DHCP options&quot;</span>);</div>
<div class="line"><a name="l05780"></a><span class="lineno"> 5780</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05781"></a><span class="lineno"> 5781</span>&#160;    }</div>
<div class="line"><a name="l05782"></a><span class="lineno"> 5782</span>&#160;    <span class="keywordflow">if</span> (len &lt; 1 || len &gt; 255)</div>
<div class="line"><a name="l05783"></a><span class="lineno"> 5783</span>&#160;    {</div>
<div class="line"><a name="l05784"></a><span class="lineno"> 5784</span>&#160;        *error = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05785"></a><span class="lineno"> 5785</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;write_dhcp_str: string &#39;%s&#39; must be &gt; 0 bytes and &lt;= 255 bytes&quot;</span>, str);</div>
<div class="line"><a name="l05786"></a><span class="lineno"> 5786</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05787"></a><span class="lineno"> 5787</span>&#160;    }</div>
<div class="line"><a name="l05788"></a><span class="lineno"> 5788</span>&#160;    <a class="code" href="buffer_8h.html#a8d2e5ac5ab176c02deae6440bd89bb49">buf_write_u8</a>(buf, type);</div>
<div class="line"><a name="l05789"></a><span class="lineno"> 5789</span>&#160;    <a class="code" href="buffer_8h.html#a8d2e5ac5ab176c02deae6440bd89bb49">buf_write_u8</a>(buf, <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>);</div>
<div class="line"><a name="l05790"></a><span class="lineno"> 5790</span>&#160;    <a class="code" href="buffer_8h.html#abcd04f5c1caaf855ccf7c947af21b6a6">buf_write</a>(buf, str, <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>);</div>
<div class="line"><a name="l05791"></a><span class="lineno"> 5791</span>&#160;}</div>
<div class="line"><a name="l05792"></a><span class="lineno"> 5792</span>&#160; </div>
<div class="line"><a name="l05793"></a><span class="lineno"> 5793</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l05794"></a><span class="lineno"> 5794</span>&#160;<span class="comment"> * RFC3397 states that multiple searchdomains are encoded as follows:</span></div>
<div class="line"><a name="l05795"></a><span class="lineno"> 5795</span>&#160;<span class="comment"> *  - at start the length of the entire option is given</span></div>
<div class="line"><a name="l05796"></a><span class="lineno"> 5796</span>&#160;<span class="comment"> *  - each subdomain is preceded by its length</span></div>
<div class="line"><a name="l05797"></a><span class="lineno"> 5797</span>&#160;<span class="comment"> *  - each searchdomain is separated by a NUL character</span></div>
<div class="line"><a name="l05798"></a><span class="lineno"> 5798</span>&#160;<span class="comment"> * e.g. if you want &quot;openvpn.net&quot; and &quot;duckduckgo.com&quot; then you end up with</span></div>
<div class="line"><a name="l05799"></a><span class="lineno"> 5799</span>&#160;<span class="comment"> *  0x1D  0x7 openvpn 0x3 net 0x00 0x0A duckduckgo 0x3 com 0x00</span></div>
<div class="line"><a name="l05800"></a><span class="lineno"> 5800</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l05801"></a><span class="lineno"> 5801</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l05802"></a><span class="lineno"><a class="line" href="tun_8c.html#a907c6286a54473bf98ccd1d8d3dd76b3"> 5802</a></span>&#160;<a class="code" href="tun_8c.html#a907c6286a54473bf98ccd1d8d3dd76b3">write_dhcp_search_str</a>(<span class="keyword">struct</span> <a class="code" href="structbuffer.html">buffer</a> *buf, <span class="keyword">const</span> <span class="keywordtype">int</span> type, <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> *str_array,</div>
<div class="line"><a name="l05803"></a><span class="lineno"> 5803</span>&#160;                      <span class="keywordtype">int</span> array_len, <span class="keywordtype">bool</span> *error)</div>
<div class="line"><a name="l05804"></a><span class="lineno"> 5804</span>&#160;{</div>
<div class="line"><a name="l05805"></a><span class="lineno"> 5805</span>&#160;    <span class="keywordtype">char</span>         tmp_buf[256];</div>
<div class="line"><a name="l05806"></a><span class="lineno"> 5806</span>&#160;    <span class="keywordtype">int</span>          i;</div>
<div class="line"><a name="l05807"></a><span class="lineno"> 5807</span>&#160;    <span class="keywordtype">int</span>          <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a> = 0;</div>
<div class="line"><a name="l05808"></a><span class="lineno"> 5808</span>&#160;    <span class="keywordtype">int</span>          label_length_pos;</div>
<div class="line"><a name="l05809"></a><span class="lineno"> 5809</span>&#160; </div>
<div class="line"><a name="l05810"></a><span class="lineno"> 5810</span>&#160;    <span class="keywordflow">for</span> (i=0; i &lt; array_len; i++)</div>
<div class="line"><a name="l05811"></a><span class="lineno"> 5811</span>&#160;    {</div>
<div class="line"><a name="l05812"></a><span class="lineno"> 5812</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span>  *ptr = str_array[i];</div>
<div class="line"><a name="l05813"></a><span class="lineno"> 5813</span>&#160; </div>
<div class="line"><a name="l05814"></a><span class="lineno"> 5814</span>&#160;        <span class="keywordflow">if</span> (strlen(ptr) + <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a> + 1 &gt; <span class="keyword">sizeof</span>(tmp_buf))</div>
<div class="line"><a name="l05815"></a><span class="lineno"> 5815</span>&#160;        {</div>
<div class="line"><a name="l05816"></a><span class="lineno"> 5816</span>&#160;            *error = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05817"></a><span class="lineno"> 5817</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;write_dhcp_search_str: temp buffer overflow building DHCP options&quot;</span>);</div>
<div class="line"><a name="l05818"></a><span class="lineno"> 5818</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05819"></a><span class="lineno"> 5819</span>&#160;        }</div>
<div class="line"><a name="l05820"></a><span class="lineno"> 5820</span>&#160;        <span class="comment">/* Loop over all subdomains separated by a dot and replace the dot</span></div>
<div class="line"><a name="l05821"></a><span class="lineno"> 5821</span>&#160;<span class="comment">           with the length of the subdomain */</span></div>
<div class="line"><a name="l05822"></a><span class="lineno"> 5822</span>&#160; </div>
<div class="line"><a name="l05823"></a><span class="lineno"> 5823</span>&#160;        <span class="comment">/* label_length_pos points to the byte to be replaced by the length</span></div>
<div class="line"><a name="l05824"></a><span class="lineno"> 5824</span>&#160;<span class="comment">         * of the following domain label */</span></div>
<div class="line"><a name="l05825"></a><span class="lineno"> 5825</span>&#160;        label_length_pos = <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>++;</div>
<div class="line"><a name="l05826"></a><span class="lineno"> 5826</span>&#160; </div>
<div class="line"><a name="l05827"></a><span class="lineno"> 5827</span>&#160;        <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a name="l05828"></a><span class="lineno"> 5828</span>&#160;        {</div>
<div class="line"><a name="l05829"></a><span class="lineno"> 5829</span>&#160;            <span class="keywordflow">if</span> (*ptr == <span class="charliteral">&#39;.&#39;</span> || *ptr == <span class="charliteral">&#39;\0&#39;</span> )</div>
<div class="line"><a name="l05830"></a><span class="lineno"> 5830</span>&#160;            {</div>
<div class="line"><a name="l05831"></a><span class="lineno"> 5831</span>&#160;                tmp_buf[label_length_pos] = (<a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>-label_length_pos)-1;</div>
<div class="line"><a name="l05832"></a><span class="lineno"> 5832</span>&#160;                label_length_pos = <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>;</div>
<div class="line"><a name="l05833"></a><span class="lineno"> 5833</span>&#160;                <span class="keywordflow">if</span> (*ptr == <span class="charliteral">&#39;\0&#39;</span>)</div>
<div class="line"><a name="l05834"></a><span class="lineno"> 5834</span>&#160;                {</div>
<div class="line"><a name="l05835"></a><span class="lineno"> 5835</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l05836"></a><span class="lineno"> 5836</span>&#160;                }</div>
<div class="line"><a name="l05837"></a><span class="lineno"> 5837</span>&#160;            }</div>
<div class="line"><a name="l05838"></a><span class="lineno"> 5838</span>&#160;            tmp_buf[<a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>++] = *ptr++;</div>
<div class="line"><a name="l05839"></a><span class="lineno"> 5839</span>&#160;        }</div>
<div class="line"><a name="l05840"></a><span class="lineno"> 5840</span>&#160;        <span class="comment">/* And close off with an extra NUL char */</span></div>
<div class="line"><a name="l05841"></a><span class="lineno"> 5841</span>&#160;        tmp_buf[<a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>++] = 0;</div>
<div class="line"><a name="l05842"></a><span class="lineno"> 5842</span>&#160;    }</div>
<div class="line"><a name="l05843"></a><span class="lineno"> 5843</span>&#160; </div>
<div class="line"><a name="l05844"></a><span class="lineno"> 5844</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="buffer_8h.html#ad1d928b086002a3ea744cc0dcbe3b524">buf_safe</a>(buf, 2 + <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>))</div>
<div class="line"><a name="l05845"></a><span class="lineno"> 5845</span>&#160;    {</div>
<div class="line"><a name="l05846"></a><span class="lineno"> 5846</span>&#160;        *error = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05847"></a><span class="lineno"> 5847</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;write_search_dhcp_str: buffer overflow building DHCP options&quot;</span>);</div>
<div class="line"><a name="l05848"></a><span class="lineno"> 5848</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05849"></a><span class="lineno"> 5849</span>&#160;    }</div>
<div class="line"><a name="l05850"></a><span class="lineno"> 5850</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a> &gt; 255)</div>
<div class="line"><a name="l05851"></a><span class="lineno"> 5851</span>&#160;    {</div>
<div class="line"><a name="l05852"></a><span class="lineno"> 5852</span>&#160;        *error = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05853"></a><span class="lineno"> 5853</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;write_dhcp_search_str: search domain string must be &lt;= 255 bytes&quot;</span>);</div>
<div class="line"><a name="l05854"></a><span class="lineno"> 5854</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05855"></a><span class="lineno"> 5855</span>&#160;    }</div>
<div class="line"><a name="l05856"></a><span class="lineno"> 5856</span>&#160; </div>
<div class="line"><a name="l05857"></a><span class="lineno"> 5857</span>&#160;    <a class="code" href="buffer_8h.html#a8d2e5ac5ab176c02deae6440bd89bb49">buf_write_u8</a>(buf, type);</div>
<div class="line"><a name="l05858"></a><span class="lineno"> 5858</span>&#160;    <a class="code" href="buffer_8h.html#a8d2e5ac5ab176c02deae6440bd89bb49">buf_write_u8</a>(buf, <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>);</div>
<div class="line"><a name="l05859"></a><span class="lineno"> 5859</span>&#160;    <a class="code" href="buffer_8h.html#abcd04f5c1caaf855ccf7c947af21b6a6">buf_write</a>(buf, tmp_buf, <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>);</div>
<div class="line"><a name="l05860"></a><span class="lineno"> 5860</span>&#160;}</div>
<div class="line"><a name="l05861"></a><span class="lineno"> 5861</span>&#160; </div>
<div class="line"><a name="l05862"></a><span class="lineno"> 5862</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l05863"></a><span class="lineno"><a class="line" href="tun_8c.html#a59d50384819dbbc49ddd0e8cf561c90b"> 5863</a></span>&#160;<a class="code" href="tun_8c.html#a59d50384819dbbc49ddd0e8cf561c90b">build_dhcp_options_string</a>(<span class="keyword">struct</span> <a class="code" href="structbuffer.html">buffer</a> *buf, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap__options.html">tuntap_options</a> *o)</div>
<div class="line"><a name="l05864"></a><span class="lineno"> 5864</span>&#160;{</div>
<div class="line"><a name="l05865"></a><span class="lineno"> 5865</span>&#160;    <span class="keywordtype">bool</span> error = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05866"></a><span class="lineno"> 5866</span>&#160;    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structtuntap__options.html#a79c23140e69d2545d30656f315a20665">domain</a>)</div>
<div class="line"><a name="l05867"></a><span class="lineno"> 5867</span>&#160;    {</div>
<div class="line"><a name="l05868"></a><span class="lineno"> 5868</span>&#160;        <a class="code" href="tun_8c.html#a9ed37827909cba4c086efb61bc50300f">write_dhcp_str</a>(buf, 15, o-&gt;<a class="code" href="structtuntap__options.html#a79c23140e69d2545d30656f315a20665">domain</a>, &amp;error);</div>
<div class="line"><a name="l05869"></a><span class="lineno"> 5869</span>&#160;    }</div>
<div class="line"><a name="l05870"></a><span class="lineno"> 5870</span>&#160; </div>
<div class="line"><a name="l05871"></a><span class="lineno"> 5871</span>&#160;    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structtuntap__options.html#a60da47cffc1393d9f16ddefe6f824a99">netbios_scope</a>)</div>
<div class="line"><a name="l05872"></a><span class="lineno"> 5872</span>&#160;    {</div>
<div class="line"><a name="l05873"></a><span class="lineno"> 5873</span>&#160;        <a class="code" href="tun_8c.html#a9ed37827909cba4c086efb61bc50300f">write_dhcp_str</a>(buf, 47, o-&gt;<a class="code" href="structtuntap__options.html#a60da47cffc1393d9f16ddefe6f824a99">netbios_scope</a>, &amp;error);</div>
<div class="line"><a name="l05874"></a><span class="lineno"> 5874</span>&#160;    }</div>
<div class="line"><a name="l05875"></a><span class="lineno"> 5875</span>&#160; </div>
<div class="line"><a name="l05876"></a><span class="lineno"> 5876</span>&#160;    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structtuntap__options.html#abeee0fcef71945ad2f37662eb02d4969">netbios_node_type</a>)</div>
<div class="line"><a name="l05877"></a><span class="lineno"> 5877</span>&#160;    {</div>
<div class="line"><a name="l05878"></a><span class="lineno"> 5878</span>&#160;        <a class="code" href="tun_8c.html#a458e8718bca8248f5bee910d2f714040">write_dhcp_u8</a>(buf, 46, o-&gt;<a class="code" href="structtuntap__options.html#abeee0fcef71945ad2f37662eb02d4969">netbios_node_type</a>, &amp;error);</div>
<div class="line"><a name="l05879"></a><span class="lineno"> 5879</span>&#160;    }</div>
<div class="line"><a name="l05880"></a><span class="lineno"> 5880</span>&#160; </div>
<div class="line"><a name="l05881"></a><span class="lineno"> 5881</span>&#160;    <a class="code" href="tun_8c.html#abee93e70e0d1c09bd532b699ba926fd2">write_dhcp_u32_array</a>(buf, 6, (<a class="code" href="config-msvc_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> *)o-&gt;<a class="code" href="structtuntap__options.html#a5c59bd51c39835c98556b124f30611b6">dns</a>, o-&gt;<a class="code" href="structtuntap__options.html#a143af129775b5984fa835d5c0026e75c">dns_len</a>, &amp;error);</div>
<div class="line"><a name="l05882"></a><span class="lineno"> 5882</span>&#160;    <a class="code" href="tun_8c.html#abee93e70e0d1c09bd532b699ba926fd2">write_dhcp_u32_array</a>(buf, 44, (<a class="code" href="config-msvc_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> *)o-&gt;<a class="code" href="structtuntap__options.html#a30def869016af7778723a529b548e820">wins</a>, o-&gt;<a class="code" href="structtuntap__options.html#a033f8e542a5ad3c4680d4203687d8bea">wins_len</a>, &amp;error);</div>
<div class="line"><a name="l05883"></a><span class="lineno"> 5883</span>&#160;    <a class="code" href="tun_8c.html#abee93e70e0d1c09bd532b699ba926fd2">write_dhcp_u32_array</a>(buf, 42, (<a class="code" href="config-msvc_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> *)o-&gt;<a class="code" href="structtuntap__options.html#a238bfd6672b50c43d1188249b9f65562">ntp</a>, o-&gt;<a class="code" href="structtuntap__options.html#a26be5effd8b34caa515f65cfba6c89c0">ntp_len</a>, &amp;error);</div>
<div class="line"><a name="l05884"></a><span class="lineno"> 5884</span>&#160;    <a class="code" href="tun_8c.html#abee93e70e0d1c09bd532b699ba926fd2">write_dhcp_u32_array</a>(buf, 45, (<a class="code" href="config-msvc_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> *)o-&gt;<a class="code" href="structtuntap__options.html#a122a1b09c383eb9c2bc529ce6de8efb9">nbdd</a>, o-&gt;<a class="code" href="structtuntap__options.html#a675199fe697d18adf762946e339c0a33">nbdd_len</a>, &amp;error);</div>
<div class="line"><a name="l05885"></a><span class="lineno"> 5885</span>&#160; </div>
<div class="line"><a name="l05886"></a><span class="lineno"> 5886</span>&#160;    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structtuntap__options.html#a7b1359366bca57d18e27a1bf16883406">domain_search_list_len</a> &gt; 0)</div>
<div class="line"><a name="l05887"></a><span class="lineno"> 5887</span>&#160;    {</div>
<div class="line"><a name="l05888"></a><span class="lineno"> 5888</span>&#160;        <a class="code" href="tun_8c.html#a907c6286a54473bf98ccd1d8d3dd76b3">write_dhcp_search_str</a>(buf, 119, o-&gt;<a class="code" href="structtuntap__options.html#a859f5bd9cb58522aa693930769e412bb">domain_search_list</a>,</div>
<div class="line"><a name="l05889"></a><span class="lineno"> 5889</span>&#160;                                        o-&gt;<a class="code" href="structtuntap__options.html#a7b1359366bca57d18e27a1bf16883406">domain_search_list_len</a>,</div>
<div class="line"><a name="l05890"></a><span class="lineno"> 5890</span>&#160;                                       &amp;error);</div>
<div class="line"><a name="l05891"></a><span class="lineno"> 5891</span>&#160;    }</div>
<div class="line"><a name="l05892"></a><span class="lineno"> 5892</span>&#160; </div>
<div class="line"><a name="l05893"></a><span class="lineno"> 5893</span>&#160;    <span class="comment">/* the MS DHCP server option &#39;Disable Netbios-over-TCP/IP</span></div>
<div class="line"><a name="l05894"></a><span class="lineno"> 5894</span>&#160;<span class="comment">     * is implemented as vendor option 001, value 002.</span></div>
<div class="line"><a name="l05895"></a><span class="lineno"> 5895</span>&#160;<span class="comment">     * A value of 001 means &#39;leave NBT alone&#39; which is the default */</span></div>
<div class="line"><a name="l05896"></a><span class="lineno"> 5896</span>&#160;    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structtuntap__options.html#aeb319652b0e05153abcce77b568aedf1">disable_nbt</a>)</div>
<div class="line"><a name="l05897"></a><span class="lineno"> 5897</span>&#160;    {</div>
<div class="line"><a name="l05898"></a><span class="lineno"> 5898</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="buffer_8h.html#ad1d928b086002a3ea744cc0dcbe3b524">buf_safe</a>(buf, 8))</div>
<div class="line"><a name="l05899"></a><span class="lineno"> 5899</span>&#160;        {</div>
<div class="line"><a name="l05900"></a><span class="lineno"> 5900</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;build_dhcp_options_string: buffer overflow building DHCP options&quot;</span>);</div>
<div class="line"><a name="l05901"></a><span class="lineno"> 5901</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05902"></a><span class="lineno"> 5902</span>&#160;        }</div>
<div class="line"><a name="l05903"></a><span class="lineno"> 5903</span>&#160;        <a class="code" href="buffer_8h.html#a8d2e5ac5ab176c02deae6440bd89bb49">buf_write_u8</a>(buf,  43);</div>
<div class="line"><a name="l05904"></a><span class="lineno"> 5904</span>&#160;        <a class="code" href="buffer_8h.html#a8d2e5ac5ab176c02deae6440bd89bb49">buf_write_u8</a>(buf,  6);<span class="comment">/* total length field */</span></div>
<div class="line"><a name="l05905"></a><span class="lineno"> 5905</span>&#160;        <a class="code" href="buffer_8h.html#a8d2e5ac5ab176c02deae6440bd89bb49">buf_write_u8</a>(buf,  0x001);</div>
<div class="line"><a name="l05906"></a><span class="lineno"> 5906</span>&#160;        <a class="code" href="buffer_8h.html#a8d2e5ac5ab176c02deae6440bd89bb49">buf_write_u8</a>(buf,  4);<span class="comment">/* length of the vendor specified field */</span></div>
<div class="line"><a name="l05907"></a><span class="lineno"> 5907</span>&#160;        <a class="code" href="buffer_8h.html#ad1033b5ae87e5c0b5ffe402ac6ef1b1d">buf_write_u32</a>(buf, 0x002);</div>
<div class="line"><a name="l05908"></a><span class="lineno"> 5908</span>&#160;    }</div>
<div class="line"><a name="l05909"></a><span class="lineno"> 5909</span>&#160;    <span class="keywordflow">return</span> !error;</div>
<div class="line"><a name="l05910"></a><span class="lineno"> 5910</span>&#160;}</div>
<div class="line"><a name="l05911"></a><span class="lineno"> 5911</span>&#160; </div>
<div class="line"><a name="l05912"></a><span class="lineno"> 5912</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l05913"></a><span class="lineno"><a class="line" href="tun_8c.html#a4b412ed4d7fe20229984758b0debde74"> 5913</a></span>&#160;<a class="code" href="tun_8c.html#a4b412ed4d7fe20229984758b0debde74">fork_dhcp_action</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l05914"></a><span class="lineno"> 5914</span>&#160;{</div>
<div class="line"><a name="l05915"></a><span class="lineno"> 5915</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ae31925735e2ef3b040695acf59feb737">dhcp_pre_release</a> || tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a82e60f4c2f209966b8867f60e49d975f">dhcp_renew</a>)</div>
<div class="line"><a name="l05916"></a><span class="lineno"> 5916</span>&#160;    {</div>
<div class="line"><a name="l05917"></a><span class="lineno"> 5917</span>&#160;        <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l05918"></a><span class="lineno"> 5918</span>&#160;        <span class="keyword">struct </span><a class="code" href="structbuffer.html">buffer</a> cmd = <a class="code" href="buffer_8c.html#aa35bf7feb6a99bf5d364b2d4eba1195c">alloc_buf_gc</a>(256, &amp;gc);</div>
<div class="line"><a name="l05919"></a><span class="lineno"> 5919</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> verb = 3;</div>
<div class="line"><a name="l05920"></a><span class="lineno"> 5920</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> pre_sleep = 1;</div>
<div class="line"><a name="l05921"></a><span class="lineno"> 5921</span>&#160; </div>
<div class="line"><a name="l05922"></a><span class="lineno"> 5922</span>&#160;        <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;cmd, <span class="stringliteral">&quot;openvpn --verb %d --tap-sleep %d&quot;</span>, verb, pre_sleep);</div>
<div class="line"><a name="l05923"></a><span class="lineno"> 5923</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ae31925735e2ef3b040695acf59feb737">dhcp_pre_release</a>)</div>
<div class="line"><a name="l05924"></a><span class="lineno"> 5924</span>&#160;        {</div>
<div class="line"><a name="l05925"></a><span class="lineno"> 5925</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;cmd, <span class="stringliteral">&quot; --dhcp-pre-release&quot;</span>);</div>
<div class="line"><a name="l05926"></a><span class="lineno"> 5926</span>&#160;        }</div>
<div class="line"><a name="l05927"></a><span class="lineno"> 5927</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a82e60f4c2f209966b8867f60e49d975f">dhcp_renew</a>)</div>
<div class="line"><a name="l05928"></a><span class="lineno"> 5928</span>&#160;        {</div>
<div class="line"><a name="l05929"></a><span class="lineno"> 5929</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;cmd, <span class="stringliteral">&quot; --dhcp-renew&quot;</span>);</div>
<div class="line"><a name="l05930"></a><span class="lineno"> 5930</span>&#160;        }</div>
<div class="line"><a name="l05931"></a><span class="lineno"> 5931</span>&#160;        <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;cmd, <span class="stringliteral">&quot; --dhcp-internal %lu&quot;</span>, tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>);</div>
<div class="line"><a name="l05932"></a><span class="lineno"> 5932</span>&#160; </div>
<div class="line"><a name="l05933"></a><span class="lineno"> 5933</span>&#160;        <a class="code" href="win32_8c.html#a6bb04e9d47205ae4a7dcc6a8c9e0a15a">fork_to_self</a>(<a class="code" href="buffer_8h.html#a34c800967d7b9583cb64236eadab94dd">BSTR</a>(&amp;cmd));</div>
<div class="line"><a name="l05934"></a><span class="lineno"> 5934</span>&#160;        <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l05935"></a><span class="lineno"> 5935</span>&#160;    }</div>
<div class="line"><a name="l05936"></a><span class="lineno"> 5936</span>&#160;}</div>
<div class="line"><a name="l05937"></a><span class="lineno"> 5937</span>&#160; </div>
<div class="line"><a name="l05938"></a><span class="lineno"> 5938</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l05939"></a><span class="lineno"><a class="line" href="tun_8c.html#a7ef34c7c71984540f3b6122fcc743f5a"> 5939</a></span>&#160;<a class="code" href="tun_8c.html#a7ef34c7c71984540f3b6122fcc743f5a">register_dns_service</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l05940"></a><span class="lineno"> 5940</span>&#160;{</div>
<div class="line"><a name="l05941"></a><span class="lineno"> 5941</span>&#160;    HANDLE msg_channel = tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">msg_channel</a>;</div>
<div class="line"><a name="l05942"></a><span class="lineno"> 5942</span>&#160;    <a class="code" href="structack__message__t.html">ack_message_t</a> ack;</div>
<div class="line"><a name="l05943"></a><span class="lineno"> 5943</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l05944"></a><span class="lineno"> 5944</span>&#160; </div>
<div class="line"><a name="l05945"></a><span class="lineno"> 5945</span>&#160;    <a class="code" href="structmessage__header__t.html">message_header_t</a> rdns = { <a class="code" href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557cab6894e32e7a6da416509e997ef0c1ebd">msg_register_dns</a>, <span class="keyword">sizeof</span>(<a class="code" href="structmessage__header__t.html">message_header_t</a>), 0 };</div>
<div class="line"><a name="l05946"></a><span class="lineno"> 5946</span>&#160; </div>
<div class="line"><a name="l05947"></a><span class="lineno"> 5947</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="win32_8c.html#a7c43018c3610f281fbcd28c092d29619">send_msg_iservice</a>(msg_channel, &amp;rdns, <span class="keyword">sizeof</span>(rdns), &amp;ack, <span class="stringliteral">&quot;Register_dns&quot;</span>))</div>
<div class="line"><a name="l05948"></a><span class="lineno"> 5948</span>&#160;    {</div>
<div class="line"><a name="l05949"></a><span class="lineno"> 5949</span>&#160;        <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l05950"></a><span class="lineno"> 5950</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05951"></a><span class="lineno"> 5951</span>&#160;    }</div>
<div class="line"><a name="l05952"></a><span class="lineno"> 5952</span>&#160; </div>
<div class="line"><a name="l05953"></a><span class="lineno"> 5953</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a> != NO_ERROR)</div>
<div class="line"><a name="l05954"></a><span class="lineno"> 5954</span>&#160;    {</div>
<div class="line"><a name="l05955"></a><span class="lineno"> 5955</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;Register_dns failed using service: %s [status=0x%x]&quot;</span>,</div>
<div class="line"><a name="l05956"></a><span class="lineno"> 5956</span>&#160;            <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a>, &amp;gc), ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a>);</div>
<div class="line"><a name="l05957"></a><span class="lineno"> 5957</span>&#160;    }</div>
<div class="line"><a name="l05958"></a><span class="lineno"> 5958</span>&#160; </div>
<div class="line"><a name="l05959"></a><span class="lineno"> 5959</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05960"></a><span class="lineno"> 5960</span>&#160;    {</div>
<div class="line"><a name="l05961"></a><span class="lineno"> 5961</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;Register_dns request sent to the service&quot;</span>);</div>
<div class="line"><a name="l05962"></a><span class="lineno"> 5962</span>&#160;    }</div>
<div class="line"><a name="l05963"></a><span class="lineno"> 5963</span>&#160; </div>
<div class="line"><a name="l05964"></a><span class="lineno"> 5964</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l05965"></a><span class="lineno"> 5965</span>&#160;}</div>
<div class="line"><a name="l05966"></a><span class="lineno"> 5966</span>&#160; </div>
<div class="line"><a name="l05967"></a><span class="lineno"> 5967</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l05968"></a><span class="lineno"><a class="line" href="tun_8c.html#aeccf147b82b28465ee451a79fc267a29"> 5968</a></span>&#160;<a class="code" href="tun_8c.html#aeccf147b82b28465ee451a79fc267a29">service_register_ring_buffers</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l05969"></a><span class="lineno"> 5969</span>&#160;{</div>
<div class="line"><a name="l05970"></a><span class="lineno"> 5970</span>&#160;    HANDLE msg_channel = tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">msg_channel</a>;</div>
<div class="line"><a name="l05971"></a><span class="lineno"> 5971</span>&#160;    <a class="code" href="structack__message__t.html">ack_message_t</a> ack;</div>
<div class="line"><a name="l05972"></a><span class="lineno"> 5972</span>&#160;    <span class="keywordtype">bool</span> ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05973"></a><span class="lineno"> 5973</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l05974"></a><span class="lineno"> 5974</span>&#160; </div>
<div class="line"><a name="l05975"></a><span class="lineno"> 5975</span>&#160;    <a class="code" href="structregister__ring__buffers__message__t.html">register_ring_buffers_message_t</a> <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a> = {</div>
<div class="line"><a name="l05976"></a><span class="lineno"> 5976</span>&#160;        .header = {</div>
<div class="line"><a name="l05977"></a><span class="lineno"> 5977</span>&#160;            <a class="code" href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557ca3040fb7d7b8355b9cfc2ea0c07b44233">msg_register_ring_buffers</a>,</div>
<div class="line"><a name="l05978"></a><span class="lineno"> 5978</span>&#160;            <span class="keyword">sizeof</span>(<a class="code" href="structregister__ring__buffers__message__t.html">register_ring_buffers_message_t</a>),</div>
<div class="line"><a name="l05979"></a><span class="lineno"> 5979</span>&#160;            0</div>
<div class="line"><a name="l05980"></a><span class="lineno"> 5980</span>&#160;        },</div>
<div class="line"><a name="l05981"></a><span class="lineno"> 5981</span>&#160;        .device = tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a>,</div>
<div class="line"><a name="l05982"></a><span class="lineno"> 5982</span>&#160;        .send_ring_handle = tt-&gt;<a class="code" href="structtuntap.html#abad5f3a4193f4e244d55ffd2fa41b7f0">wintun_send_ring_handle</a>,</div>
<div class="line"><a name="l05983"></a><span class="lineno"> 5983</span>&#160;        .receive_ring_handle = tt-&gt;<a class="code" href="structtuntap.html#a55841b7764fd4d6945e38c8d7594c7b5">wintun_receive_ring_handle</a>,</div>
<div class="line"><a name="l05984"></a><span class="lineno"> 5984</span>&#160;        .send_tail_moved = tt-&gt;<a class="code" href="structtuntap.html#a4e17e7776e70f2df81236da3bcecccaa">rw_handle</a>.<a class="code" href="structrw__handle.html#a81c9d90f164f2f82f13b43193d7e690b">read</a>,</div>
<div class="line"><a name="l05985"></a><span class="lineno"> 5985</span>&#160;        .receive_tail_moved = tt-&gt;<a class="code" href="structtuntap.html#a4e17e7776e70f2df81236da3bcecccaa">rw_handle</a>.<a class="code" href="structrw__handle.html#a0dae71c0cfb6646063148367ed15f4d1">write</a></div>
<div class="line"><a name="l05986"></a><span class="lineno"> 5986</span>&#160;    };</div>
<div class="line"><a name="l05987"></a><span class="lineno"> 5987</span>&#160; </div>
<div class="line"><a name="l05988"></a><span class="lineno"> 5988</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="win32_8c.html#a7c43018c3610f281fbcd28c092d29619">send_msg_iservice</a>(msg_channel, &amp;<a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>, <span class="keyword">sizeof</span>(<a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>), &amp;ack, <span class="stringliteral">&quot;Register ring buffers&quot;</span>))</div>
<div class="line"><a name="l05989"></a><span class="lineno"> 5989</span>&#160;    {</div>
<div class="line"><a name="l05990"></a><span class="lineno"> 5990</span>&#160;        ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05991"></a><span class="lineno"> 5991</span>&#160;    }</div>
<div class="line"><a name="l05992"></a><span class="lineno"> 5992</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a> != NO_ERROR)</div>
<div class="line"><a name="l05993"></a><span class="lineno"> 5993</span>&#160;    {</div>
<div class="line"><a name="l05994"></a><span class="lineno"> 5994</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a9e1c690bc419010e6e8346d28a237941">M_NONFATAL</a>, <span class="stringliteral">&quot;Register ring buffers failed using service: %s [status=0x%x]&quot;</span>,</div>
<div class="line"><a name="l05995"></a><span class="lineno"> 5995</span>&#160;            <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a>, &amp;gc), ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a>);</div>
<div class="line"><a name="l05996"></a><span class="lineno"> 5996</span>&#160;        ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05997"></a><span class="lineno"> 5997</span>&#160;    }</div>
<div class="line"><a name="l05998"></a><span class="lineno"> 5998</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05999"></a><span class="lineno"> 5999</span>&#160;    {</div>
<div class="line"><a name="l06000"></a><span class="lineno"> 6000</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;Ring buffers registered via service&quot;</span>);</div>
<div class="line"><a name="l06001"></a><span class="lineno"> 6001</span>&#160;    }</div>
<div class="line"><a name="l06002"></a><span class="lineno"> 6002</span>&#160; </div>
<div class="line"><a name="l06003"></a><span class="lineno"> 6003</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l06004"></a><span class="lineno"> 6004</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l06005"></a><span class="lineno"> 6005</span>&#160;}</div>
<div class="line"><a name="l06006"></a><span class="lineno"> 6006</span>&#160; </div>
<div class="line"><a name="l06007"></a><span class="lineno"> 6007</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l06008"></a><span class="lineno"><a class="line" href="tun_8h.html#a18e98c6a82bdccea18fe3d6c3475ed43"> 6008</a></span>&#160;<a class="code" href="tun_8c.html#a18e98c6a82bdccea18fe3d6c3475ed43">fork_register_dns_action</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l06009"></a><span class="lineno"> 6009</span>&#160;{</div>
<div class="line"><a name="l06010"></a><span class="lineno"> 6010</span>&#160;    <span class="keywordflow">if</span> (tt &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#aeae464f77d3fa52255121667014415b6">register_dns</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">msg_channel</a>)</div>
<div class="line"><a name="l06011"></a><span class="lineno"> 6011</span>&#160;    {</div>
<div class="line"><a name="l06012"></a><span class="lineno"> 6012</span>&#160;        <a class="code" href="tun_8c.html#a7ef34c7c71984540f3b6122fcc743f5a">register_dns_service</a>(tt);</div>
<div class="line"><a name="l06013"></a><span class="lineno"> 6013</span>&#160;    }</div>
<div class="line"><a name="l06014"></a><span class="lineno"> 6014</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#aeae464f77d3fa52255121667014415b6">register_dns</a>)</div>
<div class="line"><a name="l06015"></a><span class="lineno"> 6015</span>&#160;    {</div>
<div class="line"><a name="l06016"></a><span class="lineno"> 6016</span>&#160;        <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l06017"></a><span class="lineno"> 6017</span>&#160;        <span class="keyword">struct </span><a class="code" href="structbuffer.html">buffer</a> cmd = <a class="code" href="buffer_8c.html#aa35bf7feb6a99bf5d364b2d4eba1195c">alloc_buf_gc</a>(256, &amp;gc);</div>
<div class="line"><a name="l06018"></a><span class="lineno"> 6018</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> verb = 3;</div>
<div class="line"><a name="l06019"></a><span class="lineno"> 6019</span>&#160; </div>
<div class="line"><a name="l06020"></a><span class="lineno"> 6020</span>&#160;        <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;cmd, <span class="stringliteral">&quot;openvpn --verb %d --register-dns --rdns-internal&quot;</span>, verb);</div>
<div class="line"><a name="l06021"></a><span class="lineno"> 6021</span>&#160;        <a class="code" href="win32_8c.html#a6bb04e9d47205ae4a7dcc6a8c9e0a15a">fork_to_self</a>(<a class="code" href="buffer_8h.html#a34c800967d7b9583cb64236eadab94dd">BSTR</a>(&amp;cmd));</div>
<div class="line"><a name="l06022"></a><span class="lineno"> 6022</span>&#160;        <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l06023"></a><span class="lineno"> 6023</span>&#160;    }</div>
<div class="line"><a name="l06024"></a><span class="lineno"> 6024</span>&#160;}</div>
<div class="line"><a name="l06025"></a><span class="lineno"> 6025</span>&#160; </div>
<div class="line"><a name="l06026"></a><span class="lineno"> 6026</span>&#160;<span class="keyword">static</span> <a class="code" href="config-msvc_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a></div>
<div class="line"><a name="l06027"></a><span class="lineno"><a class="line" href="tun_8c.html#a75196eb8783f698f029065cdc793e302"> 6027</a></span>&#160;<a class="code" href="tun_8c.html#a75196eb8783f698f029065cdc793e302">dhcp_masq_addr</a>(<span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> local, <span class="keyword">const</span> <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> netmask, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="structbuffer.html#af5c1acadd937a2944674832497ba63ad">offset</a>)</div>
<div class="line"><a name="l06028"></a><span class="lineno"> 6028</span>&#160;{</div>
<div class="line"><a name="l06029"></a><span class="lineno"> 6029</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l06030"></a><span class="lineno"> 6030</span>&#160;    <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> dsa; <span class="comment">/* DHCP server addr */</span></div>
<div class="line"><a name="l06031"></a><span class="lineno"> 6031</span>&#160; </div>
<div class="line"><a name="l06032"></a><span class="lineno"> 6032</span>&#160;    <span class="keywordflow">if</span> (offset &lt; 0)</div>
<div class="line"><a name="l06033"></a><span class="lineno"> 6033</span>&#160;    {</div>
<div class="line"><a name="l06034"></a><span class="lineno"> 6034</span>&#160;        dsa = (local | (~netmask)) + offset;</div>
<div class="line"><a name="l06035"></a><span class="lineno"> 6035</span>&#160;    }</div>
<div class="line"><a name="l06036"></a><span class="lineno"> 6036</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l06037"></a><span class="lineno"> 6037</span>&#160;    {</div>
<div class="line"><a name="l06038"></a><span class="lineno"> 6038</span>&#160;        dsa = (local &amp; netmask) + offset;</div>
<div class="line"><a name="l06039"></a><span class="lineno"> 6039</span>&#160;    }</div>
<div class="line"><a name="l06040"></a><span class="lineno"> 6040</span>&#160; </div>
<div class="line"><a name="l06041"></a><span class="lineno"> 6041</span>&#160;    <span class="keywordflow">if</span> (dsa == local)</div>
<div class="line"><a name="l06042"></a><span class="lineno"> 6042</span>&#160;    {</div>
<div class="line"><a name="l06043"></a><span class="lineno"> 6043</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;ERROR: There is a clash between the --ifconfig local address and the internal DHCP server address -- both are set to %s -- please use the --ip-win32 dynamic option to choose a different free address from the --ifconfig subnet for the internal DHCP server&quot;</span>, <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(dsa, 0, &amp;gc));</div>
<div class="line"><a name="l06044"></a><span class="lineno"> 6044</span>&#160;    }</div>
<div class="line"><a name="l06045"></a><span class="lineno"> 6045</span>&#160; </div>
<div class="line"><a name="l06046"></a><span class="lineno"> 6046</span>&#160;    <span class="keywordflow">if</span> ((local &amp; netmask) != (dsa &amp; netmask))</div>
<div class="line"><a name="l06047"></a><span class="lineno"> 6047</span>&#160;    {</div>
<div class="line"><a name="l06048"></a><span class="lineno"> 6048</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;ERROR: --ip-win32 dynamic [offset] : offset is outside of --ifconfig subnet&quot;</span>);</div>
<div class="line"><a name="l06049"></a><span class="lineno"> 6049</span>&#160;    }</div>
<div class="line"><a name="l06050"></a><span class="lineno"> 6050</span>&#160; </div>
<div class="line"><a name="l06051"></a><span class="lineno"> 6051</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l06052"></a><span class="lineno"> 6052</span>&#160;    <span class="keywordflow">return</span> htonl(dsa);</div>
<div class="line"><a name="l06053"></a><span class="lineno"> 6053</span>&#160;}</div>
<div class="line"><a name="l06054"></a><span class="lineno"> 6054</span>&#160; </div>
<div class="line"><a name="l06055"></a><span class="lineno"> 6055</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l06056"></a><span class="lineno"><a class="line" href="tun_8c.html#a35735fa1394f24ce60e0876fa0d0cc7e"> 6056</a></span>&#160;<a class="code" href="tun_8c.html#a35735fa1394f24ce60e0876fa0d0cc7e">tuntap_get_version_info</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l06057"></a><span class="lineno"> 6057</span>&#160;{</div>
<div class="line"><a name="l06058"></a><span class="lineno"> 6058</span>&#160;    ULONG info[3];</div>
<div class="line"><a name="l06059"></a><span class="lineno"> 6059</span>&#160;    DWORD len;</div>
<div class="line"><a name="l06060"></a><span class="lineno"> 6060</span>&#160;    <a class="code" href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a>(info);</div>
<div class="line"><a name="l06061"></a><span class="lineno"> 6061</span>&#160;    <span class="keywordflow">if</span> (DeviceIoControl(tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a>, TAP_WIN_IOCTL_GET_VERSION,</div>
<div class="line"><a name="l06062"></a><span class="lineno"> 6062</span>&#160;                        &amp;info, <span class="keyword">sizeof</span>(info),</div>
<div class="line"><a name="l06063"></a><span class="lineno"> 6063</span>&#160;                        &amp;info, <span class="keyword">sizeof</span>(info), &amp;len, NULL))</div>
<div class="line"><a name="l06064"></a><span class="lineno"> 6064</span>&#160;    {</div>
<div class="line"><a name="l06065"></a><span class="lineno"> 6065</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#a80d57c8e34010c9b942bbb9f3171050b">D_TUNTAP_INFO</a>, <span class="stringliteral">&quot;TAP-Windows Driver Version %d.%d %s&quot;</span>,</div>
<div class="line"><a name="l06066"></a><span class="lineno"> 6066</span>&#160;            (<span class="keywordtype">int</span>)info[0],</div>
<div class="line"><a name="l06067"></a><span class="lineno"> 6067</span>&#160;            (<span class="keywordtype">int</span>)info[1],</div>
<div class="line"><a name="l06068"></a><span class="lineno"> 6068</span>&#160;            (info[2] ? <span class="stringliteral">&quot;(DEBUG)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line"><a name="l06069"></a><span class="lineno"> 6069</span>&#160; </div>
<div class="line"><a name="l06070"></a><span class="lineno"> 6070</span>&#160;    }</div>
<div class="line"><a name="l06071"></a><span class="lineno"> 6071</span>&#160;    <span class="keywordflow">if</span> (!(info[0] == <a class="code" href="config-msvc-version_8h.html#ab7f2c146e473bacc5ac8078a45abe601">TAP_WIN_MIN_MAJOR</a> &amp;&amp; info[1] &gt;= <a class="code" href="config-msvc-version_8h.html#a0d45a760f50fdff0efa95108a0ddc37b">TAP_WIN_MIN_MINOR</a>))</div>
<div class="line"><a name="l06072"></a><span class="lineno"> 6072</span>&#160;    {</div>
<div class="line"><a name="l06073"></a><span class="lineno"> 6073</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;ERROR:  This version of &quot;</span> <a class="code" href="config-msvc-version_8h.html#a1c0439e4355794c09b64274849eb0279">PACKAGE_NAME</a> <span class="stringliteral">&quot; requires a TAP-Windows driver that is at least version %d.%d -- If you recently upgraded your &quot;</span> <a class="code" href="config-msvc-version_8h.html#a1c0439e4355794c09b64274849eb0279">PACKAGE_NAME</a> <span class="stringliteral">&quot; distribution, a reboot is probably required at this point to get Windows to see the new driver.&quot;</span>,</div>
<div class="line"><a name="l06074"></a><span class="lineno"> 6074</span>&#160;            <a class="code" href="config-msvc-version_8h.html#ab7f2c146e473bacc5ac8078a45abe601">TAP_WIN_MIN_MAJOR</a>,</div>
<div class="line"><a name="l06075"></a><span class="lineno"> 6075</span>&#160;            <a class="code" href="config-msvc-version_8h.html#a0d45a760f50fdff0efa95108a0ddc37b">TAP_WIN_MIN_MINOR</a>);</div>
<div class="line"><a name="l06076"></a><span class="lineno"> 6076</span>&#160;    }</div>
<div class="line"><a name="l06077"></a><span class="lineno"> 6077</span>&#160; </div>
<div class="line"><a name="l06078"></a><span class="lineno"> 6078</span>&#160;    <span class="comment">/* usage of numeric constants is ugly, but this is really tied to</span></div>
<div class="line"><a name="l06079"></a><span class="lineno"> 6079</span>&#160;<span class="comment">     * *this* version of the driver</span></div>
<div class="line"><a name="l06080"></a><span class="lineno"> 6080</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l06081"></a><span class="lineno"> 6081</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a></div>
<div class="line"><a name="l06082"></a><span class="lineno"> 6082</span>&#160;        &amp;&amp; info[0] == 9 &amp;&amp; info[1] &lt; 8)</div>
<div class="line"><a name="l06083"></a><span class="lineno"> 6083</span>&#160;    {</div>
<div class="line"><a name="l06084"></a><span class="lineno"> 6084</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;WARNING:  Tap-Win32 driver version %d.%d does not support IPv6 in TUN mode. IPv6 will not work. Upgrade your Tap-Win32 driver.&quot;</span>, (<span class="keywordtype">int</span>)info[0], (<span class="keywordtype">int</span>)info[1]);</div>
<div class="line"><a name="l06085"></a><span class="lineno"> 6085</span>&#160;    }</div>
<div class="line"><a name="l06086"></a><span class="lineno"> 6086</span>&#160; </div>
<div class="line"><a name="l06087"></a><span class="lineno"> 6087</span>&#160;    <span class="comment">/* tap driver 9.8 (2.2.0 and 2.2.1 release) is buggy</span></div>
<div class="line"><a name="l06088"></a><span class="lineno"> 6088</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l06089"></a><span class="lineno"> 6089</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a></div>
<div class="line"><a name="l06090"></a><span class="lineno"> 6090</span>&#160;        &amp;&amp; info[0] == 9 &amp;&amp; info[1] == 8)</div>
<div class="line"><a name="l06091"></a><span class="lineno"> 6091</span>&#160;    {</div>
<div class="line"><a name="l06092"></a><span class="lineno"> 6092</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;ERROR:  Tap-Win32 driver version %d.%d is buggy regarding small IPv4 packets in TUN mode. Upgrade your Tap-Win32 driver.&quot;</span>, (<span class="keywordtype">int</span>)info[0], (<span class="keywordtype">int</span>)info[1]);</div>
<div class="line"><a name="l06093"></a><span class="lineno"> 6093</span>&#160;    }</div>
<div class="line"><a name="l06094"></a><span class="lineno"> 6094</span>&#160;}</div>
<div class="line"><a name="l06095"></a><span class="lineno"> 6095</span>&#160; </div>
<div class="line"><a name="l06096"></a><span class="lineno"> 6096</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l06097"></a><span class="lineno"><a class="line" href="tun_8c.html#ad466008eca1200b2731d52c244f859ee"> 6097</a></span>&#160;<a class="code" href="tun_8c.html#ad466008eca1200b2731d52c244f859ee">tuntap_get_mtu</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l06098"></a><span class="lineno"> 6098</span>&#160;{</div>
<div class="line"><a name="l06099"></a><span class="lineno"> 6099</span>&#160;    ULONG mtu = 0;</div>
<div class="line"><a name="l06100"></a><span class="lineno"> 6100</span>&#160;    DWORD len;</div>
<div class="line"><a name="l06101"></a><span class="lineno"> 6101</span>&#160;    <span class="keywordflow">if</span> (DeviceIoControl(tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a>, TAP_WIN_IOCTL_GET_MTU,</div>
<div class="line"><a name="l06102"></a><span class="lineno"> 6102</span>&#160;                        &amp;mtu, <span class="keyword">sizeof</span>(mtu),</div>
<div class="line"><a name="l06103"></a><span class="lineno"> 6103</span>&#160;                        &amp;mtu, <span class="keyword">sizeof</span>(mtu), &amp;len, NULL))</div>
<div class="line"><a name="l06104"></a><span class="lineno"> 6104</span>&#160;    {</div>
<div class="line"><a name="l06105"></a><span class="lineno"> 6105</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#ade6ab1d7cbe4e6f64dc453eaf7fc251e">post_open_mtu</a> = (int)mtu;</div>
<div class="line"><a name="l06106"></a><span class="lineno"> 6106</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#aab9d07562cfecbd96b4c9e1d242d7d15">D_MTU_INFO</a>, <span class="stringliteral">&quot;TAP-Windows MTU=%d&quot;</span>, (<span class="keywordtype">int</span>)mtu);</div>
<div class="line"><a name="l06107"></a><span class="lineno"> 6107</span>&#160;    }</div>
<div class="line"><a name="l06108"></a><span class="lineno"> 6108</span>&#160;}</div>
<div class="line"><a name="l06109"></a><span class="lineno"> 6109</span>&#160; </div>
<div class="line"><a name="l06110"></a><span class="lineno"> 6110</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l06111"></a><span class="lineno"><a class="line" href="tun_8c.html#a6b6ba16d1a1057d8d4e4e34021b78fd6"> 6111</a></span>&#160;<a class="code" href="tun_8c.html#a6b6ba16d1a1057d8d4e4e34021b78fd6">tuntap_set_ip_addr</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt,</div>
<div class="line"><a name="l06112"></a><span class="lineno"> 6112</span>&#160;                   <span class="keyword">const</span> <span class="keywordtype">char</span> *device_guid,</div>
<div class="line"><a name="l06113"></a><span class="lineno"> 6113</span>&#160;                   <span class="keywordtype">bool</span> dhcp_masq_post)</div>
<div class="line"><a name="l06114"></a><span class="lineno"> 6114</span>&#160;{</div>
<div class="line"><a name="l06115"></a><span class="lineno"> 6115</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l06116"></a><span class="lineno"> 6116</span>&#160;    <span class="keyword">const</span> DWORD index = tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>;</div>
<div class="line"><a name="l06117"></a><span class="lineno"> 6117</span>&#160; </div>
<div class="line"><a name="l06118"></a><span class="lineno"> 6118</span>&#160;    <span class="comment">/* flush arp cache */</span></div>
<div class="line"><a name="l06119"></a><span class="lineno"> 6119</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a859337e1a4e77338299c25b8563410ed">windows_driver</a> == <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5af42c0a58f6f53f325f4a7443ee430922">WINDOWS_DRIVER_TAP_WINDOWS6</a></div>
<div class="line"><a name="l06120"></a><span class="lineno"> 6120</span>&#160;        &amp;&amp; index != <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>)</div>
<div class="line"><a name="l06121"></a><span class="lineno"> 6121</span>&#160;    {</div>
<div class="line"><a name="l06122"></a><span class="lineno"> 6122</span>&#160;        DWORD <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = -1;</div>
<div class="line"><a name="l06123"></a><span class="lineno"> 6123</span>&#160; </div>
<div class="line"><a name="l06124"></a><span class="lineno"> 6124</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">msg_channel</a>)</div>
<div class="line"><a name="l06125"></a><span class="lineno"> 6125</span>&#160;        {</div>
<div class="line"><a name="l06126"></a><span class="lineno"> 6126</span>&#160;            <a class="code" href="structack__message__t.html">ack_message_t</a> ack;</div>
<div class="line"><a name="l06127"></a><span class="lineno"> 6127</span>&#160;            <a class="code" href="structflush__neighbors__message__t.html">flush_neighbors_message_t</a> <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a> = {</div>
<div class="line"><a name="l06128"></a><span class="lineno"> 6128</span>&#160;                .header = {</div>
<div class="line"><a name="l06129"></a><span class="lineno"> 6129</span>&#160;                    <a class="code" href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557cae91a7a3ce0ed4601fe02aeab29d1bb98">msg_flush_neighbors</a>,</div>
<div class="line"><a name="l06130"></a><span class="lineno"> 6130</span>&#160;                    <span class="keyword">sizeof</span>(<a class="code" href="structflush__neighbors__message__t.html">flush_neighbors_message_t</a>),</div>
<div class="line"><a name="l06131"></a><span class="lineno"> 6131</span>&#160;                    0</div>
<div class="line"><a name="l06132"></a><span class="lineno"> 6132</span>&#160;                },</div>
<div class="line"><a name="l06133"></a><span class="lineno"> 6133</span>&#160;                .family = AF_INET,</div>
<div class="line"><a name="l06134"></a><span class="lineno"> 6134</span>&#160;                .iface = {.index = index, .name = <span class="stringliteral">&quot;&quot;</span> }</div>
<div class="line"><a name="l06135"></a><span class="lineno"> 6135</span>&#160;            };</div>
<div class="line"><a name="l06136"></a><span class="lineno"> 6136</span>&#160; </div>
<div class="line"><a name="l06137"></a><span class="lineno"> 6137</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="win32_8c.html#a7c43018c3610f281fbcd28c092d29619">send_msg_iservice</a>(tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">msg_channel</a>, &amp;<a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>, <span class="keyword">sizeof</span>(<a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>),</div>
<div class="line"><a name="l06138"></a><span class="lineno"> 6138</span>&#160;                                  &amp;ack, <span class="stringliteral">&quot;TUN&quot;</span>))</div>
<div class="line"><a name="l06139"></a><span class="lineno"> 6139</span>&#160;            {</div>
<div class="line"><a name="l06140"></a><span class="lineno"> 6140</span>&#160;                <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = ack.<a class="code" href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">error_number</a>;</div>
<div class="line"><a name="l06141"></a><span class="lineno"> 6141</span>&#160;            }</div>
<div class="line"><a name="l06142"></a><span class="lineno"> 6142</span>&#160;        }</div>
<div class="line"><a name="l06143"></a><span class="lineno"> 6143</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l06144"></a><span class="lineno"> 6144</span>&#160;        {</div>
<div class="line"><a name="l06145"></a><span class="lineno"> 6145</span>&#160;            <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = FlushIpNetTable(index);</div>
<div class="line"><a name="l06146"></a><span class="lineno"> 6146</span>&#160;        }</div>
<div class="line"><a name="l06147"></a><span class="lineno"> 6147</span>&#160; </div>
<div class="line"><a name="l06148"></a><span class="lineno"> 6148</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> == NO_ERROR)</div>
<div class="line"><a name="l06149"></a><span class="lineno"> 6149</span>&#160;        {</div>
<div class="line"><a name="l06150"></a><span class="lineno"> 6150</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;Successful ARP Flush on interface [%lu] %s&quot;</span>,</div>
<div class="line"><a name="l06151"></a><span class="lineno"> 6151</span>&#160;                index,</div>
<div class="line"><a name="l06152"></a><span class="lineno"> 6152</span>&#160;                device_guid);</div>
<div class="line"><a name="l06153"></a><span class="lineno"> 6153</span>&#160;        }</div>
<div class="line"><a name="l06154"></a><span class="lineno"> 6154</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> != -1)</div>
<div class="line"><a name="l06155"></a><span class="lineno"> 6155</span>&#160;        {</div>
<div class="line"><a name="l06156"></a><span class="lineno"> 6156</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#a80d57c8e34010c9b942bbb9f3171050b">D_TUNTAP_INFO</a>, <span class="stringliteral">&quot;NOTE: FlushIpNetTable failed on interface [%lu] %s (status=%lu) : %s&quot;</span>,</div>
<div class="line"><a name="l06157"></a><span class="lineno"> 6157</span>&#160;                index,</div>
<div class="line"><a name="l06158"></a><span class="lineno"> 6158</span>&#160;                device_guid,</div>
<div class="line"><a name="l06159"></a><span class="lineno"> 6159</span>&#160;                <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>,</div>
<div class="line"><a name="l06160"></a><span class="lineno"> 6160</span>&#160;                <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>, &amp;gc));</div>
<div class="line"><a name="l06161"></a><span class="lineno"> 6161</span>&#160;        }</div>
<div class="line"><a name="l06162"></a><span class="lineno"> 6162</span>&#160; </div>
<div class="line"><a name="l06163"></a><span class="lineno"> 6163</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l06164"></a><span class="lineno"> 6164</span>&#160;<span class="comment">         * If the TAP-Windows driver is masquerading as a DHCP server</span></div>
<div class="line"><a name="l06165"></a><span class="lineno"> 6165</span>&#160;<span class="comment">         * make sure the TCP/IP properties for the adapter are</span></div>
<div class="line"><a name="l06166"></a><span class="lineno"> 6166</span>&#160;<span class="comment">         * set correctly.</span></div>
<div class="line"><a name="l06167"></a><span class="lineno"> 6167</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l06168"></a><span class="lineno"> 6168</span>&#160;        <span class="keywordflow">if</span> (dhcp_masq_post)</div>
<div class="line"><a name="l06169"></a><span class="lineno"> 6169</span>&#160;        {</div>
<div class="line"><a name="l06170"></a><span class="lineno"> 6170</span>&#160;            <span class="comment">/* check dhcp enable status */</span></div>
<div class="line"><a name="l06171"></a><span class="lineno"> 6171</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="tun_8c.html#aa4d13b2206b5e03c343f1fc9484b67eb">dhcp_status</a>(index) == <a class="code" href="tun_8c.html#a658237b01d9cd3e4597232c10e4c8ef3">DHCP_STATUS_DISABLED</a>)</div>
<div class="line"><a name="l06172"></a><span class="lineno"> 6172</span>&#160;            {</div>
<div class="line"><a name="l06173"></a><span class="lineno"> 6173</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;WARNING: You have selected &#39;--ip-win32 dynamic&#39;, which will not work unless the TAP-Windows TCP/IP properties are set to &#39;Obtain an IP address automatically&#39;&quot;</span>);</div>
<div class="line"><a name="l06174"></a><span class="lineno"> 6174</span>&#160;            }</div>
<div class="line"><a name="l06175"></a><span class="lineno"> 6175</span>&#160; </div>
<div class="line"><a name="l06176"></a><span class="lineno"> 6176</span>&#160;            <span class="comment">/* force an explicit DHCP lease renewal on TAP adapter? */</span></div>
<div class="line"><a name="l06177"></a><span class="lineno"> 6177</span>&#160;            <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ae31925735e2ef3b040695acf59feb737">dhcp_pre_release</a>)</div>
<div class="line"><a name="l06178"></a><span class="lineno"> 6178</span>&#160;            {</div>
<div class="line"><a name="l06179"></a><span class="lineno"> 6179</span>&#160;                <a class="code" href="tun_8c.html#a48f484ccef829bc66fef2d6734e0a3eb">dhcp_release</a>(tt);</div>
<div class="line"><a name="l06180"></a><span class="lineno"> 6180</span>&#160;            }</div>
<div class="line"><a name="l06181"></a><span class="lineno"> 6181</span>&#160;            <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a82e60f4c2f209966b8867f60e49d975f">dhcp_renew</a>)</div>
<div class="line"><a name="l06182"></a><span class="lineno"> 6182</span>&#160;            {</div>
<div class="line"><a name="l06183"></a><span class="lineno"> 6183</span>&#160;                <a class="code" href="tun_8c.html#abab0251811d3e8ef1e4891ca107d1f2e">dhcp_renew</a>(tt);</div>
<div class="line"><a name="l06184"></a><span class="lineno"> 6184</span>&#160;            }</div>
<div class="line"><a name="l06185"></a><span class="lineno"> 6185</span>&#160;        }</div>
<div class="line"><a name="l06186"></a><span class="lineno"> 6186</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l06187"></a><span class="lineno"> 6187</span>&#160;        {</div>
<div class="line"><a name="l06188"></a><span class="lineno"> 6188</span>&#160;            <a class="code" href="tun_8c.html#a4b412ed4d7fe20229984758b0debde74">fork_dhcp_action</a>(tt);</div>
<div class="line"><a name="l06189"></a><span class="lineno"> 6189</span>&#160;        }</div>
<div class="line"><a name="l06190"></a><span class="lineno"> 6190</span>&#160;    }</div>
<div class="line"><a name="l06191"></a><span class="lineno"> 6191</span>&#160; </div>
<div class="line"><a name="l06192"></a><span class="lineno"> 6192</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a8d99c6cfbc9fdf2c1466535afeebdbdb">did_ifconfig_setup</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ac4735c903581ca3bb0c35dbe48b4e4dd">ip_win32_type</a> == <a class="code" href="tun_8h.html#a36e9898c029c4572d141662c2af506a8">IPW32_SET_IPAPI</a>)</div>
<div class="line"><a name="l06193"></a><span class="lineno"> 6193</span>&#160;    {</div>
<div class="line"><a name="l06194"></a><span class="lineno"> 6194</span>&#160;        DWORD <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>;</div>
<div class="line"><a name="l06195"></a><span class="lineno"> 6195</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *error_suffix = <span class="stringliteral">&quot;I am having trouble using the Windows &#39;IP helper API&#39; to automatically set the IP address -- consider using other --ip-win32 methods (not &#39;ipapi&#39;)&quot;</span>;</div>
<div class="line"><a name="l06196"></a><span class="lineno"> 6196</span>&#160; </div>
<div class="line"><a name="l06197"></a><span class="lineno"> 6197</span>&#160;        <span class="comment">/* couldn&#39;t get adapter index */</span></div>
<div class="line"><a name="l06198"></a><span class="lineno"> 6198</span>&#160;        <span class="keywordflow">if</span> (index == <a class="code" href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a>)</div>
<div class="line"><a name="l06199"></a><span class="lineno"> 6199</span>&#160;        {</div>
<div class="line"><a name="l06200"></a><span class="lineno"> 6200</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;ERROR: unable to get adapter index for interface %s -- %s&quot;</span>,</div>
<div class="line"><a name="l06201"></a><span class="lineno"> 6201</span>&#160;                device_guid,</div>
<div class="line"><a name="l06202"></a><span class="lineno"> 6202</span>&#160;                error_suffix);</div>
<div class="line"><a name="l06203"></a><span class="lineno"> 6203</span>&#160;        }</div>
<div class="line"><a name="l06204"></a><span class="lineno"> 6204</span>&#160; </div>
<div class="line"><a name="l06205"></a><span class="lineno"> 6205</span>&#160;        <span class="comment">/* check dhcp enable status */</span></div>
<div class="line"><a name="l06206"></a><span class="lineno"> 6206</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tun_8c.html#aa4d13b2206b5e03c343f1fc9484b67eb">dhcp_status</a>(index) == <a class="code" href="tun_8c.html#a658237b01d9cd3e4597232c10e4c8ef3">DHCP_STATUS_DISABLED</a>)</div>
<div class="line"><a name="l06207"></a><span class="lineno"> 6207</span>&#160;        {</div>
<div class="line"><a name="l06208"></a><span class="lineno"> 6208</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;NOTE: You have selected (explicitly or by default) &#39;--ip-win32 ipapi&#39;, which has a better chance of working correctly if the TAP-Windows TCP/IP properties are set to &#39;Obtain an IP address automatically&#39;&quot;</span>);</div>
<div class="line"><a name="l06209"></a><span class="lineno"> 6209</span>&#160;        }</div>
<div class="line"><a name="l06210"></a><span class="lineno"> 6210</span>&#160; </div>
<div class="line"><a name="l06211"></a><span class="lineno"> 6211</span>&#160;        <span class="comment">/* delete previously added IP addresses which were not</span></div>
<div class="line"><a name="l06212"></a><span class="lineno"> 6212</span>&#160;<span class="comment">         * correctly deleted */</span></div>
<div class="line"><a name="l06213"></a><span class="lineno"> 6213</span>&#160;        <a class="code" href="tun_8c.html#a6b1909af4bc0f83c57cdde3649cc50b8">delete_temp_addresses</a>(index);</div>
<div class="line"><a name="l06214"></a><span class="lineno"> 6214</span>&#160; </div>
<div class="line"><a name="l06215"></a><span class="lineno"> 6215</span>&#160;        <span class="comment">/* add a new IP address */</span></div>
<div class="line"><a name="l06216"></a><span class="lineno"> 6216</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = AddIPAddress(htonl(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>),</div>
<div class="line"><a name="l06217"></a><span class="lineno"> 6217</span>&#160;                                   htonl(tt-&gt;<a class="code" href="structtuntap.html#a9d418d686f4369092543bcced16a39ee">adapter_netmask</a>),</div>
<div class="line"><a name="l06218"></a><span class="lineno"> 6218</span>&#160;                                   index,</div>
<div class="line"><a name="l06219"></a><span class="lineno"> 6219</span>&#160;                                   &amp;tt-&gt;<a class="code" href="structtuntap.html#abd50d085251c7c20d889f4b5d22dfb62">ipapi_context</a>,</div>
<div class="line"><a name="l06220"></a><span class="lineno"> 6220</span>&#160;                                   &amp;tt-&gt;<a class="code" href="structtuntap.html#a3795221b022bca2b97dc0ee2031d6202">ipapi_instance</a>)) == NO_ERROR)</div>
<div class="line"><a name="l06221"></a><span class="lineno"> 6221</span>&#160;        {</div>
<div class="line"><a name="l06222"></a><span class="lineno"> 6222</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;Succeeded in adding a temporary IP/netmask of %s/%s to interface %s using the Win32 IP Helper API&quot;</span>,</div>
<div class="line"><a name="l06223"></a><span class="lineno"> 6223</span>&#160;                <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>, 0, &amp;gc),</div>
<div class="line"><a name="l06224"></a><span class="lineno"> 6224</span>&#160;                <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#a9d418d686f4369092543bcced16a39ee">adapter_netmask</a>, 0, &amp;gc),</div>
<div class="line"><a name="l06225"></a><span class="lineno"> 6225</span>&#160;                device_guid</div>
<div class="line"><a name="l06226"></a><span class="lineno"> 6226</span>&#160;                );</div>
<div class="line"><a name="l06227"></a><span class="lineno"> 6227</span>&#160;        }</div>
<div class="line"><a name="l06228"></a><span class="lineno"> 6228</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l06229"></a><span class="lineno"> 6229</span>&#160;        {</div>
<div class="line"><a name="l06230"></a><span class="lineno"> 6230</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;ERROR: AddIPAddress %s/%s failed on interface %s, index=%lu, status=%lu (windows error: &#39;%s&#39;) -- %s&quot;</span>,</div>
<div class="line"><a name="l06231"></a><span class="lineno"> 6231</span>&#160;                <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>, 0, &amp;gc),</div>
<div class="line"><a name="l06232"></a><span class="lineno"> 6232</span>&#160;                <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#a9d418d686f4369092543bcced16a39ee">adapter_netmask</a>, 0, &amp;gc),</div>
<div class="line"><a name="l06233"></a><span class="lineno"> 6233</span>&#160;                device_guid,</div>
<div class="line"><a name="l06234"></a><span class="lineno"> 6234</span>&#160;                index,</div>
<div class="line"><a name="l06235"></a><span class="lineno"> 6235</span>&#160;                <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>,</div>
<div class="line"><a name="l06236"></a><span class="lineno"> 6236</span>&#160;                <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>, &amp;gc),</div>
<div class="line"><a name="l06237"></a><span class="lineno"> 6237</span>&#160;                error_suffix);</div>
<div class="line"><a name="l06238"></a><span class="lineno"> 6238</span>&#160;        }</div>
<div class="line"><a name="l06239"></a><span class="lineno"> 6239</span>&#160;        tt-&gt;<a class="code" href="structtuntap.html#aef16e632255ef67a01b83d02c5c720e8">ipapi_context_defined</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06240"></a><span class="lineno"> 6240</span>&#160;    }</div>
<div class="line"><a name="l06241"></a><span class="lineno"> 6241</span>&#160; </div>
<div class="line"><a name="l06242"></a><span class="lineno"> 6242</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l06243"></a><span class="lineno"> 6243</span>&#160;}</div>
<div class="line"><a name="l06244"></a><span class="lineno"> 6244</span>&#160; </div>
<div class="line"><a name="l06245"></a><span class="lineno"> 6245</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l06246"></a><span class="lineno"><a class="line" href="tun_8c.html#afd83369f4f7f1983f778d3b4abfd5cf6"> 6246</a></span>&#160;<a class="code" href="tun_8c.html#afd83369f4f7f1983f778d3b4abfd5cf6">wintun_register_ring_buffer</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keyword">const</span> <span class="keywordtype">char</span> *device_guid)</div>
<div class="line"><a name="l06247"></a><span class="lineno"> 6247</span>&#160;{</div>
<div class="line"><a name="l06248"></a><span class="lineno"> 6248</span>&#160;    <span class="keywordtype">bool</span> ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06249"></a><span class="lineno"> 6249</span>&#160; </div>
<div class="line"><a name="l06250"></a><span class="lineno"> 6250</span>&#160;    tt-&gt;<a class="code" href="structtuntap.html#ad883b47c0cf0372077f7d0670432e103">wintun_send_ring</a> = (<span class="keyword">struct </span><a class="code" href="structtun__ring.html">tun_ring</a> *)MapViewOfFile(tt-&gt;<a class="code" href="structtuntap.html#abad5f3a4193f4e244d55ffd2fa41b7f0">wintun_send_ring_handle</a>,</div>
<div class="line"><a name="l06251"></a><span class="lineno"> 6251</span>&#160;                                                            FILE_MAP_ALL_ACCESS,</div>
<div class="line"><a name="l06252"></a><span class="lineno"> 6252</span>&#160;                                                            0,</div>
<div class="line"><a name="l06253"></a><span class="lineno"> 6253</span>&#160;                                                            0,</div>
<div class="line"><a name="l06254"></a><span class="lineno"> 6254</span>&#160;                                                            <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structtun__ring.html">tun_ring</a>));</div>
<div class="line"><a name="l06255"></a><span class="lineno"> 6255</span>&#160; </div>
<div class="line"><a name="l06256"></a><span class="lineno"> 6256</span>&#160;    tt-&gt;<a class="code" href="structtuntap.html#aa66cb527ff9826718f381d8dece21b84">wintun_receive_ring</a> = (<span class="keyword">struct </span><a class="code" href="structtun__ring.html">tun_ring</a> *)MapViewOfFile(tt-&gt;<a class="code" href="structtuntap.html#a55841b7764fd4d6945e38c8d7594c7b5">wintun_receive_ring_handle</a>,</div>
<div class="line"><a name="l06257"></a><span class="lineno"> 6257</span>&#160;                                                               FILE_MAP_ALL_ACCESS,</div>
<div class="line"><a name="l06258"></a><span class="lineno"> 6258</span>&#160;                                                               0,</div>
<div class="line"><a name="l06259"></a><span class="lineno"> 6259</span>&#160;                                                               0,</div>
<div class="line"><a name="l06260"></a><span class="lineno"> 6260</span>&#160;                                                               <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structtun__ring.html">tun_ring</a>));</div>
<div class="line"><a name="l06261"></a><span class="lineno"> 6261</span>&#160; </div>
<div class="line"><a name="l06262"></a><span class="lineno"> 6262</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">msg_channel</a>)</div>
<div class="line"><a name="l06263"></a><span class="lineno"> 6263</span>&#160;    {</div>
<div class="line"><a name="l06264"></a><span class="lineno"> 6264</span>&#160;        ret = <a class="code" href="tun_8c.html#aeccf147b82b28465ee451a79fc267a29">service_register_ring_buffers</a>(tt);</div>
<div class="line"><a name="l06265"></a><span class="lineno"> 6265</span>&#160;    }</div>
<div class="line"><a name="l06266"></a><span class="lineno"> 6266</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l06267"></a><span class="lineno"> 6267</span>&#160;    {</div>
<div class="line"><a name="l06268"></a><span class="lineno"> 6268</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="ring__buffer_8h.html#ae6b27a61789e0225b13036efcd627ace">register_ring_buffers</a>(tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a>,</div>
<div class="line"><a name="l06269"></a><span class="lineno"> 6269</span>&#160;                                   tt-&gt;<a class="code" href="structtuntap.html#ad883b47c0cf0372077f7d0670432e103">wintun_send_ring</a>,</div>
<div class="line"><a name="l06270"></a><span class="lineno"> 6270</span>&#160;                                   tt-&gt;<a class="code" href="structtuntap.html#aa66cb527ff9826718f381d8dece21b84">wintun_receive_ring</a>,</div>
<div class="line"><a name="l06271"></a><span class="lineno"> 6271</span>&#160;                                   tt-&gt;<a class="code" href="structtuntap.html#a4e17e7776e70f2df81236da3bcecccaa">rw_handle</a>.<a class="code" href="structrw__handle.html#a81c9d90f164f2f82f13b43193d7e690b">read</a>,</div>
<div class="line"><a name="l06272"></a><span class="lineno"> 6272</span>&#160;                                   tt-&gt;<a class="code" href="structtuntap.html#a4e17e7776e70f2df81236da3bcecccaa">rw_handle</a>.<a class="code" href="structrw__handle.html#a0dae71c0cfb6646063148367ed15f4d1">write</a>))</div>
<div class="line"><a name="l06273"></a><span class="lineno"> 6273</span>&#160;        {</div>
<div class="line"><a name="l06274"></a><span class="lineno"> 6274</span>&#160;            <span class="keywordflow">switch</span> (GetLastError())</div>
<div class="line"><a name="l06275"></a><span class="lineno"> 6275</span>&#160;            {</div>
<div class="line"><a name="l06276"></a><span class="lineno"> 6276</span>&#160;                <span class="keywordflow">case</span> ERROR_ACCESS_DENIED:</div>
<div class="line"><a name="l06277"></a><span class="lineno"> 6277</span>&#160;                    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;ERROR:  Wintun requires SYSTEM privileges and therefore &quot;</span></div>
<div class="line"><a name="l06278"></a><span class="lineno"> 6278</span>&#160;                                 <span class="stringliteral">&quot;should be used with interactive service. If you want to &quot;</span></div>
<div class="line"><a name="l06279"></a><span class="lineno"> 6279</span>&#160;                                 <span class="stringliteral">&quot;use openvpn from command line, you need to do SYSTEM &quot;</span></div>
<div class="line"><a name="l06280"></a><span class="lineno"> 6280</span>&#160;                                 <span class="stringliteral">&quot;elevation yourself (for example with psexec).&quot;</span>);</div>
<div class="line"><a name="l06281"></a><span class="lineno"> 6281</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06282"></a><span class="lineno"> 6282</span>&#160; </div>
<div class="line"><a name="l06283"></a><span class="lineno"> 6283</span>&#160;                <span class="keywordflow">case</span> ERROR_ALREADY_INITIALIZED:</div>
<div class="line"><a name="l06284"></a><span class="lineno"> 6284</span>&#160;                    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a9e1c690bc419010e6e8346d28a237941">M_NONFATAL</a>, <span class="stringliteral">&quot;Adapter %s is already in use&quot;</span>, device_guid);</div>
<div class="line"><a name="l06285"></a><span class="lineno"> 6285</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06286"></a><span class="lineno"> 6286</span>&#160; </div>
<div class="line"><a name="l06287"></a><span class="lineno"> 6287</span>&#160;                <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l06288"></a><span class="lineno"> 6288</span>&#160;                    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a9e1c690bc419010e6e8346d28a237941">M_NONFATAL</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;Failed to register ring buffers&quot;</span>);</div>
<div class="line"><a name="l06289"></a><span class="lineno"> 6289</span>&#160;            }</div>
<div class="line"><a name="l06290"></a><span class="lineno"> 6290</span>&#160;            ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06291"></a><span class="lineno"> 6291</span>&#160;        }</div>
<div class="line"><a name="l06292"></a><span class="lineno"> 6292</span>&#160; </div>
<div class="line"><a name="l06293"></a><span class="lineno"> 6293</span>&#160;    }</div>
<div class="line"><a name="l06294"></a><span class="lineno"> 6294</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l06295"></a><span class="lineno"> 6295</span>&#160;}</div>
<div class="line"><a name="l06296"></a><span class="lineno"> 6296</span>&#160; </div>
<div class="line"><a name="l06297"></a><span class="lineno"> 6297</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l06298"></a><span class="lineno"><a class="line" href="tun_8c.html#ad0be0336a45cf9eed67f9b75318a96db"> 6298</a></span>&#160;<a class="code" href="tun_8c.html#ad0be0336a45cf9eed67f9b75318a96db">tuntap_set_connected</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l06299"></a><span class="lineno"> 6299</span>&#160;{</div>
<div class="line"><a name="l06300"></a><span class="lineno"> 6300</span>&#160;    ULONG <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = TRUE;</div>
<div class="line"><a name="l06301"></a><span class="lineno"> 6301</span>&#160;    DWORD len;</div>
<div class="line"><a name="l06302"></a><span class="lineno"> 6302</span>&#160;    <span class="keywordflow">if</span> (!DeviceIoControl(tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a>, TAP_WIN_IOCTL_SET_MEDIA_STATUS,</div>
<div class="line"><a name="l06303"></a><span class="lineno"> 6303</span>&#160;                         &amp;<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>, <span class="keyword">sizeof</span>(<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>),</div>
<div class="line"><a name="l06304"></a><span class="lineno"> 6304</span>&#160;                         &amp;<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>, <span class="keyword">sizeof</span>(<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>), &amp;len, NULL))</div>
<div class="line"><a name="l06305"></a><span class="lineno"> 6305</span>&#160;    {</div>
<div class="line"><a name="l06306"></a><span class="lineno"> 6306</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;WARNING: The TAP-Windows driver rejected a TAP_WIN_IOCTL_SET_MEDIA_STATUS DeviceIoControl call.&quot;</span>);</div>
<div class="line"><a name="l06307"></a><span class="lineno"> 6307</span>&#160;    }</div>
<div class="line"><a name="l06308"></a><span class="lineno"> 6308</span>&#160; </div>
<div class="line"><a name="l06309"></a><span class="lineno"> 6309</span>&#160;    <span class="keywordtype">int</span> s = tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a35d7686dee432877c5e5b3671551d4db">tap_sleep</a>;</div>
<div class="line"><a name="l06310"></a><span class="lineno"> 6310</span>&#160;    <span class="keywordflow">if</span> (s &gt; 0)</div>
<div class="line"><a name="l06311"></a><span class="lineno"> 6311</span>&#160;    {</div>
<div class="line"><a name="l06312"></a><span class="lineno"> 6312</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;Sleeping for %d seconds...&quot;</span>, s);</div>
<div class="line"><a name="l06313"></a><span class="lineno"> 6313</span>&#160;        <a class="code" href="manage_8c.html#af07a56f96cec84856d0bf97899a4d460">management_sleep</a>(s);</div>
<div class="line"><a name="l06314"></a><span class="lineno"> 6314</span>&#160;    }</div>
<div class="line"><a name="l06315"></a><span class="lineno"> 6315</span>&#160;}</div>
<div class="line"><a name="l06316"></a><span class="lineno"> 6316</span>&#160; </div>
<div class="line"><a name="l06317"></a><span class="lineno"> 6317</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l06318"></a><span class="lineno"><a class="line" href="tun_8c.html#a3e6426e54ab7edeab3fe5217340a806a"> 6318</a></span>&#160;<a class="code" href="tun_8c.html#a3e6426e54ab7edeab3fe5217340a806a">tuntap_set_ptp</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l06319"></a><span class="lineno"> 6319</span>&#160;{</div>
<div class="line"><a name="l06320"></a><span class="lineno"> 6320</span>&#160;    DWORD len;</div>
<div class="line"><a name="l06321"></a><span class="lineno"> 6321</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l06322"></a><span class="lineno"> 6322</span>&#160; </div>
<div class="line"><a name="l06323"></a><span class="lineno"> 6323</span>&#160;    <span class="keywordflow">if</span> (!tt-&gt;<a class="code" href="structtuntap.html#a8d99c6cfbc9fdf2c1466535afeebdbdb">did_ifconfig_setup</a> &amp;&amp; !tt-&gt;<a class="code" href="structtuntap.html#a70831f0f929eb68a2c0cdd85dc8c917c">did_ifconfig_ipv6_setup</a>)</div>
<div class="line"><a name="l06324"></a><span class="lineno"> 6324</span>&#160;    {</div>
<div class="line"><a name="l06325"></a><span class="lineno"> 6325</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;ERROR: --dev tun also requires --ifconfig&quot;</span>);</div>
<div class="line"><a name="l06326"></a><span class="lineno"> 6326</span>&#160;    }</div>
<div class="line"><a name="l06327"></a><span class="lineno"> 6327</span>&#160; </div>
<div class="line"><a name="l06328"></a><span class="lineno"> 6328</span>&#160;    <span class="comment">/* send 0/0/0 to the TAP driver even if we have no IPv4 configured to</span></div>
<div class="line"><a name="l06329"></a><span class="lineno"> 6329</span>&#160;<span class="comment">     * ensure it is somehow initialized.</span></div>
<div class="line"><a name="l06330"></a><span class="lineno"> 6330</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l06331"></a><span class="lineno"> 6331</span>&#160;    <span class="keywordflow">if</span> (!tt-&gt;<a class="code" href="structtuntap.html#a8d99c6cfbc9fdf2c1466535afeebdbdb">did_ifconfig_setup</a> || tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a> == <a class="code" href="proto_8h.html#af4249a88f691a14cb178b7222d35e150">TOP_SUBNET</a>)</div>
<div class="line"><a name="l06332"></a><span class="lineno"> 6332</span>&#160;    {</div>
<div class="line"><a name="l06333"></a><span class="lineno"> 6333</span>&#160;        <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> ep[3];</div>
<div class="line"><a name="l06334"></a><span class="lineno"> 6334</span>&#160;        BOOL <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>;</div>
<div class="line"><a name="l06335"></a><span class="lineno"> 6335</span>&#160; </div>
<div class="line"><a name="l06336"></a><span class="lineno"> 6336</span>&#160;        ep[0] = htonl(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>);</div>
<div class="line"><a name="l06337"></a><span class="lineno"> 6337</span>&#160;        ep[1] = htonl(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a> &amp; tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>);</div>
<div class="line"><a name="l06338"></a><span class="lineno"> 6338</span>&#160;        ep[2] = htonl(tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>);</div>
<div class="line"><a name="l06339"></a><span class="lineno"> 6339</span>&#160; </div>
<div class="line"><a name="l06340"></a><span class="lineno"> 6340</span>&#160;        <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = DeviceIoControl(tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a>, TAP_WIN_IOCTL_CONFIG_TUN,</div>
<div class="line"><a name="l06341"></a><span class="lineno"> 6341</span>&#160;                                 ep, <span class="keyword">sizeof</span>(ep),</div>
<div class="line"><a name="l06342"></a><span class="lineno"> 6342</span>&#160;                                 ep, <span class="keyword">sizeof</span>(ep), &amp;len, NULL);</div>
<div class="line"><a name="l06343"></a><span class="lineno"> 6343</span>&#160; </div>
<div class="line"><a name="l06344"></a><span class="lineno"> 6344</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a8d99c6cfbc9fdf2c1466535afeebdbdb">did_ifconfig_setup</a>)</div>
<div class="line"><a name="l06345"></a><span class="lineno"> 6345</span>&#160;        {</div>
<div class="line"><a name="l06346"></a><span class="lineno"> 6346</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> ? <a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a> : <a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Set TAP-Windows TUN subnet mode network/local/netmask = %s/%s/%s [%s]&quot;</span>,</div>
<div class="line"><a name="l06347"></a><span class="lineno"> 6347</span>&#160;                <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(ep[1], <a class="code" href="socket_8h.html#adfe6548aae7be586bf39b3e14d408ec3">IA_NET_ORDER</a>, &amp;gc),</div>
<div class="line"><a name="l06348"></a><span class="lineno"> 6348</span>&#160;                <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(ep[0], <a class="code" href="socket_8h.html#adfe6548aae7be586bf39b3e14d408ec3">IA_NET_ORDER</a>, &amp;gc),</div>
<div class="line"><a name="l06349"></a><span class="lineno"> 6349</span>&#160;                <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(ep[2], <a class="code" href="socket_8h.html#adfe6548aae7be586bf39b3e14d408ec3">IA_NET_ORDER</a>, &amp;gc),</div>
<div class="line"><a name="l06350"></a><span class="lineno"> 6350</span>&#160;                <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> ? <span class="stringliteral">&quot;SUCCEEDED&quot;</span> : <span class="stringliteral">&quot;FAILED&quot;</span>);</div>
<div class="line"><a name="l06351"></a><span class="lineno"> 6351</span>&#160;        }</div>
<div class="line"><a name="l06352"></a><span class="lineno"> 6352</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l06353"></a><span class="lineno"> 6353</span>&#160;        {</div>
<div class="line"><a name="l06354"></a><span class="lineno"> 6354</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> ? <a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a> : <a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Set TAP-Windows TUN with fake IPv4 [%s]&quot;</span>,</div>
<div class="line"><a name="l06355"></a><span class="lineno"> 6355</span>&#160;                <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> ? <span class="stringliteral">&quot;SUCCEEDED&quot;</span> : <span class="stringliteral">&quot;FAILED&quot;</span>);</div>
<div class="line"><a name="l06356"></a><span class="lineno"> 6356</span>&#160;        }</div>
<div class="line"><a name="l06357"></a><span class="lineno"> 6357</span>&#160;    }</div>
<div class="line"><a name="l06358"></a><span class="lineno"> 6358</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l06359"></a><span class="lineno"> 6359</span>&#160;    {</div>
<div class="line"><a name="l06360"></a><span class="lineno"> 6360</span>&#160;        <a class="code" href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a> ep[2];</div>
<div class="line"><a name="l06361"></a><span class="lineno"> 6361</span>&#160;        ep[0] = htonl(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>);</div>
<div class="line"><a name="l06362"></a><span class="lineno"> 6362</span>&#160;        ep[1] = htonl(tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>);</div>
<div class="line"><a name="l06363"></a><span class="lineno"> 6363</span>&#160; </div>
<div class="line"><a name="l06364"></a><span class="lineno"> 6364</span>&#160;        <span class="keywordflow">if</span> (!DeviceIoControl(tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a>, TAP_WIN_IOCTL_CONFIG_POINT_TO_POINT,</div>
<div class="line"><a name="l06365"></a><span class="lineno"> 6365</span>&#160;                             ep, <span class="keyword">sizeof</span>(ep),</div>
<div class="line"><a name="l06366"></a><span class="lineno"> 6366</span>&#160;                             ep, <span class="keyword">sizeof</span>(ep), &amp;len, NULL))</div>
<div class="line"><a name="l06367"></a><span class="lineno"> 6367</span>&#160;        {</div>
<div class="line"><a name="l06368"></a><span class="lineno"> 6368</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;ERROR: The TAP-Windows driver rejected a DeviceIoControl call to set Point-to-Point mode, which is required for --dev tun&quot;</span>);</div>
<div class="line"><a name="l06369"></a><span class="lineno"> 6369</span>&#160;        }</div>
<div class="line"><a name="l06370"></a><span class="lineno"> 6370</span>&#160;    }</div>
<div class="line"><a name="l06371"></a><span class="lineno"> 6371</span>&#160; </div>
<div class="line"><a name="l06372"></a><span class="lineno"> 6372</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l06373"></a><span class="lineno"> 6373</span>&#160;}</div>
<div class="line"><a name="l06374"></a><span class="lineno"> 6374</span>&#160; </div>
<div class="line"><a name="l06375"></a><span class="lineno"> 6375</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l06376"></a><span class="lineno"><a class="line" href="tun_8c.html#a8f86b4f423129504463e0c6fad64ece6"> 6376</a></span>&#160;<a class="code" href="tun_8c.html#a8f86b4f423129504463e0c6fad64ece6">tuntap_dhcp_mask</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keyword">const</span> <span class="keywordtype">char</span> *device_guid)</div>
<div class="line"><a name="l06377"></a><span class="lineno"> 6377</span>&#160;{</div>
<div class="line"><a name="l06378"></a><span class="lineno"> 6378</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l06379"></a><span class="lineno"> 6379</span>&#160;    DWORD len;</div>
<div class="line"><a name="l06380"></a><span class="lineno"> 6380</span>&#160;    <a class="code" href="config-msvc_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> ep[4];</div>
<div class="line"><a name="l06381"></a><span class="lineno"> 6381</span>&#160; </div>
<div class="line"><a name="l06382"></a><span class="lineno"> 6382</span>&#160;    <span class="comment">/* We will answer DHCP requests with a reply to set IP/subnet to these values */</span></div>
<div class="line"><a name="l06383"></a><span class="lineno"> 6383</span>&#160;    ep[0] = htonl(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>);</div>
<div class="line"><a name="l06384"></a><span class="lineno"> 6384</span>&#160;    ep[1] = htonl(tt-&gt;<a class="code" href="structtuntap.html#a9d418d686f4369092543bcced16a39ee">adapter_netmask</a>);</div>
<div class="line"><a name="l06385"></a><span class="lineno"> 6385</span>&#160; </div>
<div class="line"><a name="l06386"></a><span class="lineno"> 6386</span>&#160;    <span class="comment">/* At what IP address should the DHCP server masquerade at? */</span></div>
<div class="line"><a name="l06387"></a><span class="lineno"> 6387</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l06388"></a><span class="lineno"> 6388</span>&#160;    {</div>
<div class="line"><a name="l06389"></a><span class="lineno"> 6389</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">topology</a> == <a class="code" href="proto_8h.html#af4249a88f691a14cb178b7222d35e150">TOP_SUBNET</a>)</div>
<div class="line"><a name="l06390"></a><span class="lineno"> 6390</span>&#160;        {</div>
<div class="line"><a name="l06391"></a><span class="lineno"> 6391</span>&#160;            ep[2] = <a class="code" href="tun_8c.html#a75196eb8783f698f029065cdc793e302">dhcp_masq_addr</a>(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>, tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>, tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a6f06463f38c72dc9b8c2907b6ab9a6c9">dhcp_masq_custom_offset</a> ? tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#aa7a2a388db5f36ff06f6f587e97e6ec6">dhcp_masq_offset</a> : 0);</div>
<div class="line"><a name="l06392"></a><span class="lineno"> 6392</span>&#160;        }</div>
<div class="line"><a name="l06393"></a><span class="lineno"> 6393</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l06394"></a><span class="lineno"> 6394</span>&#160;        {</div>
<div class="line"><a name="l06395"></a><span class="lineno"> 6395</span>&#160;            ep[2] = htonl(tt-&gt;<a class="code" href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">remote_netmask</a>);</div>
<div class="line"><a name="l06396"></a><span class="lineno"> 6396</span>&#160;        }</div>
<div class="line"><a name="l06397"></a><span class="lineno"> 6397</span>&#160;    }</div>
<div class="line"><a name="l06398"></a><span class="lineno"> 6398</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l06399"></a><span class="lineno"> 6399</span>&#160;    {</div>
<div class="line"><a name="l06400"></a><span class="lineno"> 6400</span>&#160;        <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a3e52229580f912055a75d0cad8eff3f5">DEV_TYPE_TAP</a>);</div>
<div class="line"><a name="l06401"></a><span class="lineno"> 6401</span>&#160;        ep[2] = <a class="code" href="tun_8c.html#a75196eb8783f698f029065cdc793e302">dhcp_masq_addr</a>(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>, tt-&gt;<a class="code" href="structtuntap.html#a9d418d686f4369092543bcced16a39ee">adapter_netmask</a>, tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a6f06463f38c72dc9b8c2907b6ab9a6c9">dhcp_masq_custom_offset</a> ? tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#aa7a2a388db5f36ff06f6f587e97e6ec6">dhcp_masq_offset</a> : 0);</div>
<div class="line"><a name="l06402"></a><span class="lineno"> 6402</span>&#160;    }</div>
<div class="line"><a name="l06403"></a><span class="lineno"> 6403</span>&#160; </div>
<div class="line"><a name="l06404"></a><span class="lineno"> 6404</span>&#160;    <span class="comment">/* lease time in seconds */</span></div>
<div class="line"><a name="l06405"></a><span class="lineno"> 6405</span>&#160;    ep[3] = (<a class="code" href="config-msvc_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a>)tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a51f64fa955069fe041ab584a6fa8d977">dhcp_lease_time</a>;</div>
<div class="line"><a name="l06406"></a><span class="lineno"> 6406</span>&#160; </div>
<div class="line"><a name="l06407"></a><span class="lineno"> 6407</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(ep[3] &gt; 0);</div>
<div class="line"><a name="l06408"></a><span class="lineno"> 6408</span>&#160; </div>
<div class="line"><a name="l06409"></a><span class="lineno"> 6409</span>&#160;<span class="preprocessor">#ifndef SIMULATE_DHCP_FAILED </span><span class="comment">/* this code is disabled to simulate bad DHCP negotiation */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l06410"></a><span class="lineno"> 6410</span>&#160;    <span class="keywordflow">if</span> (!DeviceIoControl(tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a>, TAP_WIN_IOCTL_CONFIG_DHCP_MASQ,</div>
<div class="line"><a name="l06411"></a><span class="lineno"> 6411</span>&#160;                         ep, <span class="keyword">sizeof</span>(ep),</div>
<div class="line"><a name="l06412"></a><span class="lineno"> 6412</span>&#160;                         ep, <span class="keyword">sizeof</span>(ep), &amp;len, NULL))</div>
<div class="line"><a name="l06413"></a><span class="lineno"> 6413</span>&#160;    {</div>
<div class="line"><a name="l06414"></a><span class="lineno"> 6414</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;ERROR: The TAP-Windows driver rejected a DeviceIoControl call to set TAP_WIN_IOCTL_CONFIG_DHCP_MASQ mode&quot;</span>);</div>
<div class="line"><a name="l06415"></a><span class="lineno"> 6415</span>&#160;    }</div>
<div class="line"><a name="l06416"></a><span class="lineno"> 6416</span>&#160; </div>
<div class="line"><a name="l06417"></a><span class="lineno"> 6417</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;Notified TAP-Windows driver to set a DHCP IP/netmask of %s/%s on interface %s [DHCP-serv: %s, lease-time: %d]&quot;</span>,</div>
<div class="line"><a name="l06418"></a><span class="lineno"> 6418</span>&#160;        <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>, 0, &amp;gc),</div>
<div class="line"><a name="l06419"></a><span class="lineno"> 6419</span>&#160;        <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#a9d418d686f4369092543bcced16a39ee">adapter_netmask</a>, 0, &amp;gc),</div>
<div class="line"><a name="l06420"></a><span class="lineno"> 6420</span>&#160;        device_guid,</div>
<div class="line"><a name="l06421"></a><span class="lineno"> 6421</span>&#160;        <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(ep[2], <a class="code" href="socket_8h.html#adfe6548aae7be586bf39b3e14d408ec3">IA_NET_ORDER</a>, &amp;gc),</div>
<div class="line"><a name="l06422"></a><span class="lineno"> 6422</span>&#160;        ep[3]</div>
<div class="line"><a name="l06423"></a><span class="lineno"> 6423</span>&#160;        );</div>
<div class="line"><a name="l06424"></a><span class="lineno"> 6424</span>&#160; </div>
<div class="line"><a name="l06425"></a><span class="lineno"> 6425</span>&#160;    <span class="comment">/* user-supplied DHCP options capability */</span></div>
<div class="line"><a name="l06426"></a><span class="lineno"> 6426</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a0c6192bde6c53d07a9953e43d3594f3c">dhcp_options</a>)</div>
<div class="line"><a name="l06427"></a><span class="lineno"> 6427</span>&#160;    {</div>
<div class="line"><a name="l06428"></a><span class="lineno"> 6428</span>&#160;        <span class="keyword">struct </span><a class="code" href="structbuffer.html">buffer</a> buf = <a class="code" href="buffer_8c.html#aa6bae12914d41c7aecaa7b64fea1bc51">alloc_buf</a>(256);</div>
<div class="line"><a name="l06429"></a><span class="lineno"> 6429</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tun_8c.html#a59d50384819dbbc49ddd0e8cf561c90b">build_dhcp_options_string</a>(&amp;buf, &amp;tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>))</div>
<div class="line"><a name="l06430"></a><span class="lineno"> 6430</span>&#160;        {</div>
<div class="line"><a name="l06431"></a><span class="lineno"> 6431</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#afdfcf7505fc3f7c1ea04ebdfe02fd483">D_DHCP_OPT</a>, <span class="stringliteral">&quot;DHCP option string: %s&quot;</span>, <a class="code" href="buffer_8h.html#ae3916f38b92823f35c1a1bea1aac378e">format_hex</a>(<a class="code" href="buffer_8h.html#a3be0c11aee0e4d7fe9e0b15235668c43">BPTR</a>(&amp;buf), <a class="code" href="buffer_8h.html#ab7be565801383d9f7371ab9a6aa99077">BLEN</a>(&amp;buf), 0, &amp;gc));</div>
<div class="line"><a name="l06432"></a><span class="lineno"> 6432</span>&#160;            <span class="keywordflow">if</span> (!DeviceIoControl(tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a>, TAP_WIN_IOCTL_CONFIG_DHCP_SET_OPT,</div>
<div class="line"><a name="l06433"></a><span class="lineno"> 6433</span>&#160;                                 <a class="code" href="buffer_8h.html#a3be0c11aee0e4d7fe9e0b15235668c43">BPTR</a>(&amp;buf), <a class="code" href="buffer_8h.html#ab7be565801383d9f7371ab9a6aa99077">BLEN</a>(&amp;buf),</div>
<div class="line"><a name="l06434"></a><span class="lineno"> 6434</span>&#160;                                 <a class="code" href="buffer_8h.html#a3be0c11aee0e4d7fe9e0b15235668c43">BPTR</a>(&amp;buf), <a class="code" href="buffer_8h.html#ab7be565801383d9f7371ab9a6aa99077">BLEN</a>(&amp;buf), &amp;<a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>, NULL))</div>
<div class="line"><a name="l06435"></a><span class="lineno"> 6435</span>&#160;            {</div>
<div class="line"><a name="l06436"></a><span class="lineno"> 6436</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;ERROR: The TAP-Windows driver rejected a TAP_WIN_IOCTL_CONFIG_DHCP_SET_OPT DeviceIoControl call&quot;</span>);</div>
<div class="line"><a name="l06437"></a><span class="lineno"> 6437</span>&#160;            }</div>
<div class="line"><a name="l06438"></a><span class="lineno"> 6438</span>&#160;        }</div>
<div class="line"><a name="l06439"></a><span class="lineno"> 6439</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l06440"></a><span class="lineno"> 6440</span>&#160;        {</div>
<div class="line"><a name="l06441"></a><span class="lineno"> 6441</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;DHCP option string not set due to error&quot;</span>);</div>
<div class="line"><a name="l06442"></a><span class="lineno"> 6442</span>&#160;        }</div>
<div class="line"><a name="l06443"></a><span class="lineno"> 6443</span>&#160;        <a class="code" href="buffer_8c.html#a11cd36c0af3073bd1245bbed1cca9590">free_buf</a>(&amp;buf);</div>
<div class="line"><a name="l06444"></a><span class="lineno"> 6444</span>&#160;    }</div>
<div class="line"><a name="l06445"></a><span class="lineno"> 6445</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ifndef SIMULATE_DHCP_FAILED */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l06446"></a><span class="lineno"> 6446</span>&#160; </div>
<div class="line"><a name="l06447"></a><span class="lineno"> 6447</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l06448"></a><span class="lineno"> 6448</span>&#160;}</div>
<div class="line"><a name="l06449"></a><span class="lineno"> 6449</span>&#160; </div>
<div class="line"><a name="l06450"></a><span class="lineno"> 6450</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l06451"></a><span class="lineno"><a class="line" href="tun_8c.html#a4427f2e6ba60cea730cb88d0104a0923"> 6451</a></span>&#160;<a class="code" href="tun_8c.html#a4427f2e6ba60cea730cb88d0104a0923">tun_try_open_device</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keyword">const</span> <span class="keywordtype">char</span> *device_guid, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structdevice__instance__id__interface.html">device_instance_id_interface</a> *<a class="code" href="structdevice__instance__id__interface.html">device_instance_id_interface</a>)</div>
<div class="line"><a name="l06452"></a><span class="lineno"> 6452</span>&#160;{</div>
<div class="line"><a name="l06453"></a><span class="lineno"> 6453</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *path = NULL;</div>
<div class="line"><a name="l06454"></a><span class="lineno"> 6454</span>&#160;    <span class="keywordtype">char</span> tuntap_device_path[256];</div>
<div class="line"><a name="l06455"></a><span class="lineno"> 6455</span>&#160; </div>
<div class="line"><a name="l06456"></a><span class="lineno"> 6456</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a859337e1a4e77338299c25b8563410ed">windows_driver</a> == <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5a2d613eaa5b7f632cbcc6c0fd16015bbc">WINDOWS_DRIVER_WINTUN</a>)</div>
<div class="line"><a name="l06457"></a><span class="lineno"> 6457</span>&#160;    {</div>
<div class="line"><a name="l06458"></a><span class="lineno"> 6458</span>&#160;        <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdevice__instance__id__interface.html">device_instance_id_interface</a> *dev_if;</div>
<div class="line"><a name="l06459"></a><span class="lineno"> 6459</span>&#160; </div>
<div class="line"><a name="l06460"></a><span class="lineno"> 6460</span>&#160;        <span class="comment">/* Open Wintun adapter */</span></div>
<div class="line"><a name="l06461"></a><span class="lineno"> 6461</span>&#160;        <span class="keywordflow">for</span> (dev_if = <a class="code" href="structdevice__instance__id__interface.html">device_instance_id_interface</a>; dev_if != NULL; dev_if = dev_if-&gt;<a class="code" href="structdevice__instance__id__interface.html#ad6406b583eb3aa6dd03b66a22252640e">next</a>)</div>
<div class="line"><a name="l06462"></a><span class="lineno"> 6462</span>&#160;        {</div>
<div class="line"><a name="l06463"></a><span class="lineno"> 6463</span>&#160;            <span class="keywordflow">if</span> (strcmp(dev_if-&gt;<a class="code" href="structdevice__instance__id__interface.html#aedb7d2661a86a92e9ff1663731117acb">net_cfg_instance_id</a>, device_guid) == 0)</div>
<div class="line"><a name="l06464"></a><span class="lineno"> 6464</span>&#160;            {</div>
<div class="line"><a name="l06465"></a><span class="lineno"> 6465</span>&#160;                path = dev_if-&gt;<a class="code" href="structdevice__instance__id__interface.html#a7dbe478850f0a2e0773ca2e82163d5d3">device_interface_list</a>;</div>
<div class="line"><a name="l06466"></a><span class="lineno"> 6466</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06467"></a><span class="lineno"> 6467</span>&#160;            }</div>
<div class="line"><a name="l06468"></a><span class="lineno"> 6468</span>&#160;        }</div>
<div class="line"><a name="l06469"></a><span class="lineno"> 6469</span>&#160;        <span class="keywordflow">if</span> (path == NULL)</div>
<div class="line"><a name="l06470"></a><span class="lineno"> 6470</span>&#160;        {</div>
<div class="line"><a name="l06471"></a><span class="lineno"> 6471</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06472"></a><span class="lineno"> 6472</span>&#160;        }</div>
<div class="line"><a name="l06473"></a><span class="lineno"> 6473</span>&#160;    }</div>
<div class="line"><a name="l06474"></a><span class="lineno"> 6474</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l06475"></a><span class="lineno"> 6475</span>&#160;    {</div>
<div class="line"><a name="l06476"></a><span class="lineno"> 6476</span>&#160;        <span class="comment">/* Open TAP-Windows adapter */</span></div>
<div class="line"><a name="l06477"></a><span class="lineno"> 6477</span>&#160;        <a class="code" href="buffer_8c.html#afd2a93a0940b1ea7e093d293a05e2927">openvpn_snprintf</a>(tuntap_device_path, <span class="keyword">sizeof</span>(tuntap_device_path), <span class="stringliteral">&quot;%s%s%s&quot;</span>,</div>
<div class="line"><a name="l06478"></a><span class="lineno"> 6478</span>&#160;                         USERMODEDEVICEDIR,</div>
<div class="line"><a name="l06479"></a><span class="lineno"> 6479</span>&#160;                         device_guid,</div>
<div class="line"><a name="l06480"></a><span class="lineno"> 6480</span>&#160;                         TAP_WIN_SUFFIX);</div>
<div class="line"><a name="l06481"></a><span class="lineno"> 6481</span>&#160;        path = tuntap_device_path;</div>
<div class="line"><a name="l06482"></a><span class="lineno"> 6482</span>&#160;    }</div>
<div class="line"><a name="l06483"></a><span class="lineno"> 6483</span>&#160; </div>
<div class="line"><a name="l06484"></a><span class="lineno"> 6484</span>&#160;    tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a> = CreateFile(path,</div>
<div class="line"><a name="l06485"></a><span class="lineno"> 6485</span>&#160;                          GENERIC_READ | GENERIC_WRITE,</div>
<div class="line"><a name="l06486"></a><span class="lineno"> 6486</span>&#160;                          0,         <span class="comment">/* was: FILE_SHARE_READ */</span></div>
<div class="line"><a name="l06487"></a><span class="lineno"> 6487</span>&#160;                          0,</div>
<div class="line"><a name="l06488"></a><span class="lineno"> 6488</span>&#160;                          OPEN_EXISTING,</div>
<div class="line"><a name="l06489"></a><span class="lineno"> 6489</span>&#160;                          FILE_ATTRIBUTE_SYSTEM | FILE_FLAG_OVERLAPPED,</div>
<div class="line"><a name="l06490"></a><span class="lineno"> 6490</span>&#160;                          0);</div>
<div class="line"><a name="l06491"></a><span class="lineno"> 6491</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a> == INVALID_HANDLE_VALUE)</div>
<div class="line"><a name="l06492"></a><span class="lineno"> 6492</span>&#160;    {</div>
<div class="line"><a name="l06493"></a><span class="lineno"> 6493</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#a80d57c8e34010c9b942bbb9f3171050b">D_TUNTAP_INFO</a>, <span class="stringliteral">&quot;CreateFile failed on %s device: %s&quot;</span>, <a class="code" href="tun_8c.html#a010dca1493549f9daf185b9eb421ecf4">print_windows_driver</a>(tt-&gt;<a class="code" href="structtuntap.html#a859337e1a4e77338299c25b8563410ed">windows_driver</a>), path);</div>
<div class="line"><a name="l06494"></a><span class="lineno"> 6494</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06495"></a><span class="lineno"> 6495</span>&#160;    }</div>
<div class="line"><a name="l06496"></a><span class="lineno"> 6496</span>&#160; </div>
<div class="line"><a name="l06497"></a><span class="lineno"> 6497</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a859337e1a4e77338299c25b8563410ed">windows_driver</a> == <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5a2d613eaa5b7f632cbcc6c0fd16015bbc">WINDOWS_DRIVER_WINTUN</a>)</div>
<div class="line"><a name="l06498"></a><span class="lineno"> 6498</span>&#160;    {</div>
<div class="line"><a name="l06499"></a><span class="lineno"> 6499</span>&#160;        <span class="comment">/* Wintun adapter may be considered &quot;open&quot; after ring buffers are successfuly registered. */</span></div>
<div class="line"><a name="l06500"></a><span class="lineno"> 6500</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="tun_8c.html#afd83369f4f7f1983f778d3b4abfd5cf6">wintun_register_ring_buffer</a>(tt, device_guid))</div>
<div class="line"><a name="l06501"></a><span class="lineno"> 6501</span>&#160;        {</div>
<div class="line"><a name="l06502"></a><span class="lineno"> 6502</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#a80d57c8e34010c9b942bbb9f3171050b">D_TUNTAP_INFO</a>, <span class="stringliteral">&quot;Failed to register %s adapter ring buffers&quot;</span>, device_guid);</div>
<div class="line"><a name="l06503"></a><span class="lineno"> 6503</span>&#160;            CloseHandle(tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a>);</div>
<div class="line"><a name="l06504"></a><span class="lineno"> 6504</span>&#160;            tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a> = NULL;</div>
<div class="line"><a name="l06505"></a><span class="lineno"> 6505</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06506"></a><span class="lineno"> 6506</span>&#160;        }</div>
<div class="line"><a name="l06507"></a><span class="lineno"> 6507</span>&#160;    }</div>
<div class="line"><a name="l06508"></a><span class="lineno"> 6508</span>&#160; </div>
<div class="line"><a name="l06509"></a><span class="lineno"> 6509</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06510"></a><span class="lineno"> 6510</span>&#160;}</div>
<div class="line"><a name="l06511"></a><span class="lineno"> 6511</span>&#160; </div>
<div class="line"><a name="l06512"></a><span class="lineno"> 6512</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l06513"></a><span class="lineno"><a class="line" href="tun_8c.html#adc8f582b2faa8abeadd523ac8ae999ce"> 6513</a></span>&#160;<a class="code" href="tun_8c.html#adc8f582b2faa8abeadd523ac8ae999ce">tun_open_device</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node, <span class="keyword">const</span> <span class="keywordtype">char</span> **device_guid, <span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l06514"></a><span class="lineno"> 6514</span>&#160;{</div>
<div class="line"><a name="l06515"></a><span class="lineno"> 6515</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtap__reg.html">tap_reg</a> *<a class="code" href="structtap__reg.html">tap_reg</a> = <a class="code" href="tun_8c.html#ab6ace179866b796f9a2962093e36ba71">get_tap_reg</a>(gc);</div>
<div class="line"><a name="l06516"></a><span class="lineno"> 6516</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structpanel__reg.html">panel_reg</a> *<a class="code" href="structpanel__reg.html">panel_reg</a> = <a class="code" href="tun_8c.html#aae4bf389fe2e79e5cca5b3b67a4290b3">get_panel_reg</a>(gc);</div>
<div class="line"><a name="l06517"></a><span class="lineno"> 6517</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdevice__instance__id__interface.html">device_instance_id_interface</a> *<a class="code" href="structdevice__instance__id__interface.html">device_instance_id_interface</a> = <a class="code" href="tun_8c.html#ade54ed872f97bdf6e1499010b64c01cd">get_device_instance_id_interface</a>(gc);</div>
<div class="line"><a name="l06518"></a><span class="lineno"> 6518</span>&#160;    <span class="keywordtype">char</span> actual_buffer[256];</div>
<div class="line"><a name="l06519"></a><span class="lineno"> 6519</span>&#160; </div>
<div class="line"><a name="l06520"></a><span class="lineno"> 6520</span>&#160;    <a class="code" href="tun_8c.html#aaed8ba449c46f58edb6cc252c652d229">at_least_one_tap_win</a>(<a class="code" href="structtap__reg.html">tap_reg</a>);</div>
<div class="line"><a name="l06521"></a><span class="lineno"> 6521</span>&#160; </div>
<div class="line"><a name="l06522"></a><span class="lineno"> 6522</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l06523"></a><span class="lineno"> 6523</span>&#160;<span class="comment">     * Lookup the device name in the registry, using the --dev-node high level name.</span></div>
<div class="line"><a name="l06524"></a><span class="lineno"> 6524</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l06525"></a><span class="lineno"> 6525</span>&#160;    <span class="keywordflow">if</span> (dev_node)</div>
<div class="line"><a name="l06526"></a><span class="lineno"> 6526</span>&#160;    {</div>
<div class="line"><a name="l06527"></a><span class="lineno"> 6527</span>&#160;        <span class="keyword">enum</span> <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5">windows_driver_type</a> windows_driver = <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5a84774ae3fbc0453084663006f3f21835">WINDOWS_DRIVER_UNSPECIFIED</a>;</div>
<div class="line"><a name="l06528"></a><span class="lineno"> 6528</span>&#160; </div>
<div class="line"><a name="l06529"></a><span class="lineno"> 6529</span>&#160;        <span class="comment">/* Get the device GUID for the device specified with --dev-node. */</span></div>
<div class="line"><a name="l06530"></a><span class="lineno"> 6530</span>&#160;        *device_guid = <a class="code" href="tun_8c.html#a6c7f0760429559528db611dcd91bb8b2">get_device_guid</a>(dev_node, actual_buffer, <span class="keyword">sizeof</span>(actual_buffer), &amp;windows_driver, <a class="code" href="structtap__reg.html">tap_reg</a>, <a class="code" href="structpanel__reg.html">panel_reg</a>, gc);</div>
<div class="line"><a name="l06531"></a><span class="lineno"> 6531</span>&#160; </div>
<div class="line"><a name="l06532"></a><span class="lineno"> 6532</span>&#160;        <span class="keywordflow">if</span> (!*device_guid)</div>
<div class="line"><a name="l06533"></a><span class="lineno"> 6533</span>&#160;        {</div>
<div class="line"><a name="l06534"></a><span class="lineno"> 6534</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Adapter &#39;%s&#39; not found&quot;</span>, dev_node);</div>
<div class="line"><a name="l06535"></a><span class="lineno"> 6535</span>&#160;        }</div>
<div class="line"><a name="l06536"></a><span class="lineno"> 6536</span>&#160; </div>
<div class="line"><a name="l06537"></a><span class="lineno"> 6537</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a859337e1a4e77338299c25b8563410ed">windows_driver</a> != windows_driver)</div>
<div class="line"><a name="l06538"></a><span class="lineno"> 6538</span>&#160;        {</div>
<div class="line"><a name="l06539"></a><span class="lineno"> 6539</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Adapter &#39;%s&#39; is using %s driver, %s expected. If you want to use this device, adjust --windows-driver.&quot;</span>,</div>
<div class="line"><a name="l06540"></a><span class="lineno"> 6540</span>&#160;                dev_node, <a class="code" href="tun_8c.html#a010dca1493549f9daf185b9eb421ecf4">print_windows_driver</a>(windows_driver), <a class="code" href="tun_8c.html#a010dca1493549f9daf185b9eb421ecf4">print_windows_driver</a>(tt-&gt;<a class="code" href="structtuntap.html#a859337e1a4e77338299c25b8563410ed">windows_driver</a>));</div>
<div class="line"><a name="l06541"></a><span class="lineno"> 6541</span>&#160;        }</div>
<div class="line"><a name="l06542"></a><span class="lineno"> 6542</span>&#160; </div>
<div class="line"><a name="l06543"></a><span class="lineno"> 6543</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="tun_8c.html#a4427f2e6ba60cea730cb88d0104a0923">tun_try_open_device</a>(tt, *device_guid, <a class="code" href="structdevice__instance__id__interface.html">device_instance_id_interface</a>))</div>
<div class="line"><a name="l06544"></a><span class="lineno"> 6544</span>&#160;        {</div>
<div class="line"><a name="l06545"></a><span class="lineno"> 6545</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;Failed to open %s adapter: %s&quot;</span>, <a class="code" href="tun_8c.html#a010dca1493549f9daf185b9eb421ecf4">print_windows_driver</a>(tt-&gt;<a class="code" href="structtuntap.html#a859337e1a4e77338299c25b8563410ed">windows_driver</a>), dev_node);</div>
<div class="line"><a name="l06546"></a><span class="lineno"> 6546</span>&#160;        }</div>
<div class="line"><a name="l06547"></a><span class="lineno"> 6547</span>&#160;    }</div>
<div class="line"><a name="l06548"></a><span class="lineno"> 6548</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l06549"></a><span class="lineno"> 6549</span>&#160;    {</div>
<div class="line"><a name="l06550"></a><span class="lineno"> 6550</span>&#160;        <span class="keywordtype">int</span> device_number = 0;</div>
<div class="line"><a name="l06551"></a><span class="lineno"> 6551</span>&#160; </div>
<div class="line"><a name="l06552"></a><span class="lineno"> 6552</span>&#160;        <span class="comment">/* Try opening all TAP devices until we find one available */</span></div>
<div class="line"><a name="l06553"></a><span class="lineno"> 6553</span>&#160;        <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a name="l06554"></a><span class="lineno"> 6554</span>&#160;        {</div>
<div class="line"><a name="l06555"></a><span class="lineno"> 6555</span>&#160;            <span class="keyword">enum</span> <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5">windows_driver_type</a> windows_driver = <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5a84774ae3fbc0453084663006f3f21835">WINDOWS_DRIVER_UNSPECIFIED</a>;</div>
<div class="line"><a name="l06556"></a><span class="lineno"> 6556</span>&#160;            *device_guid = <a class="code" href="tun_8c.html#a54b32700415233e75316fe78594bf8be">get_unspecified_device_guid</a>(device_number,</div>
<div class="line"><a name="l06557"></a><span class="lineno"> 6557</span>&#160;                                                       actual_buffer,</div>
<div class="line"><a name="l06558"></a><span class="lineno"> 6558</span>&#160;                                                       <span class="keyword">sizeof</span>(actual_buffer),</div>
<div class="line"><a name="l06559"></a><span class="lineno"> 6559</span>&#160;                                                       <a class="code" href="structtap__reg.html">tap_reg</a>,</div>
<div class="line"><a name="l06560"></a><span class="lineno"> 6560</span>&#160;                                                       <a class="code" href="structpanel__reg.html">panel_reg</a>,</div>
<div class="line"><a name="l06561"></a><span class="lineno"> 6561</span>&#160;                                                       &amp;windows_driver,</div>
<div class="line"><a name="l06562"></a><span class="lineno"> 6562</span>&#160;                                                       gc);</div>
<div class="line"><a name="l06563"></a><span class="lineno"> 6563</span>&#160; </div>
<div class="line"><a name="l06564"></a><span class="lineno"> 6564</span>&#160;            <span class="keywordflow">if</span> (!*device_guid)</div>
<div class="line"><a name="l06565"></a><span class="lineno"> 6565</span>&#160;            {</div>
<div class="line"><a name="l06566"></a><span class="lineno"> 6566</span>&#160;                <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>, <span class="stringliteral">&quot;All %s adapters on this system are currently in use or disabled.&quot;</span>, <a class="code" href="tun_8c.html#a010dca1493549f9daf185b9eb421ecf4">print_windows_driver</a>(tt-&gt;<a class="code" href="structtuntap.html#a859337e1a4e77338299c25b8563410ed">windows_driver</a>));</div>
<div class="line"><a name="l06567"></a><span class="lineno"> 6567</span>&#160;            }</div>
<div class="line"><a name="l06568"></a><span class="lineno"> 6568</span>&#160; </div>
<div class="line"><a name="l06569"></a><span class="lineno"> 6569</span>&#160;            <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a859337e1a4e77338299c25b8563410ed">windows_driver</a> != windows_driver)</div>
<div class="line"><a name="l06570"></a><span class="lineno"> 6570</span>&#160;            {</div>
<div class="line"><a name="l06571"></a><span class="lineno"> 6571</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="structdevice__instance__id__interface.html#ad6406b583eb3aa6dd03b66a22252640e">next</a>;</div>
<div class="line"><a name="l06572"></a><span class="lineno"> 6572</span>&#160;            }</div>
<div class="line"><a name="l06573"></a><span class="lineno"> 6573</span>&#160; </div>
<div class="line"><a name="l06574"></a><span class="lineno"> 6574</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="tun_8c.html#a4427f2e6ba60cea730cb88d0104a0923">tun_try_open_device</a>(tt, *device_guid, <a class="code" href="structdevice__instance__id__interface.html">device_instance_id_interface</a>))</div>
<div class="line"><a name="l06575"></a><span class="lineno"> 6575</span>&#160;            {</div>
<div class="line"><a name="l06576"></a><span class="lineno"> 6576</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06577"></a><span class="lineno"> 6577</span>&#160;            }</div>
<div class="line"><a name="l06578"></a><span class="lineno"> 6578</span>&#160; </div>
<div class="line"><a name="l06579"></a><span class="lineno"> 6579</span>&#160;<a class="code" href="structdevice__instance__id__interface.html#ad6406b583eb3aa6dd03b66a22252640e">next</a>:</div>
<div class="line"><a name="l06580"></a><span class="lineno"> 6580</span>&#160;            device_number++;</div>
<div class="line"><a name="l06581"></a><span class="lineno"> 6581</span>&#160;        }</div>
<div class="line"><a name="l06582"></a><span class="lineno"> 6582</span>&#160;    }</div>
<div class="line"><a name="l06583"></a><span class="lineno"> 6583</span>&#160; </div>
<div class="line"><a name="l06584"></a><span class="lineno"> 6584</span>&#160;    <span class="comment">/* translate high-level device name into a device instance</span></div>
<div class="line"><a name="l06585"></a><span class="lineno"> 6585</span>&#160;<span class="comment">     * GUID using the registry */</span></div>
<div class="line"><a name="l06586"></a><span class="lineno"> 6586</span>&#160;    tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a> = <a class="code" href="buffer_8c.html#a06e0220403278399596a7a1b6b601fca">string_alloc</a>(actual_buffer, NULL);</div>
<div class="line"><a name="l06587"></a><span class="lineno"> 6587</span>&#160; </div>
<div class="line"><a name="l06588"></a><span class="lineno"> 6588</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;%s device [%s] opened&quot;</span>, <a class="code" href="tun_8c.html#a010dca1493549f9daf185b9eb421ecf4">print_windows_driver</a>(tt-&gt;<a class="code" href="structtuntap.html#a859337e1a4e77338299c25b8563410ed">windows_driver</a>), tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>);</div>
<div class="line"><a name="l06589"></a><span class="lineno"> 6589</span>&#160;    tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a> = <a class="code" href="tun_8c.html#a4625d174217c9a90173e9dc03782200e">get_adapter_index</a>(*device_guid);</div>
<div class="line"><a name="l06590"></a><span class="lineno"> 6590</span>&#160;}</div>
<div class="line"><a name="l06591"></a><span class="lineno"> 6591</span>&#160; </div>
<div class="line"><a name="l06592"></a><span class="lineno"> 6592</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l06593"></a><span class="lineno"><a class="line" href="tun_8c.html#a7d98d7187fd9453d53027d88b065f6ac"> 6593</a></span>&#160;<a class="code" href="tun_8c.html#a7d98d7187fd9453d53027d88b065f6ac">tuntap_set_ip_props</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keywordtype">bool</span> *dhcp_masq, <span class="keywordtype">bool</span> *dhcp_masq_post)</div>
<div class="line"><a name="l06594"></a><span class="lineno"> 6594</span>&#160;{</div>
<div class="line"><a name="l06595"></a><span class="lineno"> 6595</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ac4735c903581ca3bb0c35dbe48b4e4dd">ip_win32_type</a> == <a class="code" href="tun_8h.html#a53b8d43ac0464c0ad92cb7dc1ad2cb34">IPW32_SET_DHCP_MASQ</a>)</div>
<div class="line"><a name="l06596"></a><span class="lineno"> 6596</span>&#160;    {</div>
<div class="line"><a name="l06597"></a><span class="lineno"> 6597</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l06598"></a><span class="lineno"> 6598</span>&#160;<span class="comment">         * If adapter is set to non-DHCP, set to DHCP mode.</span></div>
<div class="line"><a name="l06599"></a><span class="lineno"> 6599</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l06600"></a><span class="lineno"> 6600</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tun_8c.html#aa4d13b2206b5e03c343f1fc9484b67eb">dhcp_status</a>(tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>) == <a class="code" href="tun_8c.html#a658237b01d9cd3e4597232c10e4c8ef3">DHCP_STATUS_DISABLED</a>)</div>
<div class="line"><a name="l06601"></a><span class="lineno"> 6601</span>&#160;        {</div>
<div class="line"><a name="l06602"></a><span class="lineno"> 6602</span>&#160;            <span class="comment">/* try using the service if available, else directly execute netsh */</span></div>
<div class="line"><a name="l06603"></a><span class="lineno"> 6603</span>&#160;            <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">msg_channel</a>)</div>
<div class="line"><a name="l06604"></a><span class="lineno"> 6604</span>&#160;            {</div>
<div class="line"><a name="l06605"></a><span class="lineno"> 6605</span>&#160;                <a class="code" href="tun_8c.html#a36d0521b47e5eb91b126afdd0a949420">service_enable_dhcp</a>(tt);</div>
<div class="line"><a name="l06606"></a><span class="lineno"> 6606</span>&#160;            }</div>
<div class="line"><a name="l06607"></a><span class="lineno"> 6607</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l06608"></a><span class="lineno"> 6608</span>&#160;            {</div>
<div class="line"><a name="l06609"></a><span class="lineno"> 6609</span>&#160;                <a class="code" href="tun_8c.html#a2758a9aa8e7fdef2a6db76f248150b46">netsh_enable_dhcp</a>(tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>);</div>
<div class="line"><a name="l06610"></a><span class="lineno"> 6610</span>&#160;            }</div>
<div class="line"><a name="l06611"></a><span class="lineno"> 6611</span>&#160;        }</div>
<div class="line"><a name="l06612"></a><span class="lineno"> 6612</span>&#160;        *dhcp_masq = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06613"></a><span class="lineno"> 6613</span>&#160;        *dhcp_masq_post = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06614"></a><span class="lineno"> 6614</span>&#160;    }</div>
<div class="line"><a name="l06615"></a><span class="lineno"> 6615</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ac4735c903581ca3bb0c35dbe48b4e4dd">ip_win32_type</a> == <a class="code" href="tun_8h.html#a23ccb7500379bdc9c5944b9e02e74b5c">IPW32_SET_ADAPTIVE</a>)</div>
<div class="line"><a name="l06616"></a><span class="lineno"> 6616</span>&#160;    {</div>
<div class="line"><a name="l06617"></a><span class="lineno"> 6617</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l06618"></a><span class="lineno"> 6618</span>&#160;<span class="comment">         * If adapter is set to non-DHCP, use netsh right away.</span></div>
<div class="line"><a name="l06619"></a><span class="lineno"> 6619</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l06620"></a><span class="lineno"> 6620</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tun_8c.html#aa4d13b2206b5e03c343f1fc9484b67eb">dhcp_status</a>(tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>) != <a class="code" href="tun_8c.html#a7d1277b47f2707be257eb74a1a85a61e">DHCP_STATUS_ENABLED</a>)</div>
<div class="line"><a name="l06621"></a><span class="lineno"> 6621</span>&#160;        {</div>
<div class="line"><a name="l06622"></a><span class="lineno"> 6622</span>&#160;            <a class="code" href="tun_8c.html#a4636ecf580e72087b1cd63dcc1375ec9">netsh_ifconfig</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>,</div>
<div class="line"><a name="l06623"></a><span class="lineno"> 6623</span>&#160;                           tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>,</div>
<div class="line"><a name="l06624"></a><span class="lineno"> 6624</span>&#160;                           tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>,</div>
<div class="line"><a name="l06625"></a><span class="lineno"> 6625</span>&#160;                           tt-&gt;<a class="code" href="structtuntap.html#a9d418d686f4369092543bcced16a39ee">adapter_netmask</a>,</div>
<div class="line"><a name="l06626"></a><span class="lineno"> 6626</span>&#160;                           <a class="code" href="tun_8c.html#a293109fe0e2259e2e4f18f7fa85f498d">NI_TEST_FIRST</a> | <a class="code" href="tun_8c.html#ae4ca7b1df4a85e25a8638afedb54b6dd">NI_IP_NETMASK</a> | <a class="code" href="tun_8c.html#a732f35a455d3cc46d0dd3d6b94239b87">NI_OPTIONS</a>);</div>
<div class="line"><a name="l06627"></a><span class="lineno"> 6627</span>&#160;        }</div>
<div class="line"><a name="l06628"></a><span class="lineno"> 6628</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l06629"></a><span class="lineno"> 6629</span>&#160;        {</div>
<div class="line"><a name="l06630"></a><span class="lineno"> 6630</span>&#160;            *dhcp_masq = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06631"></a><span class="lineno"> 6631</span>&#160;        }</div>
<div class="line"><a name="l06632"></a><span class="lineno"> 6632</span>&#160;    }</div>
<div class="line"><a name="l06633"></a><span class="lineno"> 6633</span>&#160;}</div>
<div class="line"><a name="l06634"></a><span class="lineno"> 6634</span>&#160; </div>
<div class="line"><a name="l06635"></a><span class="lineno"> 6635</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l06636"></a><span class="lineno"><a class="line" href="tun_8c.html#a0cb8a43f9c02419709ef007a9f78c09a"> 6636</a></span>&#160;<a class="code" href="tun_8c.html#a0cb8a43f9c02419709ef007a9f78c09a">tuntap_post_open</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keyword">const</span> <span class="keywordtype">char</span> *device_guid)</div>
<div class="line"><a name="l06637"></a><span class="lineno"> 6637</span>&#160;{</div>
<div class="line"><a name="l06638"></a><span class="lineno"> 6638</span>&#160;    <span class="keywordtype">bool</span> dhcp_masq = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06639"></a><span class="lineno"> 6639</span>&#160;    <span class="keywordtype">bool</span> dhcp_masq_post = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06640"></a><span class="lineno"> 6640</span>&#160; </div>
<div class="line"><a name="l06641"></a><span class="lineno"> 6641</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a859337e1a4e77338299c25b8563410ed">windows_driver</a> == <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5af42c0a58f6f53f325f4a7443ee430922">WINDOWS_DRIVER_TAP_WINDOWS6</a>)</div>
<div class="line"><a name="l06642"></a><span class="lineno"> 6642</span>&#160;    {</div>
<div class="line"><a name="l06643"></a><span class="lineno"> 6643</span>&#160;        <span class="comment">/* get driver version info */</span></div>
<div class="line"><a name="l06644"></a><span class="lineno"> 6644</span>&#160;        <a class="code" href="tun_8c.html#a35735fa1394f24ce60e0876fa0d0cc7e">tuntap_get_version_info</a>(tt);</div>
<div class="line"><a name="l06645"></a><span class="lineno"> 6645</span>&#160; </div>
<div class="line"><a name="l06646"></a><span class="lineno"> 6646</span>&#160;        <span class="comment">/* get driver MTU */</span></div>
<div class="line"><a name="l06647"></a><span class="lineno"> 6647</span>&#160;        <a class="code" href="tun_8c.html#ad466008eca1200b2731d52c244f859ee">tuntap_get_mtu</a>(tt);</div>
<div class="line"><a name="l06648"></a><span class="lineno"> 6648</span>&#160; </div>
<div class="line"><a name="l06649"></a><span class="lineno"> 6649</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l06650"></a><span class="lineno"> 6650</span>&#160;<span class="comment">         * Preliminaries for setting TAP-Windows adapter TCP/IP</span></div>
<div class="line"><a name="l06651"></a><span class="lineno"> 6651</span>&#160;<span class="comment">         * properties via --ip-win32 dynamic or --ip-win32 adaptive.</span></div>
<div class="line"><a name="l06652"></a><span class="lineno"> 6652</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l06653"></a><span class="lineno"> 6653</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a8d99c6cfbc9fdf2c1466535afeebdbdb">did_ifconfig_setup</a>)</div>
<div class="line"><a name="l06654"></a><span class="lineno"> 6654</span>&#160;        {</div>
<div class="line"><a name="l06655"></a><span class="lineno"> 6655</span>&#160;            <a class="code" href="tun_8c.html#a7d98d7187fd9453d53027d88b065f6ac">tuntap_set_ip_props</a>(tt, &amp;dhcp_masq, &amp;dhcp_masq_post);</div>
<div class="line"><a name="l06656"></a><span class="lineno"> 6656</span>&#160;        }</div>
<div class="line"><a name="l06657"></a><span class="lineno"> 6657</span>&#160; </div>
<div class="line"><a name="l06658"></a><span class="lineno"> 6658</span>&#160;        <span class="comment">/* set point-to-point mode if TUN device */</span></div>
<div class="line"><a name="l06659"></a><span class="lineno"> 6659</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l06660"></a><span class="lineno"> 6660</span>&#160;        {</div>
<div class="line"><a name="l06661"></a><span class="lineno"> 6661</span>&#160;            <a class="code" href="tun_8c.html#a3e6426e54ab7edeab3fe5217340a806a">tuntap_set_ptp</a>(tt);</div>
<div class="line"><a name="l06662"></a><span class="lineno"> 6662</span>&#160;        }</div>
<div class="line"><a name="l06663"></a><span class="lineno"> 6663</span>&#160; </div>
<div class="line"><a name="l06664"></a><span class="lineno"> 6664</span>&#160;        <span class="comment">/* should we tell the TAP-Windows driver to masquerade as a DHCP server as a means</span></div>
<div class="line"><a name="l06665"></a><span class="lineno"> 6665</span>&#160;<span class="comment">         * of setting the adapter address? */</span></div>
<div class="line"><a name="l06666"></a><span class="lineno"> 6666</span>&#160;        <span class="keywordflow">if</span> (dhcp_masq)</div>
<div class="line"><a name="l06667"></a><span class="lineno"> 6667</span>&#160;        {</div>
<div class="line"><a name="l06668"></a><span class="lineno"> 6668</span>&#160;            <a class="code" href="tun_8c.html#a8f86b4f423129504463e0c6fad64ece6">tuntap_dhcp_mask</a>(tt, device_guid);</div>
<div class="line"><a name="l06669"></a><span class="lineno"> 6669</span>&#160;        }</div>
<div class="line"><a name="l06670"></a><span class="lineno"> 6670</span>&#160; </div>
<div class="line"><a name="l06671"></a><span class="lineno"> 6671</span>&#160;        <span class="comment">/* set driver media status to &#39;connected&#39; */</span></div>
<div class="line"><a name="l06672"></a><span class="lineno"> 6672</span>&#160;        <a class="code" href="tun_8c.html#ad0be0336a45cf9eed67f9b75318a96db">tuntap_set_connected</a>(tt);</div>
<div class="line"><a name="l06673"></a><span class="lineno"> 6673</span>&#160;    }</div>
<div class="line"><a name="l06674"></a><span class="lineno"> 6674</span>&#160; </div>
<div class="line"><a name="l06675"></a><span class="lineno"> 6675</span>&#160;    <span class="comment">/* possibly use IP Helper API to set IP address on adapter */</span></div>
<div class="line"><a name="l06676"></a><span class="lineno"> 6676</span>&#160;    <a class="code" href="tun_8c.html#a6b6ba16d1a1057d8d4e4e34021b78fd6">tuntap_set_ip_addr</a>(tt, device_guid, dhcp_masq_post);</div>
<div class="line"><a name="l06677"></a><span class="lineno"> 6677</span>&#160;}</div>
<div class="line"><a name="l06678"></a><span class="lineno"> 6678</span>&#160; </div>
<div class="line"><a name="l06679"></a><span class="lineno"> 6679</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l06680"></a><span class="lineno"><a class="line" href="tun_8h.html#a8ed81f24edc25b83eba293057754830b"> 6680</a></span>&#160;<a class="code" href="tun_8c.html#a8ed81f24edc25b83eba293057754830b">open_tun</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node, <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l06681"></a><span class="lineno"> 6681</span>&#160;{</div>
<div class="line"><a name="l06682"></a><span class="lineno"> 6682</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *device_guid = NULL;</div>
<div class="line"><a name="l06683"></a><span class="lineno"> 6683</span>&#160; </div>
<div class="line"><a name="l06684"></a><span class="lineno"> 6684</span>&#160;    <span class="comment">/*netcmd_semaphore_lock ();*/</span></div>
<div class="line"><a name="l06685"></a><span class="lineno"> 6685</span>&#160; </div>
<div class="line"><a name="l06686"></a><span class="lineno"> 6686</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>( <a class="code" href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a>, <span class="stringliteral">&quot;open_tun&quot;</span>);</div>
<div class="line"><a name="l06687"></a><span class="lineno"> 6687</span>&#160; </div>
<div class="line"><a name="l06688"></a><span class="lineno"> 6688</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a541255b8640c189d1bd902f1168b1ee5">DEV_TYPE_NULL</a>)</div>
<div class="line"><a name="l06689"></a><span class="lineno"> 6689</span>&#160;    {</div>
<div class="line"><a name="l06690"></a><span class="lineno"> 6690</span>&#160;        <a class="code" href="tun_8c.html#a86337d8f968065ef71dc084645056fe0">open_null</a>(tt);</div>
<div class="line"><a name="l06691"></a><span class="lineno"> 6691</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l06692"></a><span class="lineno"> 6692</span>&#160;    }</div>
<div class="line"><a name="l06693"></a><span class="lineno"> 6693</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> != <a class="code" href="proto_8h.html#a3e52229580f912055a75d0cad8eff3f5">DEV_TYPE_TAP</a> &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> != <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l06694"></a><span class="lineno"> 6694</span>&#160;    {</div>
<div class="line"><a name="l06695"></a><span class="lineno"> 6695</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a>|<a class="code" href="openvpn_2error_8h.html#a39772a2bdab0bd56c1b6dd518a65c2c3">M_NOPREFIX</a>, <span class="stringliteral">&quot;Unknown virtual device type: &#39;%s&#39;&quot;</span>, dev);</div>
<div class="line"><a name="l06696"></a><span class="lineno"> 6696</span>&#160;    }</div>
<div class="line"><a name="l06697"></a><span class="lineno"> 6697</span>&#160; </div>
<div class="line"><a name="l06698"></a><span class="lineno"> 6698</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>(); <span class="comment">/* used also for device_guid allocation */</span></div>
<div class="line"><a name="l06699"></a><span class="lineno"> 6699</span>&#160;    <a class="code" href="tun_8c.html#adc8f582b2faa8abeadd523ac8ae999ce">tun_open_device</a>(tt, dev_node, &amp;device_guid, &amp;gc);</div>
<div class="line"><a name="l06700"></a><span class="lineno"> 6700</span>&#160; </div>
<div class="line"><a name="l06701"></a><span class="lineno"> 6701</span>&#160;    <a class="code" href="tun_8c.html#a0cb8a43f9c02419709ef007a9f78c09a">tuntap_post_open</a>(tt, device_guid);</div>
<div class="line"><a name="l06702"></a><span class="lineno"> 6702</span>&#160; </div>
<div class="line"><a name="l06703"></a><span class="lineno"> 6703</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l06704"></a><span class="lineno"> 6704</span>&#160; </div>
<div class="line"><a name="l06705"></a><span class="lineno"> 6705</span>&#160;    <span class="comment">/*netcmd_semaphore_release ();*/</span></div>
<div class="line"><a name="l06706"></a><span class="lineno"> 6706</span>&#160;}</div>
<div class="line"><a name="l06707"></a><span class="lineno"> 6707</span>&#160; </div>
<div class="line"><a name="l06708"></a><span class="lineno"> 6708</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a name="l06709"></a><span class="lineno"><a class="line" href="tun_8h.html#a95a74147731cfdcb17a7489715ff5985"> 6709</a></span>&#160;<a class="code" href="tun_8c.html#a95a74147731cfdcb17a7489715ff5985">tap_win_getinfo</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l06710"></a><span class="lineno"> 6710</span>&#160;{</div>
<div class="line"><a name="l06711"></a><span class="lineno"> 6711</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a859337e1a4e77338299c25b8563410ed">windows_driver</a> == <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5af42c0a58f6f53f325f4a7443ee430922">WINDOWS_DRIVER_TAP_WINDOWS6</a>)</div>
<div class="line"><a name="l06712"></a><span class="lineno"> 6712</span>&#160;    {</div>
<div class="line"><a name="l06713"></a><span class="lineno"> 6713</span>&#160;        <span class="keyword">struct </span><a class="code" href="structbuffer.html">buffer</a> out = <a class="code" href="buffer_8c.html#aa35bf7feb6a99bf5d364b2d4eba1195c">alloc_buf_gc</a>(256, gc);</div>
<div class="line"><a name="l06714"></a><span class="lineno"> 6714</span>&#160;        DWORD <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>;</div>
<div class="line"><a name="l06715"></a><span class="lineno"> 6715</span>&#160;        <span class="keywordflow">if</span> (DeviceIoControl(tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a>, TAP_WIN_IOCTL_GET_INFO,</div>
<div class="line"><a name="l06716"></a><span class="lineno"> 6716</span>&#160;                            <a class="code" href="buffer_8h.html#a34c800967d7b9583cb64236eadab94dd">BSTR</a>(&amp;out), <a class="code" href="buffer_8h.html#ac08c75bf761b2c048b14e5b6cbf2c8f3">BCAP</a>(&amp;out),</div>
<div class="line"><a name="l06717"></a><span class="lineno"> 6717</span>&#160;                            <a class="code" href="buffer_8h.html#a34c800967d7b9583cb64236eadab94dd">BSTR</a>(&amp;out), <a class="code" href="buffer_8h.html#ac08c75bf761b2c048b14e5b6cbf2c8f3">BCAP</a>(&amp;out),</div>
<div class="line"><a name="l06718"></a><span class="lineno"> 6718</span>&#160;                            &amp;<a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>, NULL))</div>
<div class="line"><a name="l06719"></a><span class="lineno"> 6719</span>&#160;        {</div>
<div class="line"><a name="l06720"></a><span class="lineno"> 6720</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="buffer_8h.html#a34c800967d7b9583cb64236eadab94dd">BSTR</a>(&amp;out);</div>
<div class="line"><a name="l06721"></a><span class="lineno"> 6721</span>&#160;        }</div>
<div class="line"><a name="l06722"></a><span class="lineno"> 6722</span>&#160;    }</div>
<div class="line"><a name="l06723"></a><span class="lineno"> 6723</span>&#160;    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l06724"></a><span class="lineno"> 6724</span>&#160;}</div>
<div class="line"><a name="l06725"></a><span class="lineno"> 6725</span>&#160; </div>
<div class="line"><a name="l06726"></a><span class="lineno"> 6726</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l06727"></a><span class="lineno"><a class="line" href="tun_8h.html#a0b29a8cad9fb60becddc33e12a7f4cef"> 6727</a></span>&#160;<a class="code" href="tun_8c.html#a0b29a8cad9fb60becddc33e12a7f4cef">tun_show_debug</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l06728"></a><span class="lineno"> 6728</span>&#160;{</div>
<div class="line"><a name="l06729"></a><span class="lineno"> 6729</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a859337e1a4e77338299c25b8563410ed">windows_driver</a> == <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5af42c0a58f6f53f325f4a7443ee430922">WINDOWS_DRIVER_TAP_WINDOWS6</a>)</div>
<div class="line"><a name="l06730"></a><span class="lineno"> 6730</span>&#160;    {</div>
<div class="line"><a name="l06731"></a><span class="lineno"> 6731</span>&#160;        <span class="keyword">struct </span><a class="code" href="structbuffer.html">buffer</a> out = <a class="code" href="buffer_8c.html#aa6bae12914d41c7aecaa7b64fea1bc51">alloc_buf</a>(1024);</div>
<div class="line"><a name="l06732"></a><span class="lineno"> 6732</span>&#160;        DWORD <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>;</div>
<div class="line"><a name="l06733"></a><span class="lineno"> 6733</span>&#160;        <span class="keywordflow">while</span> (DeviceIoControl(tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a>, TAP_WIN_IOCTL_GET_LOG_LINE,</div>
<div class="line"><a name="l06734"></a><span class="lineno"> 6734</span>&#160;                               <a class="code" href="buffer_8h.html#a34c800967d7b9583cb64236eadab94dd">BSTR</a>(&amp;out), <a class="code" href="buffer_8h.html#ac08c75bf761b2c048b14e5b6cbf2c8f3">BCAP</a>(&amp;out),</div>
<div class="line"><a name="l06735"></a><span class="lineno"> 6735</span>&#160;                               <a class="code" href="buffer_8h.html#a34c800967d7b9583cb64236eadab94dd">BSTR</a>(&amp;out), <a class="code" href="buffer_8h.html#ac08c75bf761b2c048b14e5b6cbf2c8f3">BCAP</a>(&amp;out),</div>
<div class="line"><a name="l06736"></a><span class="lineno"> 6736</span>&#160;                               &amp;<a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>, NULL))</div>
<div class="line"><a name="l06737"></a><span class="lineno"> 6737</span>&#160;        {</div>
<div class="line"><a name="l06738"></a><span class="lineno"> 6738</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="errlevel_8h.html#a12fd3192e01eb423295217076c872a3f">D_TAP_WIN_DEBUG</a>, <span class="stringliteral">&quot;TAP-Windows: %s&quot;</span>, <a class="code" href="buffer_8h.html#a34c800967d7b9583cb64236eadab94dd">BSTR</a>(&amp;out));</div>
<div class="line"><a name="l06739"></a><span class="lineno"> 6739</span>&#160;        }</div>
<div class="line"><a name="l06740"></a><span class="lineno"> 6740</span>&#160;        <a class="code" href="buffer_8c.html#a11cd36c0af3073bd1245bbed1cca9590">free_buf</a>(&amp;out);</div>
<div class="line"><a name="l06741"></a><span class="lineno"> 6741</span>&#160;    }</div>
<div class="line"><a name="l06742"></a><span class="lineno"> 6742</span>&#160;}</div>
<div class="line"><a name="l06743"></a><span class="lineno"> 6743</span>&#160; </div>
<div class="line"><a name="l06744"></a><span class="lineno"> 6744</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l06745"></a><span class="lineno"><a class="line" href="tun_8c.html#a370c6b553694cc06301b90ccae6ca759"> 6745</a></span>&#160;<a class="code" href="tun_8c.html#a370c6b553694cc06301b90ccae6ca759">netsh_delete_address_dns</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <span class="keywordtype">bool</span> ipv6, <span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l06746"></a><span class="lineno"> 6746</span>&#160;{</div>
<div class="line"><a name="l06747"></a><span class="lineno"> 6747</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *ifconfig_ip_local;</div>
<div class="line"><a name="l06748"></a><span class="lineno"> 6748</span>&#160;    <span class="keyword">struct </span><a class="code" href="structargv.html">argv</a> <a class="code" href="structargv.html">argv</a> = <a class="code" href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a>();</div>
<div class="line"><a name="l06749"></a><span class="lineno"> 6749</span>&#160; </div>
<div class="line"><a name="l06750"></a><span class="lineno"> 6750</span>&#160;    <span class="comment">/* delete ipvX dns servers if any were set */</span></div>
<div class="line"><a name="l06751"></a><span class="lineno"> 6751</span>&#160;    <span class="keywordtype">int</span> len = ipv6 ? tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a1c1812cd166c6b8069060d6005934736">dns6_len</a> : tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a143af129775b5984fa835d5c0026e75c">dns_len</a>;</div>
<div class="line"><a name="l06752"></a><span class="lineno"> 6752</span>&#160;    <span class="keywordflow">if</span> (len &gt; 0)</div>
<div class="line"><a name="l06753"></a><span class="lineno"> 6753</span>&#160;    {</div>
<div class="line"><a name="l06754"></a><span class="lineno"> 6754</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>,</div>
<div class="line"><a name="l06755"></a><span class="lineno"> 6755</span>&#160;                    <span class="stringliteral">&quot;%s%s interface %s delete dns %lu all&quot;</span>,</div>
<div class="line"><a name="l06756"></a><span class="lineno"> 6756</span>&#160;                    <a class="code" href="win32_8c.html#afa334458227a2453a4391a3a1316a0d7">get_win_sys_path</a>(),</div>
<div class="line"><a name="l06757"></a><span class="lineno"> 6757</span>&#160;                    <a class="code" href="win32_8h.html#ac14f7d0f4450ca68bf7f955e42e234cf">NETSH_PATH_SUFFIX</a>,</div>
<div class="line"><a name="l06758"></a><span class="lineno"> 6758</span>&#160;                    ipv6 ? <span class="stringliteral">&quot;ipv6&quot;</span> : <span class="stringliteral">&quot;ipv4&quot;</span>,</div>
<div class="line"><a name="l06759"></a><span class="lineno"> 6759</span>&#160;                    tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>);</div>
<div class="line"><a name="l06760"></a><span class="lineno"> 6760</span>&#160;        <a class="code" href="tun_8c.html#ac0b5e1af8dfaa627162520fbc1ae5080">netsh_command</a>(&amp;<a class="code" href="structargv.html">argv</a>, 1, <a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>);</div>
<div class="line"><a name="l06761"></a><span class="lineno"> 6761</span>&#160;    }</div>
<div class="line"><a name="l06762"></a><span class="lineno"> 6762</span>&#160; </div>
<div class="line"><a name="l06763"></a><span class="lineno"> 6763</span>&#160;    <span class="keywordflow">if</span> (!ipv6 &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a033f8e542a5ad3c4680d4203687d8bea">wins_len</a> &gt; 0)</div>
<div class="line"><a name="l06764"></a><span class="lineno"> 6764</span>&#160;    {</div>
<div class="line"><a name="l06765"></a><span class="lineno"> 6765</span>&#160;        <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>,</div>
<div class="line"><a name="l06766"></a><span class="lineno"> 6766</span>&#160;                    <span class="stringliteral">&quot;%s%s interface ipv4 delete winsservers %lu all&quot;</span>,</div>
<div class="line"><a name="l06767"></a><span class="lineno"> 6767</span>&#160;                    <a class="code" href="win32_8c.html#afa334458227a2453a4391a3a1316a0d7">get_win_sys_path</a>(),</div>
<div class="line"><a name="l06768"></a><span class="lineno"> 6768</span>&#160;                    <a class="code" href="win32_8h.html#ac14f7d0f4450ca68bf7f955e42e234cf">NETSH_PATH_SUFFIX</a>,</div>
<div class="line"><a name="l06769"></a><span class="lineno"> 6769</span>&#160;                    tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>);</div>
<div class="line"><a name="l06770"></a><span class="lineno"> 6770</span>&#160;        <a class="code" href="tun_8c.html#ac0b5e1af8dfaa627162520fbc1ae5080">netsh_command</a>(&amp;<a class="code" href="structargv.html">argv</a>, 1, <a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>);</div>
<div class="line"><a name="l06771"></a><span class="lineno"> 6771</span>&#160;    }</div>
<div class="line"><a name="l06772"></a><span class="lineno"> 6772</span>&#160; </div>
<div class="line"><a name="l06773"></a><span class="lineno"> 6773</span>&#160;    <span class="keywordflow">if</span> (ipv6 &amp;&amp; tt-&gt;<a class="code" href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">type</a> == <a class="code" href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a>)</div>
<div class="line"><a name="l06774"></a><span class="lineno"> 6774</span>&#160;    {</div>
<div class="line"><a name="l06775"></a><span class="lineno"> 6775</span>&#160;        <a class="code" href="tun_8c.html#a8ca1bf7676b89c4f0b0648001865dfc5">delete_route_connected_v6_net</a>(tt);</div>
<div class="line"><a name="l06776"></a><span class="lineno"> 6776</span>&#160;    }</div>
<div class="line"><a name="l06777"></a><span class="lineno"> 6777</span>&#160; </div>
<div class="line"><a name="l06778"></a><span class="lineno"> 6778</span>&#160;    <span class="comment">/* &quot;store=active&quot; is needed in Windows 8(.1) to delete the</span></div>
<div class="line"><a name="l06779"></a><span class="lineno"> 6779</span>&#160;<span class="comment">     * address we added (pointed out by Cedric Tabary).</span></div>
<div class="line"><a name="l06780"></a><span class="lineno"> 6780</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l06781"></a><span class="lineno"> 6781</span>&#160; </div>
<div class="line"><a name="l06782"></a><span class="lineno"> 6782</span>&#160;    <span class="comment">/* netsh interface ipvX delete address %lu %s */</span></div>
<div class="line"><a name="l06783"></a><span class="lineno"> 6783</span>&#160;    <span class="keywordflow">if</span> (ipv6)</div>
<div class="line"><a name="l06784"></a><span class="lineno"> 6784</span>&#160;    {</div>
<div class="line"><a name="l06785"></a><span class="lineno"> 6785</span>&#160;        ifconfig_ip_local = <a class="code" href="socket_8c.html#a9a911c5dde4c809f7cb3eef8e5918a8e">print_in6_addr</a>(tt-&gt;<a class="code" href="structtuntap.html#ab854704d9efd886f25b7a0083b0196c6">local_ipv6</a>, 0, <a class="code" href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">gc</a>);</div>
<div class="line"><a name="l06786"></a><span class="lineno"> 6786</span>&#160;    }</div>
<div class="line"><a name="l06787"></a><span class="lineno"> 6787</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l06788"></a><span class="lineno"> 6788</span>&#160;    {</div>
<div class="line"><a name="l06789"></a><span class="lineno"> 6789</span>&#160;        ifconfig_ip_local = <a class="code" href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a>(tt-&gt;<a class="code" href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">local</a>, 0, <a class="code" href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">gc</a>);</div>
<div class="line"><a name="l06790"></a><span class="lineno"> 6790</span>&#160;    }</div>
<div class="line"><a name="l06791"></a><span class="lineno"> 6791</span>&#160;    <a class="code" href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a>(&amp;<a class="code" href="structargv.html">argv</a>,</div>
<div class="line"><a name="l06792"></a><span class="lineno"> 6792</span>&#160;                <span class="stringliteral">&quot;%s%s interface %s delete address %lu %s store=active&quot;</span>,</div>
<div class="line"><a name="l06793"></a><span class="lineno"> 6793</span>&#160;                <a class="code" href="win32_8c.html#afa334458227a2453a4391a3a1316a0d7">get_win_sys_path</a>(),</div>
<div class="line"><a name="l06794"></a><span class="lineno"> 6794</span>&#160;                <a class="code" href="win32_8h.html#ac14f7d0f4450ca68bf7f955e42e234cf">NETSH_PATH_SUFFIX</a>,</div>
<div class="line"><a name="l06795"></a><span class="lineno"> 6795</span>&#160;                ipv6 ? <span class="stringliteral">&quot;ipv6&quot;</span> : <span class="stringliteral">&quot;ipv4&quot;</span>,</div>
<div class="line"><a name="l06796"></a><span class="lineno"> 6796</span>&#160;                tt-&gt;<a class="code" href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">adapter_index</a>,</div>
<div class="line"><a name="l06797"></a><span class="lineno"> 6797</span>&#160;                ifconfig_ip_local);</div>
<div class="line"><a name="l06798"></a><span class="lineno"> 6798</span>&#160;    <a class="code" href="tun_8c.html#ac0b5e1af8dfaa627162520fbc1ae5080">netsh_command</a>(&amp;<a class="code" href="structargv.html">argv</a>, 1, <a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>);</div>
<div class="line"><a name="l06799"></a><span class="lineno"> 6799</span>&#160; </div>
<div class="line"><a name="l06800"></a><span class="lineno"> 6800</span>&#160;    <a class="code" href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a>(&amp;<a class="code" href="structargv.html">argv</a>);</div>
<div class="line"><a name="l06801"></a><span class="lineno"> 6801</span>&#160;}</div>
<div class="line"><a name="l06802"></a><span class="lineno"> 6802</span>&#160; </div>
<div class="line"><a name="l06803"></a><span class="lineno"> 6803</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l06804"></a><span class="lineno"><a class="line" href="tun_8h.html#aa160989ccb62fe8390475d34bda3d2f8"> 6804</a></span>&#160;<a class="code" href="tun_8c.html#aa160989ccb62fe8390475d34bda3d2f8">close_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l06805"></a><span class="lineno"> 6805</span>&#160;{</div>
<div class="line"><a name="l06806"></a><span class="lineno"> 6806</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(tt);</div>
<div class="line"><a name="l06807"></a><span class="lineno"> 6807</span>&#160; </div>
<div class="line"><a name="l06808"></a><span class="lineno"> 6808</span>&#160;    <span class="keyword">struct </span><a class="code" href="structgc__arena.html">gc_arena</a> gc = <a class="code" href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a>();</div>
<div class="line"><a name="l06809"></a><span class="lineno"> 6809</span>&#160; </div>
<div class="line"><a name="l06810"></a><span class="lineno"> 6810</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a70831f0f929eb68a2c0cdd85dc8c917c">did_ifconfig_ipv6_setup</a>)</div>
<div class="line"><a name="l06811"></a><span class="lineno"> 6811</span>&#160;    {</div>
<div class="line"><a name="l06812"></a><span class="lineno"> 6812</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ac4735c903581ca3bb0c35dbe48b4e4dd">ip_win32_type</a> == <a class="code" href="tun_8h.html#a85a39082c97534bda4e02e0ed0bfd841">IPW32_SET_MANUAL</a>)</div>
<div class="line"><a name="l06813"></a><span class="lineno"> 6813</span>&#160;        {</div>
<div class="line"><a name="l06814"></a><span class="lineno"> 6814</span>&#160;            <span class="comment">/* We didn&#39;t do ifconfig. */</span></div>
<div class="line"><a name="l06815"></a><span class="lineno"> 6815</span>&#160;        }</div>
<div class="line"><a name="l06816"></a><span class="lineno"> 6816</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">msg_channel</a>)</div>
<div class="line"><a name="l06817"></a><span class="lineno"> 6817</span>&#160;        {</div>
<div class="line"><a name="l06818"></a><span class="lineno"> 6818</span>&#160;            <span class="comment">/* If IPv4 is not enabled, delete DNS domain here */</span></div>
<div class="line"><a name="l06819"></a><span class="lineno"> 6819</span>&#160;            <span class="keywordflow">if</span> (!tt-&gt;<a class="code" href="structtuntap.html#a8d99c6cfbc9fdf2c1466535afeebdbdb">did_ifconfig_setup</a>)</div>
<div class="line"><a name="l06820"></a><span class="lineno"> 6820</span>&#160;            {</div>
<div class="line"><a name="l06821"></a><span class="lineno"> 6821</span>&#160;                <a class="code" href="tun_8c.html#a1c3bf6ba2997de67eb98b3be45d85721">do_dns_domain_service</a>(<span class="keyword">false</span>, tt);</div>
<div class="line"><a name="l06822"></a><span class="lineno"> 6822</span>&#160;            }</div>
<div class="line"><a name="l06823"></a><span class="lineno"> 6823</span>&#160;            <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a1c1812cd166c6b8069060d6005934736">dns6_len</a> &gt; 0)</div>
<div class="line"><a name="l06824"></a><span class="lineno"> 6824</span>&#160;            {</div>
<div class="line"><a name="l06825"></a><span class="lineno"> 6825</span>&#160;                <a class="code" href="tun_8c.html#a1140731439cf4a6b364712a1ba146649">do_dns_service</a>(<span class="keyword">false</span>, AF_INET6, tt);</div>
<div class="line"><a name="l06826"></a><span class="lineno"> 6826</span>&#160;            }</div>
<div class="line"><a name="l06827"></a><span class="lineno"> 6827</span>&#160;            <a class="code" href="tun_8c.html#a8ca1bf7676b89c4f0b0648001865dfc5">delete_route_connected_v6_net</a>(tt);</div>
<div class="line"><a name="l06828"></a><span class="lineno"> 6828</span>&#160;            <a class="code" href="tun_8c.html#a11011674316342ddaaad3f76739d78e3">do_address_service</a>(<span class="keyword">false</span>, AF_INET6, tt);</div>
<div class="line"><a name="l06829"></a><span class="lineno"> 6829</span>&#160;        }</div>
<div class="line"><a name="l06830"></a><span class="lineno"> 6830</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l06831"></a><span class="lineno"> 6831</span>&#160;        {</div>
<div class="line"><a name="l06832"></a><span class="lineno"> 6832</span>&#160;            <a class="code" href="tun_8c.html#a370c6b553694cc06301b90ccae6ca759">netsh_delete_address_dns</a>(tt, <span class="keyword">true</span>, &amp;gc);</div>
<div class="line"><a name="l06833"></a><span class="lineno"> 6833</span>&#160;        }</div>
<div class="line"><a name="l06834"></a><span class="lineno"> 6834</span>&#160;    }</div>
<div class="line"><a name="l06835"></a><span class="lineno"> 6835</span>&#160; </div>
<div class="line"><a name="l06836"></a><span class="lineno"> 6836</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a8d99c6cfbc9fdf2c1466535afeebdbdb">did_ifconfig_setup</a>)</div>
<div class="line"><a name="l06837"></a><span class="lineno"> 6837</span>&#160;    {</div>
<div class="line"><a name="l06838"></a><span class="lineno"> 6838</span>&#160;        <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ac4735c903581ca3bb0c35dbe48b4e4dd">ip_win32_type</a> == <a class="code" href="tun_8h.html#a85a39082c97534bda4e02e0ed0bfd841">IPW32_SET_MANUAL</a>)</div>
<div class="line"><a name="l06839"></a><span class="lineno"> 6839</span>&#160;        {</div>
<div class="line"><a name="l06840"></a><span class="lineno"> 6840</span>&#160;            <span class="comment">/* We didn&#39;t do ifconfig. */</span></div>
<div class="line"><a name="l06841"></a><span class="lineno"> 6841</span>&#160;        }</div>
<div class="line"><a name="l06842"></a><span class="lineno"> 6842</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ac4735c903581ca3bb0c35dbe48b4e4dd">ip_win32_type</a> == <a class="code" href="tun_8h.html#a53b8d43ac0464c0ad92cb7dc1ad2cb34">IPW32_SET_DHCP_MASQ</a> || tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ac4735c903581ca3bb0c35dbe48b4e4dd">ip_win32_type</a> == <a class="code" href="tun_8h.html#a23ccb7500379bdc9c5944b9e02e74b5c">IPW32_SET_ADAPTIVE</a>)</div>
<div class="line"><a name="l06843"></a><span class="lineno"> 6843</span>&#160;        {</div>
<div class="line"><a name="l06844"></a><span class="lineno"> 6844</span>&#160;            <span class="comment">/* We don&#39;t have to clean the configuration with DHCP. */</span></div>
<div class="line"><a name="l06845"></a><span class="lineno"> 6845</span>&#160;        }</div>
<div class="line"><a name="l06846"></a><span class="lineno"> 6846</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">msg_channel</a>)</div>
<div class="line"><a name="l06847"></a><span class="lineno"> 6847</span>&#160;        {</div>
<div class="line"><a name="l06848"></a><span class="lineno"> 6848</span>&#160;            <a class="code" href="tun_8c.html#a1c3bf6ba2997de67eb98b3be45d85721">do_dns_domain_service</a>(<span class="keyword">false</span>, tt);</div>
<div class="line"><a name="l06849"></a><span class="lineno"> 6849</span>&#160;            <a class="code" href="tun_8c.html#a1140731439cf4a6b364712a1ba146649">do_dns_service</a>(<span class="keyword">false</span>, AF_INET, tt);</div>
<div class="line"><a name="l06850"></a><span class="lineno"> 6850</span>&#160;            <a class="code" href="tun_8c.html#a11011674316342ddaaad3f76739d78e3">do_address_service</a>(<span class="keyword">false</span>, AF_INET, tt);</div>
<div class="line"><a name="l06851"></a><span class="lineno"> 6851</span>&#160;        }</div>
<div class="line"><a name="l06852"></a><span class="lineno"> 6852</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">options</a>.<a class="code" href="structtuntap__options.html#ac4735c903581ca3bb0c35dbe48b4e4dd">ip_win32_type</a> == <a class="code" href="tun_8h.html#a14ab5cbbb86cd3bb1cfd7e0691ab4eab">IPW32_SET_NETSH</a>)</div>
<div class="line"><a name="l06853"></a><span class="lineno"> 6853</span>&#160;        {</div>
<div class="line"><a name="l06854"></a><span class="lineno"> 6854</span>&#160;            <a class="code" href="tun_8c.html#a370c6b553694cc06301b90ccae6ca759">netsh_delete_address_dns</a>(tt, <span class="keyword">false</span>, &amp;gc);</div>
<div class="line"><a name="l06855"></a><span class="lineno"> 6855</span>&#160;        }</div>
<div class="line"><a name="l06856"></a><span class="lineno"> 6856</span>&#160;    }</div>
<div class="line"><a name="l06857"></a><span class="lineno"> 6857</span>&#160; </div>
<div class="line"><a name="l06858"></a><span class="lineno"> 6858</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#aef16e632255ef67a01b83d02c5c720e8">ipapi_context_defined</a>)</div>
<div class="line"><a name="l06859"></a><span class="lineno"> 6859</span>&#160;    {</div>
<div class="line"><a name="l06860"></a><span class="lineno"> 6860</span>&#160;        DWORD <a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>;</div>
<div class="line"><a name="l06861"></a><span class="lineno"> 6861</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a> = DeleteIPAddress(tt-&gt;<a class="code" href="structtuntap.html#abd50d085251c7c20d889f4b5d22dfb62">ipapi_context</a>)) != NO_ERROR)</div>
<div class="line"><a name="l06862"></a><span class="lineno"> 6862</span>&#160;        {</div>
<div class="line"><a name="l06863"></a><span class="lineno"> 6863</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a>, <span class="stringliteral">&quot;Warning: DeleteIPAddress[%u] failed on TAP-Windows adapter, status=%u : %s&quot;</span>,</div>
<div class="line"><a name="l06864"></a><span class="lineno"> 6864</span>&#160;                (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)tt-&gt;<a class="code" href="structtuntap.html#abd50d085251c7c20d889f4b5d22dfb62">ipapi_context</a>,</div>
<div class="line"><a name="l06865"></a><span class="lineno"> 6865</span>&#160;                (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>,</div>
<div class="line"><a name="l06866"></a><span class="lineno"> 6866</span>&#160;                <a class="code" href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a>(<a class="code" href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a>, &amp;gc));</div>
<div class="line"><a name="l06867"></a><span class="lineno"> 6867</span>&#160;        }</div>
<div class="line"><a name="l06868"></a><span class="lineno"> 6868</span>&#160;    }</div>
<div class="line"><a name="l06869"></a><span class="lineno"> 6869</span>&#160; </div>
<div class="line"><a name="l06870"></a><span class="lineno"> 6870</span>&#160;    <a class="code" href="tun_8c.html#a48f484ccef829bc66fef2d6734e0a3eb">dhcp_release</a>(tt);</div>
<div class="line"><a name="l06871"></a><span class="lineno"> 6871</span>&#160; </div>
<div class="line"><a name="l06872"></a><span class="lineno"> 6872</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a> != NULL)</div>
<div class="line"><a name="l06873"></a><span class="lineno"> 6873</span>&#160;    {</div>
<div class="line"><a name="l06874"></a><span class="lineno"> 6874</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a64d3ef312f3eba119b6bf938e0a33f60">D_WIN32_IO_LOW</a>, <span class="stringliteral">&quot;Attempting CancelIO on TAP-Windows adapter&quot;</span>);</div>
<div class="line"><a name="l06875"></a><span class="lineno"> 6875</span>&#160;        <span class="keywordflow">if</span> (!CancelIo(tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a>))</div>
<div class="line"><a name="l06876"></a><span class="lineno"> 6876</span>&#160;        {</div>
<div class="line"><a name="l06877"></a><span class="lineno"> 6877</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;Warning: CancelIO failed on TAP-Windows adapter&quot;</span>);</div>
<div class="line"><a name="l06878"></a><span class="lineno"> 6878</span>&#160;        }</div>
<div class="line"><a name="l06879"></a><span class="lineno"> 6879</span>&#160;    }</div>
<div class="line"><a name="l06880"></a><span class="lineno"> 6880</span>&#160; </div>
<div class="line"><a name="l06881"></a><span class="lineno"> 6881</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a64d3ef312f3eba119b6bf938e0a33f60">D_WIN32_IO_LOW</a>, <span class="stringliteral">&quot;Attempting close of overlapped read event on TAP-Windows adapter&quot;</span>);</div>
<div class="line"><a name="l06882"></a><span class="lineno"> 6882</span>&#160;    <a class="code" href="win32_8c.html#a7f293f45d460b63e0353c9b90b7a417c">overlapped_io_close</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">reads</a>);</div>
<div class="line"><a name="l06883"></a><span class="lineno"> 6883</span>&#160; </div>
<div class="line"><a name="l06884"></a><span class="lineno"> 6884</span>&#160;    <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a64d3ef312f3eba119b6bf938e0a33f60">D_WIN32_IO_LOW</a>, <span class="stringliteral">&quot;Attempting close of overlapped write event on TAP-Windows adapter&quot;</span>);</div>
<div class="line"><a name="l06885"></a><span class="lineno"> 6885</span>&#160;    <a class="code" href="win32_8c.html#a7f293f45d460b63e0353c9b90b7a417c">overlapped_io_close</a>(&amp;tt-&gt;<a class="code" href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">writes</a>);</div>
<div class="line"><a name="l06886"></a><span class="lineno"> 6886</span>&#160; </div>
<div class="line"><a name="l06887"></a><span class="lineno"> 6887</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a> != NULL)</div>
<div class="line"><a name="l06888"></a><span class="lineno"> 6888</span>&#160;    {</div>
<div class="line"><a name="l06889"></a><span class="lineno"> 6889</span>&#160;        <a class="code" href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a>(<a class="code" href="errlevel_8h.html#a64d3ef312f3eba119b6bf938e0a33f60">D_WIN32_IO_LOW</a>, <span class="stringliteral">&quot;Attempting CloseHandle on TAP-Windows adapter&quot;</span>);</div>
<div class="line"><a name="l06890"></a><span class="lineno"> 6890</span>&#160;        <span class="keywordflow">if</span> (!CloseHandle(tt-&gt;<a class="code" href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">hand</a>))</div>
<div class="line"><a name="l06891"></a><span class="lineno"> 6891</span>&#160;        {</div>
<div class="line"><a name="l06892"></a><span class="lineno"> 6892</span>&#160;            <a class="code" href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a>(<a class="code" href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a> | <a class="code" href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a>, <span class="stringliteral">&quot;Warning: CloseHandle failed on TAP-Windows adapter&quot;</span>);</div>
<div class="line"><a name="l06893"></a><span class="lineno"> 6893</span>&#160;        }</div>
<div class="line"><a name="l06894"></a><span class="lineno"> 6894</span>&#160;    }</div>
<div class="line"><a name="l06895"></a><span class="lineno"> 6895</span>&#160; </div>
<div class="line"><a name="l06896"></a><span class="lineno"> 6896</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>)</div>
<div class="line"><a name="l06897"></a><span class="lineno"> 6897</span>&#160;    {</div>
<div class="line"><a name="l06898"></a><span class="lineno"> 6898</span>&#160;        free(tt-&gt;<a class="code" href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">actual_name</a>);</div>
<div class="line"><a name="l06899"></a><span class="lineno"> 6899</span>&#160;    }</div>
<div class="line"><a name="l06900"></a><span class="lineno"> 6900</span>&#160; </div>
<div class="line"><a name="l06901"></a><span class="lineno"> 6901</span>&#160;    <span class="keywordflow">if</span> (tt-&gt;<a class="code" href="structtuntap.html#a859337e1a4e77338299c25b8563410ed">windows_driver</a> == <a class="code" href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5a2d613eaa5b7f632cbcc6c0fd16015bbc">WINDOWS_DRIVER_WINTUN</a>)</div>
<div class="line"><a name="l06902"></a><span class="lineno"> 6902</span>&#160;    {</div>
<div class="line"><a name="l06903"></a><span class="lineno"> 6903</span>&#160;        CloseHandle(tt-&gt;<a class="code" href="structtuntap.html#a4e17e7776e70f2df81236da3bcecccaa">rw_handle</a>.<a class="code" href="structrw__handle.html#a81c9d90f164f2f82f13b43193d7e690b">read</a>);</div>
<div class="line"><a name="l06904"></a><span class="lineno"> 6904</span>&#160;        CloseHandle(tt-&gt;<a class="code" href="structtuntap.html#a4e17e7776e70f2df81236da3bcecccaa">rw_handle</a>.<a class="code" href="structrw__handle.html#a0dae71c0cfb6646063148367ed15f4d1">write</a>);</div>
<div class="line"><a name="l06905"></a><span class="lineno"> 6905</span>&#160;        UnmapViewOfFile(tt-&gt;<a class="code" href="structtuntap.html#ad883b47c0cf0372077f7d0670432e103">wintun_send_ring</a>);</div>
<div class="line"><a name="l06906"></a><span class="lineno"> 6906</span>&#160;        UnmapViewOfFile(tt-&gt;<a class="code" href="structtuntap.html#aa66cb527ff9826718f381d8dece21b84">wintun_receive_ring</a>);</div>
<div class="line"><a name="l06907"></a><span class="lineno"> 6907</span>&#160;        CloseHandle(tt-&gt;<a class="code" href="structtuntap.html#abad5f3a4193f4e244d55ffd2fa41b7f0">wintun_send_ring_handle</a>);</div>
<div class="line"><a name="l06908"></a><span class="lineno"> 6908</span>&#160;        CloseHandle(tt-&gt;<a class="code" href="structtuntap.html#a55841b7764fd4d6945e38c8d7594c7b5">wintun_receive_ring_handle</a>);</div>
<div class="line"><a name="l06909"></a><span class="lineno"> 6909</span>&#160;    }</div>
<div class="line"><a name="l06910"></a><span class="lineno"> 6910</span>&#160; </div>
<div class="line"><a name="l06911"></a><span class="lineno"> 6911</span>&#160; </div>
<div class="line"><a name="l06912"></a><span class="lineno"> 6912</span>&#160;    <a class="code" href="tun_8c.html#a12ceabb38605c3156412412d40931506">clear_tuntap</a>(tt);</div>
<div class="line"><a name="l06913"></a><span class="lineno"> 6913</span>&#160;    free(tt);</div>
<div class="line"><a name="l06914"></a><span class="lineno"> 6914</span>&#160;    <a class="code" href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a>(&amp;gc);</div>
<div class="line"><a name="l06915"></a><span class="lineno"> 6915</span>&#160;}</div>
<div class="line"><a name="l06916"></a><span class="lineno"> 6916</span>&#160; </div>
<div class="line"><a name="l06917"></a><span class="lineno"> 6917</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l06918"></a><span class="lineno"> 6918</span>&#160;<span class="comment"> * Convert --ip-win32 constants between index and ascii form.</span></div>
<div class="line"><a name="l06919"></a><span class="lineno"> 6919</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l06920"></a><span class="lineno"> 6920</span>&#160; </div>
<div class="line"><a name="l06921"></a><span class="lineno"><a class="line" href="structipset__names.html"> 6921</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structipset__names.html">ipset_names</a> {</div>
<div class="line"><a name="l06922"></a><span class="lineno"><a class="line" href="structipset__names.html#a3870aa5e6e842f41b1d1d3d2bc29cb81"> 6922</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structipset__names.html#a3870aa5e6e842f41b1d1d3d2bc29cb81">short_form</a>;</div>
<div class="line"><a name="l06923"></a><span class="lineno"> 6923</span>&#160;};</div>
<div class="line"><a name="l06924"></a><span class="lineno"> 6924</span>&#160; </div>
<div class="line"><a name="l06925"></a><span class="lineno"> 6925</span>&#160;<span class="comment">/* Indexed by IPW32_SET_x */</span></div>
<div class="line"><a name="l06926"></a><span class="lineno"><a class="line" href="tun_8c.html#a30f53cb4ece8fdae44a699304cab7546"> 6926</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structipset__names.html">ipset_names</a> <a class="code" href="structipset__names.html">ipset_names</a>[] = {</div>
<div class="line"><a name="l06927"></a><span class="lineno"> 6927</span>&#160;    {<span class="stringliteral">&quot;manual&quot;</span>},</div>
<div class="line"><a name="l06928"></a><span class="lineno"> 6928</span>&#160;    {<span class="stringliteral">&quot;netsh&quot;</span>},</div>
<div class="line"><a name="l06929"></a><span class="lineno"> 6929</span>&#160;    {<span class="stringliteral">&quot;ipapi&quot;</span>},</div>
<div class="line"><a name="l06930"></a><span class="lineno"> 6930</span>&#160;    {<span class="stringliteral">&quot;dynamic&quot;</span>},</div>
<div class="line"><a name="l06931"></a><span class="lineno"> 6931</span>&#160;    {<span class="stringliteral">&quot;adaptive&quot;</span>}</div>
<div class="line"><a name="l06932"></a><span class="lineno"> 6932</span>&#160;};</div>
<div class="line"><a name="l06933"></a><span class="lineno"> 6933</span>&#160; </div>
<div class="line"><a name="l06934"></a><span class="lineno"> 6934</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l06935"></a><span class="lineno"><a class="line" href="tun_8h.html#a38c2e09ededa0716f39cf2ea05042f2b"> 6935</a></span>&#160;<a class="code" href="tun_8c.html#a38c2e09ededa0716f39cf2ea05042f2b">ascii2ipset</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)</div>
<div class="line"><a name="l06936"></a><span class="lineno"> 6936</span>&#160;{</div>
<div class="line"><a name="l06937"></a><span class="lineno"> 6937</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l06938"></a><span class="lineno"> 6938</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(<a class="code" href="tun_8h.html#a795311d1cf67517bbe83198e51a779b8">IPW32_SET_N</a> == <a class="code" href="openvpn_2basic_8h.html#afd2537d19a3cb6556b0f727580ec6ee7">SIZE</a>(<a class="code" href="structipset__names.html">ipset_names</a>));</div>
<div class="line"><a name="l06939"></a><span class="lineno"> 6939</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="tun_8h.html#a795311d1cf67517bbe83198e51a779b8">IPW32_SET_N</a>; ++i)</div>
<div class="line"><a name="l06940"></a><span class="lineno"> 6940</span>&#160;    {</div>
<div class="line"><a name="l06941"></a><span class="lineno"> 6941</span>&#160;        <span class="keywordflow">if</span> (!strcmp(name, <a class="code" href="structipset__names.html">ipset_names</a>[i].<a class="code" href="structipset__names.html#a3870aa5e6e842f41b1d1d3d2bc29cb81">short_form</a>))</div>
<div class="line"><a name="l06942"></a><span class="lineno"> 6942</span>&#160;        {</div>
<div class="line"><a name="l06943"></a><span class="lineno"> 6943</span>&#160;            <span class="keywordflow">return</span> i;</div>
<div class="line"><a name="l06944"></a><span class="lineno"> 6944</span>&#160;        }</div>
<div class="line"><a name="l06945"></a><span class="lineno"> 6945</span>&#160;    }</div>
<div class="line"><a name="l06946"></a><span class="lineno"> 6946</span>&#160;    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l06947"></a><span class="lineno"> 6947</span>&#160;}</div>
<div class="line"><a name="l06948"></a><span class="lineno"> 6948</span>&#160; </div>
<div class="line"><a name="l06949"></a><span class="lineno"> 6949</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a name="l06950"></a><span class="lineno"><a class="line" href="tun_8h.html#a0b6743a0a02e2ca753c47a37869de489"> 6950</a></span>&#160;<a class="code" href="tun_8c.html#a0b6743a0a02e2ca753c47a37869de489">ipset2ascii</a>(<span class="keywordtype">int</span> index)</div>
<div class="line"><a name="l06951"></a><span class="lineno"> 6951</span>&#160;{</div>
<div class="line"><a name="l06952"></a><span class="lineno"> 6952</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(<a class="code" href="tun_8h.html#a795311d1cf67517bbe83198e51a779b8">IPW32_SET_N</a> == <a class="code" href="openvpn_2basic_8h.html#afd2537d19a3cb6556b0f727580ec6ee7">SIZE</a>(<a class="code" href="structipset__names.html">ipset_names</a>));</div>
<div class="line"><a name="l06953"></a><span class="lineno"> 6953</span>&#160;    <span class="keywordflow">if</span> (index &lt; 0 || index &gt;= <a class="code" href="tun_8h.html#a795311d1cf67517bbe83198e51a779b8">IPW32_SET_N</a>)</div>
<div class="line"><a name="l06954"></a><span class="lineno"> 6954</span>&#160;    {</div>
<div class="line"><a name="l06955"></a><span class="lineno"> 6955</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;[unknown --ip-win32 type]&quot;</span>;</div>
<div class="line"><a name="l06956"></a><span class="lineno"> 6956</span>&#160;    }</div>
<div class="line"><a name="l06957"></a><span class="lineno"> 6957</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l06958"></a><span class="lineno"> 6958</span>&#160;    {</div>
<div class="line"><a name="l06959"></a><span class="lineno"> 6959</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="structipset__names.html">ipset_names</a>[index].<a class="code" href="structipset__names.html#a3870aa5e6e842f41b1d1d3d2bc29cb81">short_form</a>;</div>
<div class="line"><a name="l06960"></a><span class="lineno"> 6960</span>&#160;    }</div>
<div class="line"><a name="l06961"></a><span class="lineno"> 6961</span>&#160;}</div>
<div class="line"><a name="l06962"></a><span class="lineno"> 6962</span>&#160; </div>
<div class="line"><a name="l06963"></a><span class="lineno"> 6963</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a name="l06964"></a><span class="lineno"><a class="line" href="tun_8h.html#a3e51b48818737804f360d29c8f4bc2b2"> 6964</a></span>&#160;<a class="code" href="tun_8c.html#a3e51b48818737804f360d29c8f4bc2b2">ipset2ascii_all</a>(<span class="keyword">struct</span> <a class="code" href="structgc__arena.html">gc_arena</a> *gc)</div>
<div class="line"><a name="l06965"></a><span class="lineno"> 6965</span>&#160;{</div>
<div class="line"><a name="l06966"></a><span class="lineno"> 6966</span>&#160;    <span class="keyword">struct </span><a class="code" href="structbuffer.html">buffer</a> out = <a class="code" href="buffer_8c.html#aa35bf7feb6a99bf5d364b2d4eba1195c">alloc_buf_gc</a>(256, gc);</div>
<div class="line"><a name="l06967"></a><span class="lineno"> 6967</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l06968"></a><span class="lineno"> 6968</span>&#160; </div>
<div class="line"><a name="l06969"></a><span class="lineno"> 6969</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(<a class="code" href="tun_8h.html#a795311d1cf67517bbe83198e51a779b8">IPW32_SET_N</a> == <a class="code" href="openvpn_2basic_8h.html#afd2537d19a3cb6556b0f727580ec6ee7">SIZE</a>(<a class="code" href="structipset__names.html">ipset_names</a>));</div>
<div class="line"><a name="l06970"></a><span class="lineno"> 6970</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="tun_8h.html#a795311d1cf67517bbe83198e51a779b8">IPW32_SET_N</a>; ++i)</div>
<div class="line"><a name="l06971"></a><span class="lineno"> 6971</span>&#160;    {</div>
<div class="line"><a name="l06972"></a><span class="lineno"> 6972</span>&#160;        <span class="keywordflow">if</span> (i)</div>
<div class="line"><a name="l06973"></a><span class="lineno"> 6973</span>&#160;        {</div>
<div class="line"><a name="l06974"></a><span class="lineno"> 6974</span>&#160;            <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;out, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a name="l06975"></a><span class="lineno"> 6975</span>&#160;        }</div>
<div class="line"><a name="l06976"></a><span class="lineno"> 6976</span>&#160;        <a class="code" href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a>(&amp;out, <span class="stringliteral">&quot;[%s]&quot;</span>, <a class="code" href="tun_8c.html#a0b6743a0a02e2ca753c47a37869de489">ipset2ascii</a>(i));</div>
<div class="line"><a name="l06977"></a><span class="lineno"> 6977</span>&#160;    }</div>
<div class="line"><a name="l06978"></a><span class="lineno"> 6978</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="buffer_8h.html#a34c800967d7b9583cb64236eadab94dd">BSTR</a>(&amp;out);</div>
<div class="line"><a name="l06979"></a><span class="lineno"> 6979</span>&#160;}</div>
<div class="line"><a name="l06980"></a><span class="lineno"> 6980</span>&#160; </div>
<div class="line"><a name="l06981"></a><span class="lineno"> 6981</span>&#160;<span class="preprocessor">#else </span><span class="comment">/* generic */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l06982"></a><span class="lineno"> 6982</span>&#160; </div>
<div class="line"><a name="l06983"></a><span class="lineno"> 6983</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l06984"></a><span class="lineno"> 6984</span>&#160;<a class="code" href="tun_8c.html#a8ed81f24edc25b83eba293057754830b">open_tun</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_type, <span class="keyword">const</span> <span class="keywordtype">char</span> *dev_node, <span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt)</div>
<div class="line"><a name="l06985"></a><span class="lineno"> 6985</span>&#160;{</div>
<div class="line"><a name="l06986"></a><span class="lineno"> 6986</span>&#160;    open_tun_generic(dev, dev_type, dev_node, <span class="keyword">true</span>, tt);</div>
<div class="line"><a name="l06987"></a><span class="lineno"> 6987</span>&#160;}</div>
<div class="line"><a name="l06988"></a><span class="lineno"> 6988</span>&#160; </div>
<div class="line"><a name="l06989"></a><span class="lineno"> 6989</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l06990"></a><span class="lineno"> 6990</span>&#160;<a class="code" href="tun_8c.html#aa160989ccb62fe8390475d34bda3d2f8">close_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a> *ctx)</div>
<div class="line"><a name="l06991"></a><span class="lineno"> 6991</span>&#160;{</div>
<div class="line"><a name="l06992"></a><span class="lineno"> 6992</span>&#160;    <a class="code" href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(tt);</div>
<div class="line"><a name="l06993"></a><span class="lineno"> 6993</span>&#160; </div>
<div class="line"><a name="l06994"></a><span class="lineno"> 6994</span>&#160;    close_tun_generic(tt);</div>
<div class="line"><a name="l06995"></a><span class="lineno"> 6995</span>&#160;    free(tt);</div>
<div class="line"><a name="l06996"></a><span class="lineno"> 6996</span>&#160;}</div>
<div class="line"><a name="l06997"></a><span class="lineno"> 6997</span>&#160; </div>
<div class="line"><a name="l06998"></a><span class="lineno"> 6998</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l06999"></a><span class="lineno"> 6999</span>&#160;<a class="code" href="tun_8h.html#afdac6b3217749dccb863f9dc39818b9d">write_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>)</div>
<div class="line"><a name="l07000"></a><span class="lineno"> 7000</span>&#160;{</div>
<div class="line"><a name="l07001"></a><span class="lineno"> 7001</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aae835b662be01cdc3752f7db84529cca">write</a>(tt-&gt;fd, buf, <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>);</div>
<div class="line"><a name="l07002"></a><span class="lineno"> 7002</span>&#160;}</div>
<div class="line"><a name="l07003"></a><span class="lineno"> 7003</span>&#160; </div>
<div class="line"><a name="l07004"></a><span class="lineno"> 7004</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l07005"></a><span class="lineno"> 7005</span>&#160;<a class="code" href="tun_8h.html#ac75f33ac5fe746f7bf5733d9e8c67bf2">read_tun</a>(<span class="keyword">struct</span> <a class="code" href="structtuntap.html">tuntap</a> *tt, <a class="code" href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> *buf, <span class="keywordtype">int</span> <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>)</div>
<div class="line"><a name="l07006"></a><span class="lineno"> 7006</span>&#160;{</div>
<div class="line"><a name="l07007"></a><span class="lineno"> 7007</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="interactive_8c.html#af26225c1e5936add32354d6633b47567aea7c12cb3031ad9e88104ce9859ce1c5">read</a>(tt-&gt;fd, buf, <a class="code" href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">len</a>);</div>
<div class="line"><a name="l07008"></a><span class="lineno"> 7008</span>&#160;}</div>
<div class="line"><a name="l07009"></a><span class="lineno"> 7009</span>&#160; </div>
<div class="line"><a name="l07010"></a><span class="lineno"> 7010</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* if defined (TARGET_ANDROID) */</span><span class="preprocessor"></span></div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="awin32_8c_html_a54e5d5f1a97ec870b32b6a48fd0a69b5"><div class="ttname"><a href="win32_8c.html#a54e5d5f1a97ec870b32b6a48fd0a69b5">overlapped_io_state_ascii</a></div><div class="ttdeci">char * overlapped_io_state_ascii(const struct overlapped_io *o)</div><div class="ttdef"><b>Definition:</b> <a href="win32_8c_source.html#l00205">win32.c:205</a></div></div>
<div class="ttc" id="abuffer_8h_html_abcd04f5c1caaf855ccf7c947af21b6a6"><div class="ttname"><a href="buffer_8h.html#abcd04f5c1caaf855ccf7c947af21b6a6">buf_write</a></div><div class="ttdeci">static bool buf_write(struct buffer *dest, const void *src, int size)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00673">buffer.h:673</a></div></div>
<div class="ttc" id="aconfig-msvc_8h_html_ac99ec3f1036620727a68aa8c25a8963c"><div class="ttname"><a href="config-msvc_8h.html#ac99ec3f1036620727a68aa8c25a8963c">strcasecmp</a></div><div class="ttdeci">#define strcasecmp</div><div class="ttdef"><b>Definition:</b> <a href="config-msvc_8h_source.html#l00134">config-msvc.h:134</a></div></div>
<div class="ttc" id="astructgc__arena_html_a88f958412dce42ad5ab9ca27bfb40d4f"><div class="ttname"><a href="structgc__arena.html#a88f958412dce42ad5ab9ca27bfb40d4f">gc_arena::list</a></div><div class="ttdeci">struct gc_entry * list</div><div class="ttdoc">First element of the linked list of gc_entry structures.</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00118">buffer.h:118</a></div></div>
<div class="ttc" id="asocket_8h_html_a7b81d0eeab47d45f1dd40386f6910424"><div class="ttname"><a href="socket_8h.html#a7b81d0eeab47d45f1dd40386f6910424">GETADDR_FATAL_ON_SIGNAL</a></div><div class="ttdeci">#define GETADDR_FATAL_ON_SIGNAL</div><div class="ttdef"><b>Definition:</b> <a href="socket_8h_source.html#l00527">socket.h:527</a></div></div>
<div class="ttc" id="atun_8c_html_a370c6b553694cc06301b90ccae6ca759"><div class="ttname"><a href="tun_8c.html#a370c6b553694cc06301b90ccae6ca759">netsh_delete_address_dns</a></div><div class="ttdeci">static void netsh_delete_address_dns(const struct tuntap *tt, bool ipv6, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06745">tun.c:6745</a></div></div>
<div class="ttc" id="atun_8c_html_ae4aac9803755917377784cb752dcd6e0"><div class="ttname"><a href="tun_8c.html#ae4aac9803755917377784cb752dcd6e0">tun_standby_init</a></div><div class="ttdeci">void tun_standby_init(struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05695">tun.c:5695</a></div></div>
<div class="ttc" id="astructtuntap_html_ab792981b95a153fc157417b34a2eabac"><div class="ttname"><a href="structtuntap.html#ab792981b95a153fc157417b34a2eabac">tuntap::reads</a></div><div class="ttdeci">struct overlapped_io reads</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00180">tun.h:180</a></div></div>
<div class="ttc" id="atun_8c_html_a34e614562ee36319cb88ad134de7d12c"><div class="ttname"><a href="tun_8c.html#a34e614562ee36319cb88ad134de7d12c">dhcp_renew_by_adapter_index</a></div><div class="ttdeci">bool dhcp_renew_by_adapter_index(const DWORD adapter_index)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05166">tun.c:5166</a></div></div>
<div class="ttc" id="atun_8h_html_ac75f33ac5fe746f7bf5733d9e8c67bf2"><div class="ttname"><a href="tun_8h.html#ac75f33ac5fe746f7bf5733d9e8c67bf2">read_tun</a></div><div class="ttdeci">int read_tun(struct tuntap *tt, uint8_t *buf, int len)</div></div>
<div class="ttc" id="amanage_8c_html_a8ad93473fd4ba6402ecea847d69afae1"><div class="ttname"><a href="manage_8c.html#a8ad93473fd4ba6402ecea847d69afae1">management_set_state</a></div><div class="ttdeci">void management_set_state(struct management *man, const int state, const char *detail, const in_addr_t *tun_local_ip, const struct in6_addr *tun_local_ip6, const struct openvpn_sockaddr *local, const struct openvpn_sockaddr *remote)</div><div class="ttdef"><b>Definition:</b> <a href="manage_8c_source.html#l02751">manage.c:2751</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a6f06463f38c72dc9b8c2907b6ab9a6c9"><div class="ttname"><a href="structtuntap__options.html#a6f06463f38c72dc9b8c2907b6ab9a6c9">tuntap_options::dhcp_masq_custom_offset</a></div><div class="ttdeci">bool dhcp_masq_custom_offset</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00079">tun.h:79</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a5c59bd51c39835c98556b124f30611b6"><div class="ttname"><a href="structtuntap__options.html#a5c59bd51c39835c98556b124f30611b6">tuntap_options::dns</a></div><div class="ttdeci">in_addr_t dns[N_DHCP_ADDR]</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00099">tun.h:99</a></div></div>
<div class="ttc" id="atun_8c_html_ad8365278b4f196950c8a29745b361e0a"><div class="ttname"><a href="tun_8c.html#ad8365278b4f196950c8a29745b361e0a">do_ifconfig_setenv</a></div><div class="ttdeci">void do_ifconfig_setenv(const struct tuntap *tt, struct env_set *es)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00692">tun.c:692</a></div></div>
<div class="ttc" id="astructkey2_html_a325d016ea0977d9569d3d75fd4e7fe06"><div class="ttname"><a href="structkey2.html#a325d016ea0977d9569d3d75fd4e7fe06">key2::n</a></div><div class="ttdeci">int n</div><div class="ttdoc">The number of key objects stored in the key2.keys array.</div><div class="ttdef"><b>Definition:</b> <a href="crypto_8h_source.html#l00183">crypto.h:183</a></div></div>
<div class="ttc" id="atun_8c_html_a6b1909af4bc0f83c57cdde3649cc50b8"><div class="ttname"><a href="tun_8c.html#a6b1909af4bc0f83c57cdde3649cc50b8">delete_temp_addresses</a></div><div class="ttdeci">static void delete_temp_addresses(DWORD index)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04789">tun.c:4789</a></div></div>
<div class="ttc" id="aroute_8h_html_ad868f081f0334c1a64d0682283139425"><div class="ttname"><a href="route_8h.html#ad868f081f0334c1a64d0682283139425">RT_DEFINED</a></div><div class="ttdeci">#define RT_DEFINED</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00113">route.h:113</a></div></div>
<div class="ttc" id="astructrw__handle_html_a81c9d90f164f2f82f13b43193d7e690b"><div class="ttname"><a href="structrw__handle.html#a81c9d90f164f2f82f13b43193d7e690b">rw_handle::read</a></div><div class="ttdeci">HANDLE read</div><div class="ttdef"><b>Definition:</b> <a href="win32_8h_source.html#l00076">win32.h:76</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a859f5bd9cb58522aa693930769e412bb"><div class="ttname"><a href="structtuntap__options.html#a859f5bd9cb58522aa693930769e412bb">tuntap_options::domain_search_list</a></div><div class="ttdeci">const char * domain_search_list[N_SEARCH_LIST_LEN]</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00117">tun.h:117</a></div></div>
<div class="ttc" id="aerrlevel_8h_html_a7b242eaaa97c7e6473a58b26e83fe06d"><div class="ttname"><a href="errlevel_8h.html#a7b242eaaa97c7e6473a58b26e83fe06d">D_WIN32_IO</a></div><div class="ttdeci">#define D_WIN32_IO</div><div class="ttdef"><b>Definition:</b> <a href="errlevel_8h_source.html#l00171">errlevel.h:171</a></div></div>
<div class="ttc" id="atun_8c_html_aaed8ba449c46f58edb6cc252c652d229"><div class="ttname"><a href="tun_8c.html#aaed8ba449c46f58edb6cc252c652d229">at_least_one_tap_win</a></div><div class="ttdeci">static void at_least_one_tap_win(const struct tap_reg *tap_reg)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04219">tun.c:4219</a></div></div>
<div class="ttc" id="awin32_8c_html_a6bb04e9d47205ae4a7dcc6a8c9e0a15a"><div class="ttname"><a href="win32_8c.html#a6bb04e9d47205ae4a7dcc6a8c9e0a15a">fork_to_self</a></div><div class="ttdeci">void fork_to_self(const char *cmdline)</div><div class="ttdef"><b>Definition:</b> <a href="win32_8c_source.html#l01177">win32.c:1177</a></div></div>
<div class="ttc" id="astructaddress__message__t_html"><div class="ttname"><a href="structaddress__message__t.html">address_message_t</a></div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00062">openvpn-msg.h:62</a></div></div>
<div class="ttc" id="aerrlevel_8h_html_ade61794318f1bbcac19df28e2fe83260"><div class="ttname"><a href="errlevel_8h.html#ade61794318f1bbcac19df28e2fe83260">M_INFO</a></div><div class="ttdeci">#define M_INFO</div><div class="ttdef"><b>Definition:</b> <a href="errlevel_8h_source.html#l00055">errlevel.h:55</a></div></div>
<div class="ttc" id="astructsecurity__attributes_html"><div class="ttname"><a href="structsecurity__attributes.html">security_attributes</a></div><div class="ttdef"><b>Definition:</b> <a href="win32_8h_source.html#l00058">win32.h:58</a></div></div>
<div class="ttc" id="astructtuntap_html_a8d99c6cfbc9fdf2c1466535afeebdbdb"><div class="ttname"><a href="structtuntap.html#a8d99c6cfbc9fdf2c1466535afeebdbdb">tuntap::did_ifconfig_setup</a></div><div class="ttdeci">bool did_ifconfig_setup</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00158">tun.h:158</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a82e60f4c2f209966b8867f60e49d975f"><div class="ttname"><a href="structtuntap__options.html#a82e60f4c2f209966b8867f60e49d975f">tuntap_options::dhcp_renew</a></div><div class="ttdeci">bool dhcp_renew</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00123">tun.h:123</a></div></div>
<div class="ttc" id="aroute_8h_html_a6ec44fb3d21f1f44426b0c4893aeefeb"><div class="ttname"><a href="route_8h.html#a6ec44fb3d21f1f44426b0c4893aeefeb">RT_ADDED</a></div><div class="ttdeci">#define RT_ADDED</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00114">route.h:114</a></div></div>
<div class="ttc" id="aroute_8c_html_ad7168a54dce4dd829133c755667c0c03"><div class="ttname"><a href="route_8c.html#ad7168a54dce4dd829133c755667c0c03">route_ipv6_clear_host_bits</a></div><div class="ttdeci">void route_ipv6_clear_host_bits(struct route_ipv6 *r6)</div><div class="ttdef"><b>Definition:</b> <a href="route_8c_source.html#l01854">route.c:1854</a></div></div>
<div class="ttc" id="astructaddress__message__t_html_afd2925f26e189670d192d5709d148d7b"><div class="ttname"><a href="structaddress__message__t.html#afd2925f26e189670d192d5709d148d7b">address_message_t::iface</a></div><div class="ttdeci">interface_t iface</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00067">openvpn-msg.h:67</a></div></div>
<div class="ttc" id="atun_8h_html_aec21d0e0ce49ddd2870e2b61486305c5a84774ae3fbc0453084663006f3f21835"><div class="ttname"><a href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5a84774ae3fbc0453084663006f3f21835">WINDOWS_DRIVER_UNSPECIFIED</a></div><div class="ttdeci">@ WINDOWS_DRIVER_UNSPECIFIED</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00048">tun.h:48</a></div></div>
<div class="ttc" id="astructenv__set_html_ac1f5edea620699ff13763b84a008e365"><div class="ttname"><a href="structenv__set.html#ac1f5edea620699ff13763b84a008e365">env_set::gc</a></div><div class="ttdeci">struct gc_arena * gc</div><div class="ttdef"><b>Definition:</b> <a href="env__set_8h_source.html#l00043">env_set.h:43</a></div></div>
<div class="ttc" id="astructdevice__instance__id__interface_html_ad6406b583eb3aa6dd03b66a22252640e"><div class="ttname"><a href="structdevice__instance__id__interface.html#ad6406b583eb3aa6dd03b66a22252640e">device_instance_id_interface::next</a></div><div class="ttdeci">struct device_instance_id_interface * next</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00394">tun.h:394</a></div></div>
<div class="ttc" id="astructoverlapped__io_html_a2b99716d4793c43eaa1584eb73e644f1"><div class="ttname"><a href="structoverlapped__io.html#a2b99716d4793c43eaa1584eb73e644f1">overlapped_io::buf</a></div><div class="ttdeci">struct buffer buf</div><div class="ttdef"><b>Definition:</b> <a href="win32_8h_source.html#l00214">win32.h:214</a></div></div>
<div class="ttc" id="aproto_8h_html_a541255b8640c189d1bd902f1168b1ee5"><div class="ttname"><a href="proto_8h.html#a541255b8640c189d1bd902f1168b1ee5">DEV_TYPE_NULL</a></div><div class="ttdeci">#define DEV_TYPE_NULL</div><div class="ttdef"><b>Definition:</b> <a href="proto_8h_source.html#l00036">proto.h:36</a></div></div>
<div class="ttc" id="aopenvpn-msg_8h_html_a78b97fef55da786a15a849fd9d7e557caebd78f318d63ad9c30e07ecf3af59916"><div class="ttname"><a href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557caebd78f318d63ad9c30e07ecf3af59916">msg_del_dns_cfg</a></div><div class="ttdeci">@ msg_del_dns_cfg</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00034">openvpn-msg.h:34</a></div></div>
<div class="ttc" id="atun_8c_html_a658237b01d9cd3e4597232c10e4c8ef3"><div class="ttname"><a href="tun_8c.html#a658237b01d9cd3e4597232c10e4c8ef3">DHCP_STATUS_DISABLED</a></div><div class="ttdeci">#define DHCP_STATUS_DISABLED</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04757">tun.c:4757</a></div></div>
<div class="ttc" id="atun_8c_html_a9ed37827909cba4c086efb61bc50300f"><div class="ttname"><a href="tun_8c.html#a9ed37827909cba4c086efb61bc50300f">write_dhcp_str</a></div><div class="ttdeci">static void write_dhcp_str(struct buffer *buf, const int type, const char *str, bool *error)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05773">tun.c:5773</a></div></div>
<div class="ttc" id="abuffer_8h_html_ae55eafba09aa53323a5ce9e85f00f710"><div class="ttname"><a href="buffer_8h.html#ae55eafba09aa53323a5ce9e85f00f710">gc_new</a></div><div class="ttdeci">static struct gc_arena gc_new(void)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l01024">buffer.h:1024</a></div></div>
<div class="ttc" id="atun_8c_html_a93c06e46676d0c56871eb1a71fc0c58e"><div class="ttname"><a href="tun_8c.html#a93c06e46676d0c56871eb1a71fc0c58e">do_ifconfig</a></div><div class="ttdeci">void do_ifconfig(struct tuntap *tt, const char *ifname, int tun_mtu, const struct env_set *es, openvpn_net_ctx_t *ctx)</div><div class="ttdoc">do_ifconfig - configure the tunnel interface</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l01576">tun.c:1576</a></div></div>
<div class="ttc" id="arun__command_8h_html"><div class="ttname"><a href="run__command_8h.html">run_command.h</a></div></div>
<div class="ttc" id="aopenvpn_2error_8h_html_ae003b2ded77b3b3d78acda1afc93fcc9"><div class="ttname"><a href="openvpn_2error_8h.html#ae003b2ded77b3b3d78acda1afc93fcc9">M_ERRNO</a></div><div class="ttdeci">#define M_ERRNO</div><div class="ttdef"><b>Definition:</b> <a href="openvpn_2error_8h_source.html#l00096">error.h:96</a></div></div>
<div class="ttc" id="aproto_8h_html_a7bd06f1b39bc1fa6f63378e4cf00bac0"><div class="ttname"><a href="proto_8h.html#a7bd06f1b39bc1fa6f63378e4cf00bac0">DEV_TYPE_TUN</a></div><div class="ttdeci">#define DEV_TYPE_TUN</div><div class="ttdef"><b>Definition:</b> <a href="proto_8h_source.html#l00037">proto.h:37</a></div></div>
<div class="ttc" id="astructtuntap__options_html_aeae464f77d3fa52255121667014415b6"><div class="ttname"><a href="structtuntap__options.html#aeae464f77d3fa52255121667014415b6">tuntap_options::register_dns</a></div><div class="ttdeci">bool register_dns</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00126">tun.h:126</a></div></div>
<div class="ttc" id="anetworking_8h_html"><div class="ttname"><a href="networking_8h.html">networking.h</a></div></div>
<div class="ttc" id="awin32_8c_html_a7c43018c3610f281fbcd28c092d29619"><div class="ttname"><a href="win32_8c.html#a7c43018c3610f281fbcd28c092d29619">send_msg_iservice</a></div><div class="ttdeci">bool send_msg_iservice(HANDLE pipe, const void *data, size_t size, ack_message_t *ack, const char *context)</div><div class="ttdef"><b>Definition:</b> <a href="win32_8c_source.html#l01500">win32.c:1500</a></div></div>
<div class="ttc" id="aerrlevel_8h_html_a42075a3cc301bcd3575ed219c1f01a3e"><div class="ttname"><a href="errlevel_8h.html#a42075a3cc301bcd3575ed219c1f01a3e">D_IFCONFIG</a></div><div class="ttdeci">#define D_IFCONFIG</div><div class="ttdef"><b>Definition:</b> <a href="errlevel_8h_source.html#l00094">errlevel.h:94</a></div></div>
<div class="ttc" id="aerrlevel_8h_html_a12fd3192e01eb423295217076c872a3f"><div class="ttname"><a href="errlevel_8h.html#a12fd3192e01eb423295217076c872a3f">D_TAP_WIN_DEBUG</a></div><div class="ttdeci">#define D_TAP_WIN_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="errlevel_8h_source.html#l00116">errlevel.h:116</a></div></div>
<div class="ttc" id="aconfig_8h_html_a792edd69443b63f4317d0c55908ce3f2"><div class="ttname"><a href="config_8h.html#a792edd69443b63f4317d0c55908ce3f2">ROUTE_PATH</a></div><div class="ttdeci">#define ROUTE_PATH</div><div class="ttdef"><b>Definition:</b> <a href="config_8h_source.html#l00769">config.h:769</a></div></div>
<div class="ttc" id="aopenvpn_2error_8c_html_a1e61c0e6a83a5259646db2683409f04b"><div class="ttname"><a href="openvpn_2error_8c.html#a1e61c0e6a83a5259646db2683409f04b">strerror_win32</a></div><div class="ttdeci">const char * strerror_win32(DWORD errnum, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="openvpn_2error_8c_source.html#l00827">error.c:827</a></div></div>
<div class="ttc" id="astructbuffer_html_ada52eab703a091ff327114b3b3b0140a"><div class="ttname"><a href="structbuffer.html#ada52eab703a091ff327114b3b3b0140a">buffer::len</a></div><div class="ttdeci">int len</div><div class="ttdoc">Length in bytes of the actual content within the allocated memory.</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00066">buffer.h:66</a></div></div>
<div class="ttc" id="atun_8c_html_a2850ffc60ed5bc65df05ead16a4e8bc3"><div class="ttname"><a href="tun_8c.html#a2850ffc60ed5bc65df05ead16a4e8bc3">get_adapter_by_name</a></div><div class="ttdeci">static const struct tap_reg * get_adapter_by_name(const char *name, const struct tap_reg *tap_reg, const struct panel_reg *panel_reg)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04203">tun.c:4203</a></div></div>
<div class="ttc" id="abuffer_8h_html_a65b6eb18e921471079b1cff89fe0db39"><div class="ttname"><a href="buffer_8h.html#a65b6eb18e921471079b1cff89fe0db39">has_digit</a></div><div class="ttdeci">static bool has_digit(const unsigned char *src)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00359">buffer.h:359</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a122a1b09c383eb9c2bc529ce6de8efb9"><div class="ttname"><a href="structtuntap__options.html#a122a1b09c383eb9c2bc529ce6de8efb9">tuntap_options::nbdd</a></div><div class="ttdeci">in_addr_t nbdd[N_DHCP_ADDR]</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00111">tun.h:111</a></div></div>
<div class="ttc" id="atun_8c_html_a8ed81f24edc25b83eba293057754830b"><div class="ttname"><a href="tun_8c.html#a8ed81f24edc25b83eba293057754830b">open_tun</a></div><div class="ttdeci">void open_tun(const char *dev, const char *dev_type, const char *dev_node, struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06680">tun.c:6680</a></div></div>
<div class="ttc" id="aopenvpn_2error_8h_html_a65ed7f4ae1be12a19362e90b962d72ac"><div class="ttname"><a href="openvpn_2error_8h.html#a65ed7f4ae1be12a19362e90b962d72ac">M_FATAL</a></div><div class="ttdeci">#define M_FATAL</div><div class="ttdef"><b>Definition:</b> <a href="openvpn_2error_8h_source.html#l00091">error.h:91</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a35d7686dee432877c5e5b3671551d4db"><div class="ttname"><a href="structtuntap__options.html#a35d7686dee432877c5e5b3671551d4db">tuntap_options::tap_sleep</a></div><div class="ttdeci">int tap_sleep</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00084">tun.h:84</a></div></div>
<div class="ttc" id="awin32_8h_html"><div class="ttname"><a href="win32_8h.html">win32.h</a></div></div>
<div class="ttc" id="aenv__set_8c_html_a2d1a7f0ea69776000aa9df3eca186f97"><div class="ttname"><a href="env__set_8c.html#a2d1a7f0ea69776000aa9df3eca186f97">env_set_destroy</a></div><div class="ttdeci">void env_set_destroy(struct env_set *es)</div><div class="ttdef"><b>Definition:</b> <a href="env__set_8c_source.html#l00168">env_set.c:168</a></div></div>
<div class="ttc" id="aopenvpn-msg_8h_html_a78b97fef55da786a15a849fd9d7e557cab48ee16bd1edceb7a255eaf14de2025b"><div class="ttname"><a href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557cab48ee16bd1edceb7a255eaf14de2025b">msg_add_dns_cfg</a></div><div class="ttdeci">@ msg_add_dns_cfg</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00033">openvpn-msg.h:33</a></div></div>
<div class="ttc" id="astructtuntap_html_a859337e1a4e77338299c25b8563410ed"><div class="ttname"><a href="structtuntap.html#a859337e1a4e77338299c25b8563410ed">tuntap::windows_driver</a></div><div class="ttdeci">enum windows_driver_type windows_driver</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00195">tun.h:195</a></div></div>
<div class="ttc" id="astructroute__gateway__info_html"><div class="ttname"><a href="structroute__gateway__info.html">route_gateway_info</a></div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00146">route.h:146</a></div></div>
<div class="ttc" id="astructargv_html"><div class="ttname"><a href="structargv.html">argv</a></div><div class="ttdef"><b>Definition:</b> <a href="argv_8h_source.html#l00035">argv.h:35</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a7b1359366bca57d18e27a1bf16883406"><div class="ttname"><a href="structtuntap__options.html#a7b1359366bca57d18e27a1bf16883406">tuntap_options::domain_search_list_len</a></div><div class="ttdeci">int domain_search_list_len</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00118">tun.h:118</a></div></div>
<div class="ttc" id="aconfig-msvc_8h_html_a64ca7e440847b0f5d19cbe94f9e114bd"><div class="ttname"><a href="config-msvc_8h.html#a64ca7e440847b0f5d19cbe94f9e114bd">in_addr_t</a></div><div class="ttdeci">#define in_addr_t</div><div class="ttdef"><b>Definition:</b> <a href="config-msvc_8h_source.html#l00144">config-msvc.h:144</a></div></div>
<div class="ttc" id="awin32_8c_html_acc83a5e3ac577a6c50fff6d71f232e41"><div class="ttname"><a href="win32_8c.html#acc83a5e3ac577a6c50fff6d71f232e41">netcmd_semaphore_lock</a></div><div class="ttdeci">void netcmd_semaphore_lock(void)</div><div class="ttdef"><b>Definition:</b> <a href="win32_8c_source.html#l00867">win32.c:867</a></div></div>
<div class="ttc" id="atun_8c_html_a38c2e09ededa0716f39cf2ea05042f2b"><div class="ttname"><a href="tun_8c.html#a38c2e09ededa0716f39cf2ea05042f2b">ascii2ipset</a></div><div class="ttdeci">int ascii2ipset(const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06935">tun.c:6935</a></div></div>
<div class="ttc" id="aopenvpn_2error_8h_html_a9e1c690bc419010e6e8346d28a237941"><div class="ttname"><a href="openvpn_2error_8h.html#a9e1c690bc419010e6e8346d28a237941">M_NONFATAL</a></div><div class="ttdeci">#define M_NONFATAL</div><div class="ttdef"><b>Definition:</b> <a href="openvpn_2error_8h_source.html#l00092">error.h:92</a></div></div>
<div class="ttc" id="amanage_8h_html"><div class="ttname"><a href="manage_8h.html">manage.h</a></div></div>
<div class="ttc" id="aopenvpn-msg_8h_html_a78b97fef55da786a15a849fd9d7e557cab6894e32e7a6da416509e997ef0c1ebd"><div class="ttname"><a href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557cab6894e32e7a6da416509e997ef0c1ebd">msg_register_dns</a></div><div class="ttdeci">@ msg_register_dns</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00040">openvpn-msg.h:40</a></div></div>
<div class="ttc" id="atun_8c_html_a2758a9aa8e7fdef2a6db76f248150b46"><div class="ttname"><a href="tun_8c.html#a2758a9aa8e7fdef2a6db76f248150b46">netsh_enable_dhcp</a></div><div class="ttdeci">static void netsh_enable_dhcp(DWORD adapter_index)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05556">tun.c:5556</a></div></div>
<div class="ttc" id="amanage_8c_html_af07a56f96cec84856d0bf97899a4d460"><div class="ttname"><a href="manage_8c.html#af07a56f96cec84856d0bf97899a4d460">management_sleep</a></div><div class="ttdeci">void management_sleep(const int n)</div><div class="ttdoc">A sleep function that services the management layer for n seconds rather than doing nothing.</div><div class="ttdef"><b>Definition:</b> <a href="manage_8c_source.html#l04128">manage.c:4128</a></div></div>
<div class="ttc" id="atun_8c_html_a1d5d5169074921cd8315ae3b537d003d"><div class="ttname"><a href="tun_8c.html#a1d5d5169074921cd8315ae3b537d003d">GUID_DEVINTERFACE_NET</a></div><div class="ttdeci">const static GUID GUID_DEVINTERFACE_NET</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00062">tun.c:62</a></div></div>
<div class="ttc" id="astructdns__cfg__message__t_html"><div class="ttname"><a href="structdns__cfg__message__t.html">dns_cfg_message_t</a></div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00080">openvpn-msg.h:80</a></div></div>
<div class="ttc" id="atun_8c_html_abab0251811d3e8ef1e4891ca107d1f2e"><div class="ttname"><a href="tun_8c.html#abab0251811d3e8ef1e4891ca107d1f2e">dhcp_renew</a></div><div class="ttdeci">static bool dhcp_renew(const struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05192">tun.c:5192</a></div></div>
<div class="ttc" id="atun_8c_html_aeccf147b82b28465ee451a79fc267a29"><div class="ttname"><a href="tun_8c.html#aeccf147b82b28465ee451a79fc267a29">service_register_ring_buffers</a></div><div class="ttdeci">static bool service_register_ring_buffers(const struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05968">tun.c:5968</a></div></div>
<div class="ttc" id="atun_8c_html_abee93e70e0d1c09bd532b699ba926fd2"><div class="ttname"><a href="tun_8c.html#abee93e70e0d1c09bd532b699ba926fd2">write_dhcp_u32_array</a></div><div class="ttdeci">static void write_dhcp_u32_array(struct buffer *buf, const int type, const uint32_t *data, const unsigned int len, bool *error)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05744">tun.c:5744</a></div></div>
<div class="ttc" id="astructcontext_html"><div class="ttname"><a href="structcontext.html">context</a></div><div class="ttdoc">Contains all state information for one tunnel.</div><div class="ttdef"><b>Definition:</b> <a href="openvpn_8h_source.html#l00489">openvpn.h:489</a></div></div>
<div class="ttc" id="astructroute__ipv6_html_ab356df748374308f70a7f7495fdb4a4c"><div class="ttname"><a href="structroute__ipv6.html#ab356df748374308f70a7f7495fdb4a4c">route_ipv6::metric</a></div><div class="ttdeci">int metric</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00131">route.h:131</a></div></div>
<div class="ttc" id="astructdns__cfg__message__t_html_ac1f3808caec2e43591a188bc05993d29"><div class="ttname"><a href="structdns__cfg__message__t.html#ac1f3808caec2e43591a188bc05993d29">dns_cfg_message_t::iface</a></div><div class="ttdeci">interface_t iface</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00082">openvpn-msg.h:82</a></div></div>
<div class="ttc" id="astructset__mtu__message__t_html_ac473c62a4ef12508d9a27e2ce6d8ce0b"><div class="ttname"><a href="structset__mtu__message__t.html#ac473c62a4ef12508d9a27e2ce6d8ce0b">set_mtu_message_t::iface</a></div><div class="ttdeci">interface_t iface</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00133">openvpn-msg.h:133</a></div></div>
<div class="ttc" id="astructtuntap__options_html_abeee0fcef71945ad2f37662eb02d4969"><div class="ttname"><a href="structtuntap__options.html#abeee0fcef71945ad2f37662eb02d4969">tuntap_options::netbios_node_type</a></div><div class="ttdeci">int netbios_node_type</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00094">tun.h:94</a></div></div>
<div class="ttc" id="abuffer_8h_html_a34c800967d7b9583cb64236eadab94dd"><div class="ttname"><a href="buffer_8h.html#a34c800967d7b9583cb64236eadab94dd">BSTR</a></div><div class="ttdeci">#define BSTR(buf)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00129">buffer.h:129</a></div></div>
<div class="ttc" id="astructtuntap_html_a33cc194495f4f5cac85cd788defc2350"><div class="ttname"><a href="structtuntap.html#a33cc194495f4f5cac85cd788defc2350">tuntap::type</a></div><div class="ttdeci">int type</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00153">tun.h:153</a></div></div>
<div class="ttc" id="astructenable__dhcp__message__t_html"><div class="ttname"><a href="structenable__dhcp__message__t.html">enable_dhcp_message_t</a></div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00117">openvpn-msg.h:117</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a0c6192bde6c53d07a9953e43d3594f3c"><div class="ttname"><a href="structtuntap__options.html#a0c6192bde6c53d07a9953e43d3594f3c">tuntap_options::dhcp_options</a></div><div class="ttdeci">bool dhcp_options</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00088">tun.h:88</a></div></div>
<div class="ttc" id="asocket_8c_html_aed74c8b5931192c1ad5829bd90e01603"><div class="ttname"><a href="socket_8c.html#aed74c8b5931192c1ad5829bd90e01603">getaddr</a></div><div class="ttdeci">in_addr_t getaddr(unsigned int flags, const char *hostname, int resolve_retry_seconds, bool *succeeded, volatile int *signal_received)</div><div class="ttdoc">Translate an IPv4 addr or hostname from string form to in_addr_t.</div><div class="ttdef"><b>Definition:</b> <a href="socket_8c_source.html#l00193">socket.c:193</a></div></div>
<div class="ttc" id="aerrlevel_8h_html_aab9d07562cfecbd96b4c9e1d242d7d15"><div class="ttname"><a href="errlevel_8h.html#aab9d07562cfecbd96b4c9e1d242d7d15">D_MTU_INFO</a></div><div class="ttdeci">#define D_MTU_INFO</div><div class="ttdef"><b>Definition:</b> <a href="errlevel_8h_source.html#l00107">errlevel.h:107</a></div></div>
<div class="ttc" id="atun_8c_html_ab0f91db5420a16a2656811d0749978f4"><div class="ttname"><a href="tun_8c.html#ab0f91db5420a16a2656811d0749978f4">warn_on_use_of_common_subnets</a></div><div class="ttdeci">void warn_on_use_of_common_subnets(openvpn_net_ctx_t *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00570">tun.c:570</a></div></div>
<div class="ttc" id="atun_8c_html_a35735fa1394f24ce60e0876fa0d0cc7e"><div class="ttname"><a href="tun_8c.html#a35735fa1394f24ce60e0876fa0d0cc7e">tuntap_get_version_info</a></div><div class="ttdeci">static void tuntap_get_version_info(const struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06056">tun.c:6056</a></div></div>
<div class="ttc" id="atun_8c_html_a4b412ed4d7fe20229984758b0debde74"><div class="ttname"><a href="tun_8c.html#a4b412ed4d7fe20229984758b0debde74">fork_dhcp_action</a></div><div class="ttdeci">static void fork_dhcp_action(struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05913">tun.c:5913</a></div></div>
<div class="ttc" id="aargv_8c_html_ad62a50a5c6133eaea0422cee6ba840cf"><div class="ttname"><a href="argv_8c.html#ad62a50a5c6133eaea0422cee6ba840cf">argv_printf_cat</a></div><div class="ttdeci">bool argv_printf_cat(struct argv *argres, const char *format,...)</div><div class="ttdoc">printf() inspired argv concatenation.</div><div class="ttdef"><b>Definition:</b> <a href="argv_8c_source.html#l00466">argv.c:466</a></div></div>
<div class="ttc" id="acompat-lz4_8h_html_aedfbaa502c9c447fc19b72fec8fc48e0"><div class="ttname"><a href="compat-lz4_8h.html#aedfbaa502c9c447fc19b72fec8fc48e0">dest</a></div><div class="ttdeci">char * dest</div><div class="ttdef"><b>Definition:</b> <a href="compat-lz4_8h_source.html#l00686">compat-lz4.h:686</a></div></div>
<div class="ttc" id="abuffer_8c_html_aa35bf7feb6a99bf5d364b2d4eba1195c"><div class="ttname"><a href="buffer_8c.html#aa35bf7feb6a99bf5d364b2d4eba1195c">alloc_buf_gc</a></div><div class="ttdeci">struct buffer alloc_buf_gc(size_t size, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00090">buffer.c:90</a></div></div>
<div class="ttc" id="aconfig-msvc_8h_html"><div class="ttname"><a href="config-msvc_8h.html">config-msvc.h</a></div></div>
<div class="ttc" id="astructtuntap_html_aa66cb527ff9826718f381d8dece21b84"><div class="ttname"><a href="structtuntap.html#aa66cb527ff9826718f381d8dece21b84">tuntap::wintun_receive_ring</a></div><div class="ttdeci">struct tun_ring * wintun_receive_ring</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00201">tun.h:201</a></div></div>
<div class="ttc" id="aconfig-msvc-version_8h_html_a1c0439e4355794c09b64274849eb0279"><div class="ttname"><a href="config-msvc-version_8h.html#a1c0439e4355794c09b64274849eb0279">PACKAGE_NAME</a></div><div class="ttdeci">#define PACKAGE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="config-msvc-version_8h_source.html#l00001">config-msvc-version.h:1</a></div></div>
<div class="ttc" id="astructtuntap_html_ad883b47c0cf0372077f7d0670432e103"><div class="ttname"><a href="structtuntap.html#ad883b47c0cf0372077f7d0670432e103">tuntap::wintun_send_ring</a></div><div class="ttdeci">struct tun_ring * wintun_send_ring</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00200">tun.h:200</a></div></div>
<div class="ttc" id="aargv_8c_html_a8563bed2ee30eda7125eee7bdb9ab4eb"><div class="ttname"><a href="argv_8c.html#a8563bed2ee30eda7125eee7bdb9ab4eb">argv_free</a></div><div class="ttdeci">void argv_free(struct argv *a)</div><div class="ttdoc">Frees all memory allocations allocated by the struct argv related functions.</div><div class="ttdef"><b>Definition:</b> <a href="argv_8c_source.html#l00104">argv.c:104</a></div></div>
<div class="ttc" id="atun_8h_html_aec21d0e0ce49ddd2870e2b61486305c5"><div class="ttname"><a href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5">windows_driver_type</a></div><div class="ttdeci">windows_driver_type</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00047">tun.h:47</a></div></div>
<div class="ttc" id="astructroute__ipv6_html_a1253ae18a7713ae72b30a669a0bf6ae5"><div class="ttname"><a href="structroute__ipv6.html#a1253ae18a7713ae72b30a669a0bf6ae5">route_ipv6::gateway</a></div><div class="ttdeci">struct in6_addr gateway</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00130">route.h:130</a></div></div>
<div class="ttc" id="aerrlevel_8h_html_a64d3ef312f3eba119b6bf938e0a33f60"><div class="ttname"><a href="errlevel_8h.html#a64d3ef312f3eba119b6bf938e0a33f60">D_WIN32_IO_LOW</a></div><div class="ttdeci">#define D_WIN32_IO_LOW</div><div class="ttdef"><b>Definition:</b> <a href="errlevel_8h_source.html#l00123">errlevel.h:123</a></div></div>
<div class="ttc" id="atun_8h_html_a70fbb81d58b252b61ac28785673bac06"><div class="ttname"><a href="tun_8h.html#a70fbb81d58b252b61ac28785673bac06">IPW32_SET_ADAPTIVE_TRY_NETSH</a></div><div class="ttdeci">#define IPW32_SET_ADAPTIVE_TRY_NETSH</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00060">tun.h:60</a></div></div>
<div class="ttc" id="atun_8c_html_aaeb7d66a96170c82580b2e821110c745"><div class="ttname"><a href="tun_8c.html#aaeb7d66a96170c82580b2e821110c745">dev_type_string</a></div><div class="ttdeci">const char * dev_type_string(const char *dev, const char *dev_type)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00385">tun.c:385</a></div></div>
<div class="ttc" id="atun_8c_html_a010dca1493549f9daf185b9eb421ecf4"><div class="ttname"><a href="tun_8c.html#a010dca1493549f9daf185b9eb421ecf4">print_windows_driver</a></div><div class="ttdeci">static const char * print_windows_driver(enum windows_driver_type windows_driver)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l03420">tun.c:3420</a></div></div>
<div class="ttc" id="aroute_8c_html_a55de672f1ddacfdf8b5a05d924e92684"><div class="ttname"><a href="route_8c.html#a55de672f1ddacfdf8b5a05d924e92684">delete_route_ipv6</a></div><div class="ttdeci">void delete_route_ipv6(const struct route_ipv6 *r6, const struct tuntap *tt, unsigned int flags, const struct env_set *es, openvpn_net_ctx_t *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="route_8c_source.html#l02353">route.c:2353</a></div></div>
<div class="ttc" id="atun_8c_html_aaafe36001ab32673614b12083322ba55"><div class="ttname"><a href="tun_8c.html#aaafe36001ab32673614b12083322ba55">tap_allow_nonadmin_access</a></div><div class="ttdeci">void tap_allow_nonadmin_access(const char *dev_node)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05024">tun.c:5024</a></div></div>
<div class="ttc" id="astructack__message__t_html"><div class="ttname"><a href="structack__message__t.html">ack_message_t</a></div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00107">openvpn-msg.h:107</a></div></div>
<div class="ttc" id="aplatform_8c_html_ac9360f2b8017f5885191fd52e3192ddd"><div class="ttname"><a href="platform_8c.html#ac9360f2b8017f5885191fd52e3192ddd">platform_group_get</a></div><div class="ttdeci">bool platform_group_get(const char *groupname, struct platform_state_group *state)</div><div class="ttdef"><b>Definition:</b> <a href="platform_8c_source.html#l00108">platform.c:108</a></div></div>
<div class="ttc" id="astructroute__ipv6_html"><div class="ttname"><a href="structroute__ipv6.html">route_ipv6</a></div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00125">route.h:125</a></div></div>
<div class="ttc" id="astructpanel__reg_html"><div class="ttname"><a href="structpanel__reg.html">panel_reg</a></div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00383">tun.h:383</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a60da47cffc1393d9f16ddefe6f824a99"><div class="ttname"><a href="structtuntap__options.html#a60da47cffc1393d9f16ddefe6f824a99">tuntap_options::netbios_scope</a></div><div class="ttdeci">const char * netbios_scope</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00092">tun.h:92</a></div></div>
<div class="ttc" id="awin32_8c_html_a2a97ed71e42b8d67a835dca3926dd41b"><div class="ttname"><a href="win32_8c.html#a2a97ed71e42b8d67a835dca3926dd41b">overlapped_io_init</a></div><div class="ttdeci">void overlapped_io_init(struct overlapped_io *o, const struct frame *frame, BOOL event_state, bool tuntap_buffer)</div><div class="ttdef"><b>Definition:</b> <a href="win32_8c_source.html#l00173">win32.c:173</a></div></div>
<div class="ttc" id="atun_8c_html_a8ca1bf7676b89c4f0b0648001865dfc5"><div class="ttname"><a href="tun_8c.html#a8ca1bf7676b89c4f0b0648001865dfc5">delete_route_connected_v6_net</a></div><div class="ttdeci">void delete_route_connected_v6_net(const struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00959">tun.c:959</a></div></div>
<div class="ttc" id="astructroute__ipv4_html_ac423abdde955f3da899a72382763b470"><div class="ttname"><a href="structroute__ipv4.html#ac423abdde955f3da899a72382763b470">route_ipv4::netmask</a></div><div class="ttdeci">in_addr_t netmask</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00120">route.h:120</a></div></div>
<div class="ttc" id="amanage_8h_html_ab76907c773f31afd5043b6c6f7a9d54d"><div class="ttname"><a href="manage_8h.html#ab76907c773f31afd5043b6c6f7a9d54d">OPENVPN_STATE_ASSIGN_IP</a></div><div class="ttdeci">#define OPENVPN_STATE_ASSIGN_IP</div><div class="ttdef"><b>Definition:</b> <a href="manage_8h_source.html#l00496">manage.h:496</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a26be5effd8b34caa515f65cfba6c89c0"><div class="ttname"><a href="structtuntap__options.html#a26be5effd8b34caa515f65cfba6c89c0">tuntap_options::ntp_len</a></div><div class="ttdeci">int ntp_len</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00108">tun.h:108</a></div></div>
<div class="ttc" id="afdmisc_8h_html"><div class="ttname"><a href="fdmisc_8h.html">fdmisc.h</a></div></div>
<div class="ttc" id="abuffer_8h_html_a3917d4f93343d7a095b63cd7f6bd9497"><div class="ttname"><a href="buffer_8h.html#a3917d4f93343d7a095b63cd7f6bd9497">buf_copy</a></div><div class="ttdeci">static bool buf_copy(struct buffer *dest, const struct buffer *src)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00718">buffer.h:718</a></div></div>
<div class="ttc" id="astructmessage__header__t_html"><div class="ttname"><a href="structmessage__header__t.html">message_header_t</a></div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00046">openvpn-msg.h:46</a></div></div>
<div class="ttc" id="atun_8c_html_adb24eb87f48b33a3646747ec0fb9d088"><div class="ttname"><a href="tun_8c.html#adb24eb87f48b33a3646747ec0fb9d088">do_set_mtu_service</a></div><div class="ttdeci">static bool do_set_mtu_service(const struct tuntap *tt, const short family, const int mtu)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00284">tun.c:284</a></div></div>
<div class="ttc" id="abuffer_8c_html_a765c29b346cf601c5e0be2fd2c935a8d"><div class="ttname"><a href="buffer_8c.html#a765c29b346cf601c5e0be2fd2c935a8d">format_hex_ex</a></div><div class="ttdeci">char * format_hex_ex(const uint8_t *data, int size, int maxoutput, unsigned int space_break_flags, const char *separator, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00499">buffer.c:499</a></div></div>
<div class="ttc" id="aroute_8c_html_a993077e75f7841305cf71aa248e287cb"><div class="ttname"><a href="route_8c.html#a993077e75f7841305cf71aa248e287cb">add_route</a></div><div class="ttdeci">void add_route(struct route_ipv4 *r, const struct tuntap *tt, unsigned int flags, const struct route_gateway_info *rgi, const struct env_set *es, openvpn_net_ctx_t *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="route_8c_source.html#l01566">route.c:1566</a></div></div>
<div class="ttc" id="aargv_8c_html_a58d2724394ee9bc29ac5d5ac2c1da102"><div class="ttname"><a href="argv_8c.html#a58d2724394ee9bc29ac5d5ac2c1da102">argv_msg_prefix</a></div><div class="ttdeci">void argv_msg_prefix(const int msglev, const struct argv *a, const char *prefix)</div><div class="ttdoc">Similar to argv_msg() but prefixes the messages being written with a given string.</div><div class="ttdef"><b>Definition:</b> <a href="argv_8c_source.html#l00262">argv.c:262</a></div></div>
<div class="ttc" id="atun_8c_html_aa40f049e49c31523d033dbcefec70255"><div class="ttname"><a href="tun_8c.html#aa40f049e49c31523d033dbcefec70255">get_adapter_index_method_2</a></div><div class="ttdeci">static DWORD get_adapter_index_method_2(const char *guid)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04848">tun.c:4848</a></div></div>
<div class="ttc" id="abuffer_8h_html_a37e343f627ab3e406db7b39cd96716d8"><div class="ttname"><a href="buffer_8h.html#a37e343f627ab3e406db7b39cd96716d8">clear_buf</a></div><div class="ttdeci">static struct buffer clear_buf(void)</div><div class="ttdoc">Return an empty struct buffer.</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00209">buffer.h:209</a></div></div>
<div class="ttc" id="aroute_8h_html_aecad0970615cbe7c7af3bbfbfc610c1e"><div class="ttname"><a href="route_8h.html#aecad0970615cbe7c7af3bbfbfc610c1e">RGI_NETMASK_DEFINED</a></div><div class="ttdeci">#define RGI_NETMASK_DEFINED</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00148">route.h:148</a></div></div>
<div class="ttc" id="atun_8c_html_a36d0521b47e5eb91b126afdd0a949420"><div class="ttname"><a href="tun_8c.html#a36d0521b47e5eb91b126afdd0a949420">service_enable_dhcp</a></div><div class="ttdeci">static bool service_enable_dhcp(const struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05574">tun.c:5574</a></div></div>
<div class="ttc" id="atun_8c_html_a4427f2e6ba60cea730cb88d0104a0923"><div class="ttname"><a href="tun_8c.html#a4427f2e6ba60cea730cb88d0104a0923">tun_try_open_device</a></div><div class="ttdeci">static bool tun_try_open_device(struct tuntap *tt, const char *device_guid, const struct device_instance_id_interface *device_instance_id_interface)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06451">tun.c:6451</a></div></div>
<div class="ttc" id="atun_8c_html_a186d3bab6f7316394df0fb85f079f8bf"><div class="ttname"><a href="tun_8c.html#a186d3bab6f7316394df0fb85f079f8bf">GUID_DEVCLASS_NET</a></div><div class="ttdeci">const static GUID GUID_DEVCLASS_NET</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00061">tun.c:61</a></div></div>
<div class="ttc" id="anetworking_8h_html_aff0b513686f6c72428bbca270ce87a77"><div class="ttname"><a href="networking_8h.html#aff0b513686f6c72428bbca270ce87a77">openvpn_net_ctx_t</a></div><div class="ttdeci">void * openvpn_net_ctx_t</div><div class="ttdef"><b>Definition:</b> <a href="networking_8h_source.html#l00026">networking.h:26</a></div></div>
<div class="ttc" id="aerrlevel_8h_html_ad7eba86279cb00fc16742e45bfcf3187"><div class="ttname"><a href="errlevel_8h.html#ad7eba86279cb00fc16742e45bfcf3187">D_LOW</a></div><div class="ttdeci">#define D_LOW</div><div class="ttdef"><b>Definition:</b> <a href="errlevel_8h_source.html#l00098">errlevel.h:98</a></div></div>
<div class="ttc" id="aopenvpn_2error_8h_html_a39772a2bdab0bd56c1b6dd518a65c2c3"><div class="ttname"><a href="openvpn_2error_8h.html#a39772a2bdab0bd56c1b6dd518a65c2c3">M_NOPREFIX</a></div><div class="ttdeci">#define M_NOPREFIX</div><div class="ttdef"><b>Definition:</b> <a href="openvpn_2error_8h_source.html#l00099">error.h:99</a></div></div>
<div class="ttc" id="atun_8c_html_a95a74147731cfdcb17a7489715ff5985"><div class="ttname"><a href="tun_8c.html#a95a74147731cfdcb17a7489715ff5985">tap_win_getinfo</a></div><div class="ttdeci">const char * tap_win_getinfo(const struct tuntap *tt, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06709">tun.c:6709</a></div></div>
<div class="ttc" id="aproto_8h_html_af4249a88f691a14cb178b7222d35e150"><div class="ttname"><a href="proto_8h.html#af4249a88f691a14cb178b7222d35e150">TOP_SUBNET</a></div><div class="ttdeci">#define TOP_SUBNET</div><div class="ttdef"><b>Definition:</b> <a href="proto_8h_source.html#l00045">proto.h:45</a></div></div>
<div class="ttc" id="aevent_8h_html_ac03f8506739d508e600347184b53e22c"><div class="ttname"><a href="event_8h.html#ac03f8506739d508e600347184b53e22c">EVENT_READ</a></div><div class="ttdeci">#define EVENT_READ</div><div class="ttdef"><b>Definition:</b> <a href="event_8h_source.html#l00036">event.h:36</a></div></div>
<div class="ttc" id="atun_8c_html_a3e6426e54ab7edeab3fe5217340a806a"><div class="ttname"><a href="tun_8c.html#a3e6426e54ab7edeab3fe5217340a806a">tuntap_set_ptp</a></div><div class="ttdeci">static void tuntap_set_ptp(const struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06318">tun.c:6318</a></div></div>
<div class="ttc" id="astructtuntap_html_abad5f3a4193f4e244d55ffd2fa41b7f0"><div class="ttname"><a href="structtuntap.html#abad5f3a4193f4e244d55ffd2fa41b7f0">tuntap::wintun_send_ring_handle</a></div><div class="ttdeci">HANDLE wintun_send_ring_handle</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00198">tun.h:198</a></div></div>
<div class="ttc" id="asocket_8h_html_adfe6548aae7be586bf39b3e14d408ec3"><div class="ttname"><a href="socket_8h.html#adfe6548aae7be586bf39b3e14d408ec3">IA_NET_ORDER</a></div><div class="ttdeci">#define IA_NET_ORDER</div><div class="ttdef"><b>Definition:</b> <a href="socket_8h_source.html#l00398">socket.h:398</a></div></div>
<div class="ttc" id="atun_8c_html_a48f484ccef829bc66fef2d6734e0a3eb"><div class="ttname"><a href="tun_8c.html#a48f484ccef829bc66fef2d6734e0a3eb">dhcp_release</a></div><div class="ttdeci">static bool dhcp_release(const struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05153">tun.c:5153</a></div></div>
<div class="ttc" id="astructplatform__state__group_html"><div class="ttname"><a href="structplatform__state__group.html">platform_state_group</a></div><div class="ttdef"><b>Definition:</b> <a href="platform_8h_source.html#l00067">platform.h:67</a></div></div>
<div class="ttc" id="aopenvpn-msg_8h_html_a78b97fef55da786a15a849fd9d7e557cadccc00b2f1d0259b83f17e8e778a4230"><div class="ttname"><a href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557cadccc00b2f1d0259b83f17e8e778a4230">msg_set_mtu</a></div><div class="ttdeci">@ msg_set_mtu</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00043">openvpn-msg.h:43</a></div></div>
<div class="ttc" id="aopenvpn-msg_8h_html_a78b97fef55da786a15a849fd9d7e557ca3040fb7d7b8355b9cfc2ea0c07b44233"><div class="ttname"><a href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557ca3040fb7d7b8355b9cfc2ea0c07b44233">msg_register_ring_buffers</a></div><div class="ttdeci">@ msg_register_ring_buffers</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00042">openvpn-msg.h:42</a></div></div>
<div class="ttc" id="atun_8c_html_ab6ace179866b796f9a2962093e36ba71"><div class="ttname"><a href="tun_8c.html#ab6ace179866b796f9a2962093e36ba71">get_tap_reg</a></div><div class="ttdeci">static const struct tap_reg * get_tap_reg(struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l03763">tun.c:3763</a></div></div>
<div class="ttc" id="aroute_8c_html_a2aee01d5c10bd617615f031180ee7062"><div class="ttname"><a href="route_8c.html#a2aee01d5c10bd617615f031180ee7062">netmask_to_netbits2</a></div><div class="ttdeci">int netmask_to_netbits2(in_addr_t netmask)</div><div class="ttdef"><b>Definition:</b> <a href="route_8c_source.html#l03912">route.c:3912</a></div></div>
<div class="ttc" id="astructframe_html"><div class="ttname"><a href="structframe.html">frame</a></div><div class="ttdoc">Packet geometry parameters.</div><div class="ttdef"><b>Definition:</b> <a href="mtu_8h_source.html#l00093">mtu.h:93</a></div></div>
<div class="ttc" id="awin32_8h_html_a26b3e132c1f135136ef00f53ff0756a2"><div class="ttname"><a href="win32_8h.html#a26b3e132c1f135136ef00f53ff0756a2">IOSTATE_IMMEDIATE_RETURN</a></div><div class="ttdeci">#define IOSTATE_IMMEDIATE_RETURN</div><div class="ttdef"><b>Definition:</b> <a href="win32_8h_source.html#l00201">win32.h:201</a></div></div>
<div class="ttc" id="astructregister__ring__buffers__message__t_html"><div class="ttname"><a href="structregister__ring__buffers__message__t.html">register_ring_buffers_message_t</a></div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00122">openvpn-msg.h:122</a></div></div>
<div class="ttc" id="atun_8c_html_aa1195a441c5f31c4904e2a3f950008e6"><div class="ttname"><a href="tun_8c.html#aa1195a441c5f31c4904e2a3f950008e6">ifconfig_sanity_check</a></div><div class="ttdeci">static void ifconfig_sanity_check(bool tun, in_addr_t addr, int topology)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00437">tun.c:437</a></div></div>
<div class="ttc" id="atun_8c_html_aee87d985f2ee8faa65c3716def4b9b8c"><div class="ttname"><a href="tun_8c.html#aee87d985f2ee8faa65c3716def4b9b8c">netsh_set_dns6_servers</a></div><div class="ttdeci">static void netsh_set_dns6_servers(const struct in6_addr *addr_list, const int addr_len, DWORD adapter_index)</div><div class="ttdoc">Set the ipv6 dns servers on the specified interface.</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05347">tun.c:5347</a></div></div>
<div class="ttc" id="aerrlevel_8h_html_a80d57c8e34010c9b942bbb9f3171050b"><div class="ttname"><a href="errlevel_8h.html#a80d57c8e34010c9b942bbb9f3171050b">D_TUNTAP_INFO</a></div><div class="ttdeci">#define D_TUNTAP_INFO</div><div class="ttdef"><b>Definition:</b> <a href="errlevel_8h_source.html#l00081">errlevel.h:81</a></div></div>
<div class="ttc" id="aenv__set_8c_html_a2ee1297d7cd864a08edff8440efa4143"><div class="ttname"><a href="env__set_8c.html#a2ee1297d7cd864a08edff8440efa4143">setenv_int</a></div><div class="ttdeci">void setenv_int(struct env_set *es, const char *name, int value)</div><div class="ttdef"><b>Definition:</b> <a href="env__set_8c_source.html#l00269">env_set.c:269</a></div></div>
<div class="ttc" id="atun_8c_html_a4f3ffb2db7a5081fb0beafdb32804821"><div class="ttname"><a href="tun_8c.html#a4f3ffb2db7a5081fb0beafdb32804821">get_adapter_ip_netmask</a></div><div class="ttdeci">static bool get_adapter_ip_netmask(const IP_ADAPTER_INFO *ai, const int n, in_addr_t *ip, in_addr_t *netmask)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04527">tun.c:4527</a></div></div>
<div class="ttc" id="aring__buffer_8h_html_ae6b27a61789e0225b13036efcd627ace"><div class="ttname"><a href="ring__buffer_8h.html#ae6b27a61789e0225b13036efcd627ace">register_ring_buffers</a></div><div class="ttdeci">static bool register_ring_buffers(HANDLE device, struct tun_ring *send_ring, struct tun_ring *receive_ring, HANDLE send_tail_moved, HANDLE receive_tail_moved)</div><div class="ttdoc">Registers ring buffers used to exchange data between userspace openvpn process and wintun kernel driv...</div><div class="ttdef"><b>Definition:</b> <a href="ring__buffer_8h_source.html#l00098">ring_buffer.h:98</a></div></div>
<div class="ttc" id="atun_8c_html_a54b32700415233e75316fe78594bf8be"><div class="ttname"><a href="tun_8c.html#a54b32700415233e75316fe78594bf8be">get_unspecified_device_guid</a></div><div class="ttdeci">static const char * get_unspecified_device_guid(const int device_number, char *actual_name, int actual_name_size, const struct tap_reg *tap_reg_src, const struct panel_reg *panel_reg_src, enum windows_driver_type *windows_driver, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04232">tun.c:4232</a></div></div>
<div class="ttc" id="aopenvpn-msg_8h_html_a78b97fef55da786a15a849fd9d7e557ca1c71f37d2e905659f1330446b04e6625"><div class="ttname"><a href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557ca1c71f37d2e905659f1330446b04e6625">msg_enable_dhcp</a></div><div class="ttdeci">@ msg_enable_dhcp</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00041">openvpn-msg.h:41</a></div></div>
<div class="ttc" id="asyshead_8h_html_a82b8e21bd452d01ad6d32a0d73fbfdc8"><div class="ttname"><a href="syshead_8h.html#a82b8e21bd452d01ad6d32a0d73fbfdc8">sleep</a></div><div class="ttdeci">#define sleep(x)</div><div class="ttdef"><b>Definition:</b> <a href="syshead_8h_source.html#l00043">syshead.h:43</a></div></div>
<div class="ttc" id="atun_8c_html_a3ce53f6e5b4d0e3c3d489b88b091e912"><div class="ttname"><a href="tun_8c.html#a3ce53f6e5b4d0e3c3d489b88b091e912">check_addr_clash</a></div><div class="ttdeci">static void check_addr_clash(const char *name, int type, in_addr_t public, in_addr_t local, in_addr_t remote_netmask)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00466">tun.c:466</a></div></div>
<div class="ttc" id="aautomatic_8c_html_a4da53ff46b740844b3dfb4025f6bbd09"><div class="ttname"><a href="automatic_8c.html#a4da53ff46b740844b3dfb4025f6bbd09">status</a></div><div class="ttdeci">static SERVICE_STATUS status</div><div class="ttdef"><b>Definition:</b> <a href="automatic_8c_source.html#l00043">automatic.c:43</a></div></div>
<div class="ttc" id="acompat-inet__pton_8c_html_acdce1d46efd09e8485a2f682b388ebc0"><div class="ttname"><a href="compat-inet__pton_8c.html#acdce1d46efd09e8485a2f682b388ebc0">inet_pton</a></div><div class="ttdeci">int inet_pton(int af, const char *src, void *dst)</div><div class="ttdef"><b>Definition:</b> <a href="compat-inet__pton_8c_source.html#l00048">compat-inet_pton.c:48</a></div></div>
<div class="ttc" id="astructdevice__instance__id__interface_html_aedb7d2661a86a92e9ff1663731117acb"><div class="ttname"><a href="structdevice__instance__id__interface.html#aedb7d2661a86a92e9ff1663731117acb">device_instance_id_interface::net_cfg_instance_id</a></div><div class="ttdeci">const char * net_cfg_instance_id</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00392">tun.h:392</a></div></div>
<div class="ttc" id="aenv__set_8c_html_a8f95bd5663cdc04bc9764b429538f536"><div class="ttname"><a href="env__set_8c.html#a8f95bd5663cdc04bc9764b429538f536">env_set_add</a></div><div class="ttdeci">void env_set_add(struct env_set *es, const char *str)</div><div class="ttdef"><b>Definition:</b> <a href="env__set_8c_source.html#l00195">env_set.c:195</a></div></div>
<div class="ttc" id="astructtuntap_html_acfb3d1fb2ebdae626785a31156ec8bce"><div class="ttname"><a href="structtuntap.html#acfb3d1fb2ebdae626785a31156ec8bce">tuntap::actual_name</a></div><div class="ttdeci">char * actual_name</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00165">tun.h:165</a></div></div>
<div class="ttc" id="atun_8c_html_a458e8718bca8248f5bee910d2f714040"><div class="ttname"><a href="tun_8c.html#a458e8718bca8248f5bee910d2f714040">write_dhcp_u8</a></div><div class="ttdeci">static void write_dhcp_u8(struct buffer *buf, const int type, const int data, bool *error)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05730">tun.c:5730</a></div></div>
<div class="ttc" id="atun_8c_html_ab0496a8190d1914429c200aaae073b69"><div class="ttname"><a href="tun_8c.html#ab0496a8190d1914429c200aaae073b69">add_route_connected_v6_net</a></div><div class="ttdeci">static void add_route_connected_v6_net(struct tuntap *tt, const struct env_set *es)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00944">tun.c:944</a></div></div>
<div class="ttc" id="atun_8c_html_ae9ddbb387adc74d75e7d0f5e65b07e69"><div class="ttname"><a href="tun_8c.html#ae9ddbb387adc74d75e7d0f5e65b07e69">tap_allow_nonadmin_access_handle</a></div><div class="ttdeci">static void tap_allow_nonadmin_access_handle(const char *device_path, HANDLE hand)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05002">tun.c:5002</a></div></div>
<div class="ttc" id="aopenvpn_2basic_8h_html_ab0ba4dd6e237b96132c0a66be2fb3bc2"><div class="ttname"><a href="openvpn_2basic_8h.html#ab0ba4dd6e237b96132c0a66be2fb3bc2">CLEAR</a></div><div class="ttdeci">#define CLEAR(x)</div><div class="ttdef"><b>Definition:</b> <a href="openvpn_2basic_8h_source.html#l00033">basic.h:33</a></div></div>
<div class="ttc" id="atun_8c_html_add5885eccc02f0f7e9d7edb7e781fa02"><div class="ttname"><a href="tun_8c.html#add5885eccc02f0f7e9d7edb7e781fa02">is_tun_p2p</a></div><div class="ttdeci">bool is_tun_p2p(const struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00666">tun.c:666</a></div></div>
<div class="ttc" id="atun_8c_html_a0bca45c9dee09e24d57e40e7fb87b5a8"><div class="ttname"><a href="tun_8c.html#a0bca45c9dee09e24d57e40e7fb87b5a8">get_adapter_index_method_1</a></div><div class="ttdeci">static DWORD get_adapter_index_method_1(const char *guid)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04830">tun.c:4830</a></div></div>
<div class="ttc" id="awin32_8h_html_a50dbc454ca7e3e55e1960dc710630548"><div class="ttname"><a href="win32_8h.html#a50dbc454ca7e3e55e1960dc710630548">WIN_IPCONFIG_PATH_SUFFIX</a></div><div class="ttdeci">#define WIN_IPCONFIG_PATH_SUFFIX</div><div class="ttdef"><b>Definition:</b> <a href="win32_8h_source.html#l00038">win32.h:38</a></div></div>
<div class="ttc" id="atun_8c_html_a0a364acc6be1969d05b108d0449b241b"><div class="ttname"><a href="tun_8c.html#a0a364acc6be1969d05b108d0449b241b">ipconfig_register_dns</a></div><div class="ttdeci">void ipconfig_register_dns(const struct env_set *es)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05230">tun.c:5230</a></div></div>
<div class="ttc" id="astructoverlapped__io_html_a41141dbe6995d7c7c65ce268d6c1b5d9"><div class="ttname"><a href="structoverlapped__io.html#a41141dbe6995d7c7c65ce268d6c1b5d9">overlapped_io::overlapped</a></div><div class="ttdeci">OVERLAPPED overlapped</div><div class="ttdef"><b>Definition:</b> <a href="win32_8h_source.html#l00203">win32.h:203</a></div></div>
<div class="ttc" id="astructinterface__t_html_afb924ec72cf46873e010250642116073"><div class="ttname"><a href="structinterface__t.html#afb924ec72cf46873e010250642116073">interface_t::index</a></div><div class="ttdeci">int index</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00058">openvpn-msg.h:58</a></div></div>
<div class="ttc" id="astructtuntap_html_a70831f0f929eb68a2c0cdd85dc8c917c"><div class="ttname"><a href="structtuntap.html#a70831f0f929eb68a2c0cdd85dc8c917c">tuntap::did_ifconfig_ipv6_setup</a></div><div class="ttdeci">bool did_ifconfig_ipv6_setup</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00159">tun.h:159</a></div></div>
<div class="ttc" id="abuffer_8c_html_a06e0220403278399596a7a1b6b601fca"><div class="ttname"><a href="buffer_8c.html#a06e0220403278399596a7a1b6b601fca">string_alloc</a></div><div class="ttdeci">char * string_alloc(const char *str, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00665">buffer.c:665</a></div></div>
<div class="ttc" id="astructtap__reg_html_acc79514082663502b07faba4b3838057"><div class="ttname"><a href="structtap__reg.html#acc79514082663502b07faba4b3838057">tap_reg::guid</a></div><div class="ttdeci">const char * guid</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00378">tun.h:378</a></div></div>
<div class="ttc" id="astructtuntap_html_a9f8865fd75a71538bcba91c1c310eb17"><div class="ttname"><a href="structtuntap.html#a9f8865fd75a71538bcba91c1c310eb17">tuntap::hand</a></div><div class="ttdeci">HANDLE hand</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00179">tun.h:179</a></div></div>
<div class="ttc" id="aopenvpn_2error_8h_html_aca68c0d4ac8df0838e209fb5300f7be3"><div class="ttname"><a href="openvpn_2error_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a></div><div class="ttdeci">#define ASSERT(x)</div><div class="ttdef"><b>Definition:</b> <a href="openvpn_2error_8h_source.html#l00218">error.h:218</a></div></div>
<div class="ttc" id="abuffer_8h_html_a8d2e5ac5ab176c02deae6440bd89bb49"><div class="ttname"><a href="buffer_8h.html#a8d2e5ac5ab176c02deae6440bd89bb49">buf_write_u8</a></div><div class="ttdeci">static bool buf_write_u8(struct buffer *dest, int data)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00697">buffer.h:697</a></div></div>
<div class="ttc" id="astructtuntap_html_ab854704d9efd886f25b7a0083b0196c6"><div class="ttname"><a href="structtuntap.html#ab854704d9efd886f25b7a0083b0196c6">tuntap::local_ipv6</a></div><div class="ttdeci">struct in6_addr local_ipv6</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00174">tun.h:174</a></div></div>
<div class="ttc" id="atun_8c_html_ade54ed872f97bdf6e1499010b64c01cd"><div class="ttname"><a href="tun_8c.html#ade54ed872f97bdf6e1499010b64c01cd">get_device_instance_id_interface</a></div><div class="ttdeci">static const struct device_instance_id_interface * get_device_instance_id_interface(struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l03647">tun.c:3647</a></div></div>
<div class="ttc" id="asocket_8c_html_a9a911c5dde4c809f7cb3eef8e5918a8e"><div class="ttname"><a href="socket_8c.html#a9a911c5dde4c809f7cb3eef8e5918a8e">print_in6_addr</a></div><div class="ttdeci">const char * print_in6_addr(struct in6_addr a6, unsigned int flags, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="socket_8c_source.html#l03021">socket.c:3021</a></div></div>
<div class="ttc" id="astructtuntap_html_a00ce662769a347aadc467000312a51c9"><div class="ttname"><a href="structtuntap.html#a00ce662769a347aadc467000312a51c9">tuntap::rwflags_debug</a></div><div class="ttdeci">unsigned int rwflags_debug</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00214">tun.h:214</a></div></div>
<div class="ttc" id="awin32_8c_html_a7f293f45d460b63e0353c9b90b7a417c"><div class="ttname"><a href="win32_8c.html#a7f293f45d460b63e0353c9b90b7a417c">overlapped_io_close</a></div><div class="ttdeci">void overlapped_io_close(struct overlapped_io *o)</div><div class="ttdef"><b>Definition:</b> <a href="win32_8c_source.html#l00192">win32.c:192</a></div></div>
<div class="ttc" id="ainteractive_8c_html_af26225c1e5936add32354d6633b47567aea7c12cb3031ad9e88104ce9859ce1c5"><div class="ttname"><a href="interactive_8c.html#af26225c1e5936add32354d6633b47567aea7c12cb3031ad9e88104ce9859ce1c5">read</a></div><div class="ttdeci">@ read</div><div class="ttdef"><b>Definition:</b> <a href="interactive_8c_source.html#l00225">interactive.c:225</a></div></div>
<div class="ttc" id="awin32_8h_html_ac14f7d0f4450ca68bf7f955e42e234cf"><div class="ttname"><a href="win32_8h.html#ac14f7d0f4450ca68bf7f955e42e234cf">NETSH_PATH_SUFFIX</a></div><div class="ttdeci">#define NETSH_PATH_SUFFIX</div><div class="ttdef"><b>Definition:</b> <a href="win32_8h_source.html#l00036">win32.h:36</a></div></div>
<div class="ttc" id="astructroute__ipv6_html_a6bcf2e42012b24c9ec6897da1cea73c4"><div class="ttname"><a href="structroute__ipv6.html#a6bcf2e42012b24c9ec6897da1cea73c4">route_ipv6::flags</a></div><div class="ttdeci">unsigned int flags</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00127">route.h:127</a></div></div>
<div class="ttc" id="atun_8c_html_ade2f6913cf1b1b4b6d342140d1db9f97"><div class="ttname"><a href="tun_8c.html#ade2f6913cf1b1b4b6d342140d1db9f97">windows_set_mtu</a></div><div class="ttdeci">static void windows_set_mtu(const int iface_index, const short family, const int mtu)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05612">tun.c:5612</a></div></div>
<div class="ttc" id="atun_8c_html_a4625d174217c9a90173e9dc03782200e"><div class="ttname"><a href="tun_8c.html#a4625d174217c9a90173e9dc03782200e">get_adapter_index</a></div><div class="ttdeci">static DWORD get_adapter_index(const char *guid)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04870">tun.c:4870</a></div></div>
<div class="ttc" id="astructpanel__reg_html_a56c42f64937f34d553ad09e612d5c796"><div class="ttname"><a href="structpanel__reg.html#a56c42f64937f34d553ad09e612d5c796">panel_reg::next</a></div><div class="ttdeci">struct panel_reg * next</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00387">tun.h:387</a></div></div>
<div class="ttc" id="atun_8c_html_a80f4326c6867bc81a083128864766ce9"><div class="ttname"><a href="tun_8c.html#a80f4326c6867bc81a083128864766ce9">do_ifconfig_ipv4</a></div><div class="ttdeci">static void do_ifconfig_ipv4(struct tuntap *tt, const char *ifname, int tun_mtu, const struct env_set *es, openvpn_net_ctx_t *ctx)</div><div class="ttdoc">do_ifconfig_ipv4 - perform platform specific ifconfig commands</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l01209">tun.c:1209</a></div></div>
<div class="ttc" id="atun_8c_html_ae4ca7b1df4a85e25a8638afedb54b6dd"><div class="ttname"><a href="tun_8c.html#ae4ca7b1df4a85e25a8638afedb54b6dd">NI_IP_NETMASK</a></div><div class="ttdeci">#define NI_IP_NETMASK</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00067">tun.c:67</a></div></div>
<div class="ttc" id="aopenvpn_2error_8h_html_a542de1000e6bc3b78b863494e9a033d4"><div class="ttname"><a href="openvpn_2error_8h.html#a542de1000e6bc3b78b863494e9a033d4">dmsg</a></div><div class="ttdeci">#define dmsg</div><div class="ttdef"><b>Definition:</b> <a href="openvpn_2error_8h_source.html#l00171">error.h:171</a></div></div>
<div class="ttc" id="aconfig-msvc_8h_html_aa367b75c5aed883fef5befbdf04835a4"><div class="ttname"><a href="config-msvc_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a></div><div class="ttdeci">#define snprintf</div><div class="ttdef"><b>Definition:</b> <a href="config-msvc_8h_source.html#l00137">config-msvc.h:137</a></div></div>
<div class="ttc" id="astructtun__ring_html"><div class="ttname"><a href="structtun__ring.html">tun_ring</a></div><div class="ttdoc">Wintun ring buffer See https://github.com/WireGuard/wintun#ring-layout.</div><div class="ttdef"><b>Definition:</b> <a href="ring__buffer_8h_source.html#l00050">ring_buffer.h:50</a></div></div>
<div class="ttc" id="atun_8h_html_a36e9898c029c4572d141662c2af506a8"><div class="ttname"><a href="tun_8h.html#a36e9898c029c4572d141662c2af506a8">IPW32_SET_IPAPI</a></div><div class="ttdeci">#define IPW32_SET_IPAPI</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00068">tun.h:68</a></div></div>
<div class="ttc" id="atun_8c_html_a9843a3cf47989b67f86b5e3cfa9c844a"><div class="ttname"><a href="tun_8c.html#a9843a3cf47989b67f86b5e3cfa9c844a">get_interface_info</a></div><div class="ttdeci">static const IP_ADAPTER_INDEX_MAP * get_interface_info(DWORD index, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04457">tun.c:4457</a></div></div>
<div class="ttc" id="atun_8h_html"><div class="ttname"><a href="tun_8h.html">tun.h</a></div></div>
<div class="ttc" id="aconfig-msvc-version_8h_html_a5a757f94d1c48e85c5ed83947ae1f519"><div class="ttname"><a href="config-msvc-version_8h.html#a5a757f94d1c48e85c5ed83947ae1f519">TAP_WIN_COMPONENT_ID</a></div><div class="ttdeci">#define TAP_WIN_COMPONENT_ID</div><div class="ttdef"><b>Definition:</b> <a href="config-msvc-version_8h_source.html#l00012">config-msvc-version.h:12</a></div></div>
<div class="ttc" id="atun_8c_html_ab80c97a1474ca6badb604921d8ddd534"><div class="ttname"><a href="tun_8c.html#ab80c97a1474ca6badb604921d8ddd534">get_adapter_info_list</a></div><div class="ttdeci">const IP_ADAPTER_INFO * get_adapter_info_list(struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04367">tun.c:4367</a></div></div>
<div class="ttc" id="astructtuntap__options_html_ac4735c903581ca3bb0c35dbe48b4e4dd"><div class="ttname"><a href="structtuntap__options.html#ac4735c903581ca3bb0c35dbe48b4e4dd">tuntap_options::ip_win32_type</a></div><div class="ttdeci">int ip_win32_type</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00072">tun.h:72</a></div></div>
<div class="ttc" id="ainteractive_8c_html_af26225c1e5936add32354d6633b47567aae835b662be01cdc3752f7db84529cca"><div class="ttname"><a href="interactive_8c.html#af26225c1e5936add32354d6633b47567aae835b662be01cdc3752f7db84529cca">write</a></div><div class="ttdeci">@ write</div><div class="ttdef"><b>Definition:</b> <a href="interactive_8c_source.html#l00226">interactive.c:226</a></div></div>
<div class="ttc" id="abuffer_8h_html_ab7be565801383d9f7371ab9a6aa99077"><div class="ttname"><a href="buffer_8h.html#ab7be565801383d9f7371ab9a6aa99077">BLEN</a></div><div class="ttdeci">#define BLEN(buf)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00127">buffer.h:127</a></div></div>
<div class="ttc" id="abuffer_8h_html_a0853c66f7fd4862a436ed6306d008c4b"><div class="ttname"><a href="buffer_8h.html#a0853c66f7fd4862a436ed6306d008c4b">ALLOC_OBJ</a></div><div class="ttdeci">#define ALLOC_OBJ(dptr, type)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l01054">buffer.h:1054</a></div></div>
<div class="ttc" id="astructtuntap_html_a4e17e7776e70f2df81236da3bcecccaa"><div class="ttname"><a href="structtuntap.html#a4e17e7776e70f2df81236da3bcecccaa">tuntap::rw_handle</a></div><div class="ttdeci">struct rw_handle rw_handle</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00182">tun.h:182</a></div></div>
<div class="ttc" id="astructinterface__t_html_a35af930b029104225c9d7dbbb1ff90a1"><div class="ttname"><a href="structinterface__t.html#a35af930b029104225c9d7dbbb1ff90a1">interface_t::name</a></div><div class="ttdeci">char name[256]</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00059">openvpn-msg.h:59</a></div></div>
<div class="ttc" id="aconfig-msvc-version_8h_html_aca8570fb706c81df371b7f9bc454ae03"><div class="ttname"><a href="config-msvc-version_8h.html#aca8570fb706c81df371b7f9bc454ae03">PACKAGE</a></div><div class="ttdeci">#define PACKAGE</div><div class="ttdef"><b>Definition:</b> <a href="config-msvc-version_8h_source.html#l00004">config-msvc-version.h:4</a></div></div>
<div class="ttc" id="astructaddress__message__t_html_ac09a6a55808ace5712913cd498243cee"><div class="ttname"><a href="structaddress__message__t.html#ac09a6a55808ace5712913cd498243cee">address_message_t::prefix_len</a></div><div class="ttdeci">int prefix_len</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00066">openvpn-msg.h:66</a></div></div>
<div class="ttc" id="astructtuntap_html_a3795221b022bca2b97dc0ee2031d6202"><div class="ttname"><a href="structtuntap.html#a3795221b022bca2b97dc0ee2031d6202">tuntap::ipapi_instance</a></div><div class="ttdeci">ULONG ipapi_instance</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00188">tun.h:188</a></div></div>
<div class="ttc" id="awin32_8c_html_a80193dd282dced7ba53888ff38688594"><div class="ttname"><a href="win32_8c.html#a80193dd282dced7ba53888ff38688594">netcmd_semaphore_release</a></div><div class="ttdeci">void netcmd_semaphore_release(void)</div><div class="ttdef"><b>Definition:</b> <a href="win32_8c_source.html#l00883">win32.c:883</a></div></div>
<div class="ttc" id="astructack__message__t_html_a03232a5aef1d0ab8e7f95d45d3150c1c"><div class="ttname"><a href="structack__message__t.html#a03232a5aef1d0ab8e7f95d45d3150c1c">ack_message_t::error_number</a></div><div class="ttdeci">int error_number</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00109">openvpn-msg.h:109</a></div></div>
<div class="ttc" id="astructtuntap_html_a7efedc501b62607f297aeee8b839c7c8"><div class="ttname"><a href="structtuntap.html#a7efedc501b62607f297aeee8b839c7c8">tuntap::options</a></div><div class="ttdeci">struct tuntap_options options</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00163">tun.h:163</a></div></div>
<div class="ttc" id="atun_8c_html_a45b0f91a5600efc891c040645f0db6b1"><div class="ttname"><a href="tun_8c.html#a45b0f91a5600efc891c040645f0db6b1">format_ip_addr_string</a></div><div class="ttdeci">static const char * format_ip_addr_string(const IP_ADDR_STRING *ip, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04921">tun.c:4921</a></div></div>
<div class="ttc" id="atun_8c_html_afe2a77f5d1c40b6ee4693b0946e452c0"><div class="ttname"><a href="tun_8c.html#afe2a77f5d1c40b6ee4693b0946e452c0">verify_255_255_255_252</a></div><div class="ttdeci">void verify_255_255_255_252(in_addr_t local, in_addr_t remote)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04019">tun.c:4019</a></div></div>
<div class="ttc" id="aroute_8h_html"><div class="ttname"><a href="route_8h.html">route.h</a></div></div>
<div class="ttc" id="aopenvpn_2error_8h_html_ad17a45f62ba6f3c0949d434a66ccb20a"><div class="ttname"><a href="openvpn_2error_8h.html#ad17a45f62ba6f3c0949d434a66ccb20a">M_WARN</a></div><div class="ttdeci">#define M_WARN</div><div class="ttdef"><b>Definition:</b> <a href="openvpn_2error_8h_source.html#l00093">error.h:93</a></div></div>
<div class="ttc" id="astructaddress__message__t_html_a69c735cc2dfca460c4d6feac313ceb65"><div class="ttname"><a href="structaddress__message__t.html#a69c735cc2dfca460c4d6feac313ceb65">address_message_t::address</a></div><div class="ttdeci">inet_address_t address</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00065">openvpn-msg.h:65</a></div></div>
<div class="ttc" id="abuffer_8h_html_ad1033b5ae87e5c0b5ffe402ac6ef1b1d"><div class="ttname"><a href="buffer_8h.html#ad1033b5ae87e5c0b5ffe402ac6ef1b1d">buf_write_u32</a></div><div class="ttdeci">static bool buf_write_u32(struct buffer *dest, int data)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00711">buffer.h:711</a></div></div>
<div class="ttc" id="atun_8c_html_a8d41f70f3abefc2979af2d62ee30be6a"><div class="ttname"><a href="tun_8c.html#a8d41f70f3abefc2979af2d62ee30be6a">tun_standby</a></div><div class="ttdeci">bool tun_standby(struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05701">tun.c:5701</a></div></div>
<div class="ttc" id="atun_8h_html_aec21d0e0ce49ddd2870e2b61486305c5a2d613eaa5b7f632cbcc6c0fd16015bbc"><div class="ttname"><a href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5a2d613eaa5b7f632cbcc6c0fd16015bbc">WINDOWS_DRIVER_WINTUN</a></div><div class="ttdeci">@ WINDOWS_DRIVER_WINTUN</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00050">tun.h:50</a></div></div>
<div class="ttc" id="abuffer_8h_html_ab4491b7f3124ff7b050e37c38c2e620b"><div class="ttname"><a href="buffer_8h.html#ab4491b7f3124ff7b050e37c38c2e620b">ALLOC_OBJ_CLEAR_GC</a></div><div class="ttdeci">#define ALLOC_OBJ_CLEAR_GC(dptr, type, gc)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l01096">buffer.h:1096</a></div></div>
<div class="ttc" id="aconfig-msvc-version_8h_html_ab7f2c146e473bacc5ac8078a45abe601"><div class="ttname"><a href="config-msvc-version_8h.html#ab7f2c146e473bacc5ac8078a45abe601">TAP_WIN_MIN_MAJOR</a></div><div class="ttdeci">#define TAP_WIN_MIN_MAJOR</div><div class="ttdef"><b>Definition:</b> <a href="config-msvc-version_8h_source.html#l00013">config-msvc-version.h:13</a></div></div>
<div class="ttc" id="atun_8c_html_a0cb8a43f9c02419709ef007a9f78c09a"><div class="ttname"><a href="tun_8c.html#a0cb8a43f9c02419709ef007a9f78c09a">tuntap_post_open</a></div><div class="ttdeci">static void tuntap_post_open(struct tuntap *tt, const char *device_guid)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06636">tun.c:6636</a></div></div>
<div class="ttc" id="abuffer_8h_html_a4396d308d54951fef1d209e9d60b7eb4"><div class="ttname"><a href="buffer_8h.html#a4396d308d54951fef1d209e9d60b7eb4">check_malloc_return</a></div><div class="ttdeci">static void check_malloc_return(const void *p)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l01102">buffer.h:1102</a></div></div>
<div class="ttc" id="astructtuntap_html_a48cab9dc4b56bf88d7ffb7f399d63942"><div class="ttname"><a href="structtuntap.html#a48cab9dc4b56bf88d7ffb7f399d63942">tuntap::adapter_index</a></div><div class="ttdeci">DWORD adapter_index</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00193">tun.h:193</a></div></div>
<div class="ttc" id="atun_8c_html_a1fbaac744435d6838da41f0d336ab313"><div class="ttname"><a href="tun_8c.html#a1fbaac744435d6838da41f0d336ab313">get_adapter_info</a></div><div class="ttdeci">const IP_ADAPTER_INFO * get_adapter_info(DWORD index, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04500">tun.c:4500</a></div></div>
<div class="ttc" id="atun_8c_html_a924d8c9818ca3d219b0fd0f1d49a5f1a"><div class="ttname"><a href="tun_8c.html#a924d8c9818ca3d219b0fd0f1d49a5f1a">check_subnet_conflict</a></div><div class="ttdeci">void check_subnet_conflict(const in_addr_t ip, const in_addr_t netmask, const char *prefix)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00539">tun.c:539</a></div></div>
<div class="ttc" id="astructoverlapped__io_html_af7dc2174454add437fc9031f79cdc174"><div class="ttname"><a href="structoverlapped__io.html#af7dc2174454add437fc9031f79cdc174">overlapped_io::status</a></div><div class="ttdeci">int status</div><div class="ttdef"><b>Definition:</b> <a href="win32_8h_source.html#l00206">win32.h:206</a></div></div>
<div class="ttc" id="astructoptions_html"><div class="ttname"><a href="structoptions.html">options</a></div><div class="ttdef"><b>Definition:</b> <a href="options_8h_source.html#l00210">options.h:210</a></div></div>
<div class="ttc" id="atun_8c_html_a12ceabb38605c3156412412d40931506"><div class="ttname"><a href="tun_8c.html#a12ceabb38605c3156412412d40931506">clear_tuntap</a></div><div class="ttdeci">static void clear_tuntap(struct tuntap *tuntap)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l01610">tun.c:1610</a></div></div>
<div class="ttc" id="atun_8h_html_a14ab5cbbb86cd3bb1cfd7e0691ab4eab"><div class="ttname"><a href="tun_8h.html#a14ab5cbbb86cd3bb1cfd7e0691ab4eab">IPW32_SET_NETSH</a></div><div class="ttdeci">#define IPW32_SET_NETSH</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00067">tun.h:67</a></div></div>
<div class="ttc" id="astructtuntap_html_a9d418d686f4369092543bcced16a39ee"><div class="ttname"><a href="structtuntap.html#a9d418d686f4369092543bcced16a39ee">tuntap::adapter_netmask</a></div><div class="ttdeci">in_addr_t adapter_netmask</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00189">tun.h:189</a></div></div>
<div class="ttc" id="asocket_8h_html_ac5f109019b64ee2519d9b3bc7f56dab0"><div class="ttname"><a href="socket_8h.html#ac5f109019b64ee2519d9b3bc7f56dab0">GETADDR_RESOLVE</a></div><div class="ttdeci">#define GETADDR_RESOLVE</div><div class="ttdef"><b>Definition:</b> <a href="socket_8h_source.html#l00523">socket.h:523</a></div></div>
<div class="ttc" id="astructroute__gateway__address_html_a63ded57d206c4b745e541bf51e8fd5b6"><div class="ttname"><a href="structroute__gateway__address.html#a63ded57d206c4b745e541bf51e8fd5b6">route_gateway_address::addr</a></div><div class="ttdeci">in_addr_t addr</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00142">route.h:142</a></div></div>
<div class="ttc" id="atun_8c_html_ae4f3096dcc7613fe579be2b052443395"><div class="ttname"><a href="tun_8c.html#ae4f3096dcc7613fe579be2b052443395">show_valid_win32_tun_subnets</a></div><div class="ttdeci">void show_valid_win32_tun_subnets(void)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04056">tun.c:4056</a></div></div>
<div class="ttc" id="astructroute__gateway__info_html_a28486a8aae1940b41d6969c926446820"><div class="ttname"><a href="structroute__gateway__info.html#a28486a8aae1940b41d6969c926446820">route_gateway_info::flags</a></div><div class="ttdeci">unsigned int flags</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00153">route.h:153</a></div></div>
<div class="ttc" id="atun_8c_html_a97bbdbbbde38d89780e81c3b32ed58b2"><div class="ttname"><a href="tun_8c.html#a97bbdbbbde38d89780e81c3b32ed58b2">ifconfig_warn_how_to_silence</a></div><div class="ttdeci">static const char ifconfig_warn_how_to_silence[]</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00427">tun.c:427</a></div></div>
<div class="ttc" id="aopenvpn_2error_8h_html_ab5286dbd1378331f3d1c3a0522b6a43f"><div class="ttname"><a href="openvpn_2error_8h.html#ab5286dbd1378331f3d1c3a0522b6a43f">M_ERR</a></div><div class="ttdeci">#define M_ERR</div><div class="ttdef"><b>Definition:</b> <a href="openvpn_2error_8h_source.html#l00107">error.h:107</a></div></div>
<div class="ttc" id="atun_8c_html_af145af3d388cb497273e84ffc575c76f"><div class="ttname"><a href="tun_8c.html#af145af3d388cb497273e84ffc575c76f">get_adapter_by_guid</a></div><div class="ttdeci">static const struct tap_reg * get_adapter_by_guid(const char *guid, const struct tap_reg *tap_reg)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04171">tun.c:4171</a></div></div>
<div class="ttc" id="atun_8c_html_a4636ecf580e72087b1cd63dcc1375ec9"><div class="ttname"><a href="tun_8c.html#a4636ecf580e72087b1cd63dcc1375ec9">netsh_ifconfig</a></div><div class="ttdeci">static void netsh_ifconfig(const struct tuntap_options *to, DWORD adapter_index, const in_addr_t ip, const in_addr_t netmask, const unsigned int flags)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05484">tun.c:5484</a></div></div>
<div class="ttc" id="astructtuntap__options_html"><div class="ttname"><a href="structtuntap__options.html">tuntap_options</a></div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00062">tun.h:62</a></div></div>
<div class="ttc" id="atun_8c_html_a3e51b48818737804f360d29c8f4bc2b2"><div class="ttname"><a href="tun_8c.html#a3e51b48818737804f360d29c8f4bc2b2">ipset2ascii_all</a></div><div class="ttdeci">const char * ipset2ascii_all(struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06964">tun.c:6964</a></div></div>
<div class="ttc" id="atun_8c_html_ac881cca015e20fc2d4290525767642f4"><div class="ttname"><a href="tun_8c.html#ac881cca015e20fc2d4290525767642f4">guess_tuntap_dev</a></div><div class="ttdeci">const char * guess_tuntap_dev(const char *dev, const char *dev_type, const char *dev_node, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00408">tun.c:408</a></div></div>
<div class="ttc" id="astructroute__gateway__info_html_ab9e341920923382cc32079487eca6e62"><div class="ttname"><a href="structroute__gateway__info.html#ab9e341920923382cc32079487eca6e62">route_gateway_info::gateway</a></div><div class="ttdeci">struct route_gateway_address gateway</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00166">route.h:166</a></div></div>
<div class="ttc" id="atun_8c_html_abd1ff4647b055b72492dc07cc1e25c78"><div class="ttname"><a href="tun_8c.html#abd1ff4647b055b72492dc07cc1e25c78">ifconfig_options_string</a></div><div class="ttdeci">const char * ifconfig_options_string(const struct tuntap *tt, bool remote, bool disable, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00593">tun.c:593</a></div></div>
<div class="ttc" id="aroute_8h_html_a4616ff947eb600c95e2c725b418dd23d"><div class="ttname"><a href="route_8h.html#a4616ff947eb600c95e2c725b418dd23d">RGI_ADDR_DEFINED</a></div><div class="ttdeci">#define RGI_ADDR_DEFINED</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00147">route.h:147</a></div></div>
<div class="ttc" id="atun_8c_html_adc8f582b2faa8abeadd523ac8ae999ce"><div class="ttname"><a href="tun_8c.html#adc8f582b2faa8abeadd523ac8ae999ce">tun_open_device</a></div><div class="ttdeci">static void tun_open_device(struct tuntap *tt, const char *dev_node, const char **device_guid, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06513">tun.c:6513</a></div></div>
<div class="ttc" id="aerrlevel_8h_html_a4b1b340ab75c81b27e427d091d6f2e50"><div class="ttname"><a href="errlevel_8h.html#a4b1b340ab75c81b27e427d091d6f2e50">D_ROUTE_DEBUG</a></div><div class="ttdeci">#define D_ROUTE_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="errlevel_8h_source.html#l00131">errlevel.h:131</a></div></div>
<div class="ttc" id="aproto_8h_html_a3e52229580f912055a75d0cad8eff3f5"><div class="ttname"><a href="proto_8h.html#a3e52229580f912055a75d0cad8eff3f5">DEV_TYPE_TAP</a></div><div class="ttdeci">#define DEV_TYPE_TAP</div><div class="ttdef"><b>Definition:</b> <a href="proto_8h_source.html#l00038">proto.h:38</a></div></div>
<div class="ttc" id="awin32_8c_html_a0ceac6773e93261ea0f56021ddcb4445"><div class="ttname"><a href="win32_8c.html#a0ceac6773e93261ea0f56021ddcb4445">openvpn_swprintf</a></div><div class="ttdeci">bool openvpn_swprintf(wchar_t *const str, const size_t size, const wchar_t *const format,...)</div><div class="ttdef"><b>Definition:</b> <a href="win32_8c_source.html#l01521">win32.c:1521</a></div></div>
<div class="ttc" id="atun_8c_html_ac4222076d82f58b4420bd8bd1c2c5aa9"><div class="ttname"><a href="tun_8c.html#ac4222076d82f58b4420bd8bd1c2c5aa9">tun_read_queue</a></div><div class="ttdeci">int tun_read_queue(struct tuntap *tt, int maxsize)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l03436">tun.c:3436</a></div></div>
<div class="ttc" id="atun_8h_html_a23ccb7500379bdc9c5944b9e02e74b5c"><div class="ttname"><a href="tun_8h.html#a23ccb7500379bdc9c5944b9e02e74b5c">IPW32_SET_ADAPTIVE</a></div><div class="ttdeci">#define IPW32_SET_ADAPTIVE</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00070">tun.h:70</a></div></div>
<div class="ttc" id="aopenvpn_2basic_8h_html_afd2537d19a3cb6556b0f727580ec6ee7"><div class="ttname"><a href="openvpn_2basic_8h.html#afd2537d19a3cb6556b0f727580ec6ee7">SIZE</a></div><div class="ttdeci">#define SIZE(x)</div><div class="ttdef"><b>Definition:</b> <a href="openvpn_2basic_8h_source.html#l00030">basic.h:30</a></div></div>
<div class="ttc" id="astructbuffer_html"><div class="ttname"><a href="structbuffer.html">buffer</a></div><div class="ttdoc">Wrapper structure for dynamically allocated memory.</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00060">buffer.h:60</a></div></div>
<div class="ttc" id="astructpanel__reg_html_a9ad43c42e641e3144cef76af1a67e6dd"><div class="ttname"><a href="structpanel__reg.html#a9ad43c42e641e3144cef76af1a67e6dd">panel_reg::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00385">tun.h:385</a></div></div>
<div class="ttc" id="astructargv_html_ae844a7fbae650ec7e67a8edcea262169"><div class="ttname"><a href="structargv.html#ae844a7fbae650ec7e67a8edcea262169">argv::gc</a></div><div class="ttdeci">struct gc_arena gc</div><div class="ttdef"><b>Definition:</b> <a href="argv_8h_source.html#l00036">argv.h:36</a></div></div>
<div class="ttc" id="aerrlevel_8h_html_a162e523d0aa5dd0877a1b019364c35ce"><div class="ttname"><a href="errlevel_8h.html#a162e523d0aa5dd0877a1b019364c35ce">D_REGISTRY</a></div><div class="ttdeci">#define D_REGISTRY</div><div class="ttdef"><b>Definition:</b> <a href="errlevel_8h_source.html#l00176">errlevel.h:176</a></div></div>
<div class="ttc" id="atun_8c_html_a59d50384819dbbc49ddd0e8cf561c90b"><div class="ttname"><a href="tun_8c.html#a59d50384819dbbc49ddd0e8cf561c90b">build_dhcp_options_string</a></div><div class="ttdeci">static bool build_dhcp_options_string(struct buffer *buf, const struct tuntap_options *o)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05863">tun.c:5863</a></div></div>
<div class="ttc" id="anetworking_8h_html_a5cf2c27b115c79e964fc24ee1f51580a"><div class="ttname"><a href="networking_8h.html#a5cf2c27b115c79e964fc24ee1f51580a">net_ctx_reset</a></div><div class="ttdeci">static void net_ctx_reset(openvpn_net_ctx_t *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="networking_8h_source.html#l00044">networking.h:44</a></div></div>
<div class="ttc" id="aopenvpn_2basic_8h_html_a8c148c96fd9bc7ea66141a318195b6be"><div class="ttname"><a href="openvpn_2basic_8h.html#a8c148c96fd9bc7ea66141a318195b6be">IPV4_NETMASK_HOST</a></div><div class="ttdeci">#define IPV4_NETMASK_HOST</div><div class="ttdef"><b>Definition:</b> <a href="openvpn_2basic_8h_source.html#l00035">basic.h:35</a></div></div>
<div class="ttc" id="aconfig-msvc_8h_html_af837744613408b57dc3654fbc3bcf900"><div class="ttname"><a href="config-msvc_8h.html#af837744613408b57dc3654fbc3bcf900">F_OK</a></div><div class="ttdeci">#define F_OK</div><div class="ttdef"><b>Definition:</b> <a href="config-msvc_8h_source.html#l00153">config-msvc.h:153</a></div></div>
<div class="ttc" id="atun_8c_html_aa160989ccb62fe8390475d34bda3d2f8"><div class="ttname"><a href="tun_8c.html#aa160989ccb62fe8390475d34bda3d2f8">close_tun</a></div><div class="ttdeci">void close_tun(struct tuntap *tt, openvpn_net_ctx_t *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06804">tun.c:6804</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a92da6eddcc33611db8c3ae0aba938f50"><div class="ttname"><a href="structtuntap__options.html#a92da6eddcc33611db8c3ae0aba938f50">tuntap_options::msg_channel</a></div><div class="ttdeci">HANDLE msg_channel</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00075">tun.h:75</a></div></div>
<div class="ttc" id="atun_8c_html_ad466008eca1200b2731d52c244f859ee"><div class="ttname"><a href="tun_8c.html#ad466008eca1200b2731d52c244f859ee">tuntap_get_mtu</a></div><div class="ttdeci">static void tuntap_get_mtu(struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06097">tun.c:6097</a></div></div>
<div class="ttc" id="atun_8c_html_a75b3bd013e5e9b81909d42916092b486"><div class="ttname"><a href="tun_8c.html#a75b3bd013e5e9b81909d42916092b486">DHCP_STATUS_UNDEF</a></div><div class="ttdeci">#define DHCP_STATUS_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04755">tun.c:4755</a></div></div>
<div class="ttc" id="atun_8c_html_aae4bf389fe2e79e5cca5b3b67a4290b3"><div class="ttname"><a href="tun_8c.html#aae4bf389fe2e79e5cca5b3b67a4290b3">get_panel_reg</a></div><div class="ttdeci">static const struct panel_reg * get_panel_reg(struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l03900">tun.c:3900</a></div></div>
<div class="ttc" id="atun_8h_html_a795311d1cf67517bbe83198e51a779b8"><div class="ttname"><a href="tun_8h.html#a795311d1cf67517bbe83198e51a779b8">IPW32_SET_N</a></div><div class="ttdeci">#define IPW32_SET_N</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00071">tun.h:71</a></div></div>
<div class="ttc" id="asocket_8c_html_a2741d6007f1e5a670409883f4304da61"><div class="ttname"><a href="socket_8c.html#a2741d6007f1e5a670409883f4304da61">print_in_addr_t</a></div><div class="ttdeci">const char * print_in_addr_t(in_addr_t addr, unsigned int flags, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="socket_8c_source.html#l03001">socket.c:3001</a></div></div>
<div class="ttc" id="atun_8c_html_a1be16b7c5abd7150fdd0e65cb571d113"><div class="ttname"><a href="tun_8c.html#a1be16b7c5abd7150fdd0e65cb571d113">do_ifconfig_ipv6</a></div><div class="ttdeci">static void do_ifconfig_ipv6(struct tuntap *tt, const char *ifname, int tun_mtu, const struct env_set *es, openvpn_net_ctx_t *ctx)</div><div class="ttdoc">do_ifconfig_ipv6 - perform platform specific ifconfig6 commands</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l01011">tun.c:1011</a></div></div>
<div class="ttc" id="atun_8c_html_a19e929a4cd46aa14eecd013c21c20b25"><div class="ttname"><a href="tun_8c.html#a19e929a4cd46aa14eecd013c21c20b25">test_adapter_ip_netmask</a></div><div class="ttdeci">static bool test_adapter_ip_netmask(const IP_ADAPTER_INFO *ai, const in_addr_t ip, const in_addr_t netmask)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04569">tun.c:4569</a></div></div>
<div class="ttc" id="astructoverlapped__io_html_ace488a5d44d5d2fb48eb52acb5b49c20"><div class="ttname"><a href="structoverlapped__io.html#ace488a5d44d5d2fb48eb52acb5b49c20">overlapped_io::iostate</a></div><div class="ttdeci">int iostate</div><div class="ttdef"><b>Definition:</b> <a href="win32_8h_source.html#l00202">win32.h:202</a></div></div>
<div class="ttc" id="abuffer_8h_html_ac08c75bf761b2c048b14e5b6cbf2c8f3"><div class="ttname"><a href="buffer_8h.html#ac08c75bf761b2c048b14e5b6cbf2c8f3">BCAP</a></div><div class="ttdeci">#define BCAP(buf)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00130">buffer.h:130</a></div></div>
<div class="ttc" id="astructtap__reg_html_a6db66ed21486695174b3c550d832ba97"><div class="ttname"><a href="structtap__reg.html#a6db66ed21486695174b3c550d832ba97">tap_reg::next</a></div><div class="ttdeci">struct tap_reg * next</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00380">tun.h:380</a></div></div>
<div class="ttc" id="atun_8c_html_a1140731439cf4a6b364712a1ba146649"><div class="ttname"><a href="tun_8c.html#a1140731439cf4a6b364712a1ba146649">do_dns_service</a></div><div class="ttdeci">static bool do_dns_service(bool add, const short family, const struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00207">tun.c:207</a></div></div>
<div class="ttc" id="awin32_8h_html_a98f0672ee8fd0bfd7224d357f6b30408"><div class="ttname"><a href="win32_8h.html#a98f0672ee8fd0bfd7224d357f6b30408">WIN_7</a></div><div class="ttdeci">#define WIN_7</div><div class="ttdef"><b>Definition:</b> <a href="win32_8h_source.html#l00303">win32.h:303</a></div></div>
<div class="ttc" id="aenv__set_8c_html_a589b54db89bdd1a4683d80b8132ce577"><div class="ttname"><a href="env__set_8c.html#a589b54db89bdd1a4683d80b8132ce577">env_set_create</a></div><div class="ttdeci">struct env_set * env_set_create(struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="env__set_8c_source.html#l00158">env_set.c:158</a></div></div>
<div class="ttc" id="atun_8c_html_a5c807605be4532ee930f54e179b0a7ec"><div class="ttname"><a href="tun_8c.html#a5c807605be4532ee930f54e179b0a7ec">show_tap_win_adapters</a></div><div class="ttdeci">void show_tap_win_adapters(int msglev, int warnlev)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04089">tun.c:4089</a></div></div>
<div class="ttc" id="atun_8c_html_a6f5544632174db40d087aaf55d70f5c6"><div class="ttname"><a href="tun_8c.html#a6f5544632174db40d087aaf55d70f5c6">show_adapters</a></div><div class="ttdeci">void show_adapters(int msglev)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04975">tun.c:4975</a></div></div>
<div class="ttc" id="atun_8c_html_a86337d8f968065ef71dc084645056fe0"><div class="ttname"><a href="tun_8c.html#a86337d8f968065ef71dc084645056fe0">open_null</a></div><div class="ttdeci">static void open_null(struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l01624">tun.c:1624</a></div></div>
<div class="ttc" id="anetworking_8h_html_af9f3186469845cfed931bb7a741054eb"><div class="ttname"><a href="networking_8h.html#af9f3186469845cfed931bb7a741054eb">net_ctx_free</a></div><div class="ttdeci">static void net_ctx_free(openvpn_net_ctx_t *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="networking_8h_source.html#l00050">networking.h:50</a></div></div>
<div class="ttc" id="astructdevice__instance__id__interface_html_a7dbe478850f0a2e0773ca2e82163d5d3"><div class="ttname"><a href="structdevice__instance__id__interface.html#a7dbe478850f0a2e0773ca2e82163d5d3">device_instance_id_interface::device_interface_list</a></div><div class="ttdeci">const char * device_interface_list</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00393">tun.h:393</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a033f8e542a5ad3c4680d4203687d8bea"><div class="ttname"><a href="structtuntap__options.html#a033f8e542a5ad3c4680d4203687d8bea">tuntap_options::wins_len</a></div><div class="ttdeci">int wins_len</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00104">tun.h:104</a></div></div>
<div class="ttc" id="asyshead_8h_html"><div class="ttname"><a href="syshead_8h.html">syshead.h</a></div></div>
<div class="ttc" id="atun_8c_html_a34a5aea74b2f0d2c67da91b78de830b9"><div class="ttname"><a href="tun_8c.html#a34a5aea74b2f0d2c67da91b78de830b9">get_adapter_index_flexible</a></div><div class="ttdeci">static DWORD get_adapter_index_flexible(const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04886">tun.c:4886</a></div></div>
<div class="ttc" id="abuffer_8h_html_a3be0c11aee0e4d7fe9e0b15235668c43"><div class="ttname"><a href="buffer_8h.html#a3be0c11aee0e4d7fe9e0b15235668c43">BPTR</a></div><div class="ttdeci">#define BPTR(buf)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00124">buffer.h:124</a></div></div>
<div class="ttc" id="atun_8c_html_a8f86b4f423129504463e0c6fad64ece6"><div class="ttname"><a href="tun_8c.html#a8f86b4f423129504463e0c6fad64ece6">tuntap_dhcp_mask</a></div><div class="ttdeci">static void tuntap_dhcp_mask(const struct tuntap *tt, const char *device_guid)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06376">tun.c:6376</a></div></div>
<div class="ttc" id="aerrlevel_8h_html_ac0efab1649521180bddeb20e44419a06"><div class="ttname"><a href="errlevel_8h.html#ac0efab1649521180bddeb20e44419a06">D_OSBUF</a></div><div class="ttdeci">#define D_OSBUF</div><div class="ttdef"><b>Definition:</b> <a href="errlevel_8h_source.html#l00091">errlevel.h:91</a></div></div>
<div class="ttc" id="astructdns__cfg__message__t_html_a26c9c4097a6aa8ed3a849c38f5990ff3"><div class="ttname"><a href="structdns__cfg__message__t.html#a26c9c4097a6aa8ed3a849c38f5990ff3">dns_cfg_message_t::domains</a></div><div class="ttdeci">char domains[512]</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00083">openvpn-msg.h:83</a></div></div>
<div class="ttc" id="atun_8c_html_a7d64323e3d927c3ddbf359d4ccab0893"><div class="ttname"><a href="tun_8c.html#a7d64323e3d927c3ddbf359d4ccab0893">netsh_ifconfig_options</a></div><div class="ttdeci">static void netsh_ifconfig_options(const char *type, const in_addr_t *addr_list, const int addr_len, const IP_ADDR_STRING *current, DWORD adapter_index, const bool test_first)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05385">tun.c:5385</a></div></div>
<div class="ttc" id="astructgc__arena_html"><div class="ttname"><a href="structgc__arena.html">gc_arena</a></div><div class="ttdoc">Garbage collection arena used to keep track of dynamically allocated memory.</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00116">buffer.h:116</a></div></div>
<div class="ttc" id="aopenvpn_2error_8h_html_a3ac39702968675a6552a43d7c68bf7f9"><div class="ttname"><a href="openvpn_2error_8h.html#a3ac39702968675a6552a43d7c68bf7f9">msg</a></div><div class="ttdeci">#define msg</div><div class="ttdef"><b>Definition:</b> <a href="openvpn_2error_8h_source.html#l00170">error.h:170</a></div></div>
<div class="ttc" id="aenv__set_8c_html_a872620e2e324ded9c1bc8af1c253faf9"><div class="ttname"><a href="env__set_8c.html#a872620e2e324ded9c1bc8af1c253faf9">setenv_str</a></div><div class="ttdeci">void setenv_str(struct env_set *es, const char *name, const char *value)</div><div class="ttdef"><b>Definition:</b> <a href="env__set_8c_source.html#l00285">env_set.c:285</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a675199fe697d18adf762946e339c0a33"><div class="ttname"><a href="structtuntap__options.html#a675199fe697d18adf762946e339c0a33">tuntap_options::nbdd_len</a></div><div class="ttdeci">int nbdd_len</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00112">tun.h:112</a></div></div>
<div class="ttc" id="abuffer_8h_html_a6650c2b4f43dbc6f7db7839d8c8baa94"><div class="ttname"><a href="buffer_8h.html#a6650c2b4f43dbc6f7db7839d8c8baa94">buf_set_write</a></div><div class="ttdeci">static void buf_set_write(struct buffer *buf, uint8_t *data, int size)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00318">buffer.h:318</a></div></div>
<div class="ttc" id="atun_8c_html_a0b6743a0a02e2ca753c47a37869de489"><div class="ttname"><a href="tun_8c.html#a0b6743a0a02e2ca753c47a37869de489">ipset2ascii</a></div><div class="ttdeci">const char * ipset2ascii(int index)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06950">tun.c:6950</a></div></div>
<div class="ttc" id="aerrlevel_8h_html_abe74dee3b7a9490bbbf2e9ce72f3718a"><div class="ttname"><a href="errlevel_8h.html#abe74dee3b7a9490bbbf2e9ce72f3718a">D_READ_WRITE</a></div><div class="ttdeci">#define D_READ_WRITE</div><div class="ttdef"><b>Definition:</b> <a href="errlevel_8h_source.html#l00165">errlevel.h:165</a></div></div>
<div class="ttc" id="atun_8c_html_a18e98c6a82bdccea18fe3d6c3475ed43"><div class="ttname"><a href="tun_8c.html#a18e98c6a82bdccea18fe3d6c3475ed43">fork_register_dns_action</a></div><div class="ttdeci">void fork_register_dns_action(struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06008">tun.c:6008</a></div></div>
<div class="ttc" id="atun_8c_html_a90b586c642a83689dfc52c77ca91cf3a"><div class="ttname"><a href="tun_8c.html#a90b586c642a83689dfc52c77ca91cf3a">init_ip_addr_string2</a></div><div class="ttdeci">static void init_ip_addr_string2(IP_ADDR_STRING *dest, const IP_ADDR_STRING *src1, const IP_ADDR_STRING *src2)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05466">tun.c:5466</a></div></div>
<div class="ttc" id="atun_8c_html_a907c6286a54473bf98ccd1d8d3dd76b3"><div class="ttname"><a href="tun_8c.html#a907c6286a54473bf98ccd1d8d3dd76b3">write_dhcp_search_str</a></div><div class="ttdeci">static void write_dhcp_search_str(struct buffer *buf, const int type, const char *const *str_array, int array_len, bool *error)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05802">tun.c:5802</a></div></div>
<div class="ttc" id="astructtuntap_html_a94d5bb333771e8b9bbd796d330f30791"><div class="ttname"><a href="structtuntap.html#a94d5bb333771e8b9bbd796d330f30791">tuntap::writes</a></div><div class="ttdeci">struct overlapped_io writes</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00181">tun.h:181</a></div></div>
<div class="ttc" id="astructbuffer_html_af5c1acadd937a2944674832497ba63ad"><div class="ttname"><a href="structbuffer.html#af5c1acadd937a2944674832497ba63ad">buffer::offset</a></div><div class="ttdeci">int offset</div><div class="ttdoc">Offset in bytes of the actual content within the allocated memory.</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00064">buffer.h:64</a></div></div>
<div class="ttc" id="atun_8c_html_ac81775a8129068d72892557f733bc583"><div class="ttname"><a href="tun_8c.html#ac81775a8129068d72892557f733bc583">init_tun_post</a></div><div class="ttdeci">void init_tun_post(struct tuntap *tt, const struct frame *frame, const struct tuntap_options *options)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00891">tun.c:891</a></div></div>
<div class="ttc" id="ablock__dns_8c_html_a00bdb3a9f928789a8044011b7e6f11dc"><div class="ttname"><a href="block__dns_8c.html#a00bdb3a9f928789a8044011b7e6f11dc">get_interface_metric</a></div><div class="ttdeci">int get_interface_metric(const NET_IFINDEX index, const ADDRESS_FAMILY family, int *is_auto)</div><div class="ttdoc">Return interface metric value for the specified interface index.</div><div class="ttdef"><b>Definition:</b> <a href="block__dns_8c_source.html#l00355">block_dns.c:355</a></div></div>
<div class="ttc" id="atun_8c_html_a29fc84a25e53c69d1354851d52e91986"><div class="ttname"><a href="tun_8c.html#a29fc84a25e53c69d1354851d52e91986">get_interface_info_list</a></div><div class="ttdeci">static const IP_INTERFACE_INFO * get_interface_info_list(struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04427">tun.c:4427</a></div></div>
<div class="ttc" id="astructtuntap__options_html_aa7a2a388db5f36ff06f6f587e97e6ec6"><div class="ttname"><a href="structtuntap__options.html#aa7a2a388db5f36ff06f6f587e97e6ec6">tuntap_options::dhcp_masq_offset</a></div><div class="ttdeci">int dhcp_masq_offset</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00080">tun.h:80</a></div></div>
<div class="ttc" id="abuffer_8h_html_acf5c0f0d704fd5b44b4d066044efb52c"><div class="ttname"><a href="buffer_8h.html#acf5c0f0d704fd5b44b4d066044efb52c">strncpynt</a></div><div class="ttdeci">static void strncpynt(char *dest, const char *src, size_t maxlen)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00348">buffer.h:348</a></div></div>
<div class="ttc" id="astructenv__set_html"><div class="ttname"><a href="structenv__set.html">env_set</a></div><div class="ttdef"><b>Definition:</b> <a href="env__set_8h_source.html#l00042">env_set.h:42</a></div></div>
<div class="ttc" id="atun_8c_html_a655d665719a4b6b553e2b4c0a421fe17"><div class="ttname"><a href="tun_8c.html#a655d665719a4b6b553e2b4c0a421fe17">init_tun</a></div><div class="ttdeci">struct tuntap * init_tun(const char *dev, const char *dev_type, int topology, const char *ifconfig_local_parm, const char *ifconfig_remote_netmask_parm, const char *ifconfig_ipv6_local_parm, int ifconfig_ipv6_netbits_parm, const char *ifconfig_ipv6_remote_parm, struct addrinfo *local_public, struct addrinfo *remote_public, const bool strict_warn, struct env_set *es, openvpn_net_ctx_t *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00736">tun.c:736</a></div></div>
<div class="ttc" id="aroute_8c_html_a79f572aab37f656876a0ea96120aa320"><div class="ttname"><a href="route_8c.html#a79f572aab37f656876a0ea96120aa320">get_default_gateway</a></div><div class="ttdeci">void get_default_gateway(struct route_gateway_info *rgi, openvpn_net_ctx_t *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="route_8c_source.html#l02742">route.c:2742</a></div></div>
<div class="ttc" id="astructflush__neighbors__message__t_html"><div class="ttname"><a href="structflush__neighbors__message__t.html">flush_neighbors_message_t</a></div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00101">openvpn-msg.h:101</a></div></div>
<div class="ttc" id="astructroute__ipv6_html_a9d9f0b0a90d55aae4f2e21163f9cba94"><div class="ttname"><a href="structroute__ipv6.html#a9d9f0b0a90d55aae4f2e21163f9cba94">route_ipv6::network</a></div><div class="ttdeci">struct in6_addr network</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00128">route.h:128</a></div></div>
<div class="ttc" id="ablock__dns_8h_html"><div class="ttname"><a href="block__dns_8h.html">block_dns.h</a></div></div>
<div class="ttc" id="aargv_8c_html_ae03da330eccab6d3239253b774a92d4d"><div class="ttname"><a href="argv_8c.html#ae03da330eccab6d3239253b774a92d4d">argv_new</a></div><div class="ttdeci">struct argv argv_new(void)</div><div class="ttdoc">Allocates a new struct argv and ensures it is initialised.</div><div class="ttdef"><b>Definition:</b> <a href="argv_8c_source.html#l00090">argv.c:90</a></div></div>
<div class="ttc" id="aproto_8h_html_ac294ee23be7863f7b64a51ad6971bfc5"><div class="ttname"><a href="proto_8h.html#ac294ee23be7863f7b64a51ad6971bfc5">TOP_P2P</a></div><div class="ttdeci">#define TOP_P2P</div><div class="ttdef"><b>Definition:</b> <a href="proto_8h_source.html#l00044">proto.h:44</a></div></div>
<div class="ttc" id="aargv_8c_html_acb8c504c4703e6e88c52463da877c8a8"><div class="ttname"><a href="argv_8c.html#acb8c504c4703e6e88c52463da877c8a8">argv_printf</a></div><div class="ttdeci">bool argv_printf(struct argv *argres, const char *format,...)</div><div class="ttdoc">printf() variant which populates a struct argv.</div><div class="ttdef"><b>Definition:</b> <a href="argv_8c_source.html#l00442">argv.c:442</a></div></div>
<div class="ttc" id="abuffer_8c_html_a11cd36c0af3073bd1245bbed1cca9590"><div class="ttname"><a href="buffer_8c.html#a11cd36c0af3073bd1245bbed1cca9590">free_buf</a></div><div class="ttdeci">void free_buf(struct buffer *buf)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00185">buffer.c:185</a></div></div>
<div class="ttc" id="astructtuntap__options_html_aeb319652b0e05153abcce77b568aedf1"><div class="ttname"><a href="structtuntap__options.html#aeb319652b0e05153abcce77b568aedf1">tuntap_options::disable_nbt</a></div><div class="ttdeci">bool disable_nbt</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00121">tun.h:121</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a1c1812cd166c6b8069060d6005934736"><div class="ttname"><a href="structtuntap__options.html#a1c1812cd166c6b8069060d6005934736">tuntap_options::dns6_len</a></div><div class="ttdeci">int dns6_len</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00129">tun.h:129</a></div></div>
<div class="ttc" id="atun_8c_html_a7d98d7187fd9453d53027d88b065f6ac"><div class="ttname"><a href="tun_8c.html#a7d98d7187fd9453d53027d88b065f6ac">tuntap_set_ip_props</a></div><div class="ttdeci">static void tuntap_set_ip_props(const struct tuntap *tt, bool *dhcp_masq, bool *dhcp_masq_post)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06593">tun.c:6593</a></div></div>
<div class="ttc" id="acommon_8h_html"><div class="ttname"><a href="common_8h.html">common.h</a></div></div>
<div class="ttc" id="atun_8c_html_aa4d13b2206b5e03c343f1fc9484b67eb"><div class="ttname"><a href="tun_8c.html#aa4d13b2206b5e03c343f1fc9484b67eb">dhcp_status</a></div><div class="ttdeci">static int dhcp_status(DWORD index)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04760">tun.c:4760</a></div></div>
<div class="ttc" id="astructdns__cfg__message__t_html_ab60629488d832723da3a8951693296f7"><div class="ttname"><a href="structdns__cfg__message__t.html#ab60629488d832723da3a8951693296f7">dns_cfg_message_t::addr_len</a></div><div class="ttdeci">int addr_len</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00085">openvpn-msg.h:85</a></div></div>
<div class="ttc" id="atun_8c_html_ae969bd5eb66f71a6730e6bcdde34749e"><div class="ttname"><a href="tun_8c.html#ae969bd5eb66f71a6730e6bcdde34749e">get_per_adapter_info</a></div><div class="ttdeci">const IP_PER_ADAPTER_INFO * get_per_adapter_info(const DWORD index, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04394">tun.c:4394</a></div></div>
<div class="ttc" id="astructtuntap_html_abd50d085251c7c20d889f4b5d22dfb62"><div class="ttname"><a href="structtuntap.html#abd50d085251c7c20d889f4b5d22dfb62">tuntap::ipapi_context</a></div><div class="ttdeci">ULONG ipapi_context</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00187">tun.h:187</a></div></div>
<div class="ttc" id="atun_8c_html_a2a9e358835e9587fbd460b69afbdae9b"><div class="ttname"><a href="tun_8c.html#a2a9e358835e9587fbd460b69afbdae9b">get_adapter</a></div><div class="ttdeci">const IP_ADAPTER_INFO * get_adapter(const IP_ADAPTER_INFO *ai, DWORD index)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04481">tun.c:4481</a></div></div>
<div class="ttc" id="aconfig_8h_html_a5d3674ef04791f5b743792eb7c4d7dae"><div class="ttname"><a href="config_8h.html#a5d3674ef04791f5b743792eb7c4d7dae">IFCONFIG_PATH</a></div><div class="ttdeci">#define IFCONFIG_PATH</div><div class="ttdef"><b>Definition:</b> <a href="config_8h_source.html#l00712">config.h:712</a></div></div>
<div class="ttc" id="atun_8c_html_aad0d234fc1f354196625f68246c0cf17"><div class="ttname"><a href="tun_8c.html#aad0d234fc1f354196625f68246c0cf17">ip_addr_member_of</a></div><div class="ttdeci">static bool ip_addr_member_of(const in_addr_t addr, const IP_ADDR_STRING *ias)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05324">tun.c:5324</a></div></div>
<div class="ttc" id="asocket_8h_html_a5b618d8716696f3ebe96642be56bec03"><div class="ttname"><a href="socket_8h.html#a5b618d8716696f3ebe96642be56bec03">GETADDR_HOST_ORDER</a></div><div class="ttdeci">#define GETADDR_HOST_ORDER</div><div class="ttdef"><b>Definition:</b> <a href="socket_8h_source.html#l00525">socket.h:525</a></div></div>
<div class="ttc" id="aerrlevel_8h_html_afdfcf7505fc3f7c1ea04ebdfe02fd483"><div class="ttname"><a href="errlevel_8h.html#afdfcf7505fc3f7c1ea04ebdfe02fd483">D_DHCP_OPT</a></div><div class="ttdeci">#define D_DHCP_OPT</div><div class="ttdef"><b>Definition:</b> <a href="errlevel_8h_source.html#l00099">errlevel.h:99</a></div></div>
<div class="ttc" id="astructtuntap_html_a310bbe962b4610e99c122fc7147bfbd4"><div class="ttname"><a href="structtuntap.html#a310bbe962b4610e99c122fc7147bfbd4">tuntap::local</a></div><div class="ttdeci">in_addr_t local</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00171">tun.h:171</a></div></div>
<div class="ttc" id="astructtuntap__options_html_ae31925735e2ef3b040695acf59feb737"><div class="ttname"><a href="structtuntap__options.html#ae31925735e2ef3b040695acf59feb737">tuntap_options::dhcp_pre_release</a></div><div class="ttdeci">bool dhcp_pre_release</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00124">tun.h:124</a></div></div>
<div class="ttc" id="aunioninet__address__t_html_a65d86ae3e78a199e223ca58582c6988d"><div class="ttname"><a href="unioninet__address__t.html#a65d86ae3e78a199e223ca58582c6988d">inet_address_t::ipv4</a></div><div class="ttdeci">struct in_addr ipv4</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00053">openvpn-msg.h:53</a></div></div>
<div class="ttc" id="atun_8c_html_a293109fe0e2259e2e4f18f7fa85f498d"><div class="ttname"><a href="tun_8c.html#a293109fe0e2259e2e4f18f7fa85f498d">NI_TEST_FIRST</a></div><div class="ttdeci">#define NI_TEST_FIRST</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00066">tun.c:66</a></div></div>
<div class="ttc" id="atun_8c_html_a6880ab19d254481c82ca863b6bfeca47"><div class="ttname"><a href="tun_8c.html#a6880ab19d254481c82ca863b6bfeca47">is_ip_in_adapter_subnet</a></div><div class="ttdeci">bool is_ip_in_adapter_subnet(const IP_ADAPTER_INFO *ai, const in_addr_t ip, in_addr_t *highest_netmask)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04643">tun.c:4643</a></div></div>
<div class="ttc" id="astructplatform__state__user_html"><div class="ttname"><a href="structplatform__state__user.html">platform_state_user</a></div><div class="ttdef"><b>Definition:</b> <a href="platform_8h_source.html#l00056">platform.h:56</a></div></div>
<div class="ttc" id="arun__command_8c_html_a12c490307c9e4966e41f32d08f5f3cae"><div class="ttname"><a href="run__command_8c.html#a12c490307c9e4966e41f32d08f5f3cae">openvpn_execve_check</a></div><div class="ttdeci">bool openvpn_execve_check(const struct argv *a, const struct env_set *es, const unsigned int flags, const char *error_message)</div><div class="ttdef"><b>Definition:</b> <a href="run__command_8c_source.html#l00195">run_command.c:195</a></div></div>
<div class="ttc" id="astructoverlapped__io_html_a5f59337f35e730d2e38df7dc6261b0c8"><div class="ttname"><a href="structoverlapped__io.html#a5f59337f35e730d2e38df7dc6261b0c8">overlapped_io::buf_init</a></div><div class="ttdeci">struct buffer buf_init</div><div class="ttdef"><b>Definition:</b> <a href="win32_8h_source.html#l00213">win32.h:213</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a30def869016af7778723a529b548e820"><div class="ttname"><a href="structtuntap__options.html#a30def869016af7778723a529b548e820">tuntap_options::wins</a></div><div class="ttdeci">in_addr_t wins[N_DHCP_ADDR]</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00103">tun.h:103</a></div></div>
<div class="ttc" id="atun_8h_html_a53b8d43ac0464c0ad92cb7dc1ad2cb34"><div class="ttname"><a href="tun_8h.html#a53b8d43ac0464c0ad92cb7dc1ad2cb34">IPW32_SET_DHCP_MASQ</a></div><div class="ttdeci">#define IPW32_SET_DHCP_MASQ</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00069">tun.h:69</a></div></div>
<div class="ttc" id="abuffer_8c_html_a67f7dec7f86e113dc0744584fd80b621"><div class="ttname"><a href="buffer_8c.html#a67f7dec7f86e113dc0744584fd80b621">gc_malloc</a></div><div class="ttdeci">void * gc_malloc(size_t size, bool clear, struct gc_arena *a)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00385">buffer.c:385</a></div></div>
<div class="ttc" id="astructipset__names_html"><div class="ttname"><a href="structipset__names.html">ipset_names</a></div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06921">tun.c:6921</a></div></div>
<div class="ttc" id="astructset__mtu__message__t_html"><div class="ttname"><a href="structset__mtu__message__t.html">set_mtu_message_t</a></div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00131">openvpn-msg.h:131</a></div></div>
<div class="ttc" id="atun_8c_html_a3d4b225536d0e9c462a59e47f6542c3f"><div class="ttname"><a href="tun_8c.html#a3d4b225536d0e9c462a59e47f6542c3f">is_adapter_up</a></div><div class="ttdeci">bool is_adapter_up(const struct tuntap *tt, const IP_ADAPTER_INFO *list)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04598">tun.c:4598</a></div></div>
<div class="ttc" id="atun_8c_html_afd83369f4f7f1983f778d3b4abfd5cf6"><div class="ttname"><a href="tun_8c.html#afd83369f4f7f1983f778d3b4abfd5cf6">wintun_register_ring_buffer</a></div><div class="ttdeci">static bool wintun_register_ring_buffer(struct tuntap *tt, const char *device_guid)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06246">tun.c:6246</a></div></div>
<div class="ttc" id="astructroute__gateway__address_html_a33bd1314cd069f11c22605e5e79756a0"><div class="ttname"><a href="structroute__gateway__address.html#a33bd1314cd069f11c22605e5e79756a0">route_gateway_address::netmask</a></div><div class="ttdeci">in_addr_t netmask</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00143">route.h:143</a></div></div>
<div class="ttc" id="astructpanel__reg_html_ab429b6e90735e653301755d009b0b9ec"><div class="ttname"><a href="structpanel__reg.html#ab429b6e90735e653301755d009b0b9ec">panel_reg::guid</a></div><div class="ttdeci">const char * guid</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00386">tun.h:386</a></div></div>
<div class="ttc" id="aproto_8h_html_ab6b5bc35bc49835a9d79ad0a160d6396"><div class="ttname"><a href="proto_8h.html#ab6b5bc35bc49835a9d79ad0a160d6396">OPENVPN_IPH_GET_VER</a></div><div class="ttdeci">#define OPENVPN_IPH_GET_VER(v)</div><div class="ttdef"><b>Definition:</b> <a href="proto_8h_source.html#l00107">proto.h:107</a></div></div>
<div class="ttc" id="astructopenvpn__iphdr_html_af3c74339e4e6ab5c8edbb5b8d1ab3fa6"><div class="ttname"><a href="structopenvpn__iphdr.html#af3c74339e4e6ab5c8edbb5b8d1ab3fa6">openvpn_iphdr::version_len</a></div><div class="ttdeci">uint8_t version_len</div><div class="ttdef"><b>Definition:</b> <a href="proto_8h_source.html#l00109">proto.h:109</a></div></div>
<div class="ttc" id="abuffer_8c_html_afd2a93a0940b1ea7e093d293a05e2927"><div class="ttname"><a href="buffer_8c.html#afd2a93a0940b1ea7e093d293a05e2927">openvpn_snprintf</a></div><div class="ttdeci">bool openvpn_snprintf(char *str, size_t size, const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00299">buffer.c:299</a></div></div>
<div class="ttc" id="astructroute__ipv4_html"><div class="ttname"><a href="structroute__ipv4.html">route_ipv4</a></div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00112">route.h:112</a></div></div>
<div class="ttc" id="atun_8c_html_a7d1277b47f2707be257eb74a1a85a61e"><div class="ttname"><a href="tun_8c.html#a7d1277b47f2707be257eb74a1a85a61e">DHCP_STATUS_ENABLED</a></div><div class="ttdeci">#define DHCP_STATUS_ENABLED</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04756">tun.c:4756</a></div></div>
<div class="ttc" id="astructmanagement_html"><div class="ttname"><a href="structmanagement.html">management</a></div><div class="ttdef"><b>Definition:</b> <a href="manage_8h_source.html#l00322">manage.h:322</a></div></div>
<div class="ttc" id="astructrw__handle_html_a0dae71c0cfb6646063148367ed15f4d1"><div class="ttname"><a href="structrw__handle.html#a0dae71c0cfb6646063148367ed15f4d1">rw_handle::write</a></div><div class="ttdeci">HANDLE write</div><div class="ttdef"><b>Definition:</b> <a href="win32_8h_source.html#l00077">win32.h:77</a></div></div>
<div class="ttc" id="abuffer_8h_html_ad1a8ee23a868bbed76d1a4e396290e9b"><div class="ttname"><a href="buffer_8h.html#ad1a8ee23a868bbed76d1a4e396290e9b">gc_free</a></div><div class="ttdeci">static void gc_free(struct gc_arena *a)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l01032">buffer.h:1032</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a0ecf9d2ac33d53674fd03d741cb6e4d5"><div class="ttname"><a href="structtuntap__options.html#a0ecf9d2ac33d53674fd03d741cb6e4d5">tuntap_options::dns6</a></div><div class="ttdeci">struct in6_addr dns6[N_DHCP_ADDR]</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00128">tun.h:128</a></div></div>
<div class="ttc" id="astructsecurity__attributes_html_a4a215d7812252afa2a9037fc95ba04df"><div class="ttname"><a href="structsecurity__attributes.html#a4a215d7812252afa2a9037fc95ba04df">security_attributes::sa</a></div><div class="ttdeci">SECURITY_ATTRIBUTES sa</div><div class="ttdef"><b>Definition:</b> <a href="win32_8h_source.html#l00060">win32.h:60</a></div></div>
<div class="ttc" id="atun_8c_html_a73e6d824b7b018e9b1d9230b0ea16137"><div class="ttname"><a href="tun_8c.html#a73e6d824b7b018e9b1d9230b0ea16137">is_dev_type</a></div><div class="ttdeci">bool is_dev_type(const char *dev, const char *dev_type, const char *match_type)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00346">tun.c:346</a></div></div>
<div class="ttc" id="afdmisc_8c_html_a4bd55f9b59d6c9123787beb7431dac85"><div class="ttname"><a href="fdmisc_8c.html#a4bd55f9b59d6c9123787beb7431dac85">set_nonblock</a></div><div class="ttdeci">void set_nonblock(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="fdmisc_8c_source.html#l00071">fdmisc.c:71</a></div></div>
<div class="ttc" id="atun_8c_html_afe5451b56f9b07e0f10dd8e9958a6981"><div class="ttname"><a href="tun_8c.html#afe5451b56f9b07e0f10dd8e9958a6981">ip_addr_one_to_one</a></div><div class="ttdeci">static bool ip_addr_one_to_one(const in_addr_t *a1, const int a1len, const IP_ADDR_STRING *ias)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05300">tun.c:5300</a></div></div>
<div class="ttc" id="atun_8c_html_ae17202e36b0cd27ca27324f5fcd08c10"><div class="ttname"><a href="tun_8c.html#ae17202e36b0cd27ca27324f5fcd08c10">get_adapter_n_ip_netmask</a></div><div class="ttdeci">static int get_adapter_n_ip_netmask(const IP_ADAPTER_INFO *ai)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04506">tun.c:4506</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a79c23140e69d2545d30656f315a20665"><div class="ttname"><a href="structtuntap__options.html#a79c23140e69d2545d30656f315a20665">tuntap_options::domain</a></div><div class="ttdeci">const char * domain</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00090">tun.h:90</a></div></div>
<div class="ttc" id="astructtuntap_html_adfc8cf984637bed412c9718cd8a4b0cb"><div class="ttname"><a href="structtuntap.html#adfc8cf984637bed412c9718cd8a4b0cb">tuntap::remote_netmask</a></div><div class="ttdeci">in_addr_t remote_netmask</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00172">tun.h:172</a></div></div>
<div class="ttc" id="astructaddress__message__t_html_a79342a9292a5e1568fa4f036d4bdf1b5"><div class="ttname"><a href="structaddress__message__t.html#a79342a9292a5e1568fa4f036d4bdf1b5">address_message_t::header</a></div><div class="ttdeci">message_header_t header</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00063">openvpn-msg.h:63</a></div></div>
<div class="ttc" id="awin32_8c_html_aef221066442b594355d1ed2ac80a3736"><div class="ttname"><a href="win32_8c.html#aef221066442b594355d1ed2ac80a3736">init_security_attributes_allow_all</a></div><div class="ttdeci">bool init_security_attributes_allow_all(struct security_attributes *obj)</div><div class="ttdef"><b>Definition:</b> <a href="win32_8c_source.html#l00154">win32.c:154</a></div></div>
<div class="ttc" id="astructroute__ipv4_html_a05f41b340e53a6c8292fefc84204ea74"><div class="ttname"><a href="structroute__ipv4.html#a05f41b340e53a6c8292fefc84204ea74">route_ipv4::metric</a></div><div class="ttdeci">int metric</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00122">route.h:122</a></div></div>
<div class="ttc" id="aconfig-msvc_8h_html_a6eb1e68cc391dd753bc8ce896dbb8315"><div class="ttname"><a href="config-msvc_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a></div><div class="ttdeci">unsigned __int32 uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="config-msvc_8h_source.html#l00162">config-msvc.h:162</a></div></div>
<div class="ttc" id="astructtuntap_html"><div class="ttname"><a href="structtuntap.html">tuntap</a></div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00150">tun.h:150</a></div></div>
<div class="ttc" id="asocket_8h_html"><div class="ttname"><a href="socket_8h.html">socket.h</a></div></div>
<div class="ttc" id="astructtap__reg_html"><div class="ttname"><a href="structtap__reg.html">tap_reg</a></div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00376">tun.h:376</a></div></div>
<div class="ttc" id="astructtuntap_html_a81746b4bf6278227195affed161a12c5"><div class="ttname"><a href="structtuntap.html#a81746b4bf6278227195affed161a12c5">tuntap::remote_ipv6</a></div><div class="ttdeci">struct in6_addr remote_ipv6</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00175">tun.h:175</a></div></div>
<div class="ttc" id="afdmisc_8c_html_a09193ec56615d682308eff8c491fc791"><div class="ttname"><a href="fdmisc_8c.html#a09193ec56615d682308eff8c491fc791">set_cloexec</a></div><div class="ttdeci">void set_cloexec(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="fdmisc_8c_source.html#l00081">fdmisc.c:81</a></div></div>
<div class="ttc" id="atun_8c_html_af1c4c80553da39f760e51787ba2defb1"><div class="ttname"><a href="tun_8c.html#af1c4c80553da39f760e51787ba2defb1">guid_to_name</a></div><div class="ttdeci">static const char * guid_to_name(const char *guid, const struct panel_reg *panel_reg)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04187">tun.c:4187</a></div></div>
<div class="ttc" id="aunioninet__address__t_html_a5f03e7be9b6de4597133d222d27c5716"><div class="ttname"><a href="unioninet__address__t.html#a5f03e7be9b6de4597133d222d27c5716">inet_address_t::ipv6</a></div><div class="ttdeci">struct in6_addr ipv6</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00054">openvpn-msg.h:54</a></div></div>
<div class="ttc" id="atun_8c_html_aea0fe0cbe4d20881b8378db9c6226066"><div class="ttname"><a href="tun_8c.html#aea0fe0cbe4d20881b8378db9c6226066">ip_addr_string_to_array</a></div><div class="ttdeci">void ip_addr_string_to_array(in_addr_t *dest, int *dest_len, const IP_ADDR_STRING *src)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05256">tun.c:5256</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a51f64fa955069fe041ab584a6fa8d977"><div class="ttname"><a href="structtuntap__options.html#a51f64fa955069fe041ab584a6fa8d977">tuntap_options::dhcp_lease_time</a></div><div class="ttdeci">int dhcp_lease_time</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00081">tun.h:81</a></div></div>
<div class="ttc" id="atun_8c_html_ac0b5e1af8dfaa627162520fbc1ae5080"><div class="ttname"><a href="tun_8c.html#ac0b5e1af8dfaa627162520fbc1ae5080">netsh_command</a></div><div class="ttdeci">static void netsh_command(const struct argv *a, int n, int msglevel)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05209">tun.c:5209</a></div></div>
<div class="ttc" id="abuffer_8h_html_ad1d928b086002a3ea744cc0dcbe3b524"><div class="ttname"><a href="buffer_8h.html#ad1d928b086002a3ea744cc0dcbe3b524">buf_safe</a></div><div class="ttdeci">static bool buf_safe(const struct buffer *buf, int len)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00525">buffer.h:525</a></div></div>
<div class="ttc" id="aopenvpn-msg_8h_html"><div class="ttname"><a href="openvpn-msg_8h.html">openvpn-msg.h</a></div></div>
<div class="ttc" id="astructdevice__instance__id__interface_html"><div class="ttname"><a href="structdevice__instance__id__interface.html">device_instance_id_interface</a></div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00390">tun.h:390</a></div></div>
<div class="ttc" id="aargv_8c_html_a4d63823a8aeddf605a2e4a4a420e1dd4"><div class="ttname"><a href="argv_8c.html#a4d63823a8aeddf605a2e4a4a420e1dd4">argv_msg</a></div><div class="ttdeci">void argv_msg(const int msglev, const struct argv *a)</div><div class="ttdoc">Write the arguments stored in a struct argv via the msg() command.</div><div class="ttdef"><b>Definition:</b> <a href="argv_8c_source.html#l00245">argv.c:245</a></div></div>
<div class="ttc" id="atun_8h_html_aec21d0e0ce49ddd2870e2b61486305c5af42c0a58f6f53f325f4a7443ee430922"><div class="ttname"><a href="tun_8h.html#aec21d0e0ce49ddd2870e2b61486305c5af42c0a58f6f53f325f4a7443ee430922">WINDOWS_DRIVER_TAP_WINDOWS6</a></div><div class="ttdeci">@ WINDOWS_DRIVER_TAP_WINDOWS6</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00049">tun.h:49</a></div></div>
<div class="ttc" id="astructtuntap_html_a481a2d64b9173bd16b80d758c478dfef"><div class="ttname"><a href="structtuntap.html#a481a2d64b9173bd16b80d758c478dfef">tuntap::netbits_ipv6</a></div><div class="ttdeci">int netbits_ipv6</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00176">tun.h:176</a></div></div>
<div class="ttc" id="atun_8c_html_a69a3515b1f385a59c642390602c835fd"><div class="ttname"><a href="tun_8c.html#a69a3515b1f385a59c642390602c835fd">tun_stat</a></div><div class="ttdeci">const char * tun_stat(const struct tuntap *tt, unsigned int rwflags, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00631">tun.c:631</a></div></div>
<div class="ttc" id="atun_8c_html_a6c7f0760429559528db611dcd91bb8b2"><div class="ttname"><a href="tun_8c.html#a6c7f0760429559528db611dcd91bb8b2">get_device_guid</a></div><div class="ttdeci">static const char * get_device_guid(const char *name, char *actual_name, int actual_name_size, enum windows_driver_type *windows_driver, const struct tap_reg *tap_reg, const struct panel_reg *panel_reg, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04299">tun.c:4299</a></div></div>
<div class="ttc" id="aproto_8h_html_a5432683e30ddc0abd4deb132f20477df"><div class="ttname"><a href="proto_8h.html#a5432683e30ddc0abd4deb132f20477df">TOP_NET30</a></div><div class="ttdeci">#define TOP_NET30</div><div class="ttdef"><b>Definition:</b> <a href="proto_8h_source.html#l00043">proto.h:43</a></div></div>
<div class="ttc" id="aconfig_8h_html"><div class="ttname"><a href="config_8h.html">config.h</a></div></div>
<div class="ttc" id="atun_8c_html_ad0be0336a45cf9eed67f9b75318a96db"><div class="ttname"><a href="tun_8c.html#ad0be0336a45cf9eed67f9b75318a96db">tuntap_set_connected</a></div><div class="ttdeci">static void tuntap_set_connected(const struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06298">tun.c:6298</a></div></div>
<div class="ttc" id="atun_8h_html_a3c9fe653a4b2c986abced8bc39c02696"><div class="ttname"><a href="tun_8h.html#a3c9fe653a4b2c986abced8bc39c02696">TUN_ADAPTER_INDEX_INVALID</a></div><div class="ttdeci">#define TUN_ADAPTER_INDEX_INVALID</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00056">tun.h:56</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a143af129775b5984fa835d5c0026e75c"><div class="ttname"><a href="structtuntap__options.html#a143af129775b5984fa835d5c0026e75c">tuntap_options::dns_len</a></div><div class="ttdeci">int dns_len</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00100">tun.h:100</a></div></div>
<div class="ttc" id="aotime_8c_html_a3235fa9248297a37174fafc4522bdbac"><div class="ttname"><a href="otime_8c.html#a3235fa9248297a37174fafc4522bdbac">time_string</a></div><div class="ttdeci">const char * time_string(time_t t, int usec, bool show_usec, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="otime_8c_source.html#l00114">otime.c:114</a></div></div>
<div class="ttc" id="aplatform_8c_html_a52d59a56eff6b981f01eff915af4fad8"><div class="ttname"><a href="platform_8c.html#a52d59a56eff6b981f01eff915af4fad8">platform_user_get</a></div><div class="ttdeci">bool platform_user_get(const char *username, struct platform_state_user *state)</div><div class="ttdef"><b>Definition:</b> <a href="platform_8c_source.html#l00069">platform.c:69</a></div></div>
<div class="ttc" id="arun__command_8h_html_a2a6d02b9ff0a76e78bf5c76834a29d89"><div class="ttname"><a href="run__command_8h.html#a2a6d02b9ff0a76e78bf5c76834a29d89">S_FATAL</a></div><div class="ttdeci">#define S_FATAL</div><div class="ttdef"><b>Definition:</b> <a href="run__command_8h_source.html#l00046">run_command.h:46</a></div></div>
<div class="ttc" id="atun_8c_html_aae4f18240f6eee1938e487a7add67e61"><div class="ttname"><a href="tun_8c.html#aae4f18240f6eee1938e487a7add67e61">get_tun_adapter</a></div><div class="ttdeci">const IP_ADAPTER_INFO * get_tun_adapter(const struct tuntap *tt, const IP_ADAPTER_INFO *list)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04585">tun.c:4585</a></div></div>
<div class="ttc" id="aroute_8h_html_a7c86f9369806a6f86f30a7c3185d740a"><div class="ttname"><a href="route_8h.html#a7c86f9369806a6f86f30a7c3185d740a">RT_METRIC_DEFINED</a></div><div class="ttdeci">#define RT_METRIC_DEFINED</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00115">route.h:115</a></div></div>
<div class="ttc" id="astructtuntap_html_ade6ab1d7cbe4e6f64dc453eaf7fc251e"><div class="ttname"><a href="structtuntap.html#ade6ab1d7cbe4e6f64dc453eaf7fc251e">tuntap::post_open_mtu</a></div><div class="ttdeci">int post_open_mtu</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00218">tun.h:218</a></div></div>
<div class="ttc" id="astructroute__ipv4_html_ad7a3c222084b1c670a62dc6d3d0f2fb5"><div class="ttname"><a href="structroute__ipv4.html#ad7a3c222084b1c670a62dc6d3d0f2fb5">route_ipv4::gateway</a></div><div class="ttdeci">in_addr_t gateway</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00121">route.h:121</a></div></div>
<div class="ttc" id="aevent_8h_html_a829bcc5ff94e601cfbd30e527c82f94f"><div class="ttname"><a href="event_8h.html#a829bcc5ff94e601cfbd30e527c82f94f">EVENT_WRITE</a></div><div class="ttdeci">#define EVENT_WRITE</div><div class="ttdef"><b>Definition:</b> <a href="event_8h_source.html#l00037">event.h:37</a></div></div>
<div class="ttc" id="abuffer_8h_html_ae3916f38b92823f35c1a1bea1aac378e"><div class="ttname"><a href="buffer_8h.html#ae3916f38b92823f35c1a1bea1aac378e">format_hex</a></div><div class="ttdeci">static char * format_hex(const uint8_t *data, int size, int maxoutput, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00510">buffer.h:510</a></div></div>
<div class="ttc" id="astructtap__reg_html_a9a2c6fa4ca2b0380309be23ed13092fa"><div class="ttname"><a href="structtap__reg.html#a9a2c6fa4ca2b0380309be23ed13092fa">tap_reg::windows_driver</a></div><div class="ttdeci">enum windows_driver_type windows_driver</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00379">tun.h:379</a></div></div>
<div class="ttc" id="aopenvpn-msg_8h_html_a78b97fef55da786a15a849fd9d7e557ca0224a09323cb8e271064d8a586882184"><div class="ttname"><a href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557ca0224a09323cb8e271064d8a586882184">msg_del_address</a></div><div class="ttdeci">@ msg_del_address</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00030">openvpn-msg.h:30</a></div></div>
<div class="ttc" id="astructipset__names_html_a3870aa5e6e842f41b1d1d3d2bc29cb81"><div class="ttname"><a href="structipset__names.html#a3870aa5e6e842f41b1d1d3d2bc29cb81">ipset_names::short_form</a></div><div class="ttdeci">const char * short_form</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06922">tun.c:6922</a></div></div>
<div class="ttc" id="atun_8c_html_a0b29a8cad9fb60becddc33e12a7f4cef"><div class="ttname"><a href="tun_8c.html#a0b29a8cad9fb60becddc33e12a7f4cef">tun_show_debug</a></div><div class="ttdeci">void tun_show_debug(struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06727">tun.c:6727</a></div></div>
<div class="ttc" id="aroute_8c_html_a63aa83322222f92bc2d6bfa2b183066f"><div class="ttname"><a href="route_8c.html#a63aa83322222f92bc2d6bfa2b183066f">add_route_ipv6</a></div><div class="ttdeci">void add_route_ipv6(struct route_ipv6 *r6, const struct tuntap *tt, unsigned int flags, const struct env_set *es, openvpn_net_ctx_t *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="route_8c_source.html#l01877">route.c:1877</a></div></div>
<div class="ttc" id="aconfig-msvc-version_8h_html_a0d45a760f50fdff0efa95108a0ddc37b"><div class="ttname"><a href="config-msvc-version_8h.html#a0d45a760f50fdff0efa95108a0ddc37b">TAP_WIN_MIN_MINOR</a></div><div class="ttdeci">#define TAP_WIN_MIN_MINOR</div><div class="ttdef"><b>Definition:</b> <a href="config-msvc-version_8h_source.html#l00014">config-msvc-version.h:14</a></div></div>
<div class="ttc" id="astructset__mtu__message__t_html_a70d5856c01a4200f50efc3430104e7c8"><div class="ttname"><a href="structset__mtu__message__t.html#a70d5856c01a4200f50efc3430104e7c8">set_mtu_message_t::header</a></div><div class="ttdeci">message_header_t header</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00132">openvpn-msg.h:132</a></div></div>
<div class="ttc" id="atun_8c_html_afac3ea5517cd7f5c7bf41adf2295fc13"><div class="ttname"><a href="tun_8c.html#afac3ea5517cd7f5c7bf41adf2295fc13">adapter_index_of_ip</a></div><div class="ttdeci">DWORD adapter_index_of_ip(const IP_ADAPTER_INFO *list, const in_addr_t ip, int *count, in_addr_t *netmask)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04676">tun.c:4676</a></div></div>
<div class="ttc" id="aopenvpn-msg_8h_html_a78b97fef55da786a15a849fd9d7e557ca12066b3ff846ce137d1ffc0ed01d2b0a"><div class="ttname"><a href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557ca12066b3ff846ce137d1ffc0ed01d2b0a">msg_add_address</a></div><div class="ttdeci">@ msg_add_address</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00029">openvpn-msg.h:29</a></div></div>
<div class="ttc" id="atun_8c_html_a1c3bf6ba2997de67eb98b3be45d85721"><div class="ttname"><a href="tun_8c.html#a1c3bf6ba2997de67eb98b3be45d85721">do_dns_domain_service</a></div><div class="ttdeci">static bool do_dns_domain_service(bool add, const struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00152">tun.c:152</a></div></div>
<div class="ttc" id="astructroute__ipv6_html_a40dd9f967f1b9865ab733329dff9eb78"><div class="ttname"><a href="structroute__ipv6.html#a40dd9f967f1b9865ab733329dff9eb78">route_ipv6::netbits</a></div><div class="ttdeci">unsigned int netbits</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00129">route.h:129</a></div></div>
<div class="ttc" id="atun_8h_html_afef2adbc3d7467cec1a651e1d513f227"><div class="ttname"><a href="tun_8h.html#afef2adbc3d7467cec1a651e1d513f227">tuncfg</a></div><div class="ttdeci">void tuncfg(const char *dev, const char *dev_type, const char *dev_node, int persist_mode, const char *username, const char *groupname, const struct tuntap_options *options, openvpn_net_ctx_t *ctx)</div></div>
<div class="ttc" id="awin32_8c_html_afa334458227a2453a4391a3a1316a0d7"><div class="ttname"><a href="win32_8c.html#afa334458227a2453a4391a3a1316a0d7">get_win_sys_path</a></div><div class="ttdeci">char * get_win_sys_path(void)</div><div class="ttdef"><b>Definition:</b> <a href="win32_8c_source.html#l01217">win32.c:1217</a></div></div>
<div class="ttc" id="atun_8c_html_a4752aab14c79cbf33afc053aa6a28713"><div class="ttname"><a href="tun_8c.html#a4752aab14c79cbf33afc053aa6a28713">tun_finalize</a></div><div class="ttdeci">int tun_finalize(HANDLE h, struct overlapped_io *io, struct buffer *buf)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l03563">tun.c:3563</a></div></div>
<div class="ttc" id="astructopenvpn__iphdr_html"><div class="ttname"><a href="structopenvpn__iphdr.html">openvpn_iphdr</a></div><div class="ttdef"><b>Definition:</b> <a href="proto_8h_source.html#l00106">proto.h:106</a></div></div>
<div class="ttc" id="atun_8c_html_a8973fb27cde0e97c9b1f62669f7030b0"><div class="ttname"><a href="tun_8c.html#a8973fb27cde0e97c9b1f62669f7030b0">dhcp_release_by_adapter_index</a></div><div class="ttdeci">bool dhcp_release_by_adapter_index(const DWORD adapter_index)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05126">tun.c:5126</a></div></div>
<div class="ttc" id="astructuser__pass_html"><div class="ttname"><a href="structuser__pass.html">user_pass</a></div><div class="ttdef"><b>Definition:</b> <a href="misc_8h_source.html#l00063">misc.h:63</a></div></div>
<div class="ttc" id="atun_8h_html_a85a39082c97534bda4e02e0ed0bfd841"><div class="ttname"><a href="tun_8h.html#a85a39082c97534bda4e02e0ed0bfd841">IPW32_SET_MANUAL</a></div><div class="ttdeci">#define IPW32_SET_MANUAL</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00066">tun.h:66</a></div></div>
<div class="ttc" id="astructroute__ipv4_html_ab38b0a2ab01c05b74c40c32b9b486e96"><div class="ttname"><a href="structroute__ipv4.html#ab38b0a2ab01c05b74c40c32b9b486e96">route_ipv4::network</a></div><div class="ttdeci">in_addr_t network</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00119">route.h:119</a></div></div>
<div class="ttc" id="awin32_8c_html_a427612d1943aca2700313306c34c9ee3"><div class="ttname"><a href="win32_8c.html#a427612d1943aca2700313306c34c9ee3">win32_version_info</a></div><div class="ttdeci">int win32_version_info(void)</div><div class="ttdef"><b>Definition:</b> <a href="win32_8c_source.html#l01407">win32.c:1407</a></div></div>
<div class="ttc" id="abuffer_8c_html_aa6bae12914d41c7aecaa7b64fea1bc51"><div class="ttname"><a href="buffer_8c.html#aa6bae12914d41c7aecaa7b64fea1bc51">alloc_buf</a></div><div class="ttdeci">struct buffer alloc_buf(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00064">buffer.c:64</a></div></div>
<div class="ttc" id="astructtuntap_html_afd4a0397ced0c1118162c669228dfc58"><div class="ttname"><a href="structtuntap.html#afd4a0397ced0c1118162c669228dfc58">tuntap::persistent_if</a></div><div class="ttdeci">bool persistent_if</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00161">tun.h:161</a></div></div>
<div class="ttc" id="amemdbg_8h_html"><div class="ttname"><a href="memdbg_8h.html">memdbg.h</a></div></div>
<div class="ttc" id="aproto_8h_html_a44def7b94effffa8c13220d78b841d68"><div class="ttname"><a href="proto_8h.html#a44def7b94effffa8c13220d78b841d68">DEV_TYPE_UNDEF</a></div><div class="ttdeci">#define DEV_TYPE_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="proto_8h_source.html#l00035">proto.h:35</a></div></div>
<div class="ttc" id="atun_8c_html_a11011674316342ddaaad3f76739d78e3"><div class="ttname"><a href="tun_8c.html#a11011674316342ddaaad3f76739d78e3">do_address_service</a></div><div class="ttdeci">static bool do_address_service(const bool add, const short family, const struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00091">tun.c:91</a></div></div>
<div class="ttc" id="awin32_8h_html_a5d6accbac4ed5455a785b9d509e9f593"><div class="ttname"><a href="win32_8h.html#a5d6accbac4ed5455a785b9d509e9f593">IOSTATE_INITIAL</a></div><div class="ttdeci">#define IOSTATE_INITIAL</div><div class="ttdef"><b>Definition:</b> <a href="win32_8h_source.html#l00199">win32.h:199</a></div></div>
<div class="ttc" id="atun_8c_html_a1394acf0970ce11c08bba13dee682131"><div class="ttname"><a href="tun_8c.html#a1394acf0970ce11c08bba13dee682131">netsh_get_id</a></div><div class="ttdeci">static const char * netsh_get_id(const char *dev_node, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05654">tun.c:5654</a></div></div>
<div class="ttc" id="anamespacehttp-client_html_aadb490246e2a9943d5fe72016ff60d19"><div class="ttname"><a href="namespacehttp-client.html#aadb490246e2a9943d5fe72016ff60d19">http-client.f</a></div><div class="ttdeci">string f</div><div class="ttdef"><b>Definition:</b> <a href="http-client_8py_source.html#l00006">http-client.py:6</a></div></div>
<div class="ttc" id="abuffer_8c_html_a3307f08331b1ce42168bafd2ecf7874a"><div class="ttname"><a href="buffer_8c.html#a3307f08331b1ce42168bafd2ecf7874a">buf_printf</a></div><div class="ttdeci">bool buf_printf(struct buffer *buf, const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00245">buffer.c:245</a></div></div>
<div class="ttc" id="astructdhcp_html"><div class="ttname"><a href="structdhcp.html">dhcp</a></div><div class="ttdef"><b>Definition:</b> <a href="dhcp_8h_source.html#l00053">dhcp.h:53</a></div></div>
<div class="ttc" id="astructtuntap_html_a8fcc61d0d87cd8df310942042be86f23"><div class="ttname"><a href="structtuntap.html#a8fcc61d0d87cd8df310942042be86f23">tuntap::topology</a></div><div class="ttdeci">int topology</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00156">tun.h:156</a></div></div>
<div class="ttc" id="astructoverlapped__io_html_a409152b5e8b53ea2b0d09dd7a9588334"><div class="ttname"><a href="structoverlapped__io.html#a409152b5e8b53ea2b0d09dd7a9588334">overlapped_io::size</a></div><div class="ttdeci">DWORD size</div><div class="ttdef"><b>Definition:</b> <a href="win32_8h_source.html#l00204">win32.h:204</a></div></div>
<div class="ttc" id="astructoverlapped__io_html"><div class="ttname"><a href="structoverlapped__io.html">overlapped_io</a></div><div class="ttdef"><b>Definition:</b> <a href="win32_8h_source.html#l00198">win32.h:198</a></div></div>
<div class="ttc" id="atun_8c_html_a732f35a455d3cc46d0dd3d6b94239b87"><div class="ttname"><a href="tun_8c.html#a732f35a455d3cc46d0dd3d6b94239b87">NI_OPTIONS</a></div><div class="ttdeci">#define NI_OPTIONS</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00068">tun.c:68</a></div></div>
<div class="ttc" id="atun_8h_html_a737f411b0d45e255f39036f37f29f332"><div class="ttname"><a href="tun_8h.html#a737f411b0d45e255f39036f37f29f332">WINTUN_COMPONENT_ID</a></div><div class="ttdeci">#define WINTUN_COMPONENT_ID</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00045">tun.h:45</a></div></div>
<div class="ttc" id="atun_8c_html_a6b6ba16d1a1057d8d4e4e34021b78fd6"><div class="ttname"><a href="tun_8c.html#a6b6ba16d1a1057d8d4e4e34021b78fd6">tuntap_set_ip_addr</a></div><div class="ttdeci">static void tuntap_set_ip_addr(struct tuntap *tt, const char *device_guid, bool dhcp_masq_post)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06111">tun.c:6111</a></div></div>
<div class="ttc" id="aopenvpn_2basic_8h_html_a94fd7e422c6111004392c9a1bd7242c9"><div class="ttname"><a href="openvpn_2basic_8h.html#a94fd7e422c6111004392c9a1bd7242c9">BOOL_CAST</a></div><div class="ttdeci">#define BOOL_CAST(x)</div><div class="ttdef"><b>Definition:</b> <a href="openvpn_2basic_8h_source.html#l00027">basic.h:27</a></div></div>
<div class="ttc" id="aconfig-msvc_8h_html_a9a941819355e6f658991890ff66b4b0e"><div class="ttname"><a href="config-msvc_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a></div><div class="ttdeci">unsigned __int8 uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="config-msvc_8h_source.html#l00164">config-msvc.h:164</a></div></div>
<div class="ttc" id="astructtuntap_html_aef16e632255ef67a01b83d02c5c720e8"><div class="ttname"><a href="structtuntap.html#aef16e632255ef67a01b83d02c5c720e8">tuntap::ipapi_context_defined</a></div><div class="ttdeci">bool ipapi_context_defined</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00186">tun.h:186</a></div></div>
<div class="ttc" id="atun_8c_html_a7ef34c7c71984540f3b6122fcc743f5a"><div class="ttname"><a href="tun_8c.html#a7ef34c7c71984540f3b6122fcc743f5a">register_dns_service</a></div><div class="ttdeci">static void register_dns_service(const struct tuntap *tt)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l05939">tun.c:5939</a></div></div>
<div class="ttc" id="awin32_8h_html_a796aff3281e7e20d2e63b0daeb050d82"><div class="ttname"><a href="win32_8h.html#a796aff3281e7e20d2e63b0daeb050d82">IOSTATE_QUEUED</a></div><div class="ttdeci">#define IOSTATE_QUEUED</div><div class="ttdef"><b>Definition:</b> <a href="win32_8h_source.html#l00200">win32.h:200</a></div></div>
<div class="ttc" id="atun_8h_html_afdac6b3217749dccb863f9dc39818b9d"><div class="ttname"><a href="tun_8h.html#afdac6b3217749dccb863f9dc39818b9d">write_tun</a></div><div class="ttdeci">int write_tun(struct tuntap *tt, uint8_t *buf, int len)</div></div>
<div class="ttc" id="asocket_8h_html_a34e86fc38f89673b7f0c8a48d96b7d6a"><div class="ttname"><a href="socket_8h.html#a34e86fc38f89673b7f0c8a48d96b7d6a">GETADDR_FATAL</a></div><div class="ttdeci">#define GETADDR_FATAL</div><div class="ttdef"><b>Definition:</b> <a href="socket_8h_source.html#l00524">socket.h:524</a></div></div>
<div class="ttc" id="astructtuntap__options_html_a238bfd6672b50c43d1188249b9f65562"><div class="ttname"><a href="structtuntap__options.html#a238bfd6672b50c43d1188249b9f65562">tuntap_options::ntp</a></div><div class="ttdeci">in_addr_t ntp[N_DHCP_ADDR]</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00107">tun.h:107</a></div></div>
<div class="ttc" id="astructtuntap_html_a4a42bdeae414d636860da3fb1c68b800"><div class="ttname"><a href="structtuntap.html#a4a42bdeae414d636860da3fb1c68b800">tuntap::standby_iter</a></div><div class="ttdeci">int standby_iter</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00196">tun.h:196</a></div></div>
<div class="ttc" id="aopenvpn-msg_8h_html_a78b97fef55da786a15a849fd9d7e557cae91a7a3ce0ed4601fe02aeab29d1bb98"><div class="ttname"><a href="openvpn-msg_8h.html#a78b97fef55da786a15a849fd9d7e557cae91a7a3ce0ed4601fe02aeab29d1bb98">msg_flush_neighbors</a></div><div class="ttdeci">@ msg_flush_neighbors</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00037">openvpn-msg.h:37</a></div></div>
<div class="ttc" id="atun_8c_html_a75196eb8783f698f029065cdc793e302"><div class="ttname"><a href="tun_8c.html#a75196eb8783f698f029065cdc793e302">dhcp_masq_addr</a></div><div class="ttdeci">static uint32_t dhcp_masq_addr(const in_addr_t local, const in_addr_t netmask, const int offset)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l06027">tun.c:6027</a></div></div>
<div class="ttc" id="astructdns__cfg__message__t_html_a6051eadfd2ad0eb640992f2f740ba000"><div class="ttname"><a href="structdns__cfg__message__t.html#a6051eadfd2ad0eb640992f2f740ba000">dns_cfg_message_t::header</a></div><div class="ttdeci">message_header_t header</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00081">openvpn-msg.h:81</a></div></div>
<div class="ttc" id="atun_8c_html_a167ef5d50e4284066beb05f5466bd858"><div class="ttname"><a href="tun_8c.html#a167ef5d50e4284066beb05f5466bd858">dev_type_enum</a></div><div class="ttdeci">int dev_type_enum(const char *dev, const char *dev_type)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l00364">tun.c:364</a></div></div>
<div class="ttc" id="astructtuntap_html_a55841b7764fd4d6945e38c8d7594c7b5"><div class="ttname"><a href="structtuntap.html#a55841b7764fd4d6945e38c8d7594c7b5">tuntap::wintun_receive_ring_handle</a></div><div class="ttdeci">HANDLE wintun_receive_ring_handle</div><div class="ttdef"><b>Definition:</b> <a href="tun_8h_source.html#l00199">tun.h:199</a></div></div>
<div class="ttc" id="atun_8c_html_a549a2ea6b968762682a1ef92d8de628f"><div class="ttname"><a href="tun_8c.html#a549a2ea6b968762682a1ef92d8de628f">show_adapter</a></div><div class="ttdeci">static void show_adapter(int msglev, const IP_ADAPTER_INFO *a, struct gc_arena *gc)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l04942">tun.c:4942</a></div></div>
<div class="ttc" id="astructmanagement_html_a2c35df935673267d011c9112a05e45d2"><div class="ttname"><a href="structmanagement.html#a2c35df935673267d011c9112a05e45d2">management::connection</a></div><div class="ttdeci">struct man_connection connection</div><div class="ttdef"><b>Definition:</b> <a href="manage_8h_source.html#l00326">manage.h:326</a></div></div>
<div class="ttc" id="astructaddress__message__t_html_a74e8c53521f06bc50b352b4088fe7c25"><div class="ttname"><a href="structaddress__message__t.html#a74e8c53521f06bc50b352b4088fe7c25">address_message_t::family</a></div><div class="ttdeci">short family</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00064">openvpn-msg.h:64</a></div></div>
<div class="ttc" id="astructroute__ipv4_html_aefec4e9a3022ad0d5e6f8c68905d2ad7"><div class="ttname"><a href="structroute__ipv4.html#aefec4e9a3022ad0d5e6f8c68905d2ad7">route_ipv4::flags</a></div><div class="ttdeci">unsigned int flags</div><div class="ttdef"><b>Definition:</b> <a href="route_8h_source.html#l00117">route.h:117</a></div></div>
<div class="ttc" id="atun_8c_html_a8452b544a2f27a1d2cb0518b3c091c04"><div class="ttname"><a href="tun_8c.html#a8452b544a2f27a1d2cb0518b3c091c04">tun_write_queue</a></div><div class="ttdeci">int tun_write_queue(struct tuntap *tt, struct buffer *buf)</div><div class="ttdef"><b>Definition:</b> <a href="tun_8c_source.html#l03500">tun.c:3500</a></div></div>
<div class="ttc" id="astructbuffer_html_a5d2300c691699fd563f7a1a280c2c2d6"><div class="ttname"><a href="structbuffer.html#a5d2300c691699fd563f7a1a280c2c2d6">buffer::data</a></div><div class="ttdeci">uint8_t * data</div><div class="ttdoc">Pointer to the allocated memory.</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00068">buffer.h:68</a></div></div>
<div class="ttc" id="astructdns__cfg__message__t_html_aa12d8df6fd5b2ac1fdacaaa4853c2381"><div class="ttname"><a href="structdns__cfg__message__t.html#aa12d8df6fd5b2ac1fdacaaa4853c2381">dns_cfg_message_t::addr</a></div><div class="ttdeci">inet_address_t addr[4]</div><div class="ttdef"><b>Definition:</b> <a href="openvpn-msg_8h_source.html#l00086">openvpn-msg.h:86</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
